# ðŸ§¹ CampoTech Cleanup Audit â€” 2026-02-12

## Executive Summary
- **Total git-tracked files:** 1,913
- **Total code files:** 1,518
- **Total LOC (TypeScript):** ~439,000
- **Disk space reclaimed (Phase 0):** 2,441 MB (.next cache deleted)

---

## Phase 0: Disk Bloat âœ… COMPLETED

| Item | Size | Action Taken |
|------|------|-------------|
| `.next` build cache | 2,441 MB | âœ… **Deleted** â€” reclaimed 2.4 GB |
| Python `venv` | 63 MB | â¸ï¸ Left in place (needed for AI service) |
| `admin/node_modules` | 0 MB | âœ… pnpm symlinks, healthy |
| `mobile/node_modules` | 0 MB | âœ… pnpm symlinks, healthy |
| `developer-portal/node_modules` | 34.4 MB | âœ… Acceptable |
| `web/node_modules` | 38.7 MB | âœ… Acceptable |

---

## Phase 1: Codebase Census (Baseline)

| Area | Files | LOC | % of Total |
|------|------:|----:|:----------:|
| API Routes (`apps/web/app/api/`) | 337 | 50,458 | 10.5% |
| Dashboard Pages (`apps/web/app/dashboard/`) | 141 | 55,008 | 11.5% |
| All App Routes (total) | 509 | 113,604 | 23.7% |
| Web Libraries (`apps/web/lib/`) | 233 | 99,317 | 20.7% |
| Web Components (`apps/web/components/`) | 128 | 42,710 | 8.9% |
| Web Scripts | 29 | 6,889 | 1.4% |
| Web Tests | 20 | 7,333 | 1.5% |
| Mobile App | 126 | 31,885 | 6.7% |
| Admin App | 53 | 12,116 | 2.5% |
| Consumer Mobile | 18 | 3,820 | 0.8% |
| Developer Portal | 12 | 1,896 | 0.4% |
| **Shared Modules (`src/`)** | **292** | **106,022** | **22.1%** |
| AI Service | 26 | 3,739 | 0.8% |
| Shared Packages | 4 | 1,440 | 0.3% |

### Flags
- ðŸ”´ `src/` shared modules = 106K LOC (22% of codebase) â€” needs Phase 4 audit
- ðŸ”¶ 337 API routes = 50K LOC â€” needs dead route analysis
- ðŸ”¶ `lib/` = 99K LOC in 233 files (avg 426 LOC/file) â€” potential giant files
- âš ï¸ Only 20 test files for ~480K LOC codebase

---

## Phase 2: Dead API Route Detection

**Method:** For each of 337 `route.ts` files, searched for the URL path in all non-API TypeScript files. Routes with no references were then verified via secondary segment-level search to catch dynamic string construction (e.g., `` `/api/jobs/${id}/status` ``).

### Summary

| Category | Count | LOC (est.) | Status |
|----------|------:|:----------:|--------|
| **Total API routes** | 337 | 50,458 | â€” |
| Routes WITH frontend refs | 175 | ~28K | âœ… Active |
| Routes WITHOUT refs (raw) | 162 | ~22K | âš ï¸ Investigated below |

### Breakdown of 162 No-Ref Routes

| Category | Count | Likely Status |
|----------|------:|--------------|
| Webhook endpoints (`/webhooks/*`) | 2 | âœ… EXTERNAL â€” called by MercadoPago, WhatsApp, Resend |
| Cron jobs (`/cron/*`) | 10 | âœ… EXTERNAL â€” called by Vercel Cron |
| Admin routes (`/admin/*`) | 24 | âœ… EXPECTED â€” called from `apps/admin` or admin UI |
| Mobile sync (`/sync/*`) | 5 | âœ… EXPECTED â€” called from `apps/mobile` |
| V1 public API (`/v1/*`) | 7 | âœ… EXPECTED â€” called from mobile SDK / external consumers |
| **Suspicious (remaining)** | **114** | âš ï¸ **Investigated below** |

### Secondary Verification of 114 Suspicious Routes

After deeper segment-level search, many of the 114 were found to be called via dynamic URL construction. Here are the routes confirmed as **LIKELY DEAD** (no reference found anywhere):

#### ðŸ”´ HIGH CONFIDENCE DEAD â€” Dev/Debug Routes âœ… RESOLVED 2026-02-13

| Route | LOC | Resolution |
|-------|----:|-----------|
| ~~`api/auth/debug/route.ts`~~ | 39 | âœ… **DELETED** â€” Security risk, leaked secrets |
| ~~`api/dev/cleanup-inflation-seeds/route.ts`~~ | 131 | âœ… **DELETED** â€” One-time dev script |
| ~~`api/dev/scrape-indec-unified/route.ts`~~ | 61 | âœ… **DELETED** â€” Superseded by cron job |
| ~~`api/dev/scrape-indec/route.ts`~~ | 101 | âœ… **DELETED** â€” Superseded by unified scraper |
| ~~`api/dev/seed-admin/route.ts`~~ | 129 | âœ… **DELETED** â€” Superseded by Prisma seed |
| ~~`api/dev/seed-inflation/route.ts`~~ | 105 | âœ… **DELETED** â€” Superseded by Prisma seed |
| ~~`api/monitoring/tunnel/route.ts`~~ | 79 | âœ… **DELETED** â€” @sentry/nextjs v8 auto-generates tunnel route from `tunnelRoute` config |
| `api/routes/route.ts` | 177 | âœ… **COMPLETED** â€” Active feature! Multi-stop navigation with full E2E: service â†’ API â†’ mobile UI â†’ dashboard dispatch widget |
| **Subtotal reclaimed** | **~645** | 7 files deleted, 1 feature completed |

#### ðŸŸ¡ MEDIUM CONFIDENCE DEAD â€” Feature Routes with No Consumer (29 total)

> **Verified 2026-02-13.** Each route was read end-to-end and searched for consumers across all apps. None of these routes are called by any frontend, mobile app, admin panel, cron, or webhook â€” except `dispatch/recommend` which is kept.
>
> **Legend:** â³ = Pending review Â· âœ… = Decision made Â· âš ï¸ Stub = Returns fake/hardcoded data with no real logic

---

##### 1ï¸âƒ£ AFIP â€” Tax Billing (1 route, 267 LOC)

| # | Route | LOC | What It Does | Stub? | Status |
|---|-------|----:|-------------|:-----:|:------:|
| 1 | `api/afip/queue/route.ts` | 267 | **Invoice queue manager.** Lets you see which tax invoices are waiting to be sent to AFIP, add new ones to the queue, or cancel a pending one. Like a to-do list for tax billing. | No â€” real DB queries | â³ |

---

##### 2ï¸âƒ£ AI â€” Chatbot Operations (3 routes, 229 LOC)

| # | Route | LOC | What It Does | Stub? | Status |
|---|-------|----:|-------------|:-----:|:------:|
| 2 | `api/ai/escalations/route.ts` | 132 | **Help-ticket system.** When the AI chatbot can't answer a customer, it creates a ticket for a human. This lets you see those tickets, assign them to staff, or mark them resolved. | No â€” calls OpenAI fallback handler | â³ |
| 3 | `api/ai/status/route.ts` | 48 | **Health check.** Shows if the AI system is working, running out of budget, or struggling. Like a dashboard warning light. | No â€” calls real status function | â³ |
| 4 | `api/ai/usage/route.ts` | 49 | **Usage meter.** Shows how much AI you've used today/this month and how much budget is left. Like the data usage screen on a phone plan. | No â€” calls real tracker | â³ |

---

##### 3ï¸âƒ£ Analytics â€” Business Intelligence (3 routes, 523 LOC) âš ï¸ ALL STUBS

| # | Route | LOC | What It Does | Stub? | Status |
|---|-------|----:|-------------|:-----:|:------:|
| 5 | `api/analytics/etl/route.ts` | 117 | **Data processing trigger.** A button to crunch raw data into reports. Returns "stub implementation" â€” **does nothing real**, just returns fake "success". | âš ï¸ **100% stub** | â³ |
| 6 | `api/analytics/infrastructure/route.ts` | 154 | **Analytics job monitor.** Shows status of background data jobs (daily revenue, weekly KPIs). Returns hardcoded placeholder data â€” **does nothing real**. | âš ï¸ **100% stub** | â³ |
| 7 | `api/analytics/kpis/route.ts` | 252 | **Business metrics.** Returns KPIs like revenue, customer count, satisfaction. Despite being 252 lines, **returns placeholder numbers**, no real database queries. | âš ï¸ **100% stub** | â³ |

---

##### 4ï¸âƒ£ Dispatch & Copilot â€” Technician Assignment (3 routes, 1,289 LOC)

| # | Route | LOC | What It Does | Stub? | Status |
|---|-------|----:|-------------|:-----:|:------:|
| 8 | `api/copilot/availability/route.ts` | 150 | **Schedule checker.** Looks at a specific date and shows which technicians have open 2-hour slots (9amâ€“6pm) by checking their existing jobs. Recommends the first free slot. | No â€” real DB queries | â³ |
| 9 | `api/dispatch/availability/route.ts` | 401 | **Real-time tech locations & availability.** Shows each tech's GPS position, distance to a job site, current status (available/driving/working/offline), and performance stats. A beefier version of #8. | No â€” real DB + Haversine math | â³ |
| 10 | `api/dispatch/recommend/route.ts` | 738 | âœ… **Smart assignment engine.** Scores every available technician based on: real Google Maps drive time with traffic, skills match, current workload, and past performance â€” then ranks them best to worst. **Phase 2.4 upgraded with Distance Matrix API.** | No â€” production-grade | âœ… **KEEP** |

---

##### 5ï¸âƒ£ MercadoPago â€” Payments (3 routes, 308 LOC)

| # | Route | LOC | What It Does | Stub? | Status |
|---|-------|----:|-------------|:-----:|:------:|
| 11 | `api/mercadopago/fallbacks/route.ts` | 104 | **Failed payment recovery.** When a MercadoPago payment fails, this tracks which payments need to be collected another way (cash, transfer) and lets you mark them resolved. | No â€” calls MP client | â³ |
| 12 | `api/mercadopago/instructions/route.ts` | 86 | **Payment instructions generator.** Creates step-by-step instructions for customers on how to pay (bank transfer, cash, card). Can format them for WhatsApp, email, or plain text. | No â€” calls MP client | â³ |
| 13 | `api/mercadopago/status/route.ts` | 118 | **MP health monitor.** Shows if MercadoPago is working â€” is the token valid? When was the last payment? Lets admins reset the connection if it breaks. | No â€” calls circuit breaker | â³ |

---

##### 6ï¸âƒ£ Public Profile â€” Marketplace (1 route, 131 LOC)

| # | Route | LOC | What It Does | Stub? | Status |
|---|-------|----:|-------------|:-----:|:------:|
| 14 | `api/public-profile/[slug]/route.ts` | 131 | **Public business listing (no login needed).** Shows a company's name, logo, services, ratings, verification badges, and recent reviews. Like a Yelp/Google Business listing for field service companies. | No â€” real DB queries | â³ |

---

##### 7ï¸âƒ£ Pricebook & Settings (2 routes, 354 LOC)

| # | Route | LOC | What It Does | Stub? | Status |
|---|-------|----:|-------------|:-----:|:------:|
| 15 | `api/pricebook/relations/route.ts` | 221 | **Related items linker.** Lets you connect related price items (e.g., "if you buy Service A, suggest Part B"). Create, list, and delete links between pricebook items. | No â€” real DB (PriceItemRelation) | â³ |
| 16 | `api/settings/languages/route.ts` | 133 | **Language settings.** Lets the owner turn AI translation on/off and set which languages the team speaks. Always keeps Spanish included. | No â€” real DB queries | â³ |

---

##### 8ï¸âƒ£ Notifications (2 routes, 208 LOC) âš ï¸ ALL PLACEHOLDERS

| # | Route | LOC | What It Does | Stub? | Status |
|---|-------|----:|-------------|:-----:|:------:|
| 17 | `api/notifications/defaults/route.ts` | 136 | **Notification preferences.** Returns default notification settings for Argentine businesses (WhatsApp on, SMS off, quiet hours 10pmâ€“8am). Response literally says "not yet implemented". | âš ï¸ **Placeholder** | â³ |
| 18 | `api/notifications/history/route.ts` | 72 | **Notification inbox.** Should show past notifications. Always returns an empty list and says "NotificationLogs model not yet implemented". | âš ï¸ **Placeholder** | â³ |

---

##### 9ï¸âƒ£ Inventory â€” Stock Management (4 routes, 875 LOC)

| # | Route | LOC | What It Does | Stub? | Status |
|---|-------|----:|-------------|:-----:|:------:|
| 19 | `api/inventory/generate-sku/route.ts` | 188 | **Product code generator.** Creates unique SKU codes for inventory items from their name, brand, and category (e.g., "EQP-BOT-TER-0001"). Handles collisions. | No â€” real DB queries | â³ |
| 20 | `api/inventory/reports/low-stock/route.ts` | 218 | **Low stock alerts.** Shows which products are running low and need restocking, sorted by urgency (critical vs. warning). | No â€” real DB queries | â³ |
| 21 | `api/inventory/reports/movements/route.ts` | 245 | **Stock movement report.** Shows inventory going in and out â€” what was received, what was used on jobs â€” grouped by day, product, or warehouse. | No â€” real DB queries | â³ |
| 22 | `api/inventory/reports/valuation/route.ts` | 224 | **Inventory value report.** Calculates total cost value, retail value, and profit margin of all stock. Includes ABC analysis (which 20% of products hold 80% of the value). | No â€” real DB queries | â³ |

---

##### ðŸ”Ÿ Subscription â€” Billing (2 routes, 322 LOC)

| # | Route | LOC | What It Does | Stub? | Status |
|---|-------|----:|-------------|:-----:|:------:|
| 23 | `api/subscription/change-plan/route.ts` | 161 | **Plan upgrade/downgrade.** Lets the owner switch tiers (Free â†’ Inicial â†’ Profesional â†’ Empresa). Generates a MercadoPago checkout link for paid plans. Logs an audit trail. | No â€” calls subscriptionManager | â³ |
| 24 | `api/subscription/promotions/route.ts` | 161 | **Public pricing & promotions (no login needed).** Returns all plan prices with any active discounts applied (e.g., "first month free", "20% off annual"). Would power a public pricing page. | No â€” real DB (GlobalDiscount) | â³ |

---

##### 1ï¸âƒ£1ï¸âƒ£ WhatsApp â€” Messaging (5 routes, 991 LOC)

| # | Route | LOC | What It Does | Stub? | Status |
|---|-------|----:|-------------|:-----:|:------:|
| 25 | `api/whatsapp/interactive/route.ts` | 253 | **Button/list messages.** Sends WhatsApp messages with clickable buttons ("Confirm / Cancel") or dropdown lists ("Choose a service type"). Saves the message and updates the conversation. | No â€” calls WA Cloud API | â³ |
| 26 | `api/whatsapp/media/route.ts` | 133 | **File handler.** Uploads and downloads images, documents, and audio for WhatsApp conversations. Like an attachment manager for WA chats. | No â€” calls WA Cloud API | â³ |
| 27 | `api/whatsapp/queue/route.ts` | 190 | **Send queue.** Shows how many messages are waiting to be sent, the send rate, and lets you cancel a pending message or check if you've hit the rate limit. | No â€” calls queue functions | â³ |
| 28 | `api/whatsapp/status/route.ts` | 129 | **Health monitor.** Shows if WhatsApp is connected, the success rate, message speed, and queue health. Lets admins reset the connection or rate limiters. | No â€” calls circuit breaker | â³ |
| 29 | `api/whatsapp/webhook/route.ts` | 286 | **Incoming message receiver â€” DUPLICATE.** Receives messages from Meta when customers send WhatsApp messages. But the real one already lives at `/api/webhooks/whatsapp/` (which Meta actually calls). This is a copy at the wrong URL. | **Duplicate of `/api/webhooks/whatsapp/`** | â³ |

---

#### ðŸŸ¢ FALSE POSITIVES â€” Alive via Dynamic References

The following were initially flagged but confirmed alive via secondary segment search:

| Route Segment | Refs Found | Status |
|--------------|:----------:|--------|
| `otp/request` | 3 | âœ… Used by auth flow |
| `otp/verify` | 4 | âœ… Used by auth flow |
| `auth/refresh` | 4 | âœ… Token refresh |
| `auth/register` | 5 | âœ… Registration flow |
| `jobs/today` | 2 | âœ… Mobile daily view |
| `dashboard/stats` | 1 | âœ… Dashboard homepage |
| `dashboard/activity` | 1 | âœ… Activity feed |
| `customers/search` | 2 | âœ… Search component |
| `jobs/.*/status` | 4 | âœ… Job status updates |
| `jobs/.*/assign` | 4 | âœ… Job assignment |
| `jobs/.*/complete` | 6 | âœ… Job completion flow |
| `jobs/.*/start` | 1 | âœ… Job start flow |
| `jobs/.*/line-items` | 3 | âœ… Invoice line items |
| `voice-invoice` | 1 | âœ… Voice invoice feature |
| `payment-link` | 1 | âœ… Payment link generation |
| `confirmation-code` | 2 | âœ… Mutual confirmation system |
| `push-token` | 1 | âœ… Mobile push registration |
| `verify-badge` | 2 | âœ… Digital badge system |
| `exchange-rates` | 8 | âœ… Currency/inflation tracking |
| `change-requests` | 2 | âœ… Change request system |
| `whatsapp/stats` | 1 | âœ… WA dashboard |
| `whatsapp/usage` | 3 | âœ… WA usage tracking |
| `whatsapp/templates/send` | 1 | âœ… Template sending |
| `whatsapp/contacts` | 1 | âœ… Contact sync |
| `notifications/subscription` | 2 | âœ… Push subscription |
| `notifications/verification` | 2 | âœ… Notification verification |
| `inventory/stock/adjust` | 6 | âœ… Stock adjustments |
| `inventory/stock/count` | 3 | âœ… Stock counting |
| `payments/disputes` | 1 | âœ… Dispute handling |
| `pricebook/related` | 1 | âœ… Related items |

---

## Phase 2 Conclusion

| Finding | Value |
|---------|-------|
| Total API routes | 337 |
| Confirmed active | ~175 (direct) + ~50 (dynamic) + ~48 (webhook/cron/admin/sync/v1) = **~273** |
| High-confidence dead (dev/debug) | **~8 routes, ~645 LOC** |
| Medium-confidence dead (unconnected features) | **~29 routes, estimated ~4,000-5,000 LOC** |
| Needs human decision | ~27 routes |

### Recommended Actions

1. **Immediate (safe):** Delete the 8 `dev/` and `debug` routes â€” these are one-time scripts and should not exist alongside production code (~645 LOC)
2. **After review:** Audit the 29 medium-confidence dead routes â€” many appear to be features that were built but never connected to any UI
3. **Investigate:** The `whatsapp/webhook/route.ts` outside the `/webhooks/` path may be a duplicate of `/webhooks/whatsapp/route.ts`

---

## Phase 3: Orphaned Components & Libraries

**Method:** Scanned 332 files in `apps/web/components/`, `apps/web/lib/`, and `apps/web/hooks/` (excluding barrel `index.ts` files). For each file, searched for its filename across the entire codebase. Files with zero references were flagged, then secondary-verified via partial name/keyword search.

### Summary

| Metric | Count |
|--------|------:|
| Files scanned | 332 |
| Initial orphans found | 33 |
| False positives (barrel/dynamic) | 7 |
| Reclassified as dormant (keep) | 1 |
| **Confirmed dead files** | **25** |
| **Total dead LOC** | **~10,500** |

### ðŸŸ  Reclassified as DORMANT â€” Keep for Production

| File | LOC | Why it's not dead |
|------|----:|------------------|
| `lib/errors/error-logger.ts` | 508 | **This is the structured logging system.** It was fully built (categorizes errors, hides sensitive data like CUIT/DNI, connects to Sentry for monitoring, has severity levels) but no other file in the codebase actually uses it yet. Meanwhile, 645 places in production code use raw `console.log` instead. This file is not dead â€” it's the *solution* to the `console.log` problem. It should be wired up when the app approaches production. Sentry has a free tier (5K errors/month) that's more than enough for early-stage. Even without Sentry configured, the logger still works â€” it just outputs structured, color-coded, PII-safe logs to the console instead. |

### ðŸ”´ Confirmed Dead â€” Library Services (High Impact)

| File | LOC | What it is |
|------|----:|-----------|
| `lib/services/admin-recovery.ts` | 1,125 | Admin recovery flows â€” never imported |
| `lib/services/edge-cases.ts` | 1,081 | Edge case handlers â€” never imported |
| `lib/services/subscription-flows.ts` | 859 | Subscription lifecycle flows â€” never imported |
| `lib/services/error-handling.ts` | 819 | Error handling service â€” never imported |
| `lib/services/verification-renewal-flow.ts` | 780 | Verification renewal logic â€” never imported |
| `lib/services/onboarding-flow.ts` | 561 | Onboarding wizard logic â€” never imported |
| `lib/services/payment-audit-logger.ts` | 454 | Payment audit logging â€” never imported |
| `lib/scrapers/cacaav-scraper.ts` | 444 | CACAAV scraper â€” refs only in OTHER dead API routes |
| `lib/scrapers/ersep-scraper.ts` | 389 | ERSEP scraper â€” refs only in OTHER dead API routes |
| `lib/middleware/tier-enforcement.ts` | 400 | Subscription tier middleware â€” never imported |
| `lib/cron/number-inventory-crons.ts` | 367 | Number inventory cron logic â€” never imported |
| `lib/security/url-validator.ts` | 283 | URL validation â€” never imported |
| `lib/features/whatsapp-features.ts` | 244 | WhatsApp feature flags â€” never imported |
| `lib/services/currency-conversion.ts` | 201 | Currency conversion â€” never imported |
| `lib/services/ai-action-logger.ts` | 270 | AI action logging â€” never imported |
| `lib/guards/terminal-state.ts` | 191 | Terminal state guard â€” never imported |
| **Subtotal** | **~8,468** | |

### ðŸ”´ Confirmed Dead â€” UI Components

| File | LOC | What it is |
|------|----:|-----------|
| `components/schedule/CalendarDayModal.tsx` | 487 | Calendar day detail modal â€” never used |
| `components/inventory/JobMaterialUsagePanel.tsx` | 442 | Job material usage panel â€” never used |
| `components/jobs/CompletionForm.tsx` | 363 | Job completion form â€” never used |
| `components/jobs/NearestTechnicians.tsx` | 355 | Nearest tech map view â€” never used |
| `components/maps/ItineraryTimeline.tsx` | 325 | Itinerary timeline â€” never used |
| `components/maps/TechnicianPanel.tsx` | 313 | Technician map panel â€” never used |
| `components/OrgSwitcher.tsx` | 306 | Organization switcher â€” never used |
| `components/dashboard/ComplianceWidget.tsx` | 211 | Compliance dashboard widget â€” never used |
| `components/ui/MaintenanceBanner.tsx` | 196 | Maintenance mode banner â€” never used |
| `components/analytics/charts/LineChart.tsx` | 156 | Line chart component â€” never used |
| `components/analytics/charts/Sparkline.tsx` | 124 | Sparkline chart â€” never used |
| **Subtotal** | **~3,278** | |

### ðŸŸ¢ False Positives (Confirmed Alive)

| File | Refs | Why it looked dead |
|------|:----:|-------------------|
| `components/inventory/MaterialUsageForm.tsx` | 5 | Referenced via parent component |
| `lib/scrapers/cacaav-scraper.ts` | 8 | Referenced by admin API routes (which may be dead themselves) |
| `lib/scrapers/ersep-scraper.ts` | 5 | Referenced by admin API routes |
| `components/documents/DocumentVersionHistory.tsx` | 1 | Single dynamic import |
| `lib/hooks/useFieldPermissions.ts` | 3 | Used via hook pattern |
| `lib/hooks/useWhatsAppRealtime.ts` | 2 | Used in dashboard |
| `components/jobs/JobReportButton.tsx` | 4 | Referenced in job detail pages |

### Phase 3 Observations

1. **"Ghost services" cluster:** The largest dead files are in `lib/services/` â€” these appear to be elaborate service layers that were built speculatively but never wired into any route handler or component. The top 6 alone account for **4,625 LOC**.

2. **Dead component â†” dead route correlation:** Several orphaned components (e.g., `CalendarDayModal`, `NearestTechnicians`, `ItineraryTimeline`) correspond to dashboard features whose API routes were also flagged as dead in Phase 2. This suggests entire features that were designed but never fully integrated.

3. **Scraper dependency chain:** `cacaav-scraper.ts` and `ersep-scraper.ts` ARE referenced â€” but only by the Phase 2 dead admin routes (`admin/growth-engine/scrape/cacaav`, `admin/growth-engine/scrape/ersep`). If those routes are deleted, these scrapers become dead too.

---

## Metrics (Baseline + Phase 3)

| Metric | Value (2026-02-12) |
|--------|-------------------|
| Git-tracked files | 1,913 |
| Code files | 1,518 |
| Total LOC | ~439,000 |
| API routes | 337 |
| Dead API routes (high confidence) | ~8 |
| Dead API routes (medium confidence) | ~29 |
| Disk reclaimed | 2,441 MB |
| Orphaned files (confirmed dead) | 26 files, ~11,000 LOC |
| **Unused shared modules** | **181 files, ~79,926 LOC** |
| TODO/FIXME count | *Pending Phase 6* |
| console.log count | *Pending Phase 6* |
| eslint-disable count | *Pending Phase 6* |
| Giant files (>500 LOC) | *Pending Phase 5* |

---

## Phase 4: Unused Shared Modules (`src/`)

**Method:** For each of 292 TypeScript files in `src/`, searched for its filename across all files within `apps/`. Files with zero references were flagged. Referenced files were then checked for single-app vs multi-app usage to identify consolidation candidates.

### The Big Picture

| Status | Files | LOC | % of `src/` |
|--------|------:|----:|:-----------:|
| ðŸ”´ **Unused by ANY app** | **181** | **79,926** | **62%** |
| ðŸŸ¡ Used by single app only | 35 | ~15K | 12% |
| âœ… Truly shared (2+ apps) | 76 | ~11K | 26% |
| **Total** | **292** | **106,022** | **100%** |

> **Only 76 of 292 "shared" modules are actually shared.** The `src/` directory is 75% dead or misplaced code.

### Single-App Breakdown

| App | Files in `src/` only used by it | Recommendation |
|-----|------:|----------------|
| `web` | 33 | Move into `apps/web/lib/` |
| `mobile` | 1 | Move into `apps/mobile/` |
| `admin` | 0 | â€” |
| `consumer-mobile` | 1 (indirect) | â€” |

### ðŸ”´ Dead Module Clusters by Category

| Category | Files | Unused | Unused LOC | % Dead |
|----------|------:|-------:|-----------:|:------:|
| `src/modules/` | 110 | 69 | 31,466 | 63% |
| `src/analytics/` | 44 | 39 | 22,160 | **89%** |
| `src/integrations/` | 50 | 24 | 9,322 | 48% |
| `src/workers/` | 23 | 17 | 7,217 | **74%** |
| `src/lib/` | 28 | 11 | 4,845 | 39% |
| `src/shared/` | 14 | 9 | 2,456 | 64% |
| `src/auth/` | 8 | 7 | 1,761 | **88%** |
| `src/health/` | 8 | 5 | 699 | 62% |
| `src/services/` | 5 | 0 | 0 | âœ… 0% |
| `src/validation/` | 1 | 0 | 0 | âœ… 0% |
| `src/middleware/` | 1 | 0 | 0 | âœ… 0% |

### ðŸ”´ Largest Dead Subsystems

#### 1. Analytics Engine â€” 39 files, 22,160 LOC (89% dead)

An entire analytics platform was built with KPI calculators, prediction models, report exporters, geographic analytics, ETL pipelines, and a data warehouse layer. **Almost none of it is used by any app.**

Includes:
- `src/analytics/kpis/` â€” CLV, SLA, profitability, cash flow, ARPU, MRR calculators
- `src/analytics/predictions/` â€” Churn, demand, anomaly, revenue forecasters
- `src/analytics/reports/` â€” CSV, Excel, PDF exporters + report generator
- `src/analytics/infrastructure/` â€” ETL pipeline + data warehouse
- `src/analytics/locations/` â€” Geographic analytics, expansion analyzer

#### 2. Consumer Marketplace Module â€” ~24 files, ~12,000 LOC (100% dead)

A full consumer-facing marketplace module with discovery, quotes, reviews, fraud detection, service requests, and marketing/referral system. **None of it is used by any app.**

Includes:
- `src/modules/consumer/discovery/` â€” Geo search, ranking, service discovery
- `src/modules/consumer/quotes/` â€” Quote repository, routes, service
- `src/modules/consumer/reviews/` â€” Reviews + fraud detection (987 LOC)
- `src/modules/consumer/marketing/` â€” SEO pages, referral service
- `src/modules/consumer/auth/` â€” Consumer auth (separate from main auth)

#### 3. Inventory System Module â€” ~18 files, ~9,500 LOC (100% dead)

A complete inventory management system with stock tracking, FIFO calculations, purchase orders, vehicle stock, and replenishment logic. **None of it is used by any app.**

Includes:
- `src/modules/inventory/stock/` â€” FIFO, reorder points, reservations, movements
- `src/modules/inventory/purchasing/` â€” PO system, receiving, suppliers
- `src/modules/inventory/vehicle/` â€” Vehicle stock + replenishment
- `src/modules/inventory/products/` â€” Product repo, barcodes, categories

#### 4. Workers â€” 17 files, 7,217 LOC (74% dead)

Background workers for AFIP invoicing, notification dispatch, MercadoPago payments, and WhatsApp message processing. **Never wired to any job queue.**

#### 5. Integration Modules â€” 24 files, 9,322 LOC (48% dead)

WhatsApp templates, message dispatcher extensions, and integration handlers that aren't imported by any app.

### Phase 4 Observations

1. **"Aspirational architecture"** â€” The `src/` directory appears to be a vision for where the codebase was heading, not where it currently is. Entire subsystems (analytics engine, consumer marketplace, inventory management) were designed and coded but never integrated into any running application.

2. **The core IS healthy** â€” `src/services/` (5 files, 0% dead) is the actual shared core used by all apps. These are the essential entity services (jobs, customers, invoices, etc.) that the monorepo legitimately shares.

3. **Scale mismatch** â€” The dead `src/` code (~80K LOC) is MORE than the entire `apps/web` frontend code (~42K component LOC + ~55K dashboard LOC). The "shared" layer is larger than the actual product.

4. **Consolidation needed** â€” 33 `src/` files are only used by `apps/web`. These should be moved into `apps/web/lib/` to make the `src/` layer honestly represent shared logic.

### Recommended Actions

| Priority | Action | Impact |
|----------|--------|--------|
| ðŸ”´ **P0** | Archive `src/analytics/` (39 files, 22K LOC) â€” 89% unused | -22K LOC |
| ðŸ”´ **P0** | Archive `src/modules/consumer/` (24 files, ~12K LOC) â€” 100% unused | -12K LOC |
| ðŸ”´ **P0** | Archive `src/modules/inventory/` (18 files, ~9.5K LOC) â€” 100% unused | -9.5K LOC |
| ðŸ”¶ **P1** | Archive dead workers (17 files, 7.2K LOC) | -7.2K LOC |
| ðŸ”¶ **P1** | Archive dead integrations (24 files, 9.3K LOC) | -9.3K LOC |
| ðŸŸ¡ **P2** | Move 33 web-only `src/` files into `apps/web/lib/` | Architectural clarity |
| ðŸŸ¢ **P3** | Review remaining dead `src/auth/`, `src/shared/` modules | -4.2K LOC |

---

## Phase 5: Giant File Detection

**Method:** Scanned all git-tracked `.ts`/`.tsx` files and measured line counts. Files classified into size brackets per workflow thresholds.

### Summary

| Bracket | Classification | Files | Action |
|---------|---------------|------:|--------|
| < 300 LOC | âœ… Normal | 871 | No action |
| 300â€“499 LOC | âš ï¸ Large | 380 | Review for splitting |
| 500â€“999 LOC | ðŸ”¶ Very Large | 242 | Should be split |
| **1000+ LOC** | **ðŸ”´ Oversized** | **25** | **Must be split** |
| **Total >300** | | **647** | |

### ðŸ”´ Oversized Files (1000+ LOC) â€” Top 25

| LOC | File | Status | Notes |
|----:|------|:------:|-------|
| 2,209 | `dashboard/map/page.tsx` | LIVE | Map view â€” split map logic from UI |
| 2,105 | `components/jobs/EditJobModal.tsx` | LIVE | Massive form â€” extract sub-forms |
| 1,994 | `components/jobs/NewJobModal.tsx` | LIVE | Massive form â€” extract sub-forms |
| 1,673 | `mobile/jobs/complete.tsx` | LIVE | Mobile completion flow |
| 1,569 | `dashboard/settings/ai-assistant/page.tsx` | LIVE | AI settings page |
| 1,542 | `app/page.tsx` | LIVE | Landing page â€” extract sections |
| 1,488 | `dashboard/customers/page.tsx` | LIVE | Customer list page |
| 1,466 | `lib/email/verification-emails.ts` | LIVE | Email templates â€” extract per type |
| 1,441 | `dashboard/jobs/page.tsx` | LIVE | Jobs list page |
| 1,290 | `mobile/calendar/index.tsx` | LIVE | Mobile calendar |
| 1,263 | `mobile/team/index.tsx` | LIVE | Mobile team view |
| 1,253 | `dashboard/customers/NewCustomerModal.tsx` | LIVE | Customer form modal |
| 1,249 | `lib/reports/job-completion-report.ts` | LIVE | Report generator |
| 1,227 | `components/schedule/ScheduleConfigModal.tsx` | LIVE | Schedule config modal |
| 1,195 | `src/integrations/whatsapp/whatsapp.service.ts` | LIVE | Core WhatsApp service |
| 1,144 | `lib/integrations/whatsapp/providers/dialog360.provider.ts` | LIVE | Dialog360 provider |
| 1,142 | `lib/cron/verification-crons.ts` | LIVE | Verification cron jobs |
| **1,125** | **`lib/services/admin-recovery.ts`** | **ðŸ’€ DEAD** | **Already flagged in Phase 3** |
| 1,112 | `app/api/inventory/job-materials/route.ts` | LIVE | Giant API route |
| 1,108 | `components/team/TeamMemberModal.tsx` | LIVE | Team member form |
| **1,081** | **`lib/services/edge-cases.ts`** | **ðŸ’€ DEAD** | **Already flagged in Phase 3** |
| **1,056** | **`src/analytics/infrastructure/aggregation-jobs.ts`** | **ðŸ’€ DEAD** | **Already flagged in Phase 4** |
| 1,032 | `dashboard/verificacion/page.tsx` | LIVE | Verification page |
| 1,027 | `lib/services/whatsapp-ai-responder.ts` | LIVE | WA AI responder |
| 1,020 | `lib/email/subscription-emails.ts` | LIVE | Subscription email templates |

### Phase 5 Observations

1. **3 of the 25 oversized files are already dead** â€” `admin-recovery.ts` (1,125), `edge-cases.ts` (1,081), and `aggregation-jobs.ts` (1,056) were already flagged as unused in Phases 3-4. That's 3,262 LOC that will disappear with cleanup.

2. **Modals are the biggest offenders** â€” The top live files are all massive modal forms:
   - `EditJobModal.tsx` (2,105 LOC) + `NewJobModal.tsx` (1,994 LOC) = **4,099 LOC** of job forms
   - `NewCustomerModal.tsx` (1,253 LOC) + `ScheduleConfigModal.tsx` (1,227 LOC) + `TeamMemberModal.tsx` (1,108 LOC)
   - These could each be split into sub-form components (address section, contact section, scheduling section, etc.)

3. **Dashboard pages are oversized** â€” `map/page.tsx` (2,209), `customers/page.tsx` (1,488), `jobs/page.tsx` (1,441) all contain too much logic mixed with UI. Business logic should be extracted to hooks or services.

4. **Email templates are monoliths** â€” `verification-emails.ts` (1,466) and `subscription-emails.ts` (1,020) contain all email variants in single files. Should be split by email type.

5. **The landing page is 1,542 LOC** â€” `app/page.tsx` is the public homepage with all sections inline. Should extract `HeroSection`, `FeaturesSection`, `PricingSection`, etc. into separate components.

### Splitting Recommendations (Top 5 by Impact)

| File | Current LOC | Suggested Split | Target LOC Each |
|------|------------:|----------------|----------------:|
| `EditJobModal.tsx` | 2,105 | JobDetailsForm, SchedulingForm, PricingForm, AssignmentForm | ~400-500 |
| `NewJobModal.tsx` | 1,994 | Reuse sub-forms from EditJobModal | ~300-400 |
| `map/page.tsx` | 2,209 | MapCanvas, MapControls, TechnicianOverlay, JobOverlay | ~400-550 |
| `app/page.tsx` | 1,542 | HeroSection, FeaturesSection, PricingSection, TestimonialsSection, CTASection | ~250-300 |
| `verification-emails.ts` | 1,466 | One file per email type (welcome, verify, remind, etc.) | ~150-250 |

---

### Cumulative Metrics

| Metric | Value (2026-02-12) |
|--------|-------------------|
| Git-tracked files | 1,913 |
| Code files | 1,518 |
| Total LOC | ~439,000 |
| API routes | 337 |
| Dead API routes (high confidence) | ~8 |
| Dead API routes (medium confidence) | ~29 |
| Disk reclaimed | 2,441 MB |
| Orphaned files (confirmed dead) | 26 files, ~11,000 LOC |
| Unused shared modules | 181 files, ~79,926 LOC |
| **Giant files (>1000 LOC)** | **25 files (3 dead, 22 live)** |
| **Giant files (>300 LOC)** | **647 files** |
| TODO/FIXME count | *Pending Phase 6* |
| console.log count | *Pending Phase 6* |
| eslint-disable count | *Pending Phase 6* |

### Cumulative Dead Code Estimate

| Source | Files | LOC |
|--------|------:|----:|
| Dead API routes (Phase 2) | ~37 | ~5,600 |
| Orphaned libs/components (Phase 3) | 26 | ~11,000 |
| Unused shared modules (Phase 4) | 181 | ~79,926 |
| **Total identified so far** | **~244** | **~96,500** |

> Note: Phase 5 does not add new dead code â€” it identifies live files that should be refactored for maintainability.

---

## Phase 6: Stale Code Indicators

**Method:** Used `git grep` to count TODO/FIXME/HACK/XXX comments, `console.log` statements in production code, and `eslint-disable` directives across all tracked TypeScript files.

### Summary

| Indicator | Count | Severity |
|-----------|------:|:--------:|
| TODO/FIXME/HACK/XXX comments | **181** | ðŸŸ¡ |
| `console.log` in production code | **645** | ðŸ”¶ |
| `eslint-disable` directives | **132** | ðŸŸ¡ |

### TODO/FIXME Breakdown by Area

| Area | Count | Notes |
|------|------:|-------|
| `apps/web/lib/` | 72 | **Highest** â€” mostly unimplemented integrations |
| `src/` | 21 | Many in dead modules (will disappear with cleanup) |
| `apps/web/app/dashboard/` | 20 | Incomplete UI behaviors |
| `apps/web/app/api/` | 14 | Partial route implementations |
| `apps/web/components/` | 13 | Missing navigation/actions |
| `apps/admin/` | 8 | Admin panel gaps |
| `services/ai/` | 3 | Minor AI improvements |
| `apps/mobile/` | 2 | Minimal |

### Concerning TODO Patterns

Many TODOs represent **actually incomplete features**, not aspirational notes:

| Pattern | Count | Risk |
|---------|------:|------|
| `// TODO: Implement actual [X]` | ~15 | ðŸ”´ Stub functions returning fake data |
| `// TODO: Integrate with [service]` | ~12 | ðŸŸ¡ Missing email/push/AFIP integrations |
| `// TODO: Send [notification]` | ~8 | ðŸŸ¡ Silent failures â€” user expects notification |
| `// TODO: Implement [feature]` | ~7 | ðŸŸ¡ Incomplete features like badge flow, delete |
| `// TODO: Replace with real API call` | ~3 | ðŸ”´ Hardcoded mock data in production |

**Specific high-risk TODOs:**
- `lib/integrations/mercadopago/client.ts:227` â€” *"TODO: Implement signature verification"* (security risk)
- `lib/queue/processors.ts:412` â€” *"TODO: Implement actual AFIP integration"* (compliance risk)
- `dashboard/marketplace/profile/page.tsx:38` â€” *"TODO: Replace with real API call"* (fake data in prod)
- `lib/queue/workers.ts:594-649` â€” 6 consecutive TODOs in worker handlers (email, push, DB, HTTP, reports, archive)

### console.log Breakdown

| Area | Count | Priority |
|------|------:|:--------:|
| `apps/web/lib/` | 406 | ðŸ”¶ **Majority â€” needs structured logging** |
| `apps/web/app/api/` | 151 | ðŸ”¶ API routes should use logger service |
| `src/` | 73 | ðŸŸ¡ 47 are in dead code (auto-removed by cleanup) |
| `apps/web/components/` | 10 | ðŸŸ¢ Low priority |
| `apps/web/app/dashboard/` | 5 | ðŸŸ¢ Low priority |

> **406 console.logs in `lib/`** â€” These are the serverless function and service layer. They should use the logging service with proper severity levels, not `console.log`.

### eslint-disable Analysis

| Rule Disabled | Count | % |
|--------------|------:|----:|
| `@typescript-eslint/no-explicit-any` | **123** | **93%** |
| `@next/next/no-img-element` | 5 | 4% |
| `react-hooks/exhaustive-deps` | 2 | 2% |
| `@typescript-eslint/no-unused-vars` | 1 | <1% |

> **93% of eslint-disable directives are suppressing `any` types.** This indicates 123 places where TypeScript's type safety is bypassed. Many of these are likely in API route handlers where request bodies aren't properly typed.

### Phase 6 Observations

1. **The TODO story matches the dead code story** â€” Many TODOs like "Implement actual AFIP integration" and "Integrate with push service" correspond to the dead workers and modules found in Phase 4. The code was started but never finished.

2. **645 console.logs = no structured logging** â€” The codebase lacks a centralized logging strategy. Production code should use a logger with levels (debug, info, warn, error), not raw `console.log`. Ironically, the dead `error-logger.ts` (Phase 3) WAS supposed to be this solution.

3. **123 `any` suppressions = type debt** â€” Nearly all eslint-disables are `no-explicit-any`. This is a systematic issue, not isolated cases. A dedicated typing sprint could fix most of these.

### Recommended Actions

| Priority | Action | Impact |
|----------|--------|--------|
| ðŸ”´ **P0** | Fix 3 security/compliance TODOs (MP signature, AFIP, mock data) | Security |
| ðŸ”¶ **P1** | Replace `console.log` with structured logger in `lib/` (406 instances) | Observability |
| ðŸŸ¡ **P2** | Type the 123 `any` suppressions | Type safety |
| ðŸŸ¢ **P3** | Triage remaining 178 TODOs: close stale ones, ticket real ones | Hygiene |

---

### Updated Cumulative Metrics

| Metric | Value (2026-02-12) |
|--------|-------------------|
| Git-tracked files | 1,913 |
| Code files | 1,518 |
| Total LOC | ~439,000 |
| API routes | 337 |
| Dead API routes (high confidence) | ~8 |
| Dead API routes (medium confidence) | ~29 |
| Disk reclaimed | 2,441 MB |
| Orphaned files (confirmed dead) | 26 files, ~11,000 LOC |
| Unused shared modules | 181 files, ~79,926 LOC |
| Giant files (>1000 LOC) | 25 files (3 dead, 22 live) |
| Giant files (>300 LOC) | 647 files |
| **TODO/FIXME count** | **181** |
| **console.log count** | **645** |
| **eslint-disable count** | **132 (93% `any`)** |

---

## Phase 7: Duplicate & Near-Duplicate Detection

**Method:** Scanned for files with identical names in different directories, duplicate API routes (same resource in `/api/` and `/api/v1/`), and utility functions defined in multiple places.

### ðŸ”´ Duplicate API Routes (Same Resource, Two Paths)

These routes exist in BOTH `/api/` (used by the web dashboard) and `/api/v1/` (used by mobile app). This means two separate files handle the same resource â€” if you fix a bug in one, you have to remember to fix it in the other.

| Resource | Dashboard Route | Mobile Route | Risk |
|----------|---------------|-------------|------|
| Customers (list) | `/api/customers` | `/api/v1/customers` | ðŸ”´ Logic drift |
| Customers (detail) | `/api/customers/[id]` | `/api/v1/customers/[id]` | ðŸ”´ Logic drift |
| Jobs (list) | `/api/jobs` | `/api/v1/jobs` | ðŸ”´ Logic drift |
| Jobs (detail) | `/api/jobs/[id]` | `/api/v1/jobs/[id]` | ðŸ”´ Logic drift |
| Invoices (list) | `/api/invoices` | `/api/v1/invoices` | ðŸ”´ Logic drift |
| Invoices (detail) | `/api/invoices/[id]` | `/api/v1/invoices/[id]` | ðŸ”´ Logic drift |
| Vehicles (list) | `/api/vehicles` | `/api/v1/vehicles` | ðŸ”´ Logic drift |
| Vehicles (detail) | `/api/vehicles/[id]` | `/api/v1/vehicles/[id]` | ðŸ”´ Logic drift |

> **8 duplicate route pairs.** This is a maintenance risk â€” if business logic changes (e.g., adding a new field to a job), you need to update it in two places. The v1 routes should ideally call the same shared service layer, or the dashboard should also use v1.

### ðŸ”´ Duplicate Utility Functions

**`formatCurrency` â€” defined 3 times in 3 different places:**

| Location | What it does |
|----------|--------------|
| `apps/web/lib/utils.ts:19` | Formats ARS amounts for the web dashboard |
| `src/modules/localization/es-AR.ts:418` | Formats ARS amounts in the shared localization module |
| `src/shared/i18n/index.ts:108` | Formats amounts with configurable locale |

> Three copies of the same function â€” if you change how currency is displayed (e.g., adding the $ sign or changing decimal places), you'd need to update all three. Should be one canonical version.

### ðŸŸ¡ Duplicate Infrastructure Files

| Name | Copies | Locations | Risk |
|------|-------:|-----------|------|
| `logger` | **5** | `web/lib/logger.ts`, `web/lib/logging/logger.ts`, `web/lib/audit/logger.ts`, `src/lib/logger.ts`, `src/lib/logging/logger.ts` | ðŸ”´ Which logger is "the" logger? |
| `metrics` | **5** | `web/core/observability/`, `web/lib/queue/`, `core/observability/`, `src/lib/`, `src/lib/queue/` | ðŸ”¶ Confusing |
| `rate-limiter` | **4** | `web/lib/ai/`, `web/lib/integrations/afip/`, `web/lib/integrations/whatsapp/`, `src/lib/services/` | ðŸŸ¡ May be intentional (per-service) |
| `circuit-breaker` | **3** | `web/lib/integrations/afip/`, `web/lib/integrations/mercadopago/`, `web/lib/integrations/whatsapp/` | ðŸŸ¡ Likely intentional (per-service) |
| `notification.service` | **3** | `web/modules/notifications/`, `src/modules/consumer/notifications/`, `src/modules/notifications/` | ðŸ”¶ Two of these are in dead `src/` code |
| `payment-processor` | **2** | `web/lib/services/`, `web/lib/subscription/` | ðŸ”´ Two payment processors! |
| `whatsapp.service` | **2** | `src/integrations/whatsapp/`, `src/modules/consumer/notifications/` | ðŸŸ¡ Consumer one is dead code |
| `text.utils` | **2** | `web/lib/`, `src/shared/utils/` | ðŸ”¶ Same utils defined twice |
| `sms` | **2** | `web/lib/`, `src/lib/` | ðŸ”¶ Same SMS logic twice |
| `event-bus` | **2** | `web/lib/services/`, `src/lib/services/` | ðŸ”¶ Same event bus twice |

### Phase 7 Observations

1. **5 loggers is a mess.** There are 5 files named `logger` across the codebase (plus the `error-logger.ts` we reclassified as dormant in Phase 3). This explains why nobody uses the structured logger â€” it's not clear which one is the "official" one. Before production, pick ONE logger and delete the rest.

2. **8 duplicate API routes = maintenance landmine.** Right now, `/api/jobs` and `/api/v1/jobs` are separate files that each write their own database queries. If you fix a bug or add a field in one, you must remember to do the same in the other â€” or risk the mobile app and web dashboard showing different data.

3. **Many duplicates will vanish with Phase 4 cleanup.** A lot of the `src/` copies (notification.service, whatsapp.service, event-bus, sms) are in the dead shared modules. Once those are archived, the duplication drops significantly.

4. **`rate-limiter` and `circuit-breaker` duplicates are okay.** These are per-integration (AFIP, MP, WhatsApp) and each has different thresholds/configs. They share a pattern but aren't true copies.

---

## Phase 8: Dependency Health

**Method:** Ran `pnpm audit` for security vulnerabilities. For each of 95 npm dependencies in `apps/web/package.json`, searched the codebase for any reference. Cross-checked results against config files, peer dependencies, and usage in `src/`.

### Security Vulnerabilities

| Severity | Count |
|----------|------:|
| ðŸ”´ Critical | 0 |
| ðŸŸ¡ Moderate / Low | 3 |

> 3 vulnerabilities reported by `pnpm audit`. None are critical. Check the advisory links for applicability â€” many npm audit findings don't apply to server-side/build-time-only packages.

### Unused Dependencies (apps/web)

Found **12 potentially unused** out of 95 total dependencies:

#### ðŸ”´ Truly Unused â€” Safe to Remove (6)

These packages are for frameworks CampoTech **does not use**:

| Package | Why it's unused |
|---------|----------------|
| `@opentelemetry/instrumentation-fastify` | CampoTech uses **Next.js**, not Fastify |
| `@opentelemetry/instrumentation-nestjs-core` | CampoTech does **not** use NestJS |
| `@opentelemetry/instrumentation-ioredis` | Redis instrumentation â€” could be useful later, but no direct import exists |
| `@opentelemetry/instrumentation-redis-4` | Same â€” Redis monitoring, not currently wired |
| `@opentelemetry/instrumentation-http` | HTTP instrumentation â€” not configured anywhere |
| `@opentelemetry/api` | Base OpenTelemetry API â€” only needed if the others are used |

> These 6 OpenTelemetry packages appear to have been installed for a planned observability setup that was never configured. The Fastify and NestJS instrumentations are for frameworks the project doesn't use at all.

#### ðŸŸ¡ Used Only by Dead Code (3)

These packages are only referenced in `src/` files that Phase 4 flagged as dead:

| Package | Where it's used | Status of that code |
|---------|----------------|---------------------|
| `@aws-sdk/client-ses` | `src/analytics/reports/exporters/email-sender.ts` | ðŸ’€ Dead (Phase 4) |
| `@bull-board/api` | `src/lib/queue/dashboard.ts` | ðŸ’€ Dead (Phase 4) |
| `@bull-board/express` | `src/lib/queue/dashboard.ts` | ðŸ’€ Dead (Phase 4) |
| `@sendgrid/mail` | `src/analytics/reports/exporters/email-sender.ts` | ðŸ’€ Dead (Phase 4) |

> If you archive the dead `src/` code from Phase 4, these 4 packages become truly unused and should be removed too.

#### ðŸŸ¢ False Positives â€” Keep (2)

| Package | Why it looks unused | Why it's actually needed |
|---------|--------------------|-----------------------|
| `@sentry/core` | No direct import | **Peer dependency** of `@sentry/nextjs` (which IS used in 15 files) |
| `@hookform/resolvers` | Only 1 reference | Used with `react-hook-form` for form validation â€” referenced indirectly |

### Phase 8 Observations

1. **6 wrong-framework packages** â€” The OpenTelemetry Fastify and NestJS instrumentations are for completely different Node.js frameworks. They were likely copied from a template or tutorial and never cleaned up. Safe to remove immediately.

2. **Dead code pulls in live dependencies** â€” `@aws-sdk/client-ses`, `@bull-board/*`, and `@sendgrid/mail` only exist because the dead `src/` analytics code imports them. Once Phase 4 cleanup is done, these packages become orphans too. This is a hidden cost of dead code: it inflates your `node_modules` and install times.

3. **Security is clean** â€” No critical vulnerabilities. The 3 moderate findings should be reviewed but are likely in transitive dependencies.

### Recommended Actions

| Priority | Action | Impact |
|----------|--------|--------|
| ðŸ”´ **P0** | Remove 6 OpenTelemetry packages (wrong framework) | Faster installs, smaller bundle |
| ðŸ”¶ **P1** | Remove 4 dead-code deps after Phase 4 cleanup | Cleaner dependency tree |
| ðŸŸ¡ **P2** | Review 3 moderate security advisories | Security hygiene |

---

## ðŸ Audit Complete â€” Final Executive Summary

All 8 audit phases are now complete. Here is the full picture:

### Total Dead Code Found

| Phase | What was found | Dead Files | Dead LOC |
|-------|---------------|----------:|--------:|
| Phase 2 | Dead API Routes | ~37 | ~5,600 |
| Phase 3 | Orphaned Components & Libraries | 25 | ~10,500 |
| Phase 4 | Unused Shared Modules (`src/`) | 181 | ~79,926 |
| **Total** | | **~243** | **~96,000** |

> **~96,000 lines of dead code = 22% of the codebase.** The vast majority (83%) is in `src/` â€” entire features that were designed but never connected to any app.

### Code Quality Issues

| Issue | Count | Notes |
|-------|------:|-------|
| TODO/FIXME comments | 181 | 3 are security/compliance risks |
| `console.log` in production code | 645 | Should use structured logger |
| `eslint-disable` directives | 132 | 93% suppress `any` types |
| Oversized files (>1000 LOC) | 25 | 3 are dead, 22 need splitting |
| Duplicate API routes | 8 pairs | `/api/` vs `/api/v1/` for same resource |
| Duplicate utility functions | 3+ | `formatCurrency` defined 3 times |
| Duplicate logger files | 5 | Plus 1 dormant error-logger |
| Unused npm packages | 10 | 6 wrong-framework, 4 dead-code-only |
| Security vulnerabilities | 3 | None critical |

### Recommended Cleanup Roadmap

| Step | Action | LOC Removed | Effort |
|------|--------|------------|--------|
| 1 | Delete 8 dev/debug API routes (Phase 2, high confidence) | ~645 | ðŸŸ¢ Easy |
| 2 | Delete 25 orphaned components/libraries (Phase 3) | ~10,500 | ðŸŸ¢ Easy |
| 3 | Archive `src/analytics/` (39 files, 89% dead) | ~22,000 | ðŸŸ¢ Easy |
| 4 | Archive `src/modules/consumer/` (100% dead) | ~12,000 | ðŸŸ¢ Easy |
| 5 | Archive `src/modules/inventory/` (100% dead) | ~9,500 | ðŸŸ¢ Easy |
| 6 | Archive dead workers + integrations (Phase 4) | ~16,500 | ðŸŸ¡ Moderate |
| 7 | Remove 10 unused npm packages (Phase 8) | â€” | ðŸŸ¢ Easy |
| 8 | Review 29 medium-confidence dead API routes | ~4,000-5,000 | ðŸŸ¡ Requires judgement |
| 9 | Consolidate 8 duplicate API route pairs (Phase 7) | â€” | ðŸ”¶ Architecture work |
| 10 | Wire up error-logger + replace 645 console.logs | â€” | ðŸ”¶ Pre-production task |
| 11 | Split 22 oversized files | â€” | ðŸ”¶ Refactoring |
| 12 | Type 123 `any` suppressions | â€” | ðŸŸ¡ Gradual |

### Final Metrics

| Metric | Value |
|--------|-------|
| Git-tracked files | 1,913 |
| Code files | 1,518 |
| Total LOC | ~439,000 |
| Dead code identified | ~96,000 LOC (22%) |
| LOC after full cleanup | ~343,000 |
| Disk reclaimed (build cache) | 2,441 MB |
| Security vulnerabilities | 3 (none critical) |
| Unused npm packages | 10 |

---

*Audit completed 2026-02-12. All 8 phases executed. No files were deleted â€” this report is findings-only. Cleanup actions require human approval.*

