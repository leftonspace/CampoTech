[{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\.expo\\types\\router.d.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported).","line":1,"column":1,"severity":1,"nodeType":null,"fix":{"range":[0,20],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/* eslint-disable */\nimport * as Router from 'expo-router';\n\nexport * from 'expo-router';\n\ndeclare module 'expo-router' {\n  export namespace ExpoRouter {\n    export interface __routes<T extends string | object = string> {\n      hrefInputParams: { pathname: Router.RelativePathString, params?: Router.UnknownInputParams } | { pathname: Router.ExternalPathString, params?: Router.UnknownInputParams } | { pathname: `/`; params?: Router.UnknownInputParams; } | { pathname: `/_sitemap`; params?: Router.UnknownInputParams; } | { pathname: `${'/(auth)'}/login` | `/login`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/today` | `/today`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/analytics` | `/analytics`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/calendar` | `/calendar`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/chats` | `/chats`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/customers` | `/customers`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/inventory` | `/inventory`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/inventory/replenish` | `/inventory/replenish`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/inventory/scan` | `/inventory/scan`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/inventory/usage` | `/inventory/usage`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/invoices` | `/invoices`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/jobs/complete` | `/jobs/complete`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/jobs` | `/jobs`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/jobs/map` | `/jobs/map`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/profile/badge` | `/profile/badge`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/profile` | `/profile`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/team/add` | `/team/add`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/team` | `/team`; params?: Router.UnknownInputParams; } | { pathname: `/settings`; params?: Router.UnknownInputParams; } | { pathname: `${'/(auth)'}/invite/[token]` | `/invite/[token]`, params: Router.UnknownInputParams & { token: string | number; } } | { pathname: `${'/(tabs)'}/chats/[id]` | `/chats/[id]`, params: Router.UnknownInputParams & { id: string | number; } } | { pathname: `${'/(tabs)'}/customers/[id]` | `/customers/[id]`, params: Router.UnknownInputParams & { id: string | number; } } | { pathname: `${'/(tabs)'}/jobs/[id]` | `/jobs/[id]`, params: Router.UnknownInputParams & { id: string | number; } };\n      hrefOutputParams: { pathname: Router.RelativePathString, params?: Router.UnknownOutputParams } | { pathname: Router.ExternalPathString, params?: Router.UnknownOutputParams } | { pathname: `/`; params?: Router.UnknownOutputParams; } | { pathname: `/_sitemap`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(auth)'}/login` | `/login`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/today` | `/today`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/analytics` | `/analytics`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/calendar` | `/calendar`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/chats` | `/chats`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/customers` | `/customers`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/inventory` | `/inventory`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/inventory/replenish` | `/inventory/replenish`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/inventory/scan` | `/inventory/scan`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/inventory/usage` | `/inventory/usage`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/invoices` | `/invoices`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/jobs/complete` | `/jobs/complete`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/jobs` | `/jobs`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/jobs/map` | `/jobs/map`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/profile/badge` | `/profile/badge`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/profile` | `/profile`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/team/add` | `/team/add`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(tabs)'}/team` | `/team`; params?: Router.UnknownOutputParams; } | { pathname: `/settings`; params?: Router.UnknownOutputParams; } | { pathname: `${'/(auth)'}/invite/[token]` | `/invite/[token]`, params: Router.UnknownOutputParams & { token: string; } } | { pathname: `${'/(tabs)'}/chats/[id]` | `/chats/[id]`, params: Router.UnknownOutputParams & { id: string; } } | { pathname: `${'/(tabs)'}/customers/[id]` | `/customers/[id]`, params: Router.UnknownOutputParams & { id: string; } } | { pathname: `${'/(tabs)'}/jobs/[id]` | `/jobs/[id]`, params: Router.UnknownOutputParams & { id: string; } };\n      href: Router.RelativePathString | Router.ExternalPathString | `/${`?${string}` | `#${string}` | ''}` | `/_sitemap${`?${string}` | `#${string}` | ''}` | `${'/(auth)'}/login${`?${string}` | `#${string}` | ''}` | `/login${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/today${`?${string}` | `#${string}` | ''}` | `/today${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/analytics${`?${string}` | `#${string}` | ''}` | `/analytics${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/calendar${`?${string}` | `#${string}` | ''}` | `/calendar${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/chats${`?${string}` | `#${string}` | ''}` | `/chats${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/customers${`?${string}` | `#${string}` | ''}` | `/customers${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/inventory${`?${string}` | `#${string}` | ''}` | `/inventory${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/inventory/replenish${`?${string}` | `#${string}` | ''}` | `/inventory/replenish${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/inventory/scan${`?${string}` | `#${string}` | ''}` | `/inventory/scan${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/inventory/usage${`?${string}` | `#${string}` | ''}` | `/inventory/usage${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/invoices${`?${string}` | `#${string}` | ''}` | `/invoices${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/jobs/complete${`?${string}` | `#${string}` | ''}` | `/jobs/complete${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/jobs${`?${string}` | `#${string}` | ''}` | `/jobs${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/jobs/map${`?${string}` | `#${string}` | ''}` | `/jobs/map${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/profile/badge${`?${string}` | `#${string}` | ''}` | `/profile/badge${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/profile${`?${string}` | `#${string}` | ''}` | `/profile${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/team/add${`?${string}` | `#${string}` | ''}` | `/team/add${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/team${`?${string}` | `#${string}` | ''}` | `/team${`?${string}` | `#${string}` | ''}` | `/settings${`?${string}` | `#${string}` | ''}` | { pathname: Router.RelativePathString, params?: Router.UnknownInputParams } | { pathname: Router.ExternalPathString, params?: Router.UnknownInputParams } | { pathname: `/`; params?: Router.UnknownInputParams; } | { pathname: `/_sitemap`; params?: Router.UnknownInputParams; } | { pathname: `${'/(auth)'}/login` | `/login`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/today` | `/today`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/analytics` | `/analytics`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/calendar` | `/calendar`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/chats` | `/chats`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/customers` | `/customers`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/inventory` | `/inventory`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/inventory/replenish` | `/inventory/replenish`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/inventory/scan` | `/inventory/scan`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/inventory/usage` | `/inventory/usage`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/invoices` | `/invoices`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/jobs/complete` | `/jobs/complete`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/jobs` | `/jobs`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/jobs/map` | `/jobs/map`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/profile/badge` | `/profile/badge`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/profile` | `/profile`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/team/add` | `/team/add`; params?: Router.UnknownInputParams; } | { pathname: `${'/(tabs)'}/team` | `/team`; params?: Router.UnknownInputParams; } | { pathname: `/settings`; params?: Router.UnknownInputParams; } | `${'/(auth)'}/invite/${Router.SingleRoutePart<T>}${`?${string}` | `#${string}` | ''}` | `/invite/${Router.SingleRoutePart<T>}${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/chats/${Router.SingleRoutePart<T>}${`?${string}` | `#${string}` | ''}` | `/chats/${Router.SingleRoutePart<T>}${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/customers/${Router.SingleRoutePart<T>}${`?${string}` | `#${string}` | ''}` | `/customers/${Router.SingleRoutePart<T>}${`?${string}` | `#${string}` | ''}` | `${'/(tabs)'}/jobs/${Router.SingleRoutePart<T>}${`?${string}` | `#${string}` | ''}` | `/jobs/${Router.SingleRoutePart<T>}${`?${string}` | `#${string}` | ''}` | { pathname: `${'/(auth)'}/invite/[token]` | `/invite/[token]`, params: Router.UnknownInputParams & { token: string | number; } } | { pathname: `${'/(tabs)'}/chats/[id]` | `/chats/[id]`, params: Router.UnknownInputParams & { id: string | number; } } | { pathname: `${'/(tabs)'}/customers/[id]` | `/customers/[id]`, params: Router.UnknownInputParams & { id: string | number; } } | { pathname: `${'/(tabs)'}/jobs/[id]` | `/jobs/[id]`, params: Router.UnknownInputParams & { id: string | number; } };\n    }\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\__tests__\\consumer\\BusinessCard.test.tsx","messages":[{"ruleId":"import/no-named-as-default","severity":1,"message":"Using exported name 'BusinessCard' as identifier for default import.","line":11,"column":8,"nodeType":"ImportDefaultSpecifier","endLine":11,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * BusinessCard Component Tests\r\n * ============================\r\n *\r\n * Phase 15: Consumer Marketplace\r\n * Tests for the BusinessCard component.\r\n */\r\n\r\nimport React from 'react';\r\nimport { render, fireEvent } from '@testing-library/react-native';\r\nimport BusinessCard from '../../components/consumer/BusinessCard';\r\n\r\ndescribe('BusinessCard', () => {\r\n  const mockBusiness = {\r\n    id: 'test-id',\r\n    displayName: 'Test Business',\r\n    logoUrl: 'https://example.com/logo.png',\r\n    overallRating: 4.5,\r\n    ratingCount: 120,\r\n    completedJobsCount: 85,\r\n    responseTimeMinutes: 30,\r\n    badges: ['verified', 'top_rated'],\r\n    categories: ['plumbing', 'electrical'],\r\n    city: 'Buenos Aires',\r\n    neighborhood: 'Palermo',\r\n    distance: 2.5,\r\n  };\r\n\r\n  const mockOnPress = jest.fn();\r\n\r\n  beforeEach(() => {\r\n    mockOnPress.mockClear();\r\n  });\r\n\r\n  it('renders business name', () => {\r\n    const { getByText } = render(\r\n      <BusinessCard business={mockBusiness} onPress={mockOnPress} />\r\n    );\r\n\r\n    expect(getByText('Test Business')).toBeTruthy();\r\n  });\r\n\r\n  it('renders rating and review count', () => {\r\n    const { getByText } = render(\r\n      <BusinessCard business={mockBusiness} onPress={mockOnPress} />\r\n    );\r\n\r\n    expect(getByText('4.5')).toBeTruthy();\r\n    expect(getByText('(120)')).toBeTruthy();\r\n  });\r\n\r\n  it('renders location', () => {\r\n    const { getByText } = render(\r\n      <BusinessCard business={mockBusiness} onPress={mockOnPress} />\r\n    );\r\n\r\n    expect(getByText('Palermo')).toBeTruthy();\r\n  });\r\n\r\n  it('renders distance when available', () => {\r\n    const { getByText } = render(\r\n      <BusinessCard business={mockBusiness} onPress={mockOnPress} />\r\n    );\r\n\r\n    expect(getByText('2.5 km')).toBeTruthy();\r\n  });\r\n\r\n  it('calls onPress when card is pressed', () => {\r\n    const { getByText } = render(\r\n      <BusinessCard business={mockBusiness} onPress={mockOnPress} />\r\n    );\r\n\r\n    fireEvent.press(getByText('Test Business'));\r\n    expect(mockOnPress).toHaveBeenCalledWith(mockBusiness);\r\n  });\r\n\r\n  it('renders badges', () => {\r\n    const { getByText } = render(\r\n      <BusinessCard business={mockBusiness} onPress={mockOnPress} />\r\n    );\r\n\r\n    // Badge labels from constants\r\n    expect(getByText('Verificado')).toBeTruthy();\r\n    expect(getByText('Top')).toBeTruthy();\r\n  });\r\n\r\n  it('renders without logo gracefully', () => {\r\n    const businessWithoutLogo = { ...mockBusiness, logoUrl: null };\r\n    const { getByText } = render(\r\n      <BusinessCard business={businessWithoutLogo} onPress={mockOnPress} />\r\n    );\r\n\r\n    expect(getByText('Test Business')).toBeTruthy();\r\n  });\r\n\r\n  it('renders without distance', () => {\r\n    const businessWithoutDistance = { ...mockBusiness, distance: null };\r\n    const { queryByText } = render(\r\n      <BusinessCard business={businessWithoutDistance} onPress={mockOnPress} />\r\n    );\r\n\r\n    expect(queryByText('km')).toBeNull();\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\__tests__\\consumer\\CategoryGrid.test.tsx","messages":[{"ruleId":"import/no-named-as-default","severity":1,"message":"Using exported name 'CategoryGrid' as identifier for default import.","line":11,"column":8,"nodeType":"ImportDefaultSpecifier","endLine":11,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getByTestId' is assigned a value but never used.","line":41,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getAllByRole' is assigned a value but never used.","line":52,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * CategoryGrid Component Tests\r\n * ============================\r\n *\r\n * Phase 15: Consumer Marketplace\r\n * Tests for the CategoryGrid component.\r\n */\r\n\r\nimport React from 'react';\r\nimport { render, fireEvent } from '@testing-library/react-native';\r\nimport CategoryGrid from '../../components/consumer/CategoryGrid';\r\n\r\ndescribe('CategoryGrid', () => {\r\n  const mockOnSelect = jest.fn();\r\n\r\n  beforeEach(() => {\r\n    mockOnSelect.mockClear();\r\n  });\r\n\r\n  it('renders all categories', () => {\r\n    const { getByText } = render(<CategoryGrid onSelect={mockOnSelect} />);\r\n\r\n    // Check some categories exist\r\n    expect(getByText('Plomeria')).toBeTruthy();\r\n    expect(getByText('Electricidad')).toBeTruthy();\r\n    expect(getByText('Aire y Clima')).toBeTruthy();\r\n    expect(getByText('Gas')).toBeTruthy();\r\n  });\r\n\r\n  it('calls onSelect when category is pressed', () => {\r\n    const { getByText } = render(<CategoryGrid onSelect={mockOnSelect} />);\r\n\r\n    fireEvent.press(getByText('Plomeria'));\r\n    expect(mockOnSelect).toHaveBeenCalledWith('plumbing');\r\n\r\n    fireEvent.press(getByText('Electricidad'));\r\n    expect(mockOnSelect).toHaveBeenCalledWith('electrical');\r\n  });\r\n\r\n  it('highlights selected category', () => {\r\n    const { getByTestId, rerender } = render(\r\n      <CategoryGrid onSelect={mockOnSelect} selected=\"plumbing\" />\r\n    );\r\n\r\n    // The selected category should have a different style\r\n    // We'd need to add testID to the component for this to work properly\r\n    // For now, just verify it renders without errors\r\n    rerender(<CategoryGrid onSelect={mockOnSelect} selected=\"electrical\" />);\r\n  });\r\n\r\n  it('renders correct number of categories', () => {\r\n    const { getAllByRole } = render(<CategoryGrid onSelect={mockOnSelect} />);\r\n\r\n    // Should render 18 categories (based on the CATEGORIES constant)\r\n    // Note: This test may need adjustment based on actual implementation\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(auth)\\_layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(auth)\\invite\\[token].tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchInviteData'. Either include it or remove the dependency array.","line":62,"column":6,"nodeType":"ArrayExpression","endLine":62,"endColumn":13,"suggestions":[{"desc":"Update the dependencies array to be: [fetchInviteData, token]","fix":{"range":[1831,1838],"text":"[fetchInviteData, token]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Invite Acceptance Screen\r\n * ========================\r\n *\r\n * When an owner invites an employee, they receive a WhatsApp message with a deep link\r\n * containing a token. This screen:\r\n * 1. Validates the invite token\r\n * 2. Shows organization and role info\r\n * 3. Collects employee phone number\r\n * 4. Verifies OTP\r\n * 5. Creates account linked to organization\r\n */\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  TextInput,\r\n  TouchableOpacity,\r\n  StyleSheet,\r\n  KeyboardAvoidingView,\r\n  Platform,\r\n  ActivityIndicator,\r\n  ScrollView,\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\nimport { useLocalSearchParams, useRouter } from 'expo-router';\r\nimport { Building2, CheckCircle, XCircle, User, Phone } from 'lucide-react-native';\r\n\r\nimport { api } from '../../../lib/api/client';\r\nimport { useAuth } from '../../../lib/auth/auth-context';\r\n\r\ninterface InviteData {\r\n  organizationName: string;\r\n  organizationLogo?: string;\r\n  role: string;\r\n  invitedBy: string;\r\n  expiresAt: string;\r\n}\r\n\r\ntype Step = 'loading' | 'info' | 'phone' | 'otp' | 'success' | 'error';\r\n\r\nexport default function InviteAcceptScreen() {\r\n  const { token } = useLocalSearchParams<{ token: string }>();\r\n  const router = useRouter();\r\n  const { login } = useAuth();\r\n\r\n  const [step, setStep] = useState<Step>('loading');\r\n  const [inviteData, setInviteData] = useState<InviteData | null>(null);\r\n  const [phone, setPhone] = useState('');\r\n  const [otp, setOtp] = useState(['', '', '', '', '', '']);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const otpInputs = useRef<(TextInput | null)[]>([]);\r\n\r\n  // Fetch invite data on mount\r\n  useEffect(() => {\r\n    if (token) {\r\n      fetchInviteData();\r\n    }\r\n  }, [token]);\r\n\r\n  const fetchInviteData = async () => {\r\n    try {\r\n      const response = await api.invites.get(token as string);\r\n      if (response.success && response.data) {\r\n        setInviteData(response.data);\r\n        setStep('info');\r\n      } else {\r\n        setError(response.error?.message || 'Invitaci├│n no v├ílida o expirada');\r\n        setStep('error');\r\n      }\r\n    } catch {\r\n      setError('Error de conexi├│n');\r\n      setStep('error');\r\n    }\r\n  };\r\n\r\n  const formatPhone = (value: string) => {\r\n    const digits = value.replace(/\\D/g, '');\r\n    if (digits.length <= 2) return digits;\r\n    if (digits.length <= 6) return `${digits.slice(0, 2)} ${digits.slice(2)}`;\r\n    return `${digits.slice(0, 2)} ${digits.slice(2, 6)}-${digits.slice(6, 10)}`;\r\n  };\r\n\r\n  const handlePhoneChange = (value: string) => {\r\n    const formatted = formatPhone(value);\r\n    setPhone(formatted);\r\n    setError('');\r\n  };\r\n\r\n  const handleRequestOtp = async () => {\r\n    const digits = phone.replace(/\\D/g, '');\r\n    if (digits.length < 10) {\r\n      setError('Ingres├í un n├║mero v├ílido');\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      const response = await api.invites.requestOtp(token as string, digits);\r\n      if (response.success) {\r\n        setStep('otp');\r\n        setTimeout(() => otpInputs.current[0]?.focus(), 100);\r\n      } else {\r\n        setError(response.error?.message || 'Error al enviar c├│digo');\r\n      }\r\n    } catch {\r\n      setError('Error de conexi├│n');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleOtpChange = (value: string, index: number) => {\r\n    if (value.length > 1) {\r\n      // Handle paste\r\n      const digits = value.replace(/\\D/g, '').slice(0, 6);\r\n      const newOtp = [...otp];\r\n      digits.split('').forEach((d, i) => {\r\n        if (i < 6) newOtp[i] = d;\r\n      });\r\n      setOtp(newOtp);\r\n      if (digits.length === 6) {\r\n        handleVerifyOtp(newOtp.join(''));\r\n      }\r\n      return;\r\n    }\r\n\r\n    const newOtp = [...otp];\r\n    newOtp[index] = value.replace(/\\D/g, '');\r\n    setOtp(newOtp);\r\n    setError('');\r\n\r\n    if (value && index < 5) {\r\n      otpInputs.current[index + 1]?.focus();\r\n    }\r\n\r\n    // Auto-submit when all digits entered\r\n    if (newOtp.every((d) => d) && newOtp.join('').length === 6) {\r\n      handleVerifyOtp(newOtp.join(''));\r\n    }\r\n  };\r\n\r\n  const handleOtpKeyPress = (key: string, index: number) => {\r\n    if (key === 'Backspace' && !otp[index] && index > 0) {\r\n      otpInputs.current[index - 1]?.focus();\r\n    }\r\n  };\r\n\r\n  const handleVerifyOtp = async (code: string) => {\r\n    const digits = phone.replace(/\\D/g, '');\r\n    setIsLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      const response = await api.invites.accept(token as string, digits, code);\r\n\r\n      if (response.success && response.data) {\r\n        // Use the auth context to complete login\r\n        const loginResult = await login(digits, code);\r\n        if (loginResult.success) {\r\n          setStep('success');\r\n          // Redirect to main app after a short delay\r\n          setTimeout(() => {\r\n            router.replace('/(tabs)/today');\r\n          }, 2000);\r\n        } else {\r\n          setError(loginResult.error || 'Error al iniciar sesi├│n');\r\n          setOtp(['', '', '', '', '', '']);\r\n          otpInputs.current[0]?.focus();\r\n        }\r\n      } else {\r\n        setError(response.error?.message || 'C├│digo inv├ílido');\r\n        setOtp(['', '', '', '', '', '']);\r\n        otpInputs.current[0]?.focus();\r\n      }\r\n    } catch {\r\n      setError('Error de conexi├│n');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const getRoleDisplay = (role: string) => {\r\n    const roles: Record<string, string> = {\r\n      OWNER: 'Due├▒o',\r\n      DISPATCHER: 'Despachador',\r\n      TECHNICIAN: 'T├⌐cnico',\r\n    };\r\n    return roles[role.toUpperCase()] || role;\r\n  };\r\n\r\n  // Loading state\r\n  if (step === 'loading') {\r\n    return (\r\n      <SafeAreaView style={styles.container}>\r\n        <View style={styles.centered}>\r\n          <ActivityIndicator size=\"large\" color=\"#16a34a\" />\r\n          <Text style={styles.loadingText}>Verificando invitaci├│n...</Text>\r\n        </View>\r\n      </SafeAreaView>\r\n    );\r\n  }\r\n\r\n  // Error state\r\n  if (step === 'error') {\r\n    return (\r\n      <SafeAreaView style={styles.container}>\r\n        <View style={styles.centered}>\r\n          <XCircle size={64} color=\"#ef4444\" />\r\n          <Text style={styles.errorTitle}>Invitaci├│n no v├ílida</Text>\r\n          <Text style={styles.errorMessage}>{error}</Text>\r\n          <TouchableOpacity\r\n            style={styles.button}\r\n            onPress={() => router.replace('/(auth)/login')}\r\n          >\r\n            <Text style={styles.buttonText}>Ir a Iniciar Sesi├│n</Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n      </SafeAreaView>\r\n    );\r\n  }\r\n\r\n  // Success state\r\n  if (step === 'success') {\r\n    return (\r\n      <SafeAreaView style={styles.container}>\r\n        <View style={styles.centered}>\r\n          <CheckCircle size={64} color=\"#16a34a\" />\r\n          <Text style={styles.successTitle}>┬íBienvenido!</Text>\r\n          <Text style={styles.successMessage}>\r\n            Te uniste a {inviteData?.organizationName}\r\n          </Text>\r\n          <Text style={styles.redirectText}>Redirigiendo...</Text>\r\n        </View>\r\n      </SafeAreaView>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <SafeAreaView style={styles.container}>\r\n      <KeyboardAvoidingView\r\n        behavior={Platform.OS === 'ios' ? 'padding' : 'height'}\r\n        style={styles.keyboardView}\r\n      >\r\n        <ScrollView contentContainerStyle={styles.scrollContent}>\r\n          {/* Header */}\r\n          <View style={styles.header}>\r\n            <Text style={styles.logo}>CampoTech</Text>\r\n            <Text style={styles.title}>Invitaci├│n de equipo</Text>\r\n          </View>\r\n\r\n          {/* Organization Info Card */}\r\n          {inviteData && (\r\n            <View style={styles.card}>\r\n              <View style={styles.orgInfo}>\r\n                <View style={styles.orgIcon}>\r\n                  <Building2 size={32} color=\"#16a34a\" />\r\n                </View>\r\n                <View style={styles.orgDetails}>\r\n                  <Text style={styles.orgName}>{inviteData.organizationName}</Text>\r\n                  <View style={styles.roleRow}>\r\n                    <User size={14} color=\"#6b7280\" />\r\n                    <Text style={styles.roleText}>\r\n                      Rol: {getRoleDisplay(inviteData.role)}\r\n                    </Text>\r\n                  </View>\r\n                  <Text style={styles.invitedBy}>\r\n                    Invitado por {inviteData.invitedBy}\r\n                  </Text>\r\n                </View>\r\n              </View>\r\n            </View>\r\n          )}\r\n\r\n          {/* Info step - Show accept button */}\r\n          {step === 'info' && (\r\n            <View style={styles.form}>\r\n              <Text style={styles.stepTitle}>\r\n                Acept├í la invitaci├│n para unirte al equipo\r\n              </Text>\r\n              <TouchableOpacity\r\n                style={styles.button}\r\n                onPress={() => setStep('phone')}\r\n              >\r\n                <Text style={styles.buttonText}>Aceptar invitaci├│n</Text>\r\n              </TouchableOpacity>\r\n            </View>\r\n          )}\r\n\r\n          {/* Phone step */}\r\n          {step === 'phone' && (\r\n            <View style={styles.form}>\r\n              <Text style={styles.stepTitle}>\r\n                Ingres├í tu n├║mero de celular\r\n              </Text>\r\n              <View style={styles.inputContainer}>\r\n                <Phone size={20} color=\"#6b7280\" style={styles.inputIcon} />\r\n                <Text style={styles.countryCode}>+54 9</Text>\r\n                <TextInput\r\n                  style={styles.phoneInput}\r\n                  value={phone}\r\n                  onChangeText={handlePhoneChange}\r\n                  placeholder=\"11 1234-5678\"\r\n                  placeholderTextColor=\"#9ca3af\"\r\n                  keyboardType=\"phone-pad\"\r\n                  maxLength={13}\r\n                  autoFocus\r\n                  editable={!isLoading}\r\n                />\r\n              </View>\r\n\r\n              {error ? <Text style={styles.error}>{error}</Text> : null}\r\n\r\n              <TouchableOpacity\r\n                style={[styles.button, isLoading && styles.buttonDisabled]}\r\n                onPress={handleRequestOtp}\r\n                disabled={isLoading}\r\n              >\r\n                {isLoading ? (\r\n                  <ActivityIndicator color=\"#fff\" />\r\n                ) : (\r\n                  <Text style={styles.buttonText}>Continuar</Text>\r\n                )}\r\n              </TouchableOpacity>\r\n\r\n              <TouchableOpacity\r\n                style={styles.backButton}\r\n                onPress={() => setStep('info')}\r\n              >\r\n                <Text style={styles.backText}>Volver</Text>\r\n              </TouchableOpacity>\r\n            </View>\r\n          )}\r\n\r\n          {/* OTP step */}\r\n          {step === 'otp' && (\r\n            <View style={styles.form}>\r\n              <Text style={styles.stepTitle}>\r\n                Ingres├í el c├│digo que recibiste\r\n              </Text>\r\n              <View style={styles.otpContainer}>\r\n                {otp.map((digit, index) => (\r\n                  <TextInput\r\n                    key={index}\r\n                    ref={(ref) => { otpInputs.current[index] = ref; }}\r\n                    style={[\r\n                      styles.otpInput,\r\n                      digit && styles.otpInputFilled,\r\n                      error && styles.otpInputError,\r\n                    ]}\r\n                    value={digit}\r\n                    onChangeText={(value) => handleOtpChange(value, index)}\r\n                    onKeyPress={({ nativeEvent }) =>\r\n                      handleOtpKeyPress(nativeEvent.key, index)\r\n                    }\r\n                    keyboardType=\"number-pad\"\r\n                    maxLength={1}\r\n                    editable={!isLoading}\r\n                    selectTextOnFocus\r\n                  />\r\n                ))}\r\n              </View>\r\n\r\n              {error ? <Text style={styles.error}>{error}</Text> : null}\r\n\r\n              {isLoading && (\r\n                <ActivityIndicator style={styles.loader} color=\"#16a34a\" />\r\n              )}\r\n\r\n              <TouchableOpacity\r\n                style={styles.backButton}\r\n                onPress={() => {\r\n                  setStep('phone');\r\n                  setOtp(['', '', '', '', '', '']);\r\n                  setError('');\r\n                }}\r\n              >\r\n                <Text style={styles.backText}>Cambiar n├║mero</Text>\r\n              </TouchableOpacity>\r\n            </View>\r\n          )}\r\n        </ScrollView>\r\n      </KeyboardAvoidingView>\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#fff',\r\n  },\r\n  keyboardView: {\r\n    flex: 1,\r\n  },\r\n  scrollContent: {\r\n    flexGrow: 1,\r\n    paddingHorizontal: 24,\r\n    paddingTop: 24,\r\n  },\r\n  centered: {\r\n    flex: 1,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    padding: 24,\r\n  },\r\n  header: {\r\n    alignItems: 'center',\r\n    marginBottom: 24,\r\n  },\r\n  logo: {\r\n    fontSize: 28,\r\n    fontWeight: 'bold',\r\n    color: '#16a34a',\r\n    marginBottom: 8,\r\n  },\r\n  title: {\r\n    fontSize: 20,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  card: {\r\n    backgroundColor: '#f9fafb',\r\n    borderRadius: 16,\r\n    padding: 20,\r\n    marginBottom: 24,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  orgInfo: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n  },\r\n  orgIcon: {\r\n    width: 64,\r\n    height: 64,\r\n    borderRadius: 12,\r\n    backgroundColor: '#f0fdf4',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    marginRight: 16,\r\n  },\r\n  orgDetails: {\r\n    flex: 1,\r\n  },\r\n  orgName: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginBottom: 4,\r\n  },\r\n  roleRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n    marginBottom: 4,\r\n  },\r\n  roleText: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n  },\r\n  invitedBy: {\r\n    fontSize: 13,\r\n    color: '#9ca3af',\r\n  },\r\n  form: {\r\n    gap: 16,\r\n  },\r\n  stepTitle: {\r\n    fontSize: 16,\r\n    color: '#374151',\r\n    textAlign: 'center',\r\n    marginBottom: 8,\r\n  },\r\n  inputContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    borderRadius: 12,\r\n    paddingHorizontal: 16,\r\n    backgroundColor: '#f9fafb',\r\n  },\r\n  inputIcon: {\r\n    marginRight: 8,\r\n  },\r\n  countryCode: {\r\n    fontSize: 16,\r\n    color: '#374151',\r\n    marginRight: 8,\r\n  },\r\n  phoneInput: {\r\n    flex: 1,\r\n    fontSize: 16,\r\n    paddingVertical: 16,\r\n    color: '#111827',\r\n  },\r\n  otpContainer: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n  },\r\n  otpInput: {\r\n    width: 48,\r\n    height: 56,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    borderRadius: 12,\r\n    fontSize: 24,\r\n    fontWeight: 'bold',\r\n    textAlign: 'center',\r\n    color: '#111827',\r\n    backgroundColor: '#f9fafb',\r\n  },\r\n  otpInputFilled: {\r\n    borderColor: '#16a34a',\r\n    backgroundColor: '#f0fdf4',\r\n  },\r\n  otpInputError: {\r\n    borderColor: '#ef4444',\r\n    backgroundColor: '#fef2f2',\r\n  },\r\n  error: {\r\n    color: '#ef4444',\r\n    fontSize: 14,\r\n    textAlign: 'center',\r\n  },\r\n  button: {\r\n    backgroundColor: '#16a34a',\r\n    paddingVertical: 16,\r\n    borderRadius: 12,\r\n    alignItems: 'center',\r\n    marginTop: 8,\r\n  },\r\n  buttonDisabled: {\r\n    opacity: 0.7,\r\n  },\r\n  buttonText: {\r\n    color: '#fff',\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n  },\r\n  loader: {\r\n    marginVertical: 16,\r\n  },\r\n  backButton: {\r\n    alignItems: 'center',\r\n    paddingVertical: 12,\r\n  },\r\n  backText: {\r\n    color: '#6b7280',\r\n    fontSize: 14,\r\n  },\r\n  loadingText: {\r\n    marginTop: 16,\r\n    fontSize: 16,\r\n    color: '#6b7280',\r\n  },\r\n  errorTitle: {\r\n    marginTop: 16,\r\n    fontSize: 20,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  errorMessage: {\r\n    marginTop: 8,\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    textAlign: 'center',\r\n  },\r\n  successTitle: {\r\n    marginTop: 16,\r\n    fontSize: 24,\r\n    fontWeight: '600',\r\n    color: '#16a34a',\r\n  },\r\n  successMessage: {\r\n    marginTop: 8,\r\n    fontSize: 16,\r\n    color: '#374151',\r\n    textAlign: 'center',\r\n  },\r\n  redirectText: {\r\n    marginTop: 16,\r\n    fontSize: 14,\r\n    color: '#9ca3af',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(auth)\\login.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":23,"column":25,"nodeType":"Literal","endLine":23,"endColumn":45}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Login Screen\r\n * ============\r\n *\r\n * Phone number OTP authentication with country code selector.\r\n */\r\n\r\nimport { useState, useRef } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  TextInput,\r\n  TouchableOpacity,\r\n  StyleSheet,\r\n  KeyboardAvoidingView,\r\n  Platform,\r\n  ActivityIndicator,\r\n  Modal,\r\n  FlatList,\r\n  Pressable,\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\nimport { Feather } from '@expo/vector-icons';\r\n\r\nimport { useAuth } from '../../lib/auth/auth-context';\r\nimport { api } from '../../lib/api/client';\r\n\r\ntype Step = 'phone' | 'otp';\r\n\r\n// Country codes for phone input - matches web app\r\nconst COUNTRY_CODES = [\r\n  { code: '+54', country: 'Argentina', flag: '≡ƒçª≡ƒç╖', format: '9 11 1234-5678', maxDigits: 12, placeholder: '9 11 1234-5678' },\r\n  { code: '+1', country: 'USA/Canada', flag: '≡ƒç║≡ƒç╕', format: '(xxx) xxx-xxxx', maxDigits: 10, placeholder: '(555) 123-4567' },\r\n  { code: '+52', country: 'M├⌐xico', flag: '≡ƒç▓≡ƒç╜', format: 'xx xxxx xxxx', maxDigits: 10, placeholder: '55 1234 5678' },\r\n  { code: '+55', country: 'Brasil', flag: '≡ƒçº≡ƒç╖', format: 'xx xxxxx-xxxx', maxDigits: 11, placeholder: '11 91234-5678' },\r\n  { code: '+56', country: 'Chile', flag: '≡ƒç¿≡ƒç▒', format: 'x xxxx xxxx', maxDigits: 9, placeholder: '9 1234 5678' },\r\n  { code: '+57', country: 'Colombia', flag: '≡ƒç¿≡ƒç┤', format: 'xxx xxx xxxx', maxDigits: 10, placeholder: '310 123 4567' },\r\n  { code: '+58', country: 'Venezuela', flag: '≡ƒç╗≡ƒç¬', format: 'xxx xxx xxxx', maxDigits: 10, placeholder: '412 123 4567' },\r\n  { code: '+34', country: 'Espa├▒a', flag: '≡ƒç¬≡ƒç╕', format: 'xxx xx xx xx', maxDigits: 9, placeholder: '612 34 56 78' },\r\n];\r\n\r\n// Format phone number based on country\r\nconst formatPhoneByCountry = (value: string, countryCode: string): string => {\r\n  const digits = value.replace(/\\D/g, '');\r\n\r\n  switch (countryCode) {\r\n    case '+54': // Argentina: 9 11 1234-5678\r\n      if (digits.length <= 1) return digits;\r\n      if (digits.length <= 3) return `${digits.slice(0, 1)} ${digits.slice(1)}`;\r\n      if (digits.length <= 7) return `${digits.slice(0, 1)} ${digits.slice(1, 3)} ${digits.slice(3)}`;\r\n      return `${digits.slice(0, 1)} ${digits.slice(1, 3)} ${digits.slice(3, 7)}-${digits.slice(7, 11)}`;\r\n\r\n    case '+1': // USA/Canada: (555) 123-4567\r\n      if (digits.length <= 3) return digits.length > 0 ? `(${digits}` : '';\r\n      if (digits.length <= 6) return `(${digits.slice(0, 3)}) ${digits.slice(3)}`;\r\n      return `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6, 10)}`;\r\n\r\n    case '+52': // M├⌐xico: 55 1234 5678\r\n      if (digits.length <= 2) return digits;\r\n      if (digits.length <= 6) return `${digits.slice(0, 2)} ${digits.slice(2)}`;\r\n      return `${digits.slice(0, 2)} ${digits.slice(2, 6)} ${digits.slice(6, 10)}`;\r\n\r\n    case '+55': // Brasil: 11 91234-5678\r\n      if (digits.length <= 2) return digits;\r\n      if (digits.length <= 7) return `${digits.slice(0, 2)} ${digits.slice(2)}`;\r\n      return `${digits.slice(0, 2)} ${digits.slice(2, 7)}-${digits.slice(7, 11)}`;\r\n\r\n    case '+56': // Chile: 9 1234 5678\r\n      if (digits.length <= 1) return digits;\r\n      if (digits.length <= 5) return `${digits.slice(0, 1)} ${digits.slice(1)}`;\r\n      return `${digits.slice(0, 1)} ${digits.slice(1, 5)} ${digits.slice(5, 9)}`;\r\n\r\n    case '+57': // Colombia: 310 123 4567\r\n    case '+58': // Venezuela: 412 123 4567\r\n      if (digits.length <= 3) return digits;\r\n      if (digits.length <= 6) return `${digits.slice(0, 3)} ${digits.slice(3)}`;\r\n      return `${digits.slice(0, 3)} ${digits.slice(3, 6)} ${digits.slice(6, 10)}`;\r\n\r\n    case '+34': // Espa├▒a: 612 34 56 78\r\n      if (digits.length <= 3) return digits;\r\n      if (digits.length <= 5) return `${digits.slice(0, 3)} ${digits.slice(3)}`;\r\n      if (digits.length <= 7) return `${digits.slice(0, 3)} ${digits.slice(3, 5)} ${digits.slice(5)}`;\r\n      return `${digits.slice(0, 3)} ${digits.slice(3, 5)} ${digits.slice(5, 7)} ${digits.slice(7, 9)}`;\r\n\r\n    default:\r\n      return digits;\r\n  }\r\n};\r\n\r\nexport default function LoginScreen() {\r\n  const { login } = useAuth();\r\n  const [step, setStep] = useState<Step>('phone');\r\n  const [countryCode, setCountryCode] = useState('+54'); // Default to Argentina\r\n  const [showCountryPicker, setShowCountryPicker] = useState(false);\r\n  const [phone, setPhone] = useState('');\r\n  const [otp, setOtp] = useState(['', '', '', '', '', '']);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const otpInputs = useRef<(TextInput | null)[]>([]);\r\n\r\n  const selectedCountry = COUNTRY_CODES.find((c) => c.code === countryCode) || COUNTRY_CODES[0];\r\n\r\n  const handlePhoneChange = (value: string) => {\r\n    const digits = value.replace(/\\D/g, '').slice(0, selectedCountry.maxDigits);\r\n    const formatted = formatPhoneByCountry(digits, countryCode);\r\n    setPhone(formatted);\r\n    setError('');\r\n  };\r\n\r\n  const handleCountryChange = (newCode: string) => {\r\n    setCountryCode(newCode);\r\n    setPhone(''); // Clear phone when country changes to avoid format issues\r\n    setShowCountryPicker(false);\r\n  };\r\n\r\n  // Get full phone number with country code\r\n  const getFullPhone = () => {\r\n    const phoneDigits = phone.replace(/\\D/g, '');\r\n    return `${countryCode}${phoneDigits}`;\r\n  };\r\n\r\n  const handleRequestOtp = async () => {\r\n    const digits = phone.replace(/\\D/g, '');\r\n    if (digits.length < 8) {\r\n      setError('Ingres├í un n├║mero v├ílido');\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      const fullPhone = getFullPhone();\r\n      const response = await api.auth.requestOtp(fullPhone);\r\n      if (response.success) {\r\n        setStep('otp');\r\n        setTimeout(() => otpInputs.current[0]?.focus(), 100);\r\n      } else {\r\n        setError(response.error?.message || 'Error al enviar c├│digo');\r\n      }\r\n    } catch {\r\n      setError('Error de conexi├│n');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleOtpChange = (value: string, index: number) => {\r\n    if (value.length > 1) {\r\n      // Handle paste\r\n      const digits = value.replace(/\\D/g, '').slice(0, 6);\r\n      const newOtp = [...otp];\r\n      digits.split('').forEach((d, i) => {\r\n        if (i < 6) newOtp[i] = d;\r\n      });\r\n      setOtp(newOtp);\r\n      if (digits.length === 6) {\r\n        handleVerifyOtp(newOtp.join(''));\r\n      }\r\n      return;\r\n    }\r\n\r\n    const newOtp = [...otp];\r\n    newOtp[index] = value.replace(/\\D/g, '');\r\n    setOtp(newOtp);\r\n    setError('');\r\n\r\n    if (value && index < 5) {\r\n      otpInputs.current[index + 1]?.focus();\r\n    }\r\n\r\n    // Auto-submit when all digits entered\r\n    if (newOtp.every((d) => d) && newOtp.join('').length === 6) {\r\n      handleVerifyOtp(newOtp.join(''));\r\n    }\r\n  };\r\n\r\n  const handleOtpKeyPress = (key: string, index: number) => {\r\n    if (key === 'Backspace' && !otp[index] && index > 0) {\r\n      otpInputs.current[index - 1]?.focus();\r\n    }\r\n  };\r\n\r\n  const handleVerifyOtp = async (code: string) => {\r\n    const fullPhone = getFullPhone();\r\n    setIsLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      const result = await login(fullPhone, code);\r\n      if (!result.success) {\r\n        setError(result.error || 'C├│digo inv├ílido');\r\n        setOtp(['', '', '', '', '', '']);\r\n        otpInputs.current[0]?.focus();\r\n      }\r\n    } catch {\r\n      setError('Error de conexi├│n');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleResendOtp = async () => {\r\n    setOtp(['', '', '', '', '', '']);\r\n    await handleRequestOtp();\r\n  };\r\n\r\n  const renderCountryItem = ({ item }: { item: typeof COUNTRY_CODES[0] }) => (\r\n    <TouchableOpacity\r\n      style={styles.countryItem}\r\n      onPress={() => handleCountryChange(item.code)}\r\n    >\r\n      <Text style={styles.countryFlag}>{item.flag}</Text>\r\n      <Text style={styles.countryName}>{item.country}</Text>\r\n      <Text style={styles.countryCodeText}>{item.code}</Text>\r\n      {item.code === countryCode && (\r\n        <Feather name=\"check\" size={20} color=\"#16a34a\" />\r\n      )}\r\n    </TouchableOpacity>\r\n  );\r\n\r\n  return (\r\n    <SafeAreaView style={styles.container}>\r\n      <KeyboardAvoidingView\r\n        behavior={Platform.OS === 'ios' ? 'padding' : 'height'}\r\n        style={styles.keyboardView}\r\n      >\r\n        <View style={styles.content}>\r\n          {/* Logo/Header */}\r\n          <View style={styles.header}>\r\n            <Text style={styles.logo}>CampoTech</Text>\r\n            <Text style={styles.subtitle}>\r\n              {step === 'phone'\r\n                ? 'Ingres├í tu n├║mero de celular'\r\n                : 'Ingres├í el c├│digo que recibiste'}\r\n            </Text>\r\n          </View>\r\n\r\n          {/* Form */}\r\n          {step === 'phone' ? (\r\n            <View style={styles.form}>\r\n              <View style={styles.phoneRow}>\r\n                {/* Country Code Selector */}\r\n                <TouchableOpacity\r\n                  style={styles.countrySelector}\r\n                  onPress={() => setShowCountryPicker(true)}\r\n                >\r\n                  <Text style={styles.countryFlag}>{selectedCountry.flag}</Text>\r\n                  <Text style={styles.selectedCode}>{countryCode}</Text>\r\n                  <Feather name=\"chevron-down\" size={16} color=\"#6b7280\" />\r\n                </TouchableOpacity>\r\n\r\n                {/* Phone Input */}\r\n                <View style={styles.inputContainer}>\r\n                  <TextInput\r\n                    style={styles.phoneInput}\r\n                    value={phone}\r\n                    onChangeText={handlePhoneChange}\r\n                    placeholder={selectedCountry.placeholder}\r\n                    placeholderTextColor=\"#9ca3af\"\r\n                    keyboardType=\"phone-pad\"\r\n                    maxLength={selectedCountry.maxDigits + 5}\r\n                    autoFocus\r\n                    editable={!isLoading}\r\n                  />\r\n                </View>\r\n              </View>\r\n\r\n              {error ? <Text style={styles.error}>{error}</Text> : null}\r\n\r\n              <TouchableOpacity\r\n                style={[styles.button, isLoading && styles.buttonDisabled]}\r\n                onPress={handleRequestOtp}\r\n                disabled={isLoading}\r\n              >\r\n                {isLoading ? (\r\n                  <ActivityIndicator color=\"#fff\" />\r\n                ) : (\r\n                  <Text style={styles.buttonText}>Continuar</Text>\r\n                )}\r\n              </TouchableOpacity>\r\n            </View>\r\n          ) : (\r\n            <View style={styles.form}>\r\n              <Text style={styles.phoneDisplay}>\r\n                C├│digo enviado a {getFullPhone()}\r\n              </Text>\r\n\r\n              <View style={styles.otpContainer}>\r\n                {otp.map((digit, index) => (\r\n                  <TextInput\r\n                    key={index}\r\n                    ref={(ref) => { otpInputs.current[index] = ref; }}\r\n                    style={[\r\n                      styles.otpInput,\r\n                      digit && styles.otpInputFilled,\r\n                      error && styles.otpInputError,\r\n                    ]}\r\n                    value={digit}\r\n                    onChangeText={(value) => handleOtpChange(value, index)}\r\n                    onKeyPress={({ nativeEvent }) =>\r\n                      handleOtpKeyPress(nativeEvent.key, index)\r\n                    }\r\n                    keyboardType=\"number-pad\"\r\n                    maxLength={1}\r\n                    editable={!isLoading}\r\n                    selectTextOnFocus\r\n                  />\r\n                ))}\r\n              </View>\r\n\r\n              {error ? <Text style={styles.error}>{error}</Text> : null}\r\n\r\n              {isLoading && (\r\n                <ActivityIndicator style={styles.loader} color=\"#16a34a\" />\r\n              )}\r\n\r\n              <TouchableOpacity\r\n                style={styles.resendButton}\r\n                onPress={handleResendOtp}\r\n                disabled={isLoading}\r\n              >\r\n                <Text style={styles.resendText}>Reenviar c├│digo</Text>\r\n              </TouchableOpacity>\r\n\r\n              <TouchableOpacity\r\n                style={styles.backButton}\r\n                onPress={() => {\r\n                  setStep('phone');\r\n                  setOtp(['', '', '', '', '', '']);\r\n                  setError('');\r\n                }}\r\n              >\r\n                <Text style={styles.backText}>Cambiar n├║mero</Text>\r\n              </TouchableOpacity>\r\n            </View>\r\n          )}\r\n        </View>\r\n      </KeyboardAvoidingView>\r\n\r\n      {/* Country Picker Modal */}\r\n      <Modal\r\n        visible={showCountryPicker}\r\n        animationType=\"slide\"\r\n        transparent={true}\r\n        onRequestClose={() => setShowCountryPicker(false)}\r\n      >\r\n        <Pressable\r\n          style={styles.modalOverlay}\r\n          onPress={() => setShowCountryPicker(false)}\r\n        >\r\n          <View style={styles.modalContent}>\r\n            <View style={styles.modalHeader}>\r\n              <Text style={styles.modalTitle}>Seleccionar pa├¡s</Text>\r\n              <TouchableOpacity onPress={() => setShowCountryPicker(false)}>\r\n                <Feather name=\"x\" size={24} color=\"#374151\" />\r\n              </TouchableOpacity>\r\n            </View>\r\n            <FlatList\r\n              data={COUNTRY_CODES}\r\n              renderItem={renderCountryItem}\r\n              keyExtractor={(item) => item.code}\r\n              ItemSeparatorComponent={() => <View style={styles.separator} />}\r\n            />\r\n          </View>\r\n        </Pressable>\r\n      </Modal>\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#fff',\r\n  },\r\n  keyboardView: {\r\n    flex: 1,\r\n  },\r\n  content: {\r\n    flex: 1,\r\n    paddingHorizontal: 24,\r\n    justifyContent: 'center',\r\n  },\r\n  header: {\r\n    alignItems: 'center',\r\n    marginBottom: 48,\r\n  },\r\n  logo: {\r\n    fontSize: 32,\r\n    fontWeight: 'bold',\r\n    color: '#16a34a',\r\n    marginBottom: 8,\r\n  },\r\n  subtitle: {\r\n    fontSize: 16,\r\n    color: '#6b7280',\r\n    textAlign: 'center',\r\n  },\r\n  form: {\r\n    gap: 16,\r\n  },\r\n  phoneRow: {\r\n    flexDirection: 'row',\r\n    gap: 8,\r\n  },\r\n  countrySelector: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    borderRadius: 12,\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 16,\r\n    backgroundColor: '#f9fafb',\r\n    gap: 6,\r\n  },\r\n  countryFlag: {\r\n    fontSize: 20,\r\n  },\r\n  selectedCode: {\r\n    fontSize: 16,\r\n    color: '#374151',\r\n    fontWeight: '500',\r\n  },\r\n  inputContainer: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    borderRadius: 12,\r\n    paddingHorizontal: 16,\r\n    backgroundColor: '#f9fafb',\r\n  },\r\n  phoneInput: {\r\n    flex: 1,\r\n    fontSize: 16,\r\n    paddingVertical: 16,\r\n    color: '#111827',\r\n  },\r\n  phoneDisplay: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    textAlign: 'center',\r\n    marginBottom: 8,\r\n  },\r\n  otpContainer: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n  },\r\n  otpInput: {\r\n    width: 48,\r\n    height: 56,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    borderRadius: 12,\r\n    fontSize: 24,\r\n    fontWeight: 'bold',\r\n    textAlign: 'center',\r\n    color: '#111827',\r\n    backgroundColor: '#f9fafb',\r\n  },\r\n  otpInputFilled: {\r\n    borderColor: '#16a34a',\r\n    backgroundColor: '#f0fdf4',\r\n  },\r\n  otpInputError: {\r\n    borderColor: '#ef4444',\r\n    backgroundColor: '#fef2f2',\r\n  },\r\n  error: {\r\n    color: '#ef4444',\r\n    fontSize: 14,\r\n    textAlign: 'center',\r\n  },\r\n  button: {\r\n    backgroundColor: '#16a34a',\r\n    paddingVertical: 16,\r\n    borderRadius: 12,\r\n    alignItems: 'center',\r\n    marginTop: 8,\r\n  },\r\n  buttonDisabled: {\r\n    opacity: 0.7,\r\n  },\r\n  buttonText: {\r\n    color: '#fff',\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n  },\r\n  loader: {\r\n    marginVertical: 16,\r\n  },\r\n  resendButton: {\r\n    alignItems: 'center',\r\n    paddingVertical: 12,\r\n  },\r\n  resendText: {\r\n    color: '#16a34a',\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n  },\r\n  backButton: {\r\n    alignItems: 'center',\r\n    paddingVertical: 12,\r\n  },\r\n  backText: {\r\n    color: '#6b7280',\r\n    fontSize: 14,\r\n  },\r\n  // Modal styles\r\n  modalOverlay: {\r\n    flex: 1,\r\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n    justifyContent: 'flex-end',\r\n  },\r\n  modalContent: {\r\n    backgroundColor: '#fff',\r\n    borderTopLeftRadius: 24,\r\n    borderTopRightRadius: 24,\r\n    maxHeight: '60%',\r\n  },\r\n  modalHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    padding: 16,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  modalTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  countryItem: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    padding: 16,\r\n    gap: 12,\r\n  },\r\n  countryName: {\r\n    flex: 1,\r\n    fontSize: 16,\r\n    color: '#374151',\r\n  },\r\n  countryCodeText: {\r\n    fontSize: 16,\r\n    color: '#6b7280',\r\n    marginRight: 8,\r\n  },\r\n  separator: {\r\n    height: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\_layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Map' is defined but never used.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'canSeeInvoices' is assigned a value but never used.","line":54,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'spinAnim'. Either include it or remove the dependency array.","line":73,"column":6,"nodeType":"ArrayExpression","endLine":73,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [isSyncing, spinAnim]","fix":{"range":[2248,2259],"text":"[isSyncing, spinAnim]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tabs Layout\r\n * ===========\r\n *\r\n * Role-based navigation with bottom tabs.\r\n *\r\n * Tab visibility by role:\r\n * - OWNER: All tabs (today, jobs, calendar, team, chats, profile)\r\n * - DISPATCHER: today, jobs, calendar, customers, chats, profile\r\n * - TECHNICIAN: today, inventory, chats, profile\r\n */\r\n\r\nimport { Tabs, Redirect } from 'expo-router';\r\nimport { View, Text, StyleSheet, Animated } from 'react-native';\r\nimport {\r\n  CalendarDays,\r\n  CalendarClock,\r\n  Briefcase,\r\n  Package,\r\n  User,\r\n  WifiOff,\r\n  RefreshCw,\r\n  Users,\r\n  Map,\r\n  FileText,\r\n  BarChart3,\r\n  MessageSquare,\r\n} from 'lucide-react-native';\r\nimport { useRef, useEffect, useMemo } from 'react';\r\n\r\nimport { useAuth } from '../../lib/auth/auth-context';\r\nimport { useSyncStatus } from '../../lib/hooks/use-sync-status';\r\n\r\ntype UserRole = 'OWNER' | 'DISPATCHER' | 'TECHNICIAN';\r\n\r\nexport default function TabsLayout() {\r\n  const { user, isLoading } = useAuth();\r\n  const { isOnline, pendingOperations, isSyncing } = useSyncStatus();\r\n  const spinAnim = useRef(new Animated.Value(0)).current;\r\n\r\n  // Get user role with fallback\r\n  const userRole = useMemo(() => {\r\n    const role = user?.role?.toUpperCase();\r\n    if (role === 'OWNER' || role === 'DISPATCHER' || role === 'TECHNICIAN') {\r\n      return role as UserRole;\r\n    }\r\n    return 'TECHNICIAN' as UserRole;\r\n  }, [user?.role]);\r\n\r\n  // Check if user has access to specific tabs\r\n  const canSeeJobs = userRole === 'OWNER' || userRole === 'DISPATCHER';\r\n  const canSeeCalendar = userRole === 'OWNER' || userRole === 'DISPATCHER';\r\n  const canSeeTeam = userRole === 'OWNER';\r\n  const canSeeInvoices = userRole === 'OWNER';\r\n  const canSeeAnalytics = userRole === 'OWNER';\r\n  const canSeeInventory = userRole === 'TECHNICIAN';\r\n  // Phase 5.4: Chats available to all roles (technicians see assigned conversations)\r\n  const canSeeChats = userRole === 'OWNER' || userRole === 'DISPATCHER' || userRole === 'TECHNICIAN';\r\n\r\n  // Animate sync icon\r\n  useEffect(() => {\r\n    if (isSyncing) {\r\n      Animated.loop(\r\n        Animated.timing(spinAnim, {\r\n          toValue: 1,\r\n          duration: 1000,\r\n          useNativeDriver: true,\r\n        })\r\n      ).start();\r\n    } else {\r\n      spinAnim.setValue(0);\r\n    }\r\n  }, [isSyncing]);\r\n\r\n  const spin = spinAnim.interpolate({\r\n    inputRange: [0, 1],\r\n    outputRange: ['0deg', '360deg'],\r\n  });\r\n\r\n  // Redirect to login if not authenticated\r\n  if (!isLoading && !user) {\r\n    return <Redirect href=\"/(auth)/login\" />;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {/* Offline banner with pending operations count */}\r\n      {!isOnline && (\r\n        <View style={styles.offlineBanner}>\r\n          <WifiOff size={14} color=\"#fff\" />\r\n          <Text style={styles.offlineText}>Sin conexi├│n</Text>\r\n          {pendingOperations > 0 && (\r\n            <View style={styles.pendingBadge}>\r\n              <Text style={styles.pendingText}>{pendingOperations}</Text>\r\n            </View>\r\n          )}\r\n        </View>\r\n      )}\r\n\r\n      {/* Sync indicator with animation */}\r\n      {isOnline && isSyncing && (\r\n        <View style={styles.syncBanner}>\r\n          <Animated.View style={{ transform: [{ rotate: spin }] }}>\r\n            <RefreshCw size={14} color=\"#16a34a\" />\r\n          </Animated.View>\r\n          <Text style={styles.syncText}>Sincronizando...</Text>\r\n        </View>\r\n      )}\r\n\r\n      <Tabs\r\n        screenOptions={{\r\n          tabBarActiveTintColor: '#059669',\r\n          tabBarInactiveTintColor: '#9ca3af',\r\n          tabBarStyle: styles.tabBar,\r\n          tabBarLabelStyle: styles.tabBarLabel,\r\n          headerStyle: styles.header,\r\n          headerTitleStyle: styles.headerTitle,\r\n          headerShown: false,\r\n        }}\r\n      >\r\n        {/* Today's Jobs - All roles see this */}\r\n        <Tabs.Screen\r\n          name=\"today\"\r\n          options={{\r\n            title: 'Hoy',\r\n            headerTitle: 'Mis Trabajos de Hoy',\r\n            headerShown: true,\r\n            tabBarIcon: ({ color, size }) => (\r\n              <CalendarDays size={size} color={color} />\r\n            ),\r\n          }}\r\n        />\r\n\r\n        {/* All Jobs - OWNER and DISPATCHER only */}\r\n        <Tabs.Screen\r\n          name=\"jobs\"\r\n          options={{\r\n            title: 'Trabajos',\r\n            headerTitle: 'Todos los Trabajos',\r\n            headerShown: true,\r\n            href: canSeeJobs ? undefined : null,\r\n            tabBarIcon: ({ color, size }) => (\r\n              <Briefcase size={size} color={color} />\r\n            ),\r\n          }}\r\n        />\r\n\r\n        {/* Calendar/Agenda - OWNER and DISPATCHER only */}\r\n        <Tabs.Screen\r\n          name=\"calendar\"\r\n          options={{\r\n            title: 'Agenda',\r\n            href: canSeeCalendar ? undefined : null,\r\n            tabBarIcon: ({ color, size }) => (\r\n              <CalendarClock size={size} color={color} />\r\n            ),\r\n          }}\r\n        />\r\n\r\n        {/* Inventory - TECHNICIAN only */}\r\n        <Tabs.Screen\r\n          name=\"inventory\"\r\n          options={{\r\n            title: 'Inventario',\r\n            headerTitle: 'Mi Inventario',\r\n            headerShown: true,\r\n            href: canSeeInventory ? undefined : null,\r\n            tabBarIcon: ({ color, size }) => (\r\n              <Package size={size} color={color} />\r\n            ),\r\n          }}\r\n        />\r\n\r\n        {/* Team - OWNER only */}\r\n        <Tabs.Screen\r\n          name=\"team\"\r\n          options={{\r\n            title: 'Equipo',\r\n            headerTitle: 'Mi Equipo',\r\n            headerShown: true,\r\n            href: canSeeTeam ? undefined : null,\r\n            tabBarIcon: ({ color, size }) => (\r\n              <Users size={size} color={color} />\r\n            ),\r\n          }}\r\n        />\r\n\r\n        {/* Chats - Phase 5.4: All roles (technicians see assigned conversations) */}\r\n        <Tabs.Screen\r\n          name=\"chats\"\r\n          options={{\r\n            title: 'Chats',\r\n            headerTitle: 'Mis Conversaciones',\r\n            headerShown: true,\r\n            href: canSeeChats ? undefined : null,\r\n            tabBarIcon: ({ color, size }) => (\r\n              <MessageSquare size={size} color={color} />\r\n            ),\r\n          }}\r\n        />\r\n\r\n        {/* Profile - All roles */}\r\n        <Tabs.Screen\r\n          name=\"profile\"\r\n          options={{\r\n            title: 'Perfil',\r\n            headerTitle: user?.name || 'Perfil',\r\n            headerShown: true,\r\n            tabBarIcon: ({ color, size }) => (\r\n              <User size={size} color={color} />\r\n            ),\r\n          }}\r\n        />\r\n\r\n        {/* Hidden screens - accessible via navigation but not in tab bar */}\r\n        <Tabs.Screen\r\n          name=\"customers\"\r\n          options={{\r\n            title: 'Clientes',\r\n            headerTitle: 'Clientes',\r\n            headerShown: true,\r\n            href: null,\r\n            tabBarIcon: ({ color, size }) => (\r\n              <Users size={size} color={color} />\r\n            ),\r\n          }}\r\n        />\r\n\r\n        <Tabs.Screen\r\n          name=\"invoices\"\r\n          options={{\r\n            title: 'Facturas',\r\n            headerShown: true,\r\n            href: null,\r\n            tabBarIcon: ({ color, size }) => (\r\n              <FileText size={size} color={color} />\r\n            ),\r\n          }}\r\n        />\r\n\r\n        {/* Analytics - OWNER only, accessible from profile */}\r\n        <Tabs.Screen\r\n          name=\"analytics\"\r\n          options={{\r\n            title: 'Anal├¡ticas',\r\n            headerShown: false,\r\n            href: canSeeAnalytics ? null : null, // Hidden from tab bar, accessible via navigation\r\n            tabBarIcon: ({ color, size }) => (\r\n              <BarChart3 size={size} color={color} />\r\n            ),\r\n          }}\r\n        />\r\n      </Tabs>\r\n    </>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  tabBar: {\r\n    backgroundColor: '#fff',\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#e5e7eb',\r\n    paddingTop: 8,\r\n    paddingBottom: 8,\r\n    height: 64,\r\n  },\r\n  tabBarLabel: {\r\n    fontSize: 11,\r\n    fontWeight: '500',\r\n  },\r\n  header: {\r\n    backgroundColor: '#059669',\r\n  },\r\n  headerTitle: {\r\n    color: '#fff',\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n  },\r\n  offlineBanner: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#ef4444',\r\n    paddingVertical: 8,\r\n  },\r\n  offlineText: {\r\n    color: '#fff',\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n  },\r\n  pendingBadge: {\r\n    backgroundColor: '#fff',\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 2,\r\n    borderRadius: 10,\r\n    marginLeft: 4,\r\n  },\r\n  pendingText: {\r\n    color: '#ef4444',\r\n    fontSize: 12,\r\n    fontWeight: '700',\r\n  },\r\n  syncBanner: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#f0fdf4',\r\n    paddingVertical: 8,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#dcfce7',\r\n  },\r\n  syncText: {\r\n    color: '#059669',\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\analytics\\_layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\analytics\\index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":26,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingDown' is defined but never used.","line":27,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":32,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used.","line":40,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SCREEN_WIDTH' is assigned a value but never used.","line":44,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PERIOD_LABELS' is assigned a value but never used.","line":49,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":101,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Analytics Dashboard - Owner Only\r\n * =================================\r\n *\r\n * Phase 2.5.2: Analytics Dashboard\r\n * - Revenue overview with period comparison\r\n * - Job completion metrics\r\n * - Technician performance rankings\r\n * - Customer satisfaction trends\r\n * - Service type breakdown\r\n */\r\n\r\nimport { useState, useMemo } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  ScrollView,\r\n  TouchableOpacity,\r\n  Dimensions,\r\n  RefreshControl,\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\nimport { useRouter } from 'expo-router';\r\nimport {\r\n  TrendingUp,\r\n  TrendingDown,\r\n  DollarSign,\r\n  CheckCircle2,\r\n  Clock,\r\n  Star,\r\n  Users,\r\n  Briefcase,\r\n  ChevronRight,\r\n  Calendar,\r\n  BarChart3,\r\n  PieChart,\r\n  ArrowUpRight,\r\n  ArrowDownRight,\r\n  AlertCircle,\r\n} from 'lucide-react-native';\r\nimport { useAuth } from '../../../lib/auth/auth-context';\r\n\r\nconst { width: SCREEN_WIDTH } = Dimensions.get('window');\r\n\r\n// Time period options\r\ntype Period = 'week' | 'month' | 'quarter' | 'year';\r\n\r\nconst PERIOD_LABELS: Record<Period, string> = {\r\n  week: 'Esta semana',\r\n  month: 'Este mes',\r\n  quarter: 'Este trimestre',\r\n  year: 'Este a├▒o',\r\n};\r\n\r\n// Mock analytics data\r\nconst MOCK_ANALYTICS = {\r\n  revenue: {\r\n    current: 2450000,\r\n    previous: 2180000,\r\n    currency: 'ARS',\r\n  },\r\n  jobs: {\r\n    completed: 156,\r\n    scheduled: 42,\r\n    cancelled: 8,\r\n    avgCompletionTime: 95, // minutes\r\n  },\r\n  satisfaction: {\r\n    avgRating: 4.7,\r\n    totalReviews: 134,\r\n    fiveStars: 98,\r\n    fourStars: 28,\r\n    threeOrLess: 8,\r\n  },\r\n  technicians: [\r\n    { id: '1', name: 'Carlos R.', jobs: 48, rating: 4.8, revenue: 680000 },\r\n    { id: '2', name: 'Mar├¡a G.', jobs: 42, rating: 4.6, revenue: 590000 },\r\n    { id: '3', name: 'Juan P.', jobs: 38, rating: 4.5, revenue: 520000 },\r\n    { id: '4', name: 'Diego M.', jobs: 28, rating: 4.3, revenue: 380000 },\r\n  ],\r\n  serviceTypes: [\r\n    { type: 'Instalaci├│n', count: 45, revenue: 980000, color: '#3b82f6' },\r\n    { type: 'Reparaci├│n', count: 62, revenue: 720000, color: '#10b981' },\r\n    { type: 'Mantenimiento', count: 38, revenue: 480000, color: '#f59e0b' },\r\n    { type: 'Diagn├│stico', count: 11, revenue: 270000, color: '#8b5cf6' },\r\n  ],\r\n  weeklyTrend: [\r\n    { day: 'Lun', jobs: 8, revenue: 180000 },\r\n    { day: 'Mar', jobs: 12, revenue: 260000 },\r\n    { day: 'Mi├⌐', jobs: 10, revenue: 220000 },\r\n    { day: 'Jue', jobs: 14, revenue: 310000 },\r\n    { day: 'Vie', jobs: 16, revenue: 380000 },\r\n    { day: 'S├íb', jobs: 6, revenue: 140000 },\r\n    { day: 'Dom', jobs: 2, revenue: 60000 },\r\n  ],\r\n};\r\n\r\nexport default function AnalyticsDashboard() {\r\n  const router = useRouter();\r\n  const { user } = useAuth();\r\n  const [period, setPeriod] = useState<Period>('month');\r\n  const [refreshing, setRefreshing] = useState(false);\r\n\r\n  const analytics = MOCK_ANALYTICS;\r\n\r\n  // Calculate percentage change\r\n  const revenueChange = useMemo(() => {\r\n    const change =\r\n      ((analytics.revenue.current - analytics.revenue.previous) /\r\n        analytics.revenue.previous) *\r\n      100;\r\n    return {\r\n      value: Math.abs(change).toFixed(1),\r\n      isPositive: change >= 0,\r\n    };\r\n  }, [analytics.revenue]);\r\n\r\n  // Format currency\r\n  const formatCurrency = (amount: number) => {\r\n    return new Intl.NumberFormat('es-AR', {\r\n      style: 'currency',\r\n      currency: 'ARS',\r\n      minimumFractionDigits: 0,\r\n      maximumFractionDigits: 0,\r\n    }).format(amount);\r\n  };\r\n\r\n  // Get max value for bar chart scaling\r\n  const maxWeeklyJobs = Math.max(...analytics.weeklyTrend.map((d) => d.jobs));\r\n  const totalServiceJobs = analytics.serviceTypes.reduce((sum, s) => sum + s.count, 0);\r\n\r\n  const onRefresh = async () => {\r\n    setRefreshing(true);\r\n    // In production, fetch fresh analytics data\r\n    setTimeout(() => setRefreshing(false), 1000);\r\n  };\r\n\r\n  return (\r\n    <SafeAreaView style={styles.container} edges={['top']}>\r\n      {/* Header */}\r\n      <View style={styles.header}>\r\n        <View>\r\n          <Text style={styles.title}>Anal├¡ticas</Text>\r\n          <Text style={styles.subtitle}>Resumen del negocio</Text>\r\n        </View>\r\n        <View style={styles.periodSelector}>\r\n          {(['week', 'month', 'quarter'] as Period[]).map((p) => (\r\n            <TouchableOpacity\r\n              key={p}\r\n              style={[styles.periodButton, period === p && styles.periodButtonActive]}\r\n              onPress={() => setPeriod(p)}\r\n            >\r\n              <Text\r\n                style={[\r\n                  styles.periodButtonText,\r\n                  period === p && styles.periodButtonTextActive,\r\n                ]}\r\n              >\r\n                {p === 'week' ? 'Sem' : p === 'month' ? 'Mes' : 'Trim'}\r\n              </Text>\r\n            </TouchableOpacity>\r\n          ))}\r\n        </View>\r\n      </View>\r\n\r\n      <ScrollView\r\n        style={styles.content}\r\n        showsVerticalScrollIndicator={false}\r\n        refreshControl={\r\n          <RefreshControl\r\n            refreshing={refreshing}\r\n            onRefresh={onRefresh}\r\n            tintColor=\"#059669\"\r\n          />\r\n        }\r\n      >\r\n        {/* Revenue Card */}\r\n        <View style={styles.revenueCard}>\r\n          <View style={styles.revenueHeader}>\r\n            <View style={styles.revenueIconContainer}>\r\n              <DollarSign size={20} color=\"#059669\" />\r\n            </View>\r\n            <Text style={styles.revenueLabel}>Ingresos totales</Text>\r\n          </View>\r\n          <View style={styles.revenueMain}>\r\n            <Text style={styles.revenueAmount}>\r\n              {formatCurrency(analytics.revenue.current)}\r\n            </Text>\r\n            <View\r\n              style={[\r\n                styles.changeIndicator,\r\n                revenueChange.isPositive ? styles.changePositive : styles.changeNegative,\r\n              ]}\r\n            >\r\n              {revenueChange.isPositive ? (\r\n                <ArrowUpRight size={14} color=\"#059669\" />\r\n              ) : (\r\n                <ArrowDownRight size={14} color=\"#dc2626\" />\r\n              )}\r\n              <Text\r\n                style={[\r\n                  styles.changeText,\r\n                  revenueChange.isPositive\r\n                    ? styles.changeTextPositive\r\n                    : styles.changeTextNegative,\r\n                ]}\r\n              >\r\n                {revenueChange.value}%\r\n              </Text>\r\n            </View>\r\n          </View>\r\n          <Text style={styles.revenuePrevious}>\r\n            vs {formatCurrency(analytics.revenue.previous)} per├¡odo anterior\r\n          </Text>\r\n        </View>\r\n\r\n        {/* Quick Stats */}\r\n        <View style={styles.statsGrid}>\r\n          <View style={styles.statCard}>\r\n            <View style={[styles.statIcon, { backgroundColor: '#dbeafe' }]}>\r\n              <CheckCircle2 size={18} color=\"#3b82f6\" />\r\n            </View>\r\n            <Text style={styles.statValue}>{analytics.jobs.completed}</Text>\r\n            <Text style={styles.statLabel}>Completados</Text>\r\n          </View>\r\n\r\n          <View style={styles.statCard}>\r\n            <View style={[styles.statIcon, { backgroundColor: '#fef3c7' }]}>\r\n              <Calendar size={18} color=\"#f59e0b\" />\r\n            </View>\r\n            <Text style={styles.statValue}>{analytics.jobs.scheduled}</Text>\r\n            <Text style={styles.statLabel}>Programados</Text>\r\n          </View>\r\n\r\n          <View style={styles.statCard}>\r\n            <View style={[styles.statIcon, { backgroundColor: '#fce7f3' }]}>\r\n              <Star size={18} color=\"#ec4899\" />\r\n            </View>\r\n            <Text style={styles.statValue}>{analytics.satisfaction.avgRating}</Text>\r\n            <Text style={styles.statLabel}>Calificaci├│n</Text>\r\n          </View>\r\n\r\n          <View style={styles.statCard}>\r\n            <View style={[styles.statIcon, { backgroundColor: '#e0e7ff' }]}>\r\n              <Clock size={18} color=\"#6366f1\" />\r\n            </View>\r\n            <Text style={styles.statValue}>{analytics.jobs.avgCompletionTime}m</Text>\r\n            <Text style={styles.statLabel}>Tiempo prom.</Text>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Weekly Trend */}\r\n        <View style={styles.section}>\r\n          <View style={styles.sectionHeader}>\r\n            <Text style={styles.sectionTitle}>Tendencia semanal</Text>\r\n            <BarChart3 size={18} color=\"#6b7280\" />\r\n          </View>\r\n          <View style={styles.chartContainer}>\r\n            <View style={styles.barChart}>\r\n              {analytics.weeklyTrend.map((day, index) => (\r\n                <View key={index} style={styles.barColumn}>\r\n                  <View style={styles.barWrapper}>\r\n                    <View\r\n                      style={[\r\n                        styles.bar,\r\n                        {\r\n                          height: `${(day.jobs / maxWeeklyJobs) * 100}%`,\r\n                          backgroundColor:\r\n                            index === analytics.weeklyTrend.length - 3\r\n                              ? '#059669'\r\n                              : '#d1d5db',\r\n                        },\r\n                      ]}\r\n                    />\r\n                  </View>\r\n                  <Text style={styles.barLabel}>{day.day}</Text>\r\n                </View>\r\n              ))}\r\n            </View>\r\n            <View style={styles.chartLegend}>\r\n              <Text style={styles.legendText}>\r\n                Mejor d├¡a: Viernes ({analytics.weeklyTrend[4].jobs} trabajos)\r\n              </Text>\r\n            </View>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Service Type Breakdown */}\r\n        <View style={styles.section}>\r\n          <View style={styles.sectionHeader}>\r\n            <Text style={styles.sectionTitle}>Por tipo de servicio</Text>\r\n            <PieChart size={18} color=\"#6b7280\" />\r\n          </View>\r\n          <View style={styles.serviceList}>\r\n            {analytics.serviceTypes.map((service, index) => (\r\n              <View key={index} style={styles.serviceRow}>\r\n                <View style={styles.serviceInfo}>\r\n                  <View\r\n                    style={[styles.serviceDot, { backgroundColor: service.color }]}\r\n                  />\r\n                  <Text style={styles.serviceName}>{service.type}</Text>\r\n                </View>\r\n                <View style={styles.serviceStats}>\r\n                  <Text style={styles.serviceCount}>{service.count}</Text>\r\n                  <View style={styles.serviceBarContainer}>\r\n                    <View\r\n                      style={[\r\n                        styles.serviceBar,\r\n                        {\r\n                          width: `${(service.count / totalServiceJobs) * 100}%`,\r\n                          backgroundColor: service.color,\r\n                        },\r\n                      ]}\r\n                    />\r\n                  </View>\r\n                  <Text style={styles.serviceRevenue}>\r\n                    {formatCurrency(service.revenue)}\r\n                  </Text>\r\n                </View>\r\n              </View>\r\n            ))}\r\n          </View>\r\n        </View>\r\n\r\n        {/* Top Technicians */}\r\n        <View style={styles.section}>\r\n          <View style={styles.sectionHeader}>\r\n            <Text style={styles.sectionTitle}>Top t├⌐cnicos</Text>\r\n            <TouchableOpacity\r\n              style={styles.seeAllButton}\r\n              onPress={() => router.push('/(tabs)/team')}\r\n            >\r\n              <Text style={styles.seeAllText}>Ver todos</Text>\r\n              <ChevronRight size={16} color=\"#059669\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n          <View style={styles.technicianList}>\r\n            {analytics.technicians.map((tech, index) => (\r\n              <View key={tech.id} style={styles.technicianRow}>\r\n                <View style={styles.techRank}>\r\n                  <Text\r\n                    style={[\r\n                      styles.techRankText,\r\n                      index === 0 && styles.techRankFirst,\r\n                    ]}\r\n                  >\r\n                    #{index + 1}\r\n                  </Text>\r\n                </View>\r\n                <View style={styles.techInfo}>\r\n                  <Text style={styles.techName}>{tech.name}</Text>\r\n                  <View style={styles.techMeta}>\r\n                    <View style={styles.techMetaItem}>\r\n                      <Briefcase size={12} color=\"#6b7280\" />\r\n                      <Text style={styles.techMetaText}>{tech.jobs}</Text>\r\n                    </View>\r\n                    <View style={styles.techMetaItem}>\r\n                      <Star size={12} color=\"#f59e0b\" />\r\n                      <Text style={styles.techMetaText}>{tech.rating}</Text>\r\n                    </View>\r\n                  </View>\r\n                </View>\r\n                <Text style={styles.techRevenue}>{formatCurrency(tech.revenue)}</Text>\r\n              </View>\r\n            ))}\r\n          </View>\r\n        </View>\r\n\r\n        {/* Customer Satisfaction */}\r\n        <View style={styles.section}>\r\n          <View style={styles.sectionHeader}>\r\n            <Text style={styles.sectionTitle}>Satisfacci├│n del cliente</Text>\r\n            <Star size={18} color=\"#f59e0b\" />\r\n          </View>\r\n          <View style={styles.satisfactionCard}>\r\n            <View style={styles.satisfactionMain}>\r\n              <Text style={styles.satisfactionScore}>\r\n                {analytics.satisfaction.avgRating}\r\n              </Text>\r\n              <View style={styles.starsRow}>\r\n                {[1, 2, 3, 4, 5].map((star) => (\r\n                  <Star\r\n                    key={star}\r\n                    size={20}\r\n                    color=\"#f59e0b\"\r\n                    fill={star <= Math.round(analytics.satisfaction.avgRating) ? '#f59e0b' : 'none'}\r\n                  />\r\n                ))}\r\n              </View>\r\n              <Text style={styles.reviewCount}>\r\n                {analytics.satisfaction.totalReviews} rese├▒as\r\n              </Text>\r\n            </View>\r\n            <View style={styles.satisfactionBreakdown}>\r\n              <View style={styles.ratingRow}>\r\n                <Text style={styles.ratingLabel}>5 estrellas</Text>\r\n                <View style={styles.ratingBarContainer}>\r\n                  <View\r\n                    style={[\r\n                      styles.ratingBar,\r\n                      {\r\n                        width: `${(analytics.satisfaction.fiveStars /\r\n                            analytics.satisfaction.totalReviews) *\r\n                          100\r\n                          }%`,\r\n                      },\r\n                    ]}\r\n                  />\r\n                </View>\r\n                <Text style={styles.ratingCount}>\r\n                  {analytics.satisfaction.fiveStars}\r\n                </Text>\r\n              </View>\r\n              <View style={styles.ratingRow}>\r\n                <Text style={styles.ratingLabel}>4 estrellas</Text>\r\n                <View style={styles.ratingBarContainer}>\r\n                  <View\r\n                    style={[\r\n                      styles.ratingBar,\r\n                      styles.ratingBarFour,\r\n                      {\r\n                        width: `${(analytics.satisfaction.fourStars /\r\n                            analytics.satisfaction.totalReviews) *\r\n                          100\r\n                          }%`,\r\n                      },\r\n                    ]}\r\n                  />\r\n                </View>\r\n                <Text style={styles.ratingCount}>\r\n                  {analytics.satisfaction.fourStars}\r\n                </Text>\r\n              </View>\r\n              <View style={styles.ratingRow}>\r\n                <Text style={styles.ratingLabel}>3 o menos</Text>\r\n                <View style={styles.ratingBarContainer}>\r\n                  <View\r\n                    style={[\r\n                      styles.ratingBar,\r\n                      styles.ratingBarLow,\r\n                      {\r\n                        width: `${(analytics.satisfaction.threeOrLess /\r\n                            analytics.satisfaction.totalReviews) *\r\n                          100\r\n                          }%`,\r\n                      },\r\n                    ]}\r\n                  />\r\n                </View>\r\n                <Text style={styles.ratingCount}>\r\n                  {analytics.satisfaction.threeOrLess}\r\n                </Text>\r\n              </View>\r\n            </View>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Bottom padding */}\r\n        <View style={styles.bottomPadding} />\r\n      </ScrollView>\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f9fafb',\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'flex-start',\r\n    paddingHorizontal: 16,\r\n    paddingTop: 16,\r\n    paddingBottom: 12,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  title: {\r\n    fontSize: 28,\r\n    fontWeight: '700',\r\n    color: '#111827',\r\n  },\r\n  subtitle: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n  },\r\n  periodSelector: {\r\n    flexDirection: 'row',\r\n    backgroundColor: '#f3f4f6',\r\n    borderRadius: 8,\r\n    padding: 2,\r\n  },\r\n  periodButton: {\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 6,\r\n    borderRadius: 6,\r\n  },\r\n  periodButtonActive: {\r\n    backgroundColor: '#059669',\r\n  },\r\n  periodButtonText: {\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n    color: '#6b7280',\r\n  },\r\n  periodButtonTextActive: {\r\n    color: '#fff',\r\n  },\r\n  content: {\r\n    flex: 1,\r\n  },\r\n  // Revenue Card\r\n  revenueCard: {\r\n    margin: 16,\r\n    padding: 20,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 16,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 2 },\r\n    shadowOpacity: 0.05,\r\n    shadowRadius: 8,\r\n    elevation: 2,\r\n  },\r\n  revenueHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n  },\r\n  revenueIconContainer: {\r\n    width: 36,\r\n    height: 36,\r\n    borderRadius: 18,\r\n    backgroundColor: '#ecfdf5',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  revenueLabel: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n  },\r\n  revenueMain: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 12,\r\n    marginTop: 12,\r\n  },\r\n  revenueAmount: {\r\n    fontSize: 32,\r\n    fontWeight: '700',\r\n    color: '#111827',\r\n  },\r\n  changeIndicator: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 2,\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 4,\r\n    borderRadius: 6,\r\n  },\r\n  changePositive: {\r\n    backgroundColor: '#ecfdf5',\r\n  },\r\n  changeNegative: {\r\n    backgroundColor: '#fef2f2',\r\n  },\r\n  changeText: {\r\n    fontSize: 13,\r\n    fontWeight: '600',\r\n  },\r\n  changeTextPositive: {\r\n    color: '#059669',\r\n  },\r\n  changeTextNegative: {\r\n    color: '#dc2626',\r\n  },\r\n  revenuePrevious: {\r\n    fontSize: 12,\r\n    color: '#9ca3af',\r\n    marginTop: 8,\r\n  },\r\n  // Stats Grid\r\n  statsGrid: {\r\n    flexDirection: 'row',\r\n    flexWrap: 'wrap',\r\n    paddingHorizontal: 12,\r\n    gap: 8,\r\n  },\r\n  statCard: {\r\n    flex: 1,\r\n    minWidth: '22%',\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    padding: 12,\r\n    alignItems: 'center',\r\n  },\r\n  statIcon: {\r\n    width: 36,\r\n    height: 36,\r\n    borderRadius: 18,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    marginBottom: 8,\r\n  },\r\n  statValue: {\r\n    fontSize: 20,\r\n    fontWeight: '700',\r\n    color: '#111827',\r\n  },\r\n  statLabel: {\r\n    fontSize: 11,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n    textAlign: 'center',\r\n  },\r\n  // Section\r\n  section: {\r\n    marginTop: 20,\r\n    marginHorizontal: 16,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 16,\r\n    padding: 16,\r\n  },\r\n  sectionHeader: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    marginBottom: 16,\r\n  },\r\n  sectionTitle: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  seeAllButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n  },\r\n  seeAllText: {\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n    color: '#059669',\r\n  },\r\n  // Bar Chart\r\n  chartContainer: {\r\n    marginTop: 8,\r\n  },\r\n  barChart: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'flex-end',\r\n    height: 120,\r\n    paddingTop: 20,\r\n  },\r\n  barColumn: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n  },\r\n  barWrapper: {\r\n    height: 80,\r\n    width: 24,\r\n    justifyContent: 'flex-end',\r\n  },\r\n  bar: {\r\n    width: '100%',\r\n    borderRadius: 4,\r\n    minHeight: 4,\r\n  },\r\n  barLabel: {\r\n    fontSize: 11,\r\n    color: '#6b7280',\r\n    marginTop: 8,\r\n  },\r\n  chartLegend: {\r\n    marginTop: 12,\r\n    paddingTop: 12,\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#f3f4f6',\r\n    alignItems: 'center',\r\n  },\r\n  legendText: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n  },\r\n  // Service Types\r\n  serviceList: {\r\n    gap: 12,\r\n  },\r\n  serviceRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n  },\r\n  serviceInfo: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n    width: 100,\r\n  },\r\n  serviceDot: {\r\n    width: 10,\r\n    height: 10,\r\n    borderRadius: 5,\r\n  },\r\n  serviceName: {\r\n    fontSize: 13,\r\n    color: '#374151',\r\n  },\r\n  serviceStats: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n  },\r\n  serviceCount: {\r\n    fontSize: 13,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    width: 28,\r\n    textAlign: 'center',\r\n  },\r\n  serviceBarContainer: {\r\n    flex: 1,\r\n    height: 8,\r\n    backgroundColor: '#f3f4f6',\r\n    borderRadius: 4,\r\n    overflow: 'hidden',\r\n  },\r\n  serviceBar: {\r\n    height: '100%',\r\n    borderRadius: 4,\r\n  },\r\n  serviceRevenue: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    width: 80,\r\n    textAlign: 'right',\r\n  },\r\n  // Technicians\r\n  technicianList: {\r\n    gap: 12,\r\n  },\r\n  technicianRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n  },\r\n  techRank: {\r\n    width: 32,\r\n  },\r\n  techRankText: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#9ca3af',\r\n  },\r\n  techRankFirst: {\r\n    color: '#f59e0b',\r\n  },\r\n  techInfo: {\r\n    flex: 1,\r\n  },\r\n  techName: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  techMeta: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 12,\r\n    marginTop: 4,\r\n  },\r\n  techMetaItem: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n  },\r\n  techMetaText: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n  },\r\n  techRevenue: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#059669',\r\n  },\r\n  // Satisfaction\r\n  satisfactionCard: {\r\n    flexDirection: 'row',\r\n    gap: 20,\r\n  },\r\n  satisfactionMain: {\r\n    alignItems: 'center',\r\n  },\r\n  satisfactionScore: {\r\n    fontSize: 48,\r\n    fontWeight: '700',\r\n    color: '#111827',\r\n  },\r\n  starsRow: {\r\n    flexDirection: 'row',\r\n    gap: 2,\r\n    marginTop: 4,\r\n  },\r\n  reviewCount: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 8,\r\n  },\r\n  satisfactionBreakdown: {\r\n    flex: 1,\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n  },\r\n  ratingRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n  },\r\n  ratingLabel: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    width: 70,\r\n  },\r\n  ratingBarContainer: {\r\n    flex: 1,\r\n    height: 8,\r\n    backgroundColor: '#f3f4f6',\r\n    borderRadius: 4,\r\n    overflow: 'hidden',\r\n  },\r\n  ratingBar: {\r\n    height: '100%',\r\n    backgroundColor: '#10b981',\r\n    borderRadius: 4,\r\n  },\r\n  ratingBarFour: {\r\n    backgroundColor: '#34d399',\r\n  },\r\n  ratingBarLow: {\r\n    backgroundColor: '#f59e0b',\r\n  },\r\n  ratingCount: {\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    width: 30,\r\n    textAlign: 'right',\r\n  },\r\n  bottomPadding: {\r\n    height: 100,\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\calendar\\_layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\calendar\\index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FlashList' is defined but never used.","line":25,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SCREEN_WIDTH' is assigned a value but never used.","line":47,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":93,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":93,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'renderJobCard' is assigned a value but never used.","line":450,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":450,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Calendar/Schedule Screen - Enhanced for Dispatchers\r\n * ====================================================\r\n *\r\n * Phase 2.4.3: Schedule Overview\r\n * - Day/Week view toggle\r\n * - Visual time grid with jobs\r\n * - Technician color coding\r\n * - Job assignment/reassignment\r\n * - Week stats summary\r\n */\r\n\r\nimport { useState, useMemo, useCallback } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  TouchableOpacity,\r\n  ScrollView,\r\n  Modal,\r\n  Dimensions,\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\nimport { useRouter } from 'expo-router';\r\nimport { FlashList } from '@shopify/flash-list';\r\nimport {\r\n  ChevronLeft,\r\n  ChevronRight,\r\n  Plus,\r\n  Clock,\r\n  MapPin,\r\n  User,\r\n  AlertCircle,\r\n  Calendar,\r\n  LayoutGrid,\r\n  X,\r\n  Check,\r\n  Users,\r\n} from 'lucide-react-native';\r\nimport { withObservables } from '@nozbe/watermelondb/react';\r\nimport { Q } from '@nozbe/watermelondb';\r\nimport { database } from '../../../watermelon/database';\r\nimport { Job } from '../../../watermelon/models';\r\nimport { useAuth } from '../../../lib/auth/auth-context';\r\nimport { useOffline } from '../../../lib/hooks/use-offline';\r\n\r\nconst { width: SCREEN_WIDTH } = Dimensions.get('window');\r\n\r\n// Technician colors for visual distinction\r\nconst TECHNICIAN_COLORS = [\r\n  '#3b82f6', // blue\r\n  '#10b981', // green\r\n  '#f59e0b', // amber\r\n  '#ef4444', // red\r\n  '#8b5cf6', // purple\r\n  '#ec4899', // pink\r\n  '#06b6d4', // cyan\r\n  '#f97316', // orange\r\n];\r\n\r\nconst DAYS_ES = ['Dom', 'Lun', 'Mar', 'Mi├⌐', 'Jue', 'Vie', 'S├íb'];\r\nconst DAYS_FULL_ES = ['Domingo', 'Lunes', 'Martes', 'Mi├⌐rcoles', 'Jueves', 'Viernes', 'S├íbado'];\r\nconst MONTHS_ES = [\r\n  'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',\r\n  'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre',\r\n];\r\n\r\n// Working hours for time grid\r\nconst WORK_HOURS = Array.from({ length: 12 }, (_, i) => i + 7); // 7:00 - 18:00\r\n\r\ninterface Technician {\r\n  id: string;\r\n  name: string;\r\n  color: string;\r\n}\r\n\r\n// Mock technicians - in production from WatermelonDB\r\nconst MOCK_TECHNICIANS: Technician[] = [\r\n  { id: 'tech1', name: 'Carlos R.', color: TECHNICIAN_COLORS[0] },\r\n  { id: 'tech2', name: 'Miguel S.', color: TECHNICIAN_COLORS[1] },\r\n  { id: 'tech3', name: 'Juan P.', color: TECHNICIAN_COLORS[2] },\r\n  { id: 'tech4', name: 'Diego M.', color: TECHNICIAN_COLORS[3] },\r\n];\r\n\r\ntype ViewMode = 'day' | 'week';\r\n\r\ninterface ScheduleScreenProps {\r\n  jobs: Job[];\r\n}\r\n\r\nfunction ScheduleScreen({ jobs }: ScheduleScreenProps) {\r\n  const router = useRouter();\r\n  const { user } = useAuth();\r\n  const { actions: offlineActions } = useOffline();\r\n  const enqueueOperation = offlineActions.queueOperation;\r\n\r\n  const [selectedDate, setSelectedDate] = useState(new Date());\r\n  const [viewMode, setViewMode] = useState<ViewMode>('day');\r\n  const [selectedJob, setSelectedJob] = useState<Job | null>(null);\r\n  const [showAssignModal, setShowAssignModal] = useState(false);\r\n  const [technicians] = useState<Technician[]>(MOCK_TECHNICIANS);\r\n\r\n  // Get week start (Monday)\r\n  const weekStart = useMemo(() => {\r\n    const date = new Date(selectedDate);\r\n    const day = date.getDay();\r\n    const diff = date.getDate() - day + (day === 0 ? -6 : 1);\r\n    return new Date(date.setDate(diff));\r\n  }, [selectedDate]);\r\n\r\n  // Get week days\r\n  const weekDays = useMemo(() => {\r\n    return Array.from({ length: 7 }, (_, i) => {\r\n      const date = new Date(weekStart);\r\n      date.setDate(weekStart.getDate() + i);\r\n      return date;\r\n    });\r\n  }, [weekStart]);\r\n\r\n  // Filter jobs for selected date/week\r\n  const filteredJobs = useMemo(() => {\r\n    if (viewMode === 'day') {\r\n      return jobs.filter((job) => {\r\n        const jobDate = new Date(job.scheduledDate);\r\n        return (\r\n          jobDate.getDate() === selectedDate.getDate() &&\r\n          jobDate.getMonth() === selectedDate.getMonth() &&\r\n          jobDate.getFullYear() === selectedDate.getFullYear()\r\n        );\r\n      });\r\n    } else {\r\n      const weekEnd = new Date(weekStart);\r\n      weekEnd.setDate(weekEnd.getDate() + 7);\r\n      return jobs.filter((job) => {\r\n        const jobDate = new Date(job.scheduledDate);\r\n        return jobDate >= weekStart && jobDate < weekEnd;\r\n      });\r\n    }\r\n  }, [jobs, selectedDate, viewMode, weekStart]);\r\n\r\n  // Jobs by day for week view\r\n  const jobsByDay = useMemo(() => {\r\n    const map: Record<string, Job[]> = {};\r\n    weekDays.forEach((day) => {\r\n      const key = day.toISOString().split('T')[0];\r\n      map[key] = filteredJobs.filter((job) => {\r\n        const jobDate = new Date(job.scheduledDate);\r\n        return (\r\n          jobDate.getDate() === day.getDate() &&\r\n          jobDate.getMonth() === day.getMonth() &&\r\n          jobDate.getFullYear() === day.getFullYear()\r\n        );\r\n      });\r\n    });\r\n    return map;\r\n  }, [weekDays, filteredJobs]);\r\n\r\n  // Week stats\r\n  const weekStats = useMemo(() => {\r\n    const allWeekJobs = Object.values(jobsByDay).flat();\r\n    return {\r\n      total: allWeekJobs.length,\r\n      assigned: allWeekJobs.filter((j) => j.assignedToId).length,\r\n      unassigned: allWeekJobs.filter((j) => !j.assignedToId).length,\r\n      completed: allWeekJobs.filter((j) => j.status === 'completed').length,\r\n    };\r\n  }, [jobsByDay]);\r\n\r\n  const isToday = useCallback((date: Date) => {\r\n    const today = new Date();\r\n    return (\r\n      date.getDate() === today.getDate() &&\r\n      date.getMonth() === today.getMonth() &&\r\n      date.getFullYear() === today.getFullYear()\r\n    );\r\n  }, []);\r\n\r\n  const isSelected = useCallback((date: Date) => {\r\n    return (\r\n      date.getDate() === selectedDate.getDate() &&\r\n      date.getMonth() === selectedDate.getMonth() &&\r\n      date.getFullYear() === selectedDate.getFullYear()\r\n    );\r\n  }, [selectedDate]);\r\n\r\n  const formattedDate = useMemo(() => {\r\n    const day = DAYS_ES[selectedDate.getDay()];\r\n    const date = selectedDate.getDate();\r\n    const month = MONTHS_ES[selectedDate.getMonth()];\r\n    return `${day} ${date} ${month}`;\r\n  }, [selectedDate]);\r\n\r\n  const formattedWeek = useMemo(() => {\r\n    const weekEnd = new Date(weekStart);\r\n    weekEnd.setDate(weekEnd.getDate() + 6);\r\n    const startMonth = MONTHS_ES[weekStart.getMonth()];\r\n    const endMonth = MONTHS_ES[weekEnd.getMonth()];\r\n    if (startMonth === endMonth) {\r\n      return `${weekStart.getDate()} - ${weekEnd.getDate()} ${startMonth}`;\r\n    }\r\n    return `${weekStart.getDate()} ${startMonth} - ${weekEnd.getDate()} ${endMonth}`;\r\n  }, [weekStart]);\r\n\r\n  const navigate = (direction: number) => {\r\n    const newDate = new Date(selectedDate);\r\n    if (viewMode === 'day') {\r\n      newDate.setDate(newDate.getDate() + direction);\r\n    } else {\r\n      newDate.setDate(newDate.getDate() + direction * 7);\r\n    }\r\n    setSelectedDate(newDate);\r\n  };\r\n\r\n  const goToToday = () => setSelectedDate(new Date());\r\n\r\n  const handleCreateJob = () => router.push('/jobs/create');\r\n\r\n  const handleJobPress = (job: Job) => {\r\n    router.push(`/jobs/${job.id}`);\r\n  };\r\n\r\n  const handleAssignJob = (job: Job) => {\r\n    setSelectedJob(job);\r\n    setShowAssignModal(true);\r\n  };\r\n\r\n  const assignTechnician = async (technicianId: string) => {\r\n    if (!selectedJob) return;\r\n\r\n    try {\r\n      await database.write(async () => {\r\n        await selectedJob.update((j) => {\r\n          j.assignedToId = technicianId;\r\n        });\r\n      });\r\n\r\n      enqueueOperation(\r\n        'jobs',\r\n        selectedJob.id,\r\n        'update',\r\n        { assigned_to_id: technicianId },\r\n      );\r\n    } catch (error) {\r\n      console.error('Failed to assign technician:', error);\r\n    }\r\n\r\n    setShowAssignModal(false);\r\n    setSelectedJob(null);\r\n  };\r\n\r\n  const getTechnicianColor = (techId: string | null): string => {\r\n    if (!techId) return '#9ca3af';\r\n    const tech = technicians.find((t) => t.id === techId);\r\n    return tech?.color || '#9ca3af';\r\n  };\r\n\r\n  const getTechnicianName = (techId: string | null): string => {\r\n    if (!techId) return 'Sin asignar';\r\n    const tech = technicians.find((t) => t.id === techId);\r\n    return tech?.name || 'Desconocido';\r\n  };\r\n\r\n  const getJobTime = (job: Job): string => {\r\n    const date = new Date(job.scheduledDate);\r\n    return date.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });\r\n  };\r\n\r\n  const getJobHour = (job: Job): number => {\r\n    const date = new Date(job.scheduledDate);\r\n    return date.getHours();\r\n  };\r\n\r\n  // Render time grid for day view\r\n  const renderTimeGrid = () => {\r\n    return (\r\n      <View style={styles.timeGrid}>\r\n        {WORK_HOURS.map((hour) => {\r\n          const hourJobs = filteredJobs.filter((j) => getJobHour(j) === hour);\r\n          return (\r\n            <View key={hour} style={styles.timeRow}>\r\n              <View style={styles.timeLabel}>\r\n                <Text style={styles.timeLabelText}>\r\n                  {hour.toString().padStart(2, '0')}:00\r\n                </Text>\r\n              </View>\r\n              <View style={styles.timeSlot}>\r\n                {hourJobs.map((job) => (\r\n                  <TouchableOpacity\r\n                    key={job.id}\r\n                    style={[\r\n                      styles.timeSlotJob,\r\n                      { borderLeftColor: getTechnicianColor(job.assignedToId) },\r\n                    ]}\r\n                    onPress={() => handleJobPress(job)}\r\n                    onLongPress={() => handleAssignJob(job)}\r\n                  >\r\n                    <View style={styles.timeSlotJobHeader}>\r\n                      <Text style={styles.timeSlotJobTime}>{getJobTime(job)}</Text>\r\n                      {!job.assignedToId && (\r\n                        <AlertCircle size={14} color=\"#f59e0b\" />\r\n                      )}\r\n                    </View>\r\n                    <Text style={styles.timeSlotJobTitle} numberOfLines={1}>\r\n                      {job.serviceType}\r\n                    </Text>\r\n                    <Text style={styles.timeSlotJobTech}>\r\n                      {getTechnicianName(job.assignedToId)}\r\n                    </Text>\r\n                  </TouchableOpacity>\r\n                ))}\r\n                {hourJobs.length === 0 && (\r\n                  <View style={styles.emptySlot} />\r\n                )}\r\n              </View>\r\n            </View>\r\n          );\r\n        })}\r\n      </View>\r\n    );\r\n  };\r\n\r\n  // Render week view\r\n  const renderWeekView = () => {\r\n    return (\r\n      <View style={styles.weekView}>\r\n        {/* Week header */}\r\n        <View style={styles.weekHeader}>\r\n          {weekDays.map((day, index) => {\r\n            const dayKey = day.toISOString().split('T')[0];\r\n            const dayJobs = jobsByDay[dayKey] || [];\r\n            const hasUnassigned = dayJobs.some((j) => !j.assignedToId);\r\n\r\n            return (\r\n              <TouchableOpacity\r\n                key={index}\r\n                style={[\r\n                  styles.weekDay,\r\n                  isSelected(day) && styles.weekDaySelected,\r\n                  isToday(day) && styles.weekDayToday,\r\n                ]}\r\n                onPress={() => setSelectedDate(day)}\r\n              >\r\n                <Text\r\n                  style={[\r\n                    styles.weekDayName,\r\n                    isSelected(day) && styles.weekDayTextSelected,\r\n                  ]}\r\n                >\r\n                  {DAYS_ES[day.getDay()]}\r\n                </Text>\r\n                <Text\r\n                  style={[\r\n                    styles.weekDayNumber,\r\n                    isSelected(day) && styles.weekDayTextSelected,\r\n                    isToday(day) && styles.weekDayNumberToday,\r\n                  ]}\r\n                >\r\n                  {day.getDate()}\r\n                </Text>\r\n                <View style={styles.weekDayIndicators}>\r\n                  {dayJobs.length > 0 && (\r\n                    <View style={styles.weekDayJobCount}>\r\n                      <Text style={styles.weekDayJobCountText}>\r\n                        {dayJobs.length}\r\n                      </Text>\r\n                    </View>\r\n                  )}\r\n                  {hasUnassigned && (\r\n                    <View style={styles.weekDayWarning} />\r\n                  )}\r\n                </View>\r\n              </TouchableOpacity>\r\n            );\r\n          })}\r\n        </View>\r\n\r\n        {/* Selected day jobs */}\r\n        <ScrollView style={styles.weekDayJobs}>\r\n          <Text style={styles.weekDayTitle}>\r\n            {DAYS_FULL_ES[selectedDate.getDay()]} {selectedDate.getDate()}\r\n          </Text>\r\n\r\n          {filteredJobs\r\n            .filter((job) => {\r\n              const jobDate = new Date(job.scheduledDate);\r\n              return isSelected(jobDate);\r\n            })\r\n            .sort((a, b) => new Date(a.scheduledDate).getTime() - new Date(b.scheduledDate).getTime())\r\n            .map((job) => (\r\n              <TouchableOpacity\r\n                key={job.id}\r\n                style={[\r\n                  styles.weekJobCard,\r\n                  { borderLeftColor: getTechnicianColor(job.assignedToId) },\r\n                ]}\r\n                onPress={() => handleJobPress(job)}\r\n                onLongPress={() => handleAssignJob(job)}\r\n              >\r\n                <View style={styles.weekJobHeader}>\r\n                  <Text style={styles.weekJobTime}>{getJobTime(job)}</Text>\r\n                  <Text style={styles.weekJobDuration}>\r\n                    {job.estimatedDuration || 60} min\r\n                  </Text>\r\n                </View>\r\n                <Text style={styles.weekJobTitle}>{job.serviceType}</Text>\r\n                <View style={styles.weekJobFooter}>\r\n                  <View\r\n                    style={[\r\n                      styles.weekJobTechBadge,\r\n                      { backgroundColor: getTechnicianColor(job.assignedToId) + '20' },\r\n                    ]}\r\n                  >\r\n                    <User size={12} color={getTechnicianColor(job.assignedToId)} />\r\n                    <Text\r\n                      style={[\r\n                        styles.weekJobTechText,\r\n                        { color: getTechnicianColor(job.assignedToId) },\r\n                      ]}\r\n                    >\r\n                      {getTechnicianName(job.assignedToId)}\r\n                    </Text>\r\n                  </View>\r\n                  {!job.assignedToId && (\r\n                    <TouchableOpacity\r\n                      style={styles.quickAssignButton}\r\n                      onPress={() => handleAssignJob(job)}\r\n                    >\r\n                      <Text style={styles.quickAssignText}>Asignar</Text>\r\n                    </TouchableOpacity>\r\n                  )}\r\n                </View>\r\n              </TouchableOpacity>\r\n            ))}\r\n\r\n          {filteredJobs.filter((job) => {\r\n            const jobDate = new Date(job.scheduledDate);\r\n            return isSelected(jobDate);\r\n          }).length === 0 && (\r\n              <View style={styles.noJobsDay}>\r\n                <Clock size={32} color=\"#d1d5db\" />\r\n                <Text style={styles.noJobsDayText}>Sin trabajos este d├¡a</Text>\r\n              </View>\r\n            )}\r\n        </ScrollView>\r\n      </View>\r\n    );\r\n  };\r\n\r\n  // Render job card for day list view\r\n  const renderJobCard = ({ item: job }: { item: Job }) => {\r\n    return (\r\n      <TouchableOpacity\r\n        style={[\r\n          styles.jobCard,\r\n          { borderLeftColor: getTechnicianColor(job.assignedToId) },\r\n        ]}\r\n        onPress={() => handleJobPress(job)}\r\n        onLongPress={() => handleAssignJob(job)}\r\n      >\r\n        <View style={styles.jobTime}>\r\n          <Text style={styles.jobTimeText}>{getJobTime(job)}</Text>\r\n          <Text style={styles.jobDuration}>\r\n            {job.estimatedDuration || 60} min\r\n          </Text>\r\n        </View>\r\n\r\n        <View style={styles.jobContent}>\r\n          <View style={styles.jobHeader}>\r\n            <Text style={styles.jobTitle}>{job.serviceType}</Text>\r\n            {!job.assignedToId && (\r\n              <View style={styles.warningBadge}>\r\n                <AlertCircle size={12} color=\"#f59e0b\" />\r\n              </View>\r\n            )}\r\n          </View>\r\n\r\n          <View style={styles.jobDetail}>\r\n            <MapPin size={12} color=\"#6b7280\" />\r\n            <Text style={styles.jobDetailText} numberOfLines={1}>\r\n              {job.address || 'Sin direcci├│n'}\r\n            </Text>\r\n          </View>\r\n\r\n          <View style={styles.jobAssignment}>\r\n            <View\r\n              style={[\r\n                styles.technicianBadge,\r\n                { backgroundColor: getTechnicianColor(job.assignedToId) + '20' },\r\n              ]}\r\n            >\r\n              <User size={12} color={getTechnicianColor(job.assignedToId)} />\r\n              <Text\r\n                style={[\r\n                  styles.technicianText,\r\n                  { color: getTechnicianColor(job.assignedToId) },\r\n                ]}\r\n              >\r\n                {getTechnicianName(job.assignedToId)}\r\n              </Text>\r\n            </View>\r\n\r\n            <TouchableOpacity\r\n              style={styles.reassignButton}\r\n              onPress={() => handleAssignJob(job)}\r\n            >\r\n              <Users size={14} color=\"#6b7280\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n      </TouchableOpacity>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <SafeAreaView style={styles.container} edges={['top']}>\r\n      {/* Header */}\r\n      <View style={styles.header}>\r\n        <View style={styles.dateNav}>\r\n          <TouchableOpacity style={styles.navButton} onPress={() => navigate(-1)}>\r\n            <ChevronLeft size={24} color=\"#374151\" />\r\n          </TouchableOpacity>\r\n\r\n          <TouchableOpacity style={styles.dateButton} onPress={goToToday}>\r\n            <Text style={styles.dateText}>\r\n              {viewMode === 'day' ? formattedDate : formattedWeek}\r\n            </Text>\r\n            {isToday(selectedDate) && viewMode === 'day' && (\r\n              <Text style={styles.todayBadge}>Hoy</Text>\r\n            )}\r\n          </TouchableOpacity>\r\n\r\n          <TouchableOpacity style={styles.navButton} onPress={() => navigate(1)}>\r\n            <ChevronRight size={24} color=\"#374151\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        <View style={styles.headerActions}>\r\n          {/* View Toggle */}\r\n          <View style={styles.viewToggle}>\r\n            <TouchableOpacity\r\n              style={[\r\n                styles.viewToggleButton,\r\n                viewMode === 'day' && styles.viewToggleButtonActive,\r\n              ]}\r\n              onPress={() => setViewMode('day')}\r\n            >\r\n              <Calendar size={16} color={viewMode === 'day' ? '#fff' : '#6b7280'} />\r\n            </TouchableOpacity>\r\n            <TouchableOpacity\r\n              style={[\r\n                styles.viewToggleButton,\r\n                viewMode === 'week' && styles.viewToggleButtonActive,\r\n              ]}\r\n              onPress={() => setViewMode('week')}\r\n            >\r\n              <LayoutGrid size={16} color={viewMode === 'week' ? '#fff' : '#6b7280'} />\r\n            </TouchableOpacity>\r\n          </View>\r\n\r\n          <TouchableOpacity style={styles.addButton} onPress={handleCreateJob}>\r\n            <Plus size={20} color=\"#fff\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n      </View>\r\n\r\n      {/* Stats Bar */}\r\n      <View style={styles.statsBar}>\r\n        <View style={styles.stat}>\r\n          <Text style={styles.statValue}>\r\n            {viewMode === 'day' ? filteredJobs.length : weekStats.total}\r\n          </Text>\r\n          <Text style={styles.statLabel}>Trabajos</Text>\r\n        </View>\r\n        <View style={styles.statDivider} />\r\n        <View style={styles.stat}>\r\n          <Text style={styles.statValue}>\r\n            {viewMode === 'day'\r\n              ? filteredJobs.filter((j) => j.assignedToId).length\r\n              : weekStats.assigned}\r\n          </Text>\r\n          <Text style={styles.statLabel}>Asignados</Text>\r\n        </View>\r\n        <View style={styles.statDivider} />\r\n        <View style={styles.stat}>\r\n          <Text style={[styles.statValue, styles.statWarning]}>\r\n            {viewMode === 'day'\r\n              ? filteredJobs.filter((j) => !j.assignedToId).length\r\n              : weekStats.unassigned}\r\n          </Text>\r\n          <Text style={styles.statLabel}>Sin asignar</Text>\r\n        </View>\r\n        {viewMode === 'week' && (\r\n          <>\r\n            <View style={styles.statDivider} />\r\n            <View style={styles.stat}>\r\n              <Text style={[styles.statValue, styles.statSuccess]}>\r\n                {weekStats.completed}\r\n              </Text>\r\n              <Text style={styles.statLabel}>Completados</Text>\r\n            </View>\r\n          </>\r\n        )}\r\n      </View>\r\n\r\n      {/* Content */}\r\n      {viewMode === 'day' ? (\r\n        <ScrollView style={styles.content} showsVerticalScrollIndicator={false}>\r\n          {filteredJobs.length === 0 ? (\r\n            <View style={styles.emptyState}>\r\n              <Clock size={48} color=\"#d1d5db\" />\r\n              <Text style={styles.emptyTitle}>Sin trabajos</Text>\r\n              <Text style={styles.emptySubtitle}>\r\n                No hay trabajos programados para este d├¡a\r\n              </Text>\r\n              <TouchableOpacity\r\n                style={styles.emptyButton}\r\n                onPress={handleCreateJob}\r\n              >\r\n                <Plus size={16} color=\"#fff\" />\r\n                <Text style={styles.emptyButtonText}>Nuevo trabajo</Text>\r\n              </TouchableOpacity>\r\n            </View>\r\n          ) : (\r\n            renderTimeGrid()\r\n          )}\r\n          <View style={styles.bottomPadding} />\r\n        </ScrollView>\r\n      ) : (\r\n        renderWeekView()\r\n      )}\r\n\r\n      {/* Technician Legend */}\r\n      <View style={styles.legend}>\r\n        <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n          {technicians.map((tech) => (\r\n            <View key={tech.id} style={styles.legendItem}>\r\n              <View style={[styles.legendDot, { backgroundColor: tech.color }]} />\r\n              <Text style={styles.legendText}>{tech.name}</Text>\r\n            </View>\r\n          ))}\r\n          <View style={styles.legendItem}>\r\n            <View style={[styles.legendDot, { backgroundColor: '#9ca3af' }]} />\r\n            <Text style={styles.legendText}>Sin asignar</Text>\r\n          </View>\r\n        </ScrollView>\r\n      </View>\r\n\r\n      {/* Assignment Modal */}\r\n      <Modal\r\n        visible={showAssignModal}\r\n        transparent\r\n        animationType=\"slide\"\r\n        onRequestClose={() => setShowAssignModal(false)}\r\n      >\r\n        <View style={styles.modalOverlay}>\r\n          <View style={styles.modalContent}>\r\n            <View style={styles.modalHeader}>\r\n              <Text style={styles.modalTitle}>Asignar t├⌐cnico</Text>\r\n              <TouchableOpacity\r\n                style={styles.modalClose}\r\n                onPress={() => setShowAssignModal(false)}\r\n              >\r\n                <X size={24} color=\"#6b7280\" />\r\n              </TouchableOpacity>\r\n            </View>\r\n\r\n            {selectedJob && (\r\n              <View style={styles.modalJobInfo}>\r\n                <Text style={styles.modalJobTitle}>{selectedJob.serviceType}</Text>\r\n                <Text style={styles.modalJobTime}>\r\n                  {new Date(selectedJob.scheduledDate).toLocaleDateString('es-AR')} - {getJobTime(selectedJob)}\r\n                </Text>\r\n              </View>\r\n            )}\r\n\r\n            <ScrollView style={styles.technicianList}>\r\n              {technicians.map((tech) => (\r\n                <TouchableOpacity\r\n                  key={tech.id}\r\n                  style={styles.technicianOption}\r\n                  onPress={() => assignTechnician(tech.id)}\r\n                >\r\n                  <View style={styles.technicianOptionLeft}>\r\n                    <View\r\n                      style={[\r\n                        styles.technicianAvatar,\r\n                        { backgroundColor: tech.color },\r\n                      ]}\r\n                    >\r\n                      <Text style={styles.technicianAvatarText}>\r\n                        {tech.name.charAt(0)}\r\n                      </Text>\r\n                    </View>\r\n                    <Text style={styles.technicianOptionName}>{tech.name}</Text>\r\n                  </View>\r\n                  {selectedJob?.assignedToId === tech.id && (\r\n                    <Check size={20} color=\"#059669\" />\r\n                  )}\r\n                </TouchableOpacity>\r\n              ))}\r\n            </ScrollView>\r\n\r\n            {selectedJob?.assignedToId && (\r\n              <TouchableOpacity\r\n                style={styles.unassignButton}\r\n                onPress={() => assignTechnician('')}\r\n              >\r\n                <Text style={styles.unassignButtonText}>Quitar asignaci├│n</Text>\r\n              </TouchableOpacity>\r\n            )}\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\n// WatermelonDB enhancement\r\nconst enhance = withObservables([], () => ({\r\n  jobs: database\r\n    .get<Job>('jobs')\r\n    .query(Q.sortBy('scheduled_date', Q.asc))\r\n    .observe(),\r\n}));\r\n\r\nconst EnhancedScheduleScreen = enhance(ScheduleScreen);\r\n\r\n// Wrapper for auth context\r\nexport default function ScheduleScreenWrapper() {\r\n  return <EnhancedScheduleScreen />;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f9fafb',\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  dateNav: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n    flex: 1,\r\n  },\r\n  navButton: {\r\n    width: 36,\r\n    height: 36,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    borderRadius: 18,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  dateButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n    flex: 1,\r\n    justifyContent: 'center',\r\n  },\r\n  dateText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  todayBadge: {\r\n    backgroundColor: '#059669',\r\n    color: '#fff',\r\n    fontSize: 11,\r\n    fontWeight: '600',\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 2,\r\n    borderRadius: 10,\r\n    overflow: 'hidden',\r\n  },\r\n  headerActions: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n  },\r\n  viewToggle: {\r\n    flexDirection: 'row',\r\n    backgroundColor: '#f3f4f6',\r\n    borderRadius: 8,\r\n    padding: 2,\r\n  },\r\n  viewToggleButton: {\r\n    width: 32,\r\n    height: 32,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    borderRadius: 6,\r\n  },\r\n  viewToggleButtonActive: {\r\n    backgroundColor: '#059669',\r\n  },\r\n  addButton: {\r\n    width: 36,\r\n    height: 36,\r\n    backgroundColor: '#059669',\r\n    borderRadius: 18,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  statsBar: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    paddingVertical: 12,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  stat: {\r\n    alignItems: 'center',\r\n    paddingHorizontal: 16,\r\n  },\r\n  statValue: {\r\n    fontSize: 18,\r\n    fontWeight: '700',\r\n    color: '#111827',\r\n  },\r\n  statWarning: {\r\n    color: '#f59e0b',\r\n  },\r\n  statSuccess: {\r\n    color: '#059669',\r\n  },\r\n  statLabel: {\r\n    fontSize: 11,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  statDivider: {\r\n    width: 1,\r\n    height: 24,\r\n    backgroundColor: '#e5e7eb',\r\n  },\r\n  content: {\r\n    flex: 1,\r\n  },\r\n  // Time grid styles\r\n  timeGrid: {\r\n    paddingHorizontal: 16,\r\n    paddingTop: 8,\r\n  },\r\n  timeRow: {\r\n    flexDirection: 'row',\r\n    minHeight: 60,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  timeLabel: {\r\n    width: 50,\r\n    paddingTop: 8,\r\n  },\r\n  timeLabelText: {\r\n    fontSize: 12,\r\n    color: '#9ca3af',\r\n    fontWeight: '500',\r\n  },\r\n  timeSlot: {\r\n    flex: 1,\r\n    paddingVertical: 4,\r\n    gap: 4,\r\n  },\r\n  emptySlot: {\r\n    flex: 1,\r\n  },\r\n  timeSlotJob: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 8,\r\n    borderLeftWidth: 4,\r\n    padding: 8,\r\n    marginRight: 8,\r\n  },\r\n  timeSlotJobHeader: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n  },\r\n  timeSlotJobTime: {\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n  },\r\n  timeSlotJobTitle: {\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n    marginTop: 2,\r\n  },\r\n  timeSlotJobTech: {\r\n    fontSize: 11,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  // Week view styles\r\n  weekView: {\r\n    flex: 1,\r\n  },\r\n  weekHeader: {\r\n    flexDirection: 'row',\r\n    backgroundColor: '#fff',\r\n    paddingVertical: 8,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  weekDay: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    paddingVertical: 8,\r\n  },\r\n  weekDaySelected: {\r\n    backgroundColor: '#ecfdf5',\r\n    borderRadius: 8,\r\n    marginHorizontal: 2,\r\n  },\r\n  weekDayToday: {\r\n    borderWidth: 2,\r\n    borderColor: '#059669',\r\n    borderRadius: 8,\r\n    marginHorizontal: 2,\r\n  },\r\n  weekDayName: {\r\n    fontSize: 11,\r\n    color: '#6b7280',\r\n    fontWeight: '500',\r\n  },\r\n  weekDayNumber: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginTop: 2,\r\n  },\r\n  weekDayNumberToday: {\r\n    color: '#059669',\r\n  },\r\n  weekDayTextSelected: {\r\n    color: '#059669',\r\n  },\r\n  weekDayIndicators: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n    marginTop: 4,\r\n  },\r\n  weekDayJobCount: {\r\n    backgroundColor: '#e5e7eb',\r\n    borderRadius: 8,\r\n    paddingHorizontal: 6,\r\n    paddingVertical: 1,\r\n  },\r\n  weekDayJobCountText: {\r\n    fontSize: 10,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n  },\r\n  weekDayWarning: {\r\n    width: 6,\r\n    height: 6,\r\n    borderRadius: 3,\r\n    backgroundColor: '#f59e0b',\r\n  },\r\n  weekDayJobs: {\r\n    flex: 1,\r\n    paddingHorizontal: 16,\r\n    paddingTop: 12,\r\n  },\r\n  weekDayTitle: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginBottom: 12,\r\n  },\r\n  weekJobCard: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 10,\r\n    borderLeftWidth: 4,\r\n    padding: 12,\r\n    marginBottom: 8,\r\n  },\r\n  weekJobHeader: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n  },\r\n  weekJobTime: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n  },\r\n  weekJobDuration: {\r\n    fontSize: 12,\r\n    color: '#9ca3af',\r\n  },\r\n  weekJobTitle: {\r\n    fontSize: 15,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n    marginTop: 4,\r\n  },\r\n  weekJobFooter: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    marginTop: 8,\r\n  },\r\n  weekJobTechBadge: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 4,\r\n    borderRadius: 12,\r\n  },\r\n  weekJobTechText: {\r\n    fontSize: 12,\r\n    fontWeight: '500',\r\n  },\r\n  quickAssignButton: {\r\n    backgroundColor: '#059669',\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 6,\r\n    borderRadius: 6,\r\n  },\r\n  quickAssignText: {\r\n    color: '#fff',\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n  },\r\n  noJobsDay: {\r\n    alignItems: 'center',\r\n    paddingVertical: 32,\r\n  },\r\n  noJobsDayText: {\r\n    fontSize: 14,\r\n    color: '#9ca3af',\r\n    marginTop: 8,\r\n  },\r\n  // Job card styles (day list view)\r\n  jobCard: {\r\n    flexDirection: 'row',\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    marginHorizontal: 16,\r\n    marginBottom: 8,\r\n    borderLeftWidth: 4,\r\n    overflow: 'hidden',\r\n  },\r\n  jobTime: {\r\n    width: 65,\r\n    backgroundColor: '#f9fafb',\r\n    paddingVertical: 12,\r\n    paddingHorizontal: 8,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  jobTimeText: {\r\n    fontSize: 14,\r\n    fontWeight: '700',\r\n    color: '#111827',\r\n  },\r\n  jobDuration: {\r\n    fontSize: 10,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  jobContent: {\r\n    flex: 1,\r\n    padding: 12,\r\n  },\r\n  jobHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n  },\r\n  jobTitle: {\r\n    fontSize: 15,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    flex: 1,\r\n  },\r\n  warningBadge: {\r\n    width: 20,\r\n    height: 20,\r\n    backgroundColor: '#fef3c7',\r\n    borderRadius: 10,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  jobDetail: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n    marginTop: 6,\r\n  },\r\n  jobDetailText: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    flex: 1,\r\n  },\r\n  jobAssignment: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    marginTop: 8,\r\n  },\r\n  technicianBadge: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n    paddingHorizontal: 10,\r\n    paddingVertical: 4,\r\n    borderRadius: 12,\r\n  },\r\n  technicianText: {\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n  },\r\n  reassignButton: {\r\n    width: 28,\r\n    height: 28,\r\n    backgroundColor: '#f3f4f6',\r\n    borderRadius: 14,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  // Legend\r\n  legend: {\r\n    backgroundColor: '#fff',\r\n    paddingVertical: 8,\r\n    paddingHorizontal: 16,\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#e5e7eb',\r\n  },\r\n  legendItem: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    marginRight: 16,\r\n  },\r\n  legendDot: {\r\n    width: 10,\r\n    height: 10,\r\n    borderRadius: 5,\r\n    marginRight: 6,\r\n  },\r\n  legendText: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n  },\r\n  // Empty state\r\n  emptyState: {\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    paddingVertical: 64,\r\n  },\r\n  emptyTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    marginTop: 16,\r\n  },\r\n  emptySubtitle: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginTop: 8,\r\n    textAlign: 'center',\r\n  },\r\n  emptyButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n    backgroundColor: '#059669',\r\n    paddingHorizontal: 20,\r\n    paddingVertical: 12,\r\n    borderRadius: 8,\r\n    marginTop: 20,\r\n  },\r\n  emptyButtonText: {\r\n    color: '#fff',\r\n    fontWeight: '600',\r\n    fontSize: 14,\r\n  },\r\n  bottomPadding: {\r\n    height: 80,\r\n  },\r\n  // Modal styles\r\n  modalOverlay: {\r\n    flex: 1,\r\n    backgroundColor: 'rgba(0,0,0,0.5)',\r\n    justifyContent: 'flex-end',\r\n  },\r\n  modalContent: {\r\n    backgroundColor: '#fff',\r\n    borderTopLeftRadius: 20,\r\n    borderTopRightRadius: 20,\r\n    maxHeight: '70%',\r\n  },\r\n  modalHeader: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    padding: 16,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  modalTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  modalClose: {\r\n    width: 36,\r\n    height: 36,\r\n    borderRadius: 18,\r\n    backgroundColor: '#f3f4f6',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  modalJobInfo: {\r\n    padding: 16,\r\n    backgroundColor: '#f9fafb',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  modalJobTitle: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  modalJobTime: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n  },\r\n  technicianList: {\r\n    padding: 16,\r\n  },\r\n  technicianOption: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingVertical: 12,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#f3f4f6',\r\n  },\r\n  technicianOptionLeft: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 12,\r\n  },\r\n  technicianAvatar: {\r\n    width: 40,\r\n    height: 40,\r\n    borderRadius: 20,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  technicianAvatarText: {\r\n    color: '#fff',\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n  },\r\n  technicianOptionName: {\r\n    fontSize: 16,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  unassignButton: {\r\n    margin: 16,\r\n    paddingVertical: 14,\r\n    backgroundColor: '#fee2e2',\r\n    borderRadius: 10,\r\n    alignItems: 'center',\r\n  },\r\n  unassignButtonText: {\r\n    color: '#dc2626',\r\n    fontSize: 15,\r\n    fontWeight: '600',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\chats\\[id].tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":180,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":180,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Technician Chat Detail\r\n * ======================\r\n * \r\n * Phase 5.4: Technician Copilot Access\r\n * \r\n * Shows conversation details with AI Copilot suggestions.\r\n * Technicians can view messages and get AI-assisted response suggestions.\r\n */\r\n\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport {\r\n    View,\r\n    Text,\r\n    FlatList,\r\n    TextInput,\r\n    TouchableOpacity,\r\n    StyleSheet,\r\n    ActivityIndicator,\r\n    KeyboardAvoidingView,\r\n    Platform,\r\n} from 'react-native';\r\nimport { useLocalSearchParams, Stack } from 'expo-router';\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport {\r\n    Send,\r\n    Bot,\r\n    ThumbsUp,\r\n    ThumbsDown,\r\n    MessageSquare,\r\n    Sparkles,\r\n    CheckCircle,\r\n    X,\r\n} from 'lucide-react-native';\r\nimport { useAuth } from '../../../lib/auth/auth-context';\r\n\r\nconst API_BASE_URL = process.env.EXPO_PUBLIC_API_URL || 'http://localhost:3000';\r\n\r\ninterface Message {\r\n    id: string;\r\n    content: string;\r\n    direction: 'inbound' | 'outbound';\r\n    senderType: 'customer' | 'ai' | 'human' | null;\r\n    createdAt: string;\r\n    detectedLanguage?: string;\r\n    translatedContent?: string;\r\n}\r\n\r\ninterface Conversation {\r\n    id: string;\r\n    customerPhone: string;\r\n    customerName: string | null;\r\n    messages: Message[];\r\n}\r\n\r\ninterface CopilotSuggestion {\r\n    text: string;\r\n    confidence: number;\r\n}\r\n\r\nasync function fetchConversation(conversationId: string): Promise<Conversation> {\r\n    const response = await fetch(`${API_BASE_URL}/api/whatsapp/conversations/${conversationId}`, {\r\n        credentials: 'include',\r\n    });\r\n    if (!response.ok) {\r\n        throw new Error('Error al cargar conversaci├│n');\r\n    }\r\n    return response.json();\r\n}\r\n\r\nasync function getCopilotSuggestion(conversationId: string, messages: Message[]): Promise<CopilotSuggestion> {\r\n    const response = await fetch(`${API_BASE_URL}/api/copilot/chat`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n            message: 'Suger├¡ una respuesta para el ├║ltimo mensaje del cliente',\r\n            conversationId,\r\n            context: {\r\n                messages: messages.slice(-10).map(m => ({\r\n                    content: m.content,\r\n                    direction: m.direction,\r\n                    senderType: m.senderType,\r\n                })),\r\n            },\r\n        }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n        throw new Error('Error al obtener sugerencia');\r\n    }\r\n\r\n    const data = await response.json();\r\n    return {\r\n        text: data.response,\r\n        confidence: data.metadata?.confidence || 80,\r\n    };\r\n}\r\n\r\nasync function sendMessage(conversationId: string, text: string): Promise<void> {\r\n    const response = await fetch(`${API_BASE_URL}/api/whatsapp/conversations/${conversationId}/messages`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n            content: text,\r\n            type: 'text',\r\n        }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n        throw new Error('Error al enviar mensaje');\r\n    }\r\n}\r\n\r\nasync function sendFeedback(messageId: string, feedback: 'positive' | 'negative'): Promise<void> {\r\n    await fetch(`${API_BASE_URL}/api/ai/feedback`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n            messageId,\r\n            feedback,\r\n            feedbackType: 'response',\r\n        }),\r\n    });\r\n}\r\n\r\nfunction formatTime(timestamp: string): string {\r\n    return new Date(timestamp).toLocaleTimeString('es-AR', {\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n        timeZone: 'America/Argentina/Buenos_Aires',\r\n    });\r\n}\r\n\r\nfunction MessageBubble({ message }: { message: Message }) {\r\n    const isInbound = message.direction === 'inbound';\r\n    const isAI = message.senderType === 'ai';\r\n\r\n    return (\r\n        <View style={[\r\n            styles.messageBubble,\r\n            isInbound ? styles.inboundBubble : styles.outboundBubble,\r\n        ]}>\r\n            {isAI && (\r\n                <View style={styles.aiLabel}>\r\n                    <Bot size={10} color=\"#8b5cf6\" />\r\n                    <Text style={styles.aiLabelText}>IA</Text>\r\n                </View>\r\n            )}\r\n\r\n            <Text style={[\r\n                styles.messageText,\r\n                isInbound ? styles.inboundText : styles.outboundText,\r\n            ]}>\r\n                {message.content}\r\n            </Text>\r\n\r\n            {/* Show translation if available */}\r\n            {message.detectedLanguage && message.detectedLanguage !== 'es' && message.translatedContent && (\r\n                <View style={styles.translationContainer}>\r\n                    <Text style={styles.translationLabel}>≡ƒîÉ Traducci├│n:</Text>\r\n                    <Text style={styles.translationText}>{message.translatedContent}</Text>\r\n                </View>\r\n            )}\r\n\r\n            <Text style={[\r\n                styles.timestamp,\r\n                isInbound ? styles.inboundTimestamp : styles.outboundTimestamp,\r\n            ]}>\r\n                {formatTime(message.createdAt)}\r\n            </Text>\r\n        </View>\r\n    );\r\n}\r\n\r\nexport default function ChatDetailScreen() {\r\n    const { id: conversationId } = useLocalSearchParams<{ id: string }>();\r\n    const { user } = useAuth();\r\n    const queryClient = useQueryClient();\r\n    const flatListRef = useRef<FlatList>(null);\r\n\r\n    const [messageText, setMessageText] = useState('');\r\n    const [showSuggestion, setShowSuggestion] = useState(false);\r\n\r\n    const { data: conversation, isLoading, error } = useQuery({\r\n        queryKey: ['conversation', conversationId],\r\n        queryFn: () => fetchConversation(conversationId!),\r\n        enabled: !!conversationId,\r\n        refetchInterval: 10000, // Poll every 10 seconds\r\n    });\r\n\r\n    // Copilot suggestion mutation\r\n    const {\r\n        mutate: requestSuggestion,\r\n        data: suggestion,\r\n        isPending: isLoadingSuggestion,\r\n        reset: resetSuggestion,\r\n    } = useMutation({\r\n        mutationFn: () => getCopilotSuggestion(conversationId!, conversation?.messages || []),\r\n    });\r\n\r\n    // Send message mutation\r\n    const { mutate: sendMessageMutation, isPending: isSending } = useMutation({\r\n        mutationFn: (text: string) => sendMessage(conversationId!, text),\r\n        onSuccess: () => {\r\n            setMessageText('');\r\n            setShowSuggestion(false);\r\n            resetSuggestion();\r\n            queryClient.invalidateQueries({ queryKey: ['conversation', conversationId] });\r\n        },\r\n    });\r\n\r\n    // Feedback mutation\r\n    const { mutate: sendFeedbackMutation } = useMutation({\r\n        mutationFn: ({ feedback }: { feedback: 'positive' | 'negative' }) => {\r\n            const lastMessage = conversation?.messages?.slice(-1)[0];\r\n            if (lastMessage) {\r\n                return sendFeedback(lastMessage.id, feedback);\r\n            }\r\n            return Promise.resolve();\r\n        },\r\n    });\r\n\r\n    // Auto-scroll to bottom on new messages\r\n    useEffect(() => {\r\n        if (conversation?.messages?.length) {\r\n            setTimeout(() => {\r\n                flatListRef.current?.scrollToEnd({ animated: true });\r\n            }, 100);\r\n        }\r\n    }, [conversation?.messages?.length]);\r\n\r\n    const handleSendMessage = () => {\r\n        if (messageText.trim()) {\r\n            sendMessageMutation(messageText.trim());\r\n        }\r\n    };\r\n\r\n    const handleUseSuggestion = () => {\r\n        if (suggestion?.text) {\r\n            setMessageText(suggestion.text);\r\n            setShowSuggestion(false);\r\n        }\r\n    };\r\n\r\n    const handleRequestSuggestion = () => {\r\n        setShowSuggestion(true);\r\n        requestSuggestion();\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <View style={styles.centerContainer}>\r\n                <ActivityIndicator size=\"large\" color=\"#059669\" />\r\n            </View>\r\n        );\r\n    }\r\n\r\n    if (error || !conversation) {\r\n        return (\r\n            <View style={styles.centerContainer}>\r\n                <MessageSquare size={48} color=\"#9ca3af\" />\r\n                <Text style={styles.errorText}>Error al cargar conversaci├│n</Text>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Stack.Screen\r\n                options={{\r\n                    title: conversation.customerName || conversation.customerPhone,\r\n                    headerBackTitle: 'Chats',\r\n                }}\r\n            />\r\n\r\n            <KeyboardAvoidingView\r\n                style={styles.container}\r\n                behavior={Platform.OS === 'ios' ? 'padding' : undefined}\r\n                keyboardVerticalOffset={90}\r\n            >\r\n                {/* Messages list */}\r\n                <FlatList\r\n                    ref={flatListRef}\r\n                    data={conversation.messages}\r\n                    keyExtractor={(item) => item.id}\r\n                    renderItem={({ item }) => <MessageBubble message={item} />}\r\n                    contentContainerStyle={styles.messagesList}\r\n                    onContentSizeChange={() => flatListRef.current?.scrollToEnd()}\r\n                />\r\n\r\n                {/* Copilot suggestion card */}\r\n                {showSuggestion && (\r\n                    <View style={styles.suggestionCard}>\r\n                        <View style={styles.suggestionHeader}>\r\n                            <Bot size={16} color=\"#8b5cf6\" />\r\n                            <Text style={styles.suggestionTitle}>Sugerencia del Copilot</Text>\r\n                            <TouchableOpacity onPress={() => setShowSuggestion(false)}>\r\n                                <X size={18} color=\"#6b7280\" />\r\n                            </TouchableOpacity>\r\n                        </View>\r\n\r\n                        {isLoadingSuggestion ? (\r\n                            <View style={styles.suggestionLoading}>\r\n                                <ActivityIndicator size=\"small\" color=\"#8b5cf6\" />\r\n                                <Text style={styles.loadingText}>Pensando...</Text>\r\n                            </View>\r\n                        ) : suggestion ? (\r\n                            <>\r\n                                <Text style={styles.suggestionText}>{suggestion.text}</Text>\r\n                                <View style={styles.suggestionActions}>\r\n                                    <TouchableOpacity\r\n                                        style={styles.useSuggestionButton}\r\n                                        onPress={handleUseSuggestion}\r\n                                    >\r\n                                        <CheckCircle size={16} color=\"#fff\" />\r\n                                        <Text style={styles.useSuggestionText}>Usar</Text>\r\n                                    </TouchableOpacity>\r\n\r\n                                    <View style={styles.feedbackButtons}>\r\n                                        <TouchableOpacity\r\n                                            style={styles.feedbackButton}\r\n                                            onPress={() => sendFeedbackMutation({ feedback: 'positive' })}\r\n                                        >\r\n                                            <ThumbsUp size={16} color=\"#6b7280\" />\r\n                                        </TouchableOpacity>\r\n                                        <TouchableOpacity\r\n                                            style={styles.feedbackButton}\r\n                                            onPress={() => sendFeedbackMutation({ feedback: 'negative' })}\r\n                                        >\r\n                                            <ThumbsDown size={16} color=\"#6b7280\" />\r\n                                        </TouchableOpacity>\r\n                                    </View>\r\n                                </View>\r\n                            </>\r\n                        ) : null}\r\n                    </View>\r\n                )}\r\n\r\n                {/* Input area */}\r\n                <View style={styles.inputContainer}>\r\n                    <TouchableOpacity\r\n                        style={styles.copilotButton}\r\n                        onPress={handleRequestSuggestion}\r\n                    >\r\n                        <Sparkles size={20} color=\"#8b5cf6\" />\r\n                    </TouchableOpacity>\r\n\r\n                    <TextInput\r\n                        style={styles.textInput}\r\n                        value={messageText}\r\n                        onChangeText={setMessageText}\r\n                        placeholder=\"Escrib├¡ un mensaje...\"\r\n                        placeholderTextColor=\"#9ca3af\"\r\n                        multiline\r\n                        maxLength={1000}\r\n                    />\r\n\r\n                    <TouchableOpacity\r\n                        style={[\r\n                            styles.sendButton,\r\n                            (!messageText.trim() || isSending) && styles.sendButtonDisabled,\r\n                        ]}\r\n                        onPress={handleSendMessage}\r\n                        disabled={!messageText.trim() || isSending}\r\n                    >\r\n                        {isSending ? (\r\n                            <ActivityIndicator size=\"small\" color=\"#fff\" />\r\n                        ) : (\r\n                            <Send size={20} color=\"#fff\" />\r\n                        )}\r\n                    </TouchableOpacity>\r\n                </View>\r\n            </KeyboardAvoidingView>\r\n        </>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n        backgroundColor: '#f3f4f6',\r\n    },\r\n    centerContainer: {\r\n        flex: 1,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        padding: 24,\r\n    },\r\n    errorText: {\r\n        marginTop: 12,\r\n        color: '#ef4444',\r\n        fontSize: 14,\r\n    },\r\n    messagesList: {\r\n        padding: 16,\r\n        paddingBottom: 8,\r\n    },\r\n    messageBubble: {\r\n        maxWidth: '80%',\r\n        padding: 12,\r\n        borderRadius: 16,\r\n        marginBottom: 8,\r\n    },\r\n    inboundBubble: {\r\n        alignSelf: 'flex-start',\r\n        backgroundColor: '#fff',\r\n        borderBottomLeftRadius: 4,\r\n    },\r\n    outboundBubble: {\r\n        alignSelf: 'flex-end',\r\n        backgroundColor: '#059669',\r\n        borderBottomRightRadius: 4,\r\n    },\r\n    aiLabel: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        gap: 4,\r\n        marginBottom: 4,\r\n    },\r\n    aiLabelText: {\r\n        fontSize: 10,\r\n        color: '#8b5cf6',\r\n        fontWeight: '600',\r\n    },\r\n    messageText: {\r\n        fontSize: 15,\r\n        lineHeight: 20,\r\n    },\r\n    inboundText: {\r\n        color: '#111827',\r\n    },\r\n    outboundText: {\r\n        color: '#fff',\r\n    },\r\n    translationContainer: {\r\n        marginTop: 8,\r\n        paddingTop: 8,\r\n        borderTopWidth: 1,\r\n        borderTopColor: '#e5e7eb',\r\n    },\r\n    translationLabel: {\r\n        fontSize: 10,\r\n        color: '#6b7280',\r\n        marginBottom: 4,\r\n    },\r\n    translationText: {\r\n        fontSize: 13,\r\n        color: '#4b5563',\r\n        fontStyle: 'italic',\r\n    },\r\n    timestamp: {\r\n        fontSize: 11,\r\n        marginTop: 4,\r\n    },\r\n    inboundTimestamp: {\r\n        color: '#9ca3af',\r\n    },\r\n    outboundTimestamp: {\r\n        color: 'rgba(255, 255, 255, 0.7)',\r\n    },\r\n    suggestionCard: {\r\n        backgroundColor: '#f5f3ff',\r\n        borderTopWidth: 1,\r\n        borderTopColor: '#e9d5ff',\r\n        padding: 12,\r\n    },\r\n    suggestionHeader: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        gap: 8,\r\n        marginBottom: 8,\r\n    },\r\n    suggestionTitle: {\r\n        flex: 1,\r\n        fontSize: 13,\r\n        fontWeight: '600',\r\n        color: '#7c3aed',\r\n    },\r\n    suggestionLoading: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        gap: 8,\r\n        paddingVertical: 12,\r\n    },\r\n    loadingText: {\r\n        color: '#8b5cf6',\r\n        fontSize: 14,\r\n    },\r\n    suggestionText: {\r\n        fontSize: 14,\r\n        color: '#374151',\r\n        lineHeight: 20,\r\n        backgroundColor: '#fff',\r\n        padding: 12,\r\n        borderRadius: 8,\r\n        marginBottom: 8,\r\n    },\r\n    suggestionActions: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'space-between',\r\n    },\r\n    useSuggestionButton: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        gap: 6,\r\n        backgroundColor: '#8b5cf6',\r\n        paddingHorizontal: 16,\r\n        paddingVertical: 8,\r\n        borderRadius: 8,\r\n    },\r\n    useSuggestionText: {\r\n        color: '#fff',\r\n        fontSize: 14,\r\n        fontWeight: '500',\r\n    },\r\n    feedbackButtons: {\r\n        flexDirection: 'row',\r\n        gap: 8,\r\n    },\r\n    feedbackButton: {\r\n        padding: 8,\r\n        backgroundColor: '#fff',\r\n        borderRadius: 8,\r\n    },\r\n    inputContainer: {\r\n        flexDirection: 'row',\r\n        alignItems: 'flex-end',\r\n        padding: 12,\r\n        backgroundColor: '#fff',\r\n        borderTopWidth: 1,\r\n        borderTopColor: '#e5e7eb',\r\n        gap: 8,\r\n    },\r\n    copilotButton: {\r\n        padding: 10,\r\n        backgroundColor: '#f5f3ff',\r\n        borderRadius: 20,\r\n    },\r\n    textInput: {\r\n        flex: 1,\r\n        backgroundColor: '#f3f4f6',\r\n        borderRadius: 20,\r\n        paddingHorizontal: 16,\r\n        paddingVertical: 10,\r\n        fontSize: 15,\r\n        maxHeight: 100,\r\n        color: '#111827',\r\n    },\r\n    sendButton: {\r\n        backgroundColor: '#059669',\r\n        padding: 10,\r\n        borderRadius: 20,\r\n    },\r\n    sendButtonDisabled: {\r\n        backgroundColor: '#9ca3af',\r\n    },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\chats\\_layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\chats\\index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":23,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'api' is defined but never used.","line":25,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Technician Chat List\r\n * ====================\r\n * \r\n * Phase 5.4: Technician Copilot Access\r\n * \r\n * Shows WhatsApp conversations assigned to the current technician.\r\n * Allows access to Copilot for AI-assisted responses.\r\n */\r\n\r\nimport React from 'react';\r\nimport {\r\n    View,\r\n    Text,\r\n    FlatList,\r\n    TouchableOpacity,\r\n    StyleSheet,\r\n    ActivityIndicator,\r\n    RefreshControl,\r\n} from 'react-native';\r\nimport { useRouter } from 'expo-router';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { MessageSquare, Clock, ChevronRight, Bot } from 'lucide-react-native';\r\nimport { useAuth } from '../../../lib/auth/auth-context';\r\nimport { api } from '../../../lib/api/client';\r\n\r\ninterface Conversation {\r\n    id: string;\r\n    customerPhone: string;\r\n    customerName: string | null;\r\n    lastMessagePreview: string | null;\r\n    lastMessageAt: string;\r\n    unreadCount: number;\r\n    status: string;\r\n    hasAISuggestion?: boolean;\r\n}\r\n\r\nasync function fetchAssignedConversations(): Promise<Conversation[]> {\r\n    // Use the generic request method for custom endpoints\r\n    const response = await fetch(`${process.env.EXPO_PUBLIC_API_URL || 'http://localhost:3000'}/api/whatsapp/conversations?assignedToMe=true`, {\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n    });\r\n    if (!response.ok) {\r\n        throw new Error('Error al cargar conversaciones');\r\n    }\r\n    const data = await response.json();\r\n    return data.conversations || [];\r\n}\r\n\r\nfunction formatTimestamp(timestamp: string): string {\r\n    const date = new Date(timestamp);\r\n    const now = new Date();\r\n    const diffMs = now.getTime() - date.getTime();\r\n    const diffHours = diffMs / (1000 * 60 * 60);\r\n\r\n    if (diffHours < 1) {\r\n        const diffMins = Math.floor(diffMs / (1000 * 60));\r\n        return diffMins <= 1 ? 'Ahora' : `Hace ${diffMins} min`;\r\n    } else if (diffHours < 24) {\r\n        return `Hace ${Math.floor(diffHours)} hs`;\r\n    } else {\r\n        return date.toLocaleDateString('es-AR', {\r\n            day: '2-digit',\r\n            month: 'short',\r\n            timeZone: 'America/Argentina/Buenos_Aires',\r\n        });\r\n    }\r\n}\r\n\r\nfunction ConversationItem({\r\n    conversation,\r\n    onPress\r\n}: {\r\n    conversation: Conversation;\r\n    onPress: () => void;\r\n}) {\r\n    return (\r\n        <TouchableOpacity\r\n            style={styles.conversationItem}\r\n            onPress={onPress}\r\n            activeOpacity={0.7}\r\n        >\r\n            {/* Avatar placeholder */}\r\n            <View style={styles.avatar}>\r\n                <Text style={styles.avatarText}>\r\n                    {(conversation.customerName || conversation.customerPhone)[0]?.toUpperCase()}\r\n                </Text>\r\n            </View>\r\n\r\n            {/* Conversation details */}\r\n            <View style={styles.conversationContent}>\r\n                <View style={styles.conversationHeader}>\r\n                    <Text style={styles.customerName} numberOfLines={1}>\r\n                        {conversation.customerName || conversation.customerPhone}\r\n                    </Text>\r\n                    <View style={styles.timeContainer}>\r\n                        {conversation.hasAISuggestion && (\r\n                            <Bot size={14} color=\"#8b5cf6\" style={styles.aiIcon} />\r\n                        )}\r\n                        <Text style={styles.timestamp}>\r\n                            {formatTimestamp(conversation.lastMessageAt)}\r\n                        </Text>\r\n                    </View>\r\n                </View>\r\n\r\n                <View style={styles.conversationFooter}>\r\n                    <Text style={styles.preview} numberOfLines={1}>\r\n                        {conversation.lastMessagePreview || 'Sin mensajes'}\r\n                    </Text>\r\n                    {conversation.unreadCount > 0 && (\r\n                        <View style={styles.badge}>\r\n                            <Text style={styles.badgeText}>{conversation.unreadCount}</Text>\r\n                        </View>\r\n                    )}\r\n                </View>\r\n            </View>\r\n\r\n            <ChevronRight size={20} color=\"#9ca3af\" />\r\n        </TouchableOpacity>\r\n    );\r\n}\r\n\r\nexport default function ChatsScreen() {\r\n    const router = useRouter();\r\n    const { user } = useAuth();\r\n\r\n    const {\r\n        data: conversations = [],\r\n        isLoading,\r\n        error,\r\n        refetch,\r\n        isRefetching,\r\n    } = useQuery({\r\n        queryKey: ['assigned-conversations', user?.id],\r\n        queryFn: fetchAssignedConversations,\r\n        enabled: !!user,\r\n    });\r\n\r\n    const handleConversationPress = (conversationId: string) => {\r\n        // Use type assertion for dynamic route\r\n        router.push(`/chats/${conversationId}` as never);\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <View style={styles.centerContainer}>\r\n                <ActivityIndicator size=\"large\" color=\"#059669\" />\r\n                <Text style={styles.loadingText}>Cargando conversaciones...</Text>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    if (error) {\r\n        return (\r\n            <View style={styles.centerContainer}>\r\n                <MessageSquare size={48} color=\"#9ca3af\" />\r\n                <Text style={styles.errorText}>Error al cargar conversaciones</Text>\r\n                <TouchableOpacity style={styles.retryButton} onPress={() => refetch()}>\r\n                    <Text style={styles.retryText}>Reintentar</Text>\r\n                </TouchableOpacity>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    if (conversations.length === 0) {\r\n        return (\r\n            <View style={styles.centerContainer}>\r\n                <MessageSquare size={48} color=\"#9ca3af\" />\r\n                <Text style={styles.emptyTitle}>Sin conversaciones asignadas</Text>\r\n                <Text style={styles.emptySubtitle}>\r\n                    Cuando te asignen una conversaci├│n de WhatsApp, aparecer├í ac├í.\r\n                </Text>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            {/* Header with Copilot info */}\r\n            <View style={styles.header}>\r\n                <Bot size={20} color=\"#8b5cf6\" />\r\n                <Text style={styles.headerText}>\r\n                    Copilot disponible para ayudarte a responder\r\n                </Text>\r\n            </View>\r\n\r\n            <FlatList\r\n                data={conversations}\r\n                keyExtractor={(item) => item.id}\r\n                renderItem={({ item }) => (\r\n                    <ConversationItem\r\n                        conversation={item}\r\n                        onPress={() => handleConversationPress(item.id)}\r\n                    />\r\n                )}\r\n                refreshControl={\r\n                    <RefreshControl\r\n                        refreshing={isRefetching}\r\n                        onRefresh={refetch}\r\n                        tintColor=\"#059669\"\r\n                        colors={['#059669']}\r\n                    />\r\n                }\r\n                contentContainerStyle={styles.listContent}\r\n            />\r\n        </View>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n        backgroundColor: '#f9fafb',\r\n    },\r\n    centerContainer: {\r\n        flex: 1,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        padding: 24,\r\n        backgroundColor: '#f9fafb',\r\n    },\r\n    loadingText: {\r\n        marginTop: 12,\r\n        color: '#6b7280',\r\n        fontSize: 14,\r\n    },\r\n    errorText: {\r\n        marginTop: 12,\r\n        color: '#ef4444',\r\n        fontSize: 14,\r\n    },\r\n    retryButton: {\r\n        marginTop: 16,\r\n        paddingHorizontal: 16,\r\n        paddingVertical: 8,\r\n        backgroundColor: '#059669',\r\n        borderRadius: 8,\r\n    },\r\n    retryText: {\r\n        color: '#fff',\r\n        fontSize: 14,\r\n        fontWeight: '500',\r\n    },\r\n    emptyTitle: {\r\n        marginTop: 16,\r\n        fontSize: 16,\r\n        fontWeight: '600',\r\n        color: '#374151',\r\n    },\r\n    emptySubtitle: {\r\n        marginTop: 8,\r\n        fontSize: 14,\r\n        color: '#6b7280',\r\n        textAlign: 'center',\r\n        maxWidth: 280,\r\n    },\r\n    header: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        gap: 8,\r\n        padding: 12,\r\n        backgroundColor: '#f5f3ff',\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: '#e9d5ff',\r\n    },\r\n    headerText: {\r\n        fontSize: 13,\r\n        color: '#7c3aed',\r\n        fontWeight: '500',\r\n    },\r\n    listContent: {\r\n        paddingBottom: 20,\r\n    },\r\n    conversationItem: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        padding: 16,\r\n        backgroundColor: '#fff',\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: '#f3f4f6',\r\n    },\r\n    avatar: {\r\n        width: 48,\r\n        height: 48,\r\n        borderRadius: 24,\r\n        backgroundColor: '#059669',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n    },\r\n    avatarText: {\r\n        color: '#fff',\r\n        fontSize: 18,\r\n        fontWeight: '600',\r\n    },\r\n    conversationContent: {\r\n        flex: 1,\r\n        marginLeft: 12,\r\n        marginRight: 8,\r\n    },\r\n    conversationHeader: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        marginBottom: 4,\r\n    },\r\n    customerName: {\r\n        fontSize: 15,\r\n        fontWeight: '600',\r\n        color: '#111827',\r\n        flex: 1,\r\n        marginRight: 8,\r\n    },\r\n    timeContainer: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        gap: 4,\r\n    },\r\n    aiIcon: {\r\n        marginRight: 2,\r\n    },\r\n    timestamp: {\r\n        fontSize: 12,\r\n        color: '#9ca3af',\r\n    },\r\n    conversationFooter: {\r\n        flexDirection: 'row',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n    },\r\n    preview: {\r\n        fontSize: 14,\r\n        color: '#6b7280',\r\n        flex: 1,\r\n        marginRight: 8,\r\n    },\r\n    badge: {\r\n        backgroundColor: '#059669',\r\n        paddingHorizontal: 8,\r\n        paddingVertical: 2,\r\n        borderRadius: 10,\r\n        minWidth: 20,\r\n        alignItems: 'center',\r\n    },\r\n    badgeText: {\r\n        color: '#fff',\r\n        fontSize: 12,\r\n        fontWeight: '600',\r\n    },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\customers\\[id].tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Customer Detail Screen\r\n * ======================\r\n *\r\n * Phase 9.10: Mobile-First Architecture\r\n * Customer details and job history.\r\n */\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  ScrollView,\r\n  TouchableOpacity,\r\n  StyleSheet,\r\n  Alert,\r\n  Linking,\r\n  ActivityIndicator,\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\nimport { useLocalSearchParams, useRouter, Stack } from 'expo-router';\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport {\r\n  Phone,\r\n  Mail,\r\n  MapPin,\r\n  FileText,\r\n  Briefcase,\r\n  Edit2,\r\n  Trash2,\r\n  MessageCircle,\r\n  ChevronRight,\r\n  Calendar,\r\n  DollarSign,\r\n} from 'lucide-react-native';\r\n\r\nimport { api } from '../../../lib/api/client';\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// TYPES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\ninterface Customer {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  email?: string;\r\n  address?: string;\r\n  cuit?: string;\r\n  taxCondition?: string;\r\n  notes?: string;\r\n  createdAt: string;\r\n}\r\n\r\ninterface CustomerJob {\r\n  id: string;\r\n  serviceType: string;\r\n  status: string;\r\n  scheduledStart?: string;\r\n  address: string;\r\n  total?: number;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// COMPONENT\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport default function CustomerDetailScreen() {\r\n  const { id } = useLocalSearchParams<{ id: string }>();\r\n  const router = useRouter();\r\n  const queryClient = useQueryClient();\r\n\r\n  // Fetch customer details\r\n  const { data: customerData, isLoading } = useQuery({\r\n    queryKey: ['customer', id],\r\n    queryFn: async () => {\r\n      const response = await api.customers.get(id);\r\n      return response;\r\n    },\r\n    enabled: !!id,\r\n  });\r\n\r\n  // Fetch customer jobs\r\n  const { data: jobsData } = useQuery({\r\n    queryKey: ['customer-jobs', id],\r\n    queryFn: async () => {\r\n      const response = await api.jobs.list({ customerId: id, limit: 10 });\r\n      return response;\r\n    },\r\n    enabled: !!id,\r\n  });\r\n\r\n  const customer: Customer | null = customerData?.data as Customer || null;\r\n  const jobs: CustomerJob[] = (jobsData?.data as CustomerJob[]) || [];\r\n\r\n  // Delete mutation\r\n  const deleteMutation = useMutation({\r\n    mutationFn: async () => {\r\n      const response = await api.customers.delete(id);\r\n      return response;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: ['customers'] });\r\n      router.back();\r\n    },\r\n  });\r\n\r\n  // Actions\r\n  const handleCall = useCallback(() => {\r\n    if (customer?.phone) {\r\n      Linking.openURL(`tel:${customer.phone}`);\r\n    }\r\n  }, [customer?.phone]);\r\n\r\n  const handleWhatsApp = useCallback(() => {\r\n    if (customer?.phone) {\r\n      const phone = customer.phone.replace(/\\D/g, '');\r\n      Linking.openURL(`whatsapp://send?phone=${phone}`);\r\n    }\r\n  }, [customer?.phone]);\r\n\r\n  const handleEmail = useCallback(() => {\r\n    if (customer?.email) {\r\n      Linking.openURL(`mailto:${customer.email}`);\r\n    }\r\n  }, [customer?.email]);\r\n\r\n  const handleMap = useCallback(() => {\r\n    if (customer?.address) {\r\n      const query = encodeURIComponent(customer.address);\r\n      Linking.openURL(`https://maps.google.com/?q=${query}`);\r\n    }\r\n  }, [customer?.address]);\r\n\r\n  const handleEdit = useCallback(() => {\r\n    router.push(`/customers/${id}/edit`);\r\n  }, [router, id]);\r\n\r\n  const handleDelete = useCallback(() => {\r\n    Alert.alert(\r\n      'Eliminar cliente',\r\n      `┬┐Est├ís seguro de eliminar a ${customer?.name}?`,\r\n      [\r\n        { text: 'Cancelar', style: 'cancel' },\r\n        {\r\n          text: 'Eliminar',\r\n          style: 'destructive',\r\n          onPress: () => deleteMutation.mutate(),\r\n        },\r\n      ]\r\n    );\r\n  }, [customer?.name, deleteMutation]);\r\n\r\n  const handleCreateJob = useCallback(() => {\r\n    router.push(`/jobs/create?customerId=${id}`);\r\n  }, [router, id]);\r\n\r\n  const navigateToJob = useCallback((jobId: string) => {\r\n    router.push(`/jobs/${jobId}`);\r\n  }, [router]);\r\n\r\n  const getStatusColor = (status: string) => {\r\n    const colors: Record<string, string> = {\r\n      pending: '#f59e0b',\r\n      scheduled: '#3b82f6',\r\n      en_camino: '#8b5cf6',\r\n      in_progress: '#6366f1',\r\n      completed: '#22c55e',\r\n      cancelled: '#ef4444',\r\n    };\r\n    return colors[status] || '#6b7280';\r\n  };\r\n\r\n  const formatTaxCondition = (condition?: string) => {\r\n    const conditions: Record<string, string> = {\r\n      responsable_inscripto: 'Responsable Inscripto',\r\n      monotributista: 'Monotributista',\r\n      consumidor_final: 'Consumidor Final',\r\n      exento: 'Exento',\r\n    };\r\n    return conditions[condition || ''] || condition || '-';\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <SafeAreaView style={styles.container}>\r\n        <Stack.Screen options={{ title: 'Cliente' }} />\r\n        <View style={styles.loadingContainer}>\r\n          <ActivityIndicator size=\"large\" color=\"#16a34a\" />\r\n        </View>\r\n      </SafeAreaView>\r\n    );\r\n  }\r\n\r\n  if (!customer) {\r\n    return (\r\n      <SafeAreaView style={styles.container}>\r\n        <Stack.Screen options={{ title: 'Cliente' }} />\r\n        <View style={styles.errorContainer}>\r\n          <Text style={styles.errorText}>Cliente no encontrado</Text>\r\n        </View>\r\n      </SafeAreaView>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <SafeAreaView style={styles.container} edges={['bottom']}>\r\n      <Stack.Screen\r\n        options={{\r\n          title: customer.name,\r\n          headerRight: () => (\r\n            <View style={styles.headerActions}>\r\n              <TouchableOpacity onPress={handleEdit} style={styles.headerButton}>\r\n                <Edit2 size={20} color=\"#16a34a\" />\r\n              </TouchableOpacity>\r\n              <TouchableOpacity onPress={handleDelete} style={styles.headerButton}>\r\n                <Trash2 size={20} color=\"#ef4444\" />\r\n              </TouchableOpacity>\r\n            </View>\r\n          ),\r\n        }}\r\n      />\r\n\r\n      <ScrollView showsVerticalScrollIndicator={false}>\r\n        {/* Contact Actions */}\r\n        <View style={styles.actionsRow}>\r\n          <TouchableOpacity style={styles.actionButton} onPress={handleCall}>\r\n            <Phone size={20} color=\"#16a34a\" />\r\n            <Text style={styles.actionText}>Llamar</Text>\r\n          </TouchableOpacity>\r\n\r\n          <TouchableOpacity style={styles.actionButton} onPress={handleWhatsApp}>\r\n            <MessageCircle size={20} color=\"#25d366\" />\r\n            <Text style={styles.actionText}>WhatsApp</Text>\r\n          </TouchableOpacity>\r\n\r\n          {customer.email && (\r\n            <TouchableOpacity style={styles.actionButton} onPress={handleEmail}>\r\n              <Mail size={20} color=\"#3b82f6\" />\r\n              <Text style={styles.actionText}>Email</Text>\r\n            </TouchableOpacity>\r\n          )}\r\n\r\n          {customer.address && (\r\n            <TouchableOpacity style={styles.actionButton} onPress={handleMap}>\r\n              <MapPin size={20} color=\"#ef4444\" />\r\n              <Text style={styles.actionText}>Mapa</Text>\r\n            </TouchableOpacity>\r\n          )}\r\n        </View>\r\n\r\n        {/* Contact Info */}\r\n        <View style={styles.section}>\r\n          <Text style={styles.sectionTitle}>Informaci├│n de contacto</Text>\r\n\r\n          <View style={styles.infoCard}>\r\n            <InfoRow icon={Phone} label=\"Tel├⌐fono\" value={customer.phone} />\r\n            {customer.email && (\r\n              <InfoRow icon={Mail} label=\"Email\" value={customer.email} />\r\n            )}\r\n            {customer.address && (\r\n              <InfoRow icon={MapPin} label=\"Direcci├│n\" value={customer.address} />\r\n            )}\r\n          </View>\r\n        </View>\r\n\r\n        {/* Fiscal Info */}\r\n        {(customer.cuit || customer.taxCondition) && (\r\n          <View style={styles.section}>\r\n            <Text style={styles.sectionTitle}>Informaci├│n fiscal</Text>\r\n\r\n            <View style={styles.infoCard}>\r\n              {customer.cuit && (\r\n                <InfoRow icon={FileText} label=\"CUIT\" value={customer.cuit} />\r\n              )}\r\n              {customer.taxCondition && (\r\n                <InfoRow\r\n                  icon={DollarSign}\r\n                  label=\"Condici├│n fiscal\"\r\n                  value={formatTaxCondition(customer.taxCondition)}\r\n                />\r\n              )}\r\n            </View>\r\n          </View>\r\n        )}\r\n\r\n        {/* Notes */}\r\n        {customer.notes && (\r\n          <View style={styles.section}>\r\n            <Text style={styles.sectionTitle}>Notas</Text>\r\n            <View style={styles.notesCard}>\r\n              <Text style={styles.notesText}>{customer.notes}</Text>\r\n            </View>\r\n          </View>\r\n        )}\r\n\r\n        {/* Jobs */}\r\n        <View style={styles.section}>\r\n          <View style={styles.sectionHeader}>\r\n            <Text style={styles.sectionTitle}>Trabajos recientes</Text>\r\n            <TouchableOpacity onPress={handleCreateJob}>\r\n              <Text style={styles.sectionAction}>+ Nuevo trabajo</Text>\r\n            </TouchableOpacity>\r\n          </View>\r\n\r\n          {jobs.length === 0 ? (\r\n            <View style={styles.emptyJobs}>\r\n              <Briefcase size={32} color=\"#d1d5db\" />\r\n              <Text style={styles.emptyJobsText}>Sin trabajos registrados</Text>\r\n            </View>\r\n          ) : (\r\n            <View style={styles.jobsList}>\r\n              {jobs.map((job) => (\r\n                <TouchableOpacity\r\n                  key={job.id}\r\n                  style={styles.jobCard}\r\n                  onPress={() => navigateToJob(job.id)}\r\n                >\r\n                  <View style={styles.jobInfo}>\r\n                    <Text style={styles.jobTitle}>{job.serviceType}</Text>\r\n                    <View style={styles.jobMeta}>\r\n                      {job.scheduledStart && (\r\n                        <>\r\n                          <Calendar size={12} color=\"#6b7280\" />\r\n                          <Text style={styles.jobMetaText}>\r\n                            {new Date(job.scheduledStart).toLocaleDateString('es-AR')}\r\n                          </Text>\r\n                        </>\r\n                      )}\r\n                    </View>\r\n                  </View>\r\n                  <View\r\n                    style={[\r\n                      styles.statusBadge,\r\n                      { backgroundColor: `${getStatusColor(job.status)}20` },\r\n                    ]}\r\n                  >\r\n                    <Text\r\n                      style={[styles.statusText, { color: getStatusColor(job.status) }]}\r\n                    >\r\n                      {job.status}\r\n                    </Text>\r\n                  </View>\r\n                  <ChevronRight size={16} color=\"#9ca3af\" />\r\n                </TouchableOpacity>\r\n              ))}\r\n            </View>\r\n          )}\r\n        </View>\r\n      </ScrollView>\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// SUB-COMPONENTS\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\ninterface InfoRowProps {\r\n  icon: React.ElementType;\r\n  label: string;\r\n  value: string;\r\n}\r\n\r\nfunction InfoRow({ icon: Icon, label, value }: InfoRowProps) {\r\n  return (\r\n    <View style={styles.infoRow}>\r\n      <View style={styles.infoIcon}>\r\n        <Icon size={16} color=\"#6b7280\" />\r\n      </View>\r\n      <View style={styles.infoContent}>\r\n        <Text style={styles.infoLabel}>{label}</Text>\r\n        <Text style={styles.infoValue}>{value}</Text>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// STYLES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f9fafb',\r\n  },\r\n  loadingContainer: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  errorContainer: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  errorText: {\r\n    fontSize: 16,\r\n    color: '#6b7280',\r\n  },\r\n  headerActions: {\r\n    flexDirection: 'row',\r\n    gap: 16,\r\n  },\r\n  headerButton: {\r\n    padding: 4,\r\n  },\r\n  actionsRow: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-around',\r\n    paddingVertical: 16,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  actionButton: {\r\n    alignItems: 'center',\r\n    gap: 4,\r\n  },\r\n  actionText: {\r\n    fontSize: 12,\r\n    color: '#374151',\r\n  },\r\n  section: {\r\n    padding: 16,\r\n  },\r\n  sectionHeader: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    marginBottom: 12,\r\n  },\r\n  sectionTitle: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginBottom: 12,\r\n  },\r\n  sectionAction: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#16a34a',\r\n  },\r\n  infoCard: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    padding: 16,\r\n  },\r\n  infoRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'flex-start',\r\n    paddingVertical: 8,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#f3f4f6',\r\n  },\r\n  infoIcon: {\r\n    width: 32,\r\n    height: 32,\r\n    borderRadius: 16,\r\n    backgroundColor: '#f3f4f6',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    marginRight: 12,\r\n  },\r\n  infoContent: {\r\n    flex: 1,\r\n  },\r\n  infoLabel: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n  },\r\n  infoValue: {\r\n    fontSize: 14,\r\n    color: '#111827',\r\n    marginTop: 2,\r\n  },\r\n  notesCard: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    padding: 16,\r\n  },\r\n  notesText: {\r\n    fontSize: 14,\r\n    color: '#374151',\r\n    lineHeight: 20,\r\n  },\r\n  emptyJobs: {\r\n    alignItems: 'center',\r\n    paddingVertical: 32,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n  },\r\n  emptyJobsText: {\r\n    marginTop: 8,\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n  },\r\n  jobsList: {\r\n    gap: 8,\r\n  },\r\n  jobCard: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    padding: 12,\r\n  },\r\n  jobInfo: {\r\n    flex: 1,\r\n  },\r\n  jobTitle: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  jobMeta: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n    marginTop: 4,\r\n  },\r\n  jobMetaText: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n  },\r\n  statusBadge: {\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 4,\r\n    borderRadius: 4,\r\n    marginRight: 8,\r\n  },\r\n  statusText: {\r\n    fontSize: 12,\r\n    fontWeight: '500',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\customers\\_layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\customers\\index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":26,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":7}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Customers List Screen\r\n * =====================\r\n *\r\n * Phase 9.10: Mobile-First Architecture\r\n * Customer management for mobile app.\r\n */\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  FlatList,\r\n  TextInput,\r\n  TouchableOpacity,\r\n  StyleSheet,\r\n  RefreshControl,\r\n  ActivityIndicator,\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\nimport { useRouter } from 'expo-router';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport {\r\n  Search,\r\n  Plus,\r\n  User,\r\n  Phone,\r\n  MapPin,\r\n  ChevronRight,\r\n  Users,\r\n} from 'lucide-react-native';\r\n\r\nimport { api } from '../../../lib/api/client';\r\nimport { useIsOnline } from '../../../lib/hooks/use-offline';\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// TYPES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\ninterface Customer {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  email?: string;\r\n  address?: string;\r\n  cuit?: string;\r\n  taxCondition?: string;\r\n  jobsCount?: number;\r\n  lastJobAt?: string;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// COMPONENT\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport default function CustomersScreen() {\r\n  const router = useRouter();\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const isOnline = useIsOnline();\r\n\r\n  // Fetch customers\r\n  const {\r\n    data,\r\n    isLoading,\r\n    isRefetching,\r\n    refetch,\r\n  } = useQuery({\r\n    queryKey: ['customers', searchQuery],\r\n    queryFn: async () => {\r\n      const response = await api.customers.list({\r\n        search: searchQuery || undefined,\r\n        limit: 50,\r\n      });\r\n      return response;\r\n    },\r\n    staleTime: 30000, // 30 seconds\r\n  });\r\n\r\n  const customers: Customer[] = (data?.data as Customer[]) || [];\r\n\r\n  const handleRefresh = useCallback(() => {\r\n    refetch();\r\n  }, [refetch]);\r\n\r\n  const handleSearch = useCallback((text: string) => {\r\n    setSearchQuery(text);\r\n  }, []);\r\n\r\n  const navigateToCustomer = useCallback((customerId: string) => {\r\n    router.push(`/customers/${customerId}`);\r\n  }, [router]);\r\n\r\n  const navigateToCreate = useCallback(() => {\r\n    router.push('/customers/create');\r\n  }, [router]);\r\n\r\n  const renderCustomer = useCallback(({ item }: { item: Customer }) => (\r\n    <TouchableOpacity\r\n      style={styles.customerCard}\r\n      onPress={() => navigateToCustomer(item.id)}\r\n      activeOpacity={0.7}\r\n    >\r\n      <View style={styles.avatar}>\r\n        <Text style={styles.avatarText}>\r\n          {item.name.charAt(0).toUpperCase()}\r\n        </Text>\r\n      </View>\r\n\r\n      <View style={styles.customerInfo}>\r\n        <Text style={styles.customerName} numberOfLines={1}>\r\n          {item.name}\r\n        </Text>\r\n\r\n        <View style={styles.customerMeta}>\r\n          <Phone size={12} color=\"#6b7280\" />\r\n          <Text style={styles.metaText}>{item.phone}</Text>\r\n        </View>\r\n\r\n        {item.address && (\r\n          <View style={styles.customerMeta}>\r\n            <MapPin size={12} color=\"#6b7280\" />\r\n            <Text style={styles.metaText} numberOfLines={1}>\r\n              {item.address}\r\n            </Text>\r\n          </View>\r\n        )}\r\n\r\n        {item.jobsCount !== undefined && item.jobsCount > 0 && (\r\n          <Text style={styles.jobsCount}>\r\n            {item.jobsCount} trabajo{item.jobsCount !== 1 ? 's' : ''}\r\n          </Text>\r\n        )}\r\n      </View>\r\n\r\n      <ChevronRight size={20} color=\"#9ca3af\" />\r\n    </TouchableOpacity>\r\n  ), [navigateToCustomer]);\r\n\r\n  const ListEmptyComponent = useCallback(() => (\r\n    <View style={styles.emptyContainer}>\r\n      <Users size={48} color=\"#d1d5db\" />\r\n      <Text style={styles.emptyTitle}>\r\n        {searchQuery ? 'Sin resultados' : 'Sin clientes'}\r\n      </Text>\r\n      <Text style={styles.emptyText}>\r\n        {searchQuery\r\n          ? 'No se encontraron clientes con esa b├║squeda'\r\n          : 'Agreg├í tu primer cliente para comenzar'}\r\n      </Text>\r\n      {!searchQuery && (\r\n        <TouchableOpacity style={styles.emptyButton} onPress={navigateToCreate}>\r\n          <Plus size={18} color=\"#fff\" />\r\n          <Text style={styles.emptyButtonText}>Agregar cliente</Text>\r\n        </TouchableOpacity>\r\n      )}\r\n    </View>\r\n  ), [searchQuery, navigateToCreate]);\r\n\r\n  return (\r\n    <SafeAreaView style={styles.container} edges={['bottom']}>\r\n      {/* Header */}\r\n      <View style={styles.header}>\r\n        <Text style={styles.title}>Clientes</Text>\r\n        <TouchableOpacity\r\n          style={styles.addButton}\r\n          onPress={navigateToCreate}\r\n        >\r\n          <Plus size={20} color=\"#fff\" />\r\n        </TouchableOpacity>\r\n      </View>\r\n\r\n      {/* Search */}\r\n      <View style={styles.searchContainer}>\r\n        <Search size={18} color=\"#9ca3af\" style={styles.searchIcon} />\r\n        <TextInput\r\n          style={styles.searchInput}\r\n          placeholder=\"Buscar por nombre, tel├⌐fono...\"\r\n          placeholderTextColor=\"#9ca3af\"\r\n          value={searchQuery}\r\n          onChangeText={handleSearch}\r\n          returnKeyType=\"search\"\r\n          clearButtonMode=\"while-editing\"\r\n        />\r\n      </View>\r\n\r\n      {/* Offline indicator */}\r\n      {!isOnline && (\r\n        <View style={styles.offlineBanner}>\r\n          <Text style={styles.offlineText}>\r\n            Modo sin conexi├│n - Datos pueden estar desactualizados\r\n          </Text>\r\n        </View>\r\n      )}\r\n\r\n      {/* List */}\r\n      {isLoading && !isRefetching ? (\r\n        <View style={styles.loadingContainer}>\r\n          <ActivityIndicator size=\"large\" color=\"#16a34a\" />\r\n          <Text style={styles.loadingText}>Cargando clientes...</Text>\r\n        </View>\r\n      ) : (\r\n        <FlatList\r\n          data={customers}\r\n          keyExtractor={(item) => item.id}\r\n          renderItem={renderCustomer}\r\n          contentContainerStyle={styles.listContent}\r\n          refreshControl={\r\n            <RefreshControl\r\n              refreshing={isRefetching}\r\n              onRefresh={handleRefresh}\r\n              colors={['#16a34a']}\r\n              tintColor=\"#16a34a\"\r\n            />\r\n          }\r\n          ListEmptyComponent={ListEmptyComponent}\r\n          showsVerticalScrollIndicator={false}\r\n        />\r\n      )}\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// STYLES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f9fafb',\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  title: {\r\n    fontSize: 24,\r\n    fontWeight: 'bold',\r\n    color: '#111827',\r\n  },\r\n  addButton: {\r\n    width: 40,\r\n    height: 40,\r\n    borderRadius: 20,\r\n    backgroundColor: '#16a34a',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  searchContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    margin: 16,\r\n    paddingHorizontal: 12,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  searchIcon: {\r\n    marginRight: 8,\r\n  },\r\n  searchInput: {\r\n    flex: 1,\r\n    paddingVertical: 12,\r\n    fontSize: 16,\r\n    color: '#111827',\r\n  },\r\n  offlineBanner: {\r\n    backgroundColor: '#fef3c7',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 8,\r\n  },\r\n  offlineText: {\r\n    fontSize: 12,\r\n    color: '#92400e',\r\n    textAlign: 'center',\r\n  },\r\n  listContent: {\r\n    paddingHorizontal: 16,\r\n    paddingBottom: 100,\r\n  },\r\n  customerCard: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    padding: 12,\r\n    marginBottom: 8,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 1 },\r\n    shadowOpacity: 0.05,\r\n    shadowRadius: 2,\r\n    elevation: 1,\r\n  },\r\n  avatar: {\r\n    width: 48,\r\n    height: 48,\r\n    borderRadius: 24,\r\n    backgroundColor: '#dcfce7',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    marginRight: 12,\r\n  },\r\n  avatarText: {\r\n    fontSize: 20,\r\n    fontWeight: '600',\r\n    color: '#16a34a',\r\n  },\r\n  customerInfo: {\r\n    flex: 1,\r\n  },\r\n  customerName: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginBottom: 4,\r\n  },\r\n  customerMeta: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n    marginBottom: 2,\r\n  },\r\n  metaText: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n    flex: 1,\r\n  },\r\n  jobsCount: {\r\n    fontSize: 12,\r\n    color: '#16a34a',\r\n    fontWeight: '500',\r\n    marginTop: 2,\r\n  },\r\n  loadingContainer: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  loadingText: {\r\n    marginTop: 12,\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n  },\r\n  emptyContainer: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    paddingVertical: 48,\r\n  },\r\n  emptyTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    marginTop: 16,\r\n  },\r\n  emptyText: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n    textAlign: 'center',\r\n    paddingHorizontal: 32,\r\n  },\r\n  emptyButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#16a34a',\r\n    paddingHorizontal: 20,\r\n    paddingVertical: 12,\r\n    borderRadius: 8,\r\n    marginTop: 24,\r\n  },\r\n  emptyButtonText: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\inventory\\_layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\inventory\\index.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":19,"column":25,"nodeType":"Literal","endLine":19,"endColumn":45}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Inventory Screen\r\n * ================\r\n *\r\n * Main inventory view for technicians showing vehicle stock.\r\n */\r\n\r\nimport { useCallback, useMemo, useState, useEffect } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  RefreshControl,\r\n  TouchableOpacity,\r\n  TextInput,\r\n} from 'react-native';\r\nimport { FlashList } from '@shopify/flash-list';\r\nimport { useRouter } from 'expo-router';\r\nimport { Feather } from '@expo/vector-icons';\r\nimport { withObservables } from '@nozbe/watermelondb/react';\r\nimport { Q } from '@nozbe/watermelondb';\r\n\r\nimport { database } from '../../../watermelon/database';\r\nimport { VehicleStock } from '../../../watermelon/models';\r\nimport { performSync } from '../../../lib/sync/sync-engine';\r\nimport { useSyncStatus } from '../../../lib/hooks/use-sync-status';\r\nimport {\r\n  getPendingDeductionCount,\r\n  getFailedDeductionCount,\r\n  retryFailedDeductions,\r\n} from '../../../lib/sync/pending-deductions-sync';\r\n\r\nconst vehicleStockCollection = database.get<VehicleStock>('vehicle_stock');\r\n\r\nfunction InventoryScreen({ stock }: { stock: VehicleStock[] }) {\r\n  const router = useRouter();\r\n  const syncStatus = useSyncStatus();\r\n  const isSyncing = syncStatus.isSyncing;\r\n  const [search, setSearch] = useState('');\r\n  const [pendingCount, setPendingCount] = useState(0);\r\n  const [failedCount, setFailedCount] = useState(0);\r\n\r\n  // Load pending deduction counts\r\n  useEffect(() => {\r\n    const loadCounts = async () => {\r\n      try {\r\n        const [pending, failed] = await Promise.all([\r\n          getPendingDeductionCount(),\r\n          getFailedDeductionCount(),\r\n        ]);\r\n        setPendingCount(pending);\r\n        setFailedCount(failed);\r\n      } catch (error) {\r\n        console.error('Error loading pending counts:', error);\r\n      }\r\n    };\r\n    loadCounts();\r\n  }, [isSyncing]); // Refresh counts after sync\r\n\r\n  const handleRefresh = useCallback(async () => {\r\n    await performSync();\r\n  }, []);\r\n\r\n  const handleRetryFailed = useCallback(async () => {\r\n    try {\r\n      const retried = await retryFailedDeductions();\r\n      if (retried > 0) {\r\n        setFailedCount(0);\r\n        setPendingCount((prev) => prev + retried);\r\n        // Trigger sync\r\n        performSync().catch(console.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error retrying failed deductions:', error);\r\n    }\r\n  }, []);\r\n\r\n  const filteredStock = useMemo(() => {\r\n    if (!search) return stock;\r\n    const query = search.toLowerCase();\r\n    return stock.filter(\r\n      (item) =>\r\n        item.productName.toLowerCase().includes(query) ||\r\n        item.productSku.toLowerCase().includes(query)\r\n    );\r\n  }, [stock, search]);\r\n\r\n  // Group by status\r\n  const groupedStock = useMemo(() => {\r\n    const groups = {\r\n      needsReplenishment: [] as VehicleStock[],\r\n      ok: [] as VehicleStock[],\r\n    };\r\n\r\n    filteredStock.forEach((item) => {\r\n      if (item.needsReplenishment || item.quantity <= item.minQuantity) {\r\n        groups.needsReplenishment.push(item);\r\n      } else {\r\n        groups.ok.push(item);\r\n      }\r\n    });\r\n\r\n    return groups;\r\n  }, [filteredStock]);\r\n\r\n  const totalValue = useMemo(() => {\r\n    return stock.reduce((sum, item) => sum + item.quantity * item.unitCost, 0);\r\n  }, [stock]);\r\n\r\n  const renderItem = ({ item }: { item: VehicleStock }) => (\r\n    <TouchableOpacity\r\n      style={styles.stockCard}\r\n      onPress={() => router.push({ pathname: '/(tabs)/inventory/[id]', params: { id: item.id } } as any)}\r\n    >\r\n      <View style={styles.stockInfo}>\r\n        <Text style={styles.productName}>{item.productName}</Text>\r\n        <Text style={styles.productSku}>{item.productSku}</Text>\r\n      </View>\r\n      <View style={styles.stockQuantity}>\r\n        <Text\r\n          style={[\r\n            styles.quantityText,\r\n            item.quantity <= item.minQuantity && styles.lowQuantity,\r\n          ]}\r\n        >\r\n          {item.quantity}\r\n        </Text>\r\n        <Text style={styles.quantityLabel}>\r\n          Min: {item.minQuantity}\r\n        </Text>\r\n      </View>\r\n      <Feather name=\"chevron-right\" size={20} color=\"#9ca3af\" />\r\n    </TouchableOpacity>\r\n  );\r\n\r\n  const ListHeader = () => (\r\n    <View>\r\n      {/* Pending sync indicator */}\r\n      {(pendingCount > 0 || failedCount > 0) && (\r\n        <View style={styles.pendingSyncBanner}>\r\n          <View style={styles.pendingSyncContent}>\r\n            <Feather\r\n              name={failedCount > 0 ? 'alert-circle' : 'cloud-off'}\r\n              size={18}\r\n              color={failedCount > 0 ? '#ef4444' : '#f59e0b'}\r\n            />\r\n            <Text style={styles.pendingSyncText}>\r\n              {failedCount > 0\r\n                ? `${failedCount} uso${failedCount > 1 ? 's' : ''} fallido${failedCount > 1 ? 's' : ''}`\r\n                : `${pendingCount} material${pendingCount > 1 ? 'es' : ''} pendiente${pendingCount > 1 ? 's' : ''} de sincronizar`}\r\n            </Text>\r\n          </View>\r\n          {failedCount > 0 ? (\r\n            <TouchableOpacity\r\n              style={styles.retryButton}\r\n              onPress={handleRetryFailed}\r\n            >\r\n              <Feather name=\"refresh-cw\" size={14} color=\"#ef4444\" />\r\n              <Text style={styles.retryButtonText}>Reintentar</Text>\r\n            </TouchableOpacity>\r\n          ) : (\r\n            <Feather name=\"loader\" size={16} color=\"#f59e0b\" />\r\n          )}\r\n        </View>\r\n      )}\r\n\r\n      {/* Stats */}\r\n      <View style={styles.statsContainer}>\r\n        <View style={styles.stat}>\r\n          <Text style={styles.statNumber}>{stock.length}</Text>\r\n          <Text style={styles.statLabel}>Productos</Text>\r\n        </View>\r\n        <View style={styles.stat}>\r\n          <Text style={[styles.statNumber, { color: '#ef4444' }]}>\r\n            {groupedStock.needsReplenishment.length}\r\n          </Text>\r\n          <Text style={styles.statLabel}>Stock bajo</Text>\r\n        </View>\r\n        <View style={styles.stat}>\r\n          <Text style={[styles.statNumber, { color: '#16a34a' }]}>\r\n            ${totalValue.toLocaleString()}\r\n          </Text>\r\n          <Text style={styles.statLabel}>Valor total</Text>\r\n        </View>\r\n      </View>\r\n\r\n      {/* Search */}\r\n      <View style={styles.searchContainer}>\r\n        <Feather name=\"search\" size={18} color=\"#9ca3af\" />\r\n        <TextInput\r\n          style={styles.searchInput}\r\n          placeholder=\"Buscar producto...\"\r\n          value={search}\r\n          onChangeText={setSearch}\r\n          placeholderTextColor=\"#9ca3af\"\r\n        />\r\n        {search.length > 0 && (\r\n          <TouchableOpacity onPress={() => setSearch('')}>\r\n            <Feather name=\"x\" size={18} color=\"#9ca3af\" />\r\n          </TouchableOpacity>\r\n        )}\r\n      </View>\r\n\r\n      {/* Low stock section */}\r\n      {groupedStock.needsReplenishment.length > 0 && (\r\n        <View style={styles.sectionHeader}>\r\n          <Feather name=\"alert-triangle\" size={16} color=\"#ef4444\" />\r\n          <Text style={[styles.sectionTitle, { color: '#ef4444' }]}>\r\n            Stock bajo ({groupedStock.needsReplenishment.length})\r\n          </Text>\r\n        </View>\r\n      )}\r\n    </View>\r\n  );\r\n\r\n  const ListEmpty = () => (\r\n    <View style={styles.empty}>\r\n      <Feather name=\"package\" size={48} color=\"#d1d5db\" />\r\n      <Text style={styles.emptyTitle}>Sin stock en veh├¡culo</Text>\r\n      <Text style={styles.emptyText}>\r\n        El inventario de tu veh├¡culo aparecer├í aqu├¡\r\n      </Text>\r\n    </View>\r\n  );\r\n\r\n  // Combine low stock and ok stock for flat list\r\n  const listData = [\r\n    ...groupedStock.needsReplenishment,\r\n    ...(groupedStock.needsReplenishment.length > 0 && groupedStock.ok.length > 0\r\n      ? [{ id: 'separator', type: 'separator' } as any]\r\n      : []),\r\n    ...groupedStock.ok,\r\n  ];\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <FlashList\r\n        data={listData}\r\n        renderItem={({ item }) => {\r\n          if (item.type === 'separator') {\r\n            return (\r\n              <View style={styles.sectionHeader}>\r\n                <Feather name=\"check-circle\" size={16} color=\"#16a34a\" />\r\n                <Text style={[styles.sectionTitle, { color: '#16a34a' }]}>\r\n                  Stock OK ({groupedStock.ok.length})\r\n                </Text>\r\n              </View>\r\n            );\r\n          }\r\n          return renderItem({ item });\r\n        }}\r\n        refreshControl={\r\n          <RefreshControl\r\n            refreshing={isSyncing}\r\n            onRefresh={handleRefresh}\r\n            colors={['#16a34a']}\r\n            tintColor=\"#16a34a\"\r\n          />\r\n        }\r\n        ListHeaderComponent={<ListHeader />}\r\n        ListEmptyComponent={<ListEmpty />}\r\n        contentContainerStyle={styles.listContent}\r\n      />\r\n\r\n      {/* Request replenishment FAB */}\r\n      <TouchableOpacity\r\n        style={styles.fab}\r\n        onPress={() => router.push('/(tabs)/inventory/replenish')}\r\n      >\r\n        <Feather name=\"plus\" size={24} color=\"#fff\" />\r\n      </TouchableOpacity>\r\n    </View>\r\n  );\r\n}\r\n\r\n// Observe vehicle stock from WatermelonDB\r\nconst enhance = withObservables([], () => ({\r\n  stock: vehicleStockCollection.query(Q.sortBy('product_name', Q.asc)),\r\n}));\r\n\r\nexport default enhance(InventoryScreen);\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  listContent: {\r\n    paddingBottom: 100,\r\n  },\r\n  statsContainer: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-around',\r\n    backgroundColor: '#fff',\r\n    paddingVertical: 16,\r\n    marginBottom: 8,\r\n  },\r\n  stat: {\r\n    alignItems: 'center',\r\n  },\r\n  statNumber: {\r\n    fontSize: 22,\r\n    fontWeight: 'bold',\r\n    color: '#111827',\r\n  },\r\n  statLabel: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  searchContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    marginHorizontal: 16,\r\n    marginVertical: 8,\r\n    paddingHorizontal: 12,\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  searchInput: {\r\n    flex: 1,\r\n    paddingVertical: 12,\r\n    paddingHorizontal: 8,\r\n    fontSize: 16,\r\n    color: '#111827',\r\n  },\r\n  sectionHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n    marginTop: 8,\r\n  },\r\n  sectionTitle: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    marginLeft: 8,\r\n  },\r\n  stockCard: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  stockInfo: {\r\n    flex: 1,\r\n  },\r\n  productName: {\r\n    fontSize: 16,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  productSku: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  stockQuantity: {\r\n    alignItems: 'flex-end',\r\n    marginRight: 12,\r\n  },\r\n  quantityText: {\r\n    fontSize: 20,\r\n    fontWeight: 'bold',\r\n    color: '#16a34a',\r\n  },\r\n  lowQuantity: {\r\n    color: '#ef4444',\r\n  },\r\n  quantityLabel: {\r\n    fontSize: 11,\r\n    color: '#9ca3af',\r\n  },\r\n  empty: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    paddingVertical: 64,\r\n    paddingHorizontal: 32,\r\n  },\r\n  emptyTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    marginTop: 16,\r\n  },\r\n  emptyText: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    textAlign: 'center',\r\n    marginTop: 8,\r\n  },\r\n  pendingSyncBanner: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    backgroundColor: '#fef3c7',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#fcd34d',\r\n  },\r\n  pendingSyncContent: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    flex: 1,\r\n  },\r\n  pendingSyncText: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#92400e',\r\n    marginLeft: 8,\r\n    flex: 1,\r\n  },\r\n  retryButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 6,\r\n    borderRadius: 6,\r\n    backgroundColor: '#fef2f2',\r\n    borderWidth: 1,\r\n    borderColor: '#fecaca',\r\n  },\r\n  retryButtonText: {\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n    color: '#ef4444',\r\n    marginLeft: 4,\r\n  },\r\n  fab: {\r\n    position: 'absolute',\r\n    bottom: 24,\r\n    right: 24,\r\n    width: 56,\r\n    height: 56,\r\n    borderRadius: 28,\r\n    backgroundColor: '#16a34a',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 2 },\r\n    shadowOpacity: 0.25,\r\n    shadowRadius: 4,\r\n    elevation: 5,\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\inventory\\replenish.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":19,"column":25,"nodeType":"Literal","endLine":19,"endColumn":45}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Replenishment Request Screen\r\n * ============================\r\n *\r\n * Allows technicians to request stock replenishment.\r\n */\r\n\r\nimport { useState, useCallback, useMemo } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  ScrollView,\r\n  TouchableOpacity,\r\n  TextInput,\r\n  Alert,\r\n} from 'react-native';\r\nimport { useRouter } from 'expo-router';\r\nimport { Feather } from '@expo/vector-icons';\r\nimport { withObservables } from '@nozbe/watermelondb/react';\r\nimport { Q } from '@nozbe/watermelondb';\r\n\r\nimport { database } from '../../../watermelon/database';\r\nimport { VehicleStock, ReplenishmentRequest } from '../../../watermelon/models';\r\n\r\nconst vehicleStockCollection = database.get<VehicleStock>('vehicle_stock');\r\nconst replenishmentCollection = database.get<ReplenishmentRequest>('replenishment_requests');\r\n\r\ninterface RequestItem {\r\n  productId: string;\r\n  productName: string;\r\n  currentQty: number;\r\n  requestedQty: number;\r\n}\r\n\r\nfunction ReplenishScreen({ stock }: { stock: VehicleStock[] }) {\r\n  const router = useRouter();\r\n  const [selectedItems, setSelectedItems] = useState<Map<string, number>>(new Map());\r\n  const [notes, setNotes] = useState('');\r\n  const [priority, setPriority] = useState<'low' | 'medium' | 'high' | 'urgent'>('medium');\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  // Items that need replenishment\r\n  const lowStockItems = useMemo(() => {\r\n    return stock.filter((item) => item.needsReplenishment || item.quantity <= item.minQuantity);\r\n  }, [stock]);\r\n\r\n  const toggleItem = useCallback((item: VehicleStock) => {\r\n    setSelectedItems((prev) => {\r\n      const next = new Map(prev);\r\n      if (next.has(item.productId)) {\r\n        next.delete(item.productId);\r\n      } else {\r\n        // Default request quantity is max - current\r\n        const requestQty = Math.max(item.maxQuantity - item.quantity, 1);\r\n        next.set(item.productId, requestQty);\r\n      }\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  const updateQuantity = useCallback((productId: string, qty: number) => {\r\n    setSelectedItems((prev) => {\r\n      const next = new Map(prev);\r\n      if (qty > 0) {\r\n        next.set(productId, qty);\r\n      } else {\r\n        next.delete(productId);\r\n      }\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  const handleSubmit = useCallback(async () => {\r\n    if (selectedItems.size === 0) {\r\n      Alert.alert('Error', 'Selecciona al menos un producto');\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      const items: RequestItem[] = [];\r\n      selectedItems.forEach((requestedQty, productId) => {\r\n        const stockItem = stock.find((s) => s.productId === productId);\r\n        if (stockItem) {\r\n          items.push({\r\n            productId,\r\n            productName: stockItem.productName,\r\n            currentQty: stockItem.quantity,\r\n            requestedQty,\r\n          });\r\n        }\r\n      });\r\n\r\n      // Create local replenishment request\r\n      await database.write(async () => {\r\n        await replenishmentCollection.create((request: any) => {\r\n          request.vehicleId = stock[0]?.vehicleId || '';\r\n          request.status = 'pending';\r\n          request.priority = priority;\r\n          request._raw.items = JSON.stringify(items);\r\n          request.notes = notes || null;\r\n          request.isSynced = false;\r\n        });\r\n      });\r\n\r\n      Alert.alert(\r\n        'Solicitud enviada',\r\n        'Tu solicitud de reposici├│n ha sido registrada',\r\n        [{ text: 'OK', onPress: () => router.back() }]\r\n      );\r\n    } catch (error) {\r\n      console.error('Error creating replenishment request:', error);\r\n      Alert.alert('Error', 'No se pudo crear la solicitud');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  }, [selectedItems, stock, priority, notes, router]);\r\n\r\n  const PrioritySelector = () => (\r\n    <View style={styles.priorityContainer}>\r\n      <Text style={styles.sectionLabel}>Prioridad</Text>\r\n      <View style={styles.priorityButtons}>\r\n        {(['low', 'medium', 'high', 'urgent'] as const).map((p) => (\r\n          <TouchableOpacity\r\n            key={p}\r\n            style={[\r\n              styles.priorityButton,\r\n              priority === p && styles.priorityButtonActive,\r\n              priority === p && { backgroundColor: PRIORITY_COLORS[p] },\r\n            ]}\r\n            onPress={() => setPriority(p)}\r\n          >\r\n            <Text\r\n              style={[\r\n                styles.priorityButtonText,\r\n                priority === p && styles.priorityButtonTextActive,\r\n              ]}\r\n            >\r\n              {PRIORITY_LABELS[p]}\r\n            </Text>\r\n          </TouchableOpacity>\r\n        ))}\r\n      </View>\r\n    </View>\r\n  );\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <ScrollView style={styles.scrollView} contentContainerStyle={styles.scrollContent}>\r\n        {/* Priority selector */}\r\n        <PrioritySelector />\r\n\r\n        {/* Products section */}\r\n        <View style={styles.section}>\r\n          <View style={styles.sectionHeader}>\r\n            <Text style={styles.sectionLabel}>Productos con stock bajo</Text>\r\n            <Text style={styles.sectionCount}>\r\n              {selectedItems.size} seleccionados\r\n            </Text>\r\n          </View>\r\n\r\n          {lowStockItems.length === 0 ? (\r\n            <View style={styles.emptySection}>\r\n              <Feather name=\"check-circle\" size={32} color=\"#16a34a\" />\r\n              <Text style={styles.emptyText}>\r\n                Todos los productos tienen stock suficiente\r\n              </Text>\r\n            </View>\r\n          ) : (\r\n            lowStockItems.map((item) => {\r\n              const isSelected = selectedItems.has(item.productId);\r\n              const requestQty = selectedItems.get(item.productId) || 0;\r\n\r\n              return (\r\n                <TouchableOpacity\r\n                  key={item.id}\r\n                  style={[styles.itemCard, isSelected && styles.itemCardSelected]}\r\n                  onPress={() => toggleItem(item)}\r\n                >\r\n                  <View style={styles.itemCheckbox}>\r\n                    {isSelected ? (\r\n                      <Feather name=\"check-square\" size={24} color=\"#16a34a\" />\r\n                    ) : (\r\n                      <Feather name=\"square\" size={24} color=\"#d1d5db\" />\r\n                    )}\r\n                  </View>\r\n                  <View style={styles.itemInfo}>\r\n                    <Text style={styles.itemName}>{item.productName}</Text>\r\n                    <Text style={styles.itemMeta}>\r\n                      {item.productSku} ΓÇó Actual: {item.quantity} ΓÇó Min: {item.minQuantity}\r\n                    </Text>\r\n                  </View>\r\n                  {isSelected && (\r\n                    <View style={styles.quantityInput}>\r\n                      <TouchableOpacity\r\n                        style={styles.quantityButton}\r\n                        onPress={() => updateQuantity(item.productId, requestQty - 1)}\r\n                      >\r\n                        <Feather name=\"minus\" size={16} color=\"#6b7280\" />\r\n                      </TouchableOpacity>\r\n                      <TextInput\r\n                        style={styles.quantityValue}\r\n                        value={String(requestQty)}\r\n                        onChangeText={(text) => {\r\n                          const num = parseInt(text, 10);\r\n                          if (!isNaN(num)) updateQuantity(item.productId, num);\r\n                        }}\r\n                        keyboardType=\"number-pad\"\r\n                      />\r\n                      <TouchableOpacity\r\n                        style={styles.quantityButton}\r\n                        onPress={() => updateQuantity(item.productId, requestQty + 1)}\r\n                      >\r\n                        <Feather name=\"plus\" size={16} color=\"#6b7280\" />\r\n                      </TouchableOpacity>\r\n                    </View>\r\n                  )}\r\n                </TouchableOpacity>\r\n              );\r\n            })\r\n          )}\r\n        </View>\r\n\r\n        {/* Notes section */}\r\n        <View style={styles.section}>\r\n          <Text style={styles.sectionLabel}>Notas (opcional)</Text>\r\n          <TextInput\r\n            style={styles.notesInput}\r\n            placeholder=\"Agregar notas...\"\r\n            value={notes}\r\n            onChangeText={setNotes}\r\n            multiline\r\n            numberOfLines={3}\r\n            placeholderTextColor=\"#9ca3af\"\r\n          />\r\n        </View>\r\n      </ScrollView>\r\n\r\n      {/* Submit button */}\r\n      <View style={styles.footer}>\r\n        <TouchableOpacity\r\n          style={[\r\n            styles.submitButton,\r\n            (selectedItems.size === 0 || isSubmitting) && styles.submitButtonDisabled,\r\n          ]}\r\n          onPress={handleSubmit}\r\n          disabled={selectedItems.size === 0 || isSubmitting}\r\n        >\r\n          <Feather name=\"send\" size={20} color=\"#fff\" />\r\n          <Text style={styles.submitButtonText}>\r\n            {isSubmitting ? 'Enviando...' : 'Enviar solicitud'}\r\n          </Text>\r\n        </TouchableOpacity>\r\n      </View>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst PRIORITY_LABELS: Record<string, string> = {\r\n  low: 'Baja',\r\n  medium: 'Media',\r\n  high: 'Alta',\r\n  urgent: 'Urgente',\r\n};\r\n\r\nconst PRIORITY_COLORS: Record<string, string> = {\r\n  low: '#16a34a',\r\n  medium: '#3b82f6',\r\n  high: '#f59e0b',\r\n  urgent: '#ef4444',\r\n};\r\n\r\n// Observe vehicle stock from WatermelonDB\r\nconst enhance = withObservables([], () => ({\r\n  stock: vehicleStockCollection.query(Q.sortBy('product_name', Q.asc)),\r\n}));\r\n\r\nexport default enhance(ReplenishScreen);\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  scrollView: {\r\n    flex: 1,\r\n  },\r\n  scrollContent: {\r\n    paddingBottom: 100,\r\n  },\r\n  section: {\r\n    backgroundColor: '#fff',\r\n    marginTop: 8,\r\n    paddingVertical: 16,\r\n  },\r\n  sectionHeader: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    paddingHorizontal: 16,\r\n    marginBottom: 12,\r\n  },\r\n  sectionLabel: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    paddingHorizontal: 16,\r\n    marginBottom: 8,\r\n  },\r\n  sectionCount: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n  },\r\n  priorityContainer: {\r\n    backgroundColor: '#fff',\r\n    paddingVertical: 16,\r\n  },\r\n  priorityButtons: {\r\n    flexDirection: 'row',\r\n    paddingHorizontal: 16,\r\n    gap: 8,\r\n  },\r\n  priorityButton: {\r\n    flex: 1,\r\n    paddingVertical: 10,\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    alignItems: 'center',\r\n  },\r\n  priorityButtonActive: {\r\n    borderColor: 'transparent',\r\n  },\r\n  priorityButtonText: {\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n    color: '#6b7280',\r\n  },\r\n  priorityButtonTextActive: {\r\n    color: '#fff',\r\n  },\r\n  emptySection: {\r\n    alignItems: 'center',\r\n    paddingVertical: 32,\r\n  },\r\n  emptyText: {\r\n    marginTop: 12,\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n  },\r\n  itemCard: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  itemCardSelected: {\r\n    backgroundColor: '#f0fdf4',\r\n  },\r\n  itemCheckbox: {\r\n    marginRight: 12,\r\n  },\r\n  itemInfo: {\r\n    flex: 1,\r\n  },\r\n  itemName: {\r\n    fontSize: 15,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  itemMeta: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  quantityInput: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  quantityButton: {\r\n    padding: 8,\r\n  },\r\n  quantityValue: {\r\n    width: 40,\r\n    textAlign: 'center',\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  notesInput: {\r\n    marginHorizontal: 16,\r\n    padding: 12,\r\n    backgroundColor: '#f9fafb',\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    fontSize: 15,\r\n    color: '#111827',\r\n    minHeight: 80,\r\n    textAlignVertical: 'top',\r\n  },\r\n  footer: {\r\n    backgroundColor: '#fff',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#e5e7eb',\r\n  },\r\n  submitButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    backgroundColor: '#16a34a',\r\n    paddingVertical: 14,\r\n    borderRadius: 12,\r\n    gap: 8,\r\n  },\r\n  submitButtonDisabled: {\r\n    backgroundColor: '#9ca3af',\r\n  },\r\n  submitButtonText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\inventory\\scan.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":19,"column":25,"nodeType":"Literal","endLine":19,"endColumn":45}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Inventory Scan Screen\r\n * =====================\r\n *\r\n * Barcode scanning for quick product lookup and stock management.\r\n */\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  TouchableOpacity,\r\n  ScrollView,\r\n  Alert,\r\n  TextInput,\r\n} from 'react-native';\r\nimport { useRouter } from 'expo-router';\r\nimport { Feather } from '@expo/vector-icons';\r\nimport { Q } from '@nozbe/watermelondb';\r\n\r\nimport { database } from '../../../watermelon/database';\r\nimport { Product, VehicleStock } from '../../../watermelon/models';\r\nimport BarcodeScanner from '../../../components/inventory/BarcodeScanner';\r\n\r\nconst productCollection = database.get<Product>('products');\r\nconst vehicleStockCollection = database.get<VehicleStock>('vehicle_stock');\r\n\r\ninterface ScannedProduct {\r\n  product: Product;\r\n  stockInfo: VehicleStock | null;\r\n}\r\n\r\nexport default function InventoryScanScreen() {\r\n  const router = useRouter();\r\n  const [scannerVisible, setScannerVisible] = useState(true);\r\n  const [scannedProduct, setScannedProduct] = useState<ScannedProduct | null>(null);\r\n  const [isSearching, setIsSearching] = useState(false);\r\n  const [manualBarcode, setManualBarcode] = useState('');\r\n  const [recentScans, setRecentScans] = useState<ScannedProduct[]>([]);\r\n\r\n  const handleScan = useCallback(async (barcode: string, type: string) => {\r\n    setScannerVisible(false);\r\n    setIsSearching(true);\r\n\r\n    try {\r\n      // Search by barcode first\r\n      let products = await productCollection\r\n        .query(Q.where('barcode', barcode))\r\n        .fetch();\r\n\r\n      // If not found, try SKU\r\n      if (products.length === 0) {\r\n        products = await productCollection\r\n          .query(Q.where('sku', barcode))\r\n          .fetch();\r\n      }\r\n\r\n      if (products.length === 0) {\r\n        Alert.alert(\r\n          'Producto no encontrado',\r\n          `No se encontr├│ ning├║n producto con el c├│digo: ${barcode}`,\r\n          [\r\n            { text: 'Escanear otro', onPress: () => setScannerVisible(true) },\r\n            { text: 'Cerrar', style: 'cancel' },\r\n          ]\r\n        );\r\n        setScannedProduct(null);\r\n        return;\r\n      }\r\n\r\n      const product = products[0];\r\n\r\n      // Get vehicle stock info for this product\r\n      const stockResults = await vehicleStockCollection\r\n        .query(Q.where('product_id', product.serverId))\r\n        .fetch();\r\n      const stockInfo = stockResults.length > 0 ? stockResults[0] : null;\r\n\r\n      const scanned: ScannedProduct = { product, stockInfo };\r\n      setScannedProduct(scanned);\r\n\r\n      // Add to recent scans (keep last 5)\r\n      setRecentScans((prev) => {\r\n        const filtered = prev.filter((s) => s.product.id !== product.id);\r\n        return [scanned, ...filtered].slice(0, 5);\r\n      });\r\n    } catch (error) {\r\n      console.error('Error searching product:', error);\r\n      Alert.alert('Error', 'No se pudo buscar el producto');\r\n    } finally {\r\n      setIsSearching(false);\r\n    }\r\n  }, []);\r\n\r\n  const handleManualSearch = useCallback(() => {\r\n    if (manualBarcode.trim()) {\r\n      handleScan(manualBarcode.trim(), 'manual');\r\n      setManualBarcode('');\r\n    }\r\n  }, [manualBarcode, handleScan]);\r\n\r\n  const handleRecordUsage = useCallback(\r\n    (product: ScannedProduct) => {\r\n      router.push({\r\n        pathname: '/(tabs)/inventory/usage',\r\n        params: { productId: product.product.serverId },\r\n      });\r\n    },\r\n    [router]\r\n  );\r\n\r\n  const renderProductCard = (scanned: ScannedProduct, isMain: boolean = false) => {\r\n    const { product, stockInfo } = scanned;\r\n    const hasStock = stockInfo && stockInfo.quantity > 0;\r\n    const isLowStock = stockInfo && stockInfo.quantity <= stockInfo.minQuantity;\r\n\r\n    return (\r\n      <View\r\n        key={product.id}\r\n        style={[styles.productCard, isMain && styles.productCardMain]}\r\n      >\r\n        <View style={styles.productHeader}>\r\n          <View style={styles.productInfo}>\r\n            <Text style={styles.productName}>{product.name}</Text>\r\n            <Text style={styles.productSku}>SKU: {product.sku}</Text>\r\n            {product.barcode && (\r\n              <Text style={styles.productBarcode}>\r\n                <Feather name=\"bar-chart-2\" size={12} /> {product.barcode}\r\n              </Text>\r\n            )}\r\n          </View>\r\n          {stockInfo ? (\r\n            <View\r\n              style={[\r\n                styles.stockBadge,\r\n                isLowStock ? styles.stockBadgeLow : styles.stockBadgeOk,\r\n              ]}\r\n            >\r\n              <Text\r\n                style={[\r\n                  styles.stockBadgeText,\r\n                  isLowStock ? styles.stockBadgeLowText : styles.stockBadgeOkText,\r\n                ]}\r\n              >\r\n                {stockInfo.quantity} en veh├¡culo\r\n              </Text>\r\n            </View>\r\n          ) : (\r\n            <View style={styles.stockBadgeNone}>\r\n              <Text style={styles.stockBadgeNoneText}>Sin stock</Text>\r\n            </View>\r\n          )}\r\n        </View>\r\n\r\n        {/* Stock details */}\r\n        {stockInfo && (\r\n          <View style={styles.stockDetails}>\r\n            <View style={styles.stockDetailItem}>\r\n              <Text style={styles.stockDetailLabel}>M├¡nimo</Text>\r\n              <Text style={styles.stockDetailValue}>{stockInfo.minQuantity}</Text>\r\n            </View>\r\n            <View style={styles.stockDetailItem}>\r\n              <Text style={styles.stockDetailLabel}>M├íximo</Text>\r\n              <Text style={styles.stockDetailValue}>{stockInfo.maxQuantity}</Text>\r\n            </View>\r\n            <View style={styles.stockDetailItem}>\r\n              <Text style={styles.stockDetailLabel}>Costo unit.</Text>\r\n              <Text style={styles.stockDetailValue}>\r\n                ${stockInfo.unitCost.toLocaleString()}\r\n              </Text>\r\n            </View>\r\n          </View>\r\n        )}\r\n\r\n        {/* Product details */}\r\n        <View style={styles.productDetails}>\r\n          {product.categoryName && (\r\n            <View style={styles.detailRow}>\r\n              <Feather name=\"folder\" size={14} color=\"#6b7280\" />\r\n              <Text style={styles.detailText}>{product.categoryName}</Text>\r\n            </View>\r\n          )}\r\n          <View style={styles.detailRow}>\r\n            <Feather name=\"package\" size={14} color=\"#6b7280\" />\r\n            <Text style={styles.detailText}>{product.unitOfMeasure}</Text>\r\n          </View>\r\n          <View style={styles.detailRow}>\r\n            <Feather name=\"dollar-sign\" size={14} color=\"#6b7280\" />\r\n            <Text style={styles.detailText}>\r\n              Venta: ${product.salePrice.toLocaleString()} | Costo: ${product.costPrice.toLocaleString()}\r\n            </Text>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Actions */}\r\n        {isMain && (\r\n          <View style={styles.productActions}>\r\n            {hasStock && (\r\n              <TouchableOpacity\r\n                style={styles.actionButton}\r\n                onPress={() => handleRecordUsage(scanned)}\r\n              >\r\n                <Feather name=\"minus-circle\" size={18} color=\"#fff\" />\r\n                <Text style={styles.actionButtonText}>Registrar uso</Text>\r\n              </TouchableOpacity>\r\n            )}\r\n            <TouchableOpacity\r\n              style={[styles.actionButton, styles.actionButtonSecondary]}\r\n              onPress={() => setScannerVisible(true)}\r\n            >\r\n              <Feather name=\"camera\" size={18} color=\"#16a34a\" />\r\n              <Text style={[styles.actionButtonText, styles.actionButtonTextSecondary]}>\r\n                Escanear otro\r\n              </Text>\r\n            </TouchableOpacity>\r\n          </View>\r\n        )}\r\n      </View>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <BarcodeScanner\r\n        visible={scannerVisible}\r\n        onClose={() => {\r\n          setScannerVisible(false);\r\n          if (!scannedProduct) {\r\n            router.back();\r\n          }\r\n        }}\r\n        onScan={handleScan}\r\n      />\r\n\r\n      <ScrollView style={styles.scrollView} contentContainerStyle={styles.scrollContent}>\r\n        {/* Manual search */}\r\n        <View style={styles.searchSection}>\r\n          <Text style={styles.sectionTitle}>B├║squeda manual</Text>\r\n          <View style={styles.searchRow}>\r\n            <TextInput\r\n              style={styles.searchInput}\r\n              placeholder=\"C├│digo de barras o SKU...\"\r\n              value={manualBarcode}\r\n              onChangeText={setManualBarcode}\r\n              onSubmitEditing={handleManualSearch}\r\n              returnKeyType=\"search\"\r\n              placeholderTextColor=\"#9ca3af\"\r\n            />\r\n            <TouchableOpacity\r\n              style={styles.searchButton}\r\n              onPress={handleManualSearch}\r\n            >\r\n              <Feather name=\"search\" size={20} color=\"#fff\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Loading state */}\r\n        {isSearching && (\r\n          <View style={styles.loading}>\r\n            <Text style={styles.loadingText}>Buscando producto...</Text>\r\n          </View>\r\n        )}\r\n\r\n        {/* Scanned product */}\r\n        {scannedProduct && !isSearching && (\r\n          <View style={styles.resultSection}>\r\n            <Text style={styles.sectionTitle}>Producto encontrado</Text>\r\n            {renderProductCard(scannedProduct, true)}\r\n          </View>\r\n        )}\r\n\r\n        {/* Recent scans */}\r\n        {recentScans.length > 1 && (\r\n          <View style={styles.recentSection}>\r\n            <Text style={styles.sectionTitle}>Escaneos recientes</Text>\r\n            {recentScans.slice(1).map((scan) => (\r\n              <TouchableOpacity\r\n                key={scan.product.id}\r\n                onPress={() => setScannedProduct(scan)}\r\n              >\r\n                {renderProductCard(scan)}\r\n              </TouchableOpacity>\r\n            ))}\r\n          </View>\r\n        )}\r\n\r\n        {/* Empty state */}\r\n        {!scannedProduct && !isSearching && recentScans.length === 0 && (\r\n          <View style={styles.empty}>\r\n            <Feather name=\"camera\" size={48} color=\"#d1d5db\" />\r\n            <Text style={styles.emptyTitle}>Escanea un c├│digo</Text>\r\n            <Text style={styles.emptyText}>\r\n              Usa la c├ímara o ingresa el c├│digo manualmente\r\n            </Text>\r\n            <TouchableOpacity\r\n              style={styles.openScannerButton}\r\n              onPress={() => setScannerVisible(true)}\r\n            >\r\n              <Feather name=\"camera\" size={20} color=\"#fff\" />\r\n              <Text style={styles.openScannerButtonText}>Abrir esc├íner</Text>\r\n            </TouchableOpacity>\r\n          </View>\r\n        )}\r\n      </ScrollView>\r\n\r\n      {/* Floating scan button */}\r\n      {!scannerVisible && (\r\n        <TouchableOpacity\r\n          style={styles.fab}\r\n          onPress={() => setScannerVisible(true)}\r\n        >\r\n          <Feather name=\"camera\" size={24} color=\"#fff\" />\r\n        </TouchableOpacity>\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  scrollView: {\r\n    flex: 1,\r\n  },\r\n  scrollContent: {\r\n    paddingBottom: 100,\r\n  },\r\n  searchSection: {\r\n    backgroundColor: '#fff',\r\n    padding: 16,\r\n  },\r\n  sectionTitle: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    marginBottom: 12,\r\n  },\r\n  searchRow: {\r\n    flexDirection: 'row',\r\n    gap: 8,\r\n  },\r\n  searchInput: {\r\n    flex: 1,\r\n    backgroundColor: '#f9fafb',\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 12,\r\n    fontSize: 16,\r\n    color: '#111827',\r\n  },\r\n  searchButton: {\r\n    backgroundColor: '#16a34a',\r\n    borderRadius: 8,\r\n    paddingHorizontal: 16,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  loading: {\r\n    padding: 32,\r\n    alignItems: 'center',\r\n  },\r\n  loadingText: {\r\n    fontSize: 15,\r\n    color: '#6b7280',\r\n  },\r\n  resultSection: {\r\n    padding: 16,\r\n  },\r\n  recentSection: {\r\n    padding: 16,\r\n  },\r\n  productCard: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    padding: 16,\r\n    marginBottom: 12,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 1 },\r\n    shadowOpacity: 0.05,\r\n    shadowRadius: 2,\r\n    elevation: 1,\r\n  },\r\n  productCardMain: {\r\n    borderWidth: 2,\r\n    borderColor: '#16a34a',\r\n  },\r\n  productHeader: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'flex-start',\r\n    marginBottom: 12,\r\n  },\r\n  productInfo: {\r\n    flex: 1,\r\n  },\r\n  productName: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginBottom: 4,\r\n  },\r\n  productSku: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n  },\r\n  productBarcode: {\r\n    fontSize: 12,\r\n    color: '#9ca3af',\r\n    marginTop: 2,\r\n  },\r\n  stockBadge: {\r\n    paddingHorizontal: 10,\r\n    paddingVertical: 4,\r\n    borderRadius: 12,\r\n  },\r\n  stockBadgeOk: {\r\n    backgroundColor: '#dcfce7',\r\n  },\r\n  stockBadgeLow: {\r\n    backgroundColor: '#fef2f2',\r\n  },\r\n  stockBadgeNone: {\r\n    backgroundColor: '#f3f4f6',\r\n    paddingHorizontal: 10,\r\n    paddingVertical: 4,\r\n    borderRadius: 12,\r\n  },\r\n  stockBadgeText: {\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n  },\r\n  stockBadgeOkText: {\r\n    color: '#16a34a',\r\n  },\r\n  stockBadgeLowText: {\r\n    color: '#ef4444',\r\n  },\r\n  stockBadgeNoneText: {\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n    color: '#6b7280',\r\n  },\r\n  stockDetails: {\r\n    flexDirection: 'row',\r\n    backgroundColor: '#f9fafb',\r\n    borderRadius: 8,\r\n    padding: 12,\r\n    marginBottom: 12,\r\n  },\r\n  stockDetailItem: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n  },\r\n  stockDetailLabel: {\r\n    fontSize: 11,\r\n    color: '#6b7280',\r\n    marginBottom: 2,\r\n  },\r\n  stockDetailValue: {\r\n    fontSize: 15,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  productDetails: {\r\n    gap: 6,\r\n    marginBottom: 16,\r\n  },\r\n  detailRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n  },\r\n  detailText: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n  },\r\n  productActions: {\r\n    flexDirection: 'row',\r\n    gap: 12,\r\n  },\r\n  actionButton: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    backgroundColor: '#16a34a',\r\n    paddingVertical: 12,\r\n    borderRadius: 8,\r\n    gap: 8,\r\n  },\r\n  actionButtonSecondary: {\r\n    backgroundColor: '#fff',\r\n    borderWidth: 1,\r\n    borderColor: '#16a34a',\r\n  },\r\n  actionButtonText: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  actionButtonTextSecondary: {\r\n    color: '#16a34a',\r\n  },\r\n  empty: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    paddingVertical: 64,\r\n    paddingHorizontal: 32,\r\n  },\r\n  emptyTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    marginTop: 16,\r\n  },\r\n  emptyText: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    textAlign: 'center',\r\n    marginTop: 8,\r\n  },\r\n  openScannerButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#16a34a',\r\n    paddingHorizontal: 24,\r\n    paddingVertical: 12,\r\n    borderRadius: 8,\r\n    marginTop: 24,\r\n    gap: 8,\r\n  },\r\n  openScannerButtonText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  fab: {\r\n    position: 'absolute',\r\n    bottom: 24,\r\n    right: 24,\r\n    width: 56,\r\n    height: 56,\r\n    borderRadius: 28,\r\n    backgroundColor: '#16a34a',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 2 },\r\n    shadowOpacity: 0.25,\r\n    shadowRadius: 4,\r\n    elevation: 5,\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\inventory\\usage.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":21,"column":25,"nodeType":"Literal","endLine":21,"endColumn":45},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'usageItems'. Either include it or remove the dependency array.","line":80,"column":6,"nodeType":"ArrayExpression","endLine":80,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [preselectedProductId, stock, usageItems]","fix":{"range":[2526,2555],"text":"[preselectedProductId, stock, usageItems]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Material Usage Screen\r\n * =====================\r\n *\r\n * Records material consumption from vehicle stock during jobs.\r\n */\r\n\r\nimport { useState, useCallback, useEffect, useMemo } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  ScrollView,\r\n  TouchableOpacity,\r\n  TextInput,\r\n  Alert,\r\n  KeyboardAvoidingView,\r\n  Platform,\r\n} from 'react-native';\r\nimport { useRouter, useLocalSearchParams } from 'expo-router';\r\nimport { Feather } from '@expo/vector-icons';\r\nimport { withObservables } from '@nozbe/watermelondb/react';\r\nimport { Q } from '@nozbe/watermelondb';\r\n\r\nimport { database } from '../../../watermelon/database';\r\nimport { VehicleStock, Job } from '../../../watermelon/models';\r\nimport { performSync } from '../../../lib/sync/sync-engine';\r\nimport BarcodeScanner from '../../../components/inventory/BarcodeScanner';\r\n\r\nconst vehicleStockCollection = database.get<VehicleStock>('vehicle_stock');\r\nconst jobCollection = database.get<Job>('jobs');\r\n\r\ninterface UsageItem {\r\n  stockId: string;\r\n  productId: string;\r\n  productName: string;\r\n  productSku: string;\r\n  availableQty: number;\r\n  usedQty: number;\r\n  unitCost: number;\r\n}\r\n\r\nfunction MaterialUsageScreen({\r\n  stock,\r\n  activeJobs,\r\n}: {\r\n  stock: VehicleStock[];\r\n  activeJobs: Job[];\r\n}) {\r\n  const router = useRouter();\r\n  const params = useLocalSearchParams();\r\n  const preselectedProductId = params.productId as string | undefined;\r\n  const preselectedJobId = params.jobId as string | undefined;\r\n\r\n  const [selectedJob, setSelectedJob] = useState<string>(preselectedJobId || '');\r\n  const [usageItems, setUsageItems] = useState<UsageItem[]>([]);\r\n  const [notes, setNotes] = useState('');\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [scannerVisible, setScannerVisible] = useState(false);\r\n  const [search, setSearch] = useState('');\r\n\r\n  // Initialize with preselected product if provided\r\n  useEffect(() => {\r\n    if (preselectedProductId && stock.length > 0) {\r\n      const stockItem = stock.find((s) => s.productId === preselectedProductId);\r\n      if (stockItem && !usageItems.some((u) => u.productId === preselectedProductId)) {\r\n        setUsageItems([\r\n          {\r\n            stockId: stockItem.id,\r\n            productId: stockItem.productId,\r\n            productName: stockItem.productName,\r\n            productSku: stockItem.productSku,\r\n            availableQty: stockItem.quantity,\r\n            usedQty: 1,\r\n            unitCost: stockItem.unitCost,\r\n          },\r\n        ]);\r\n      }\r\n    }\r\n  }, [preselectedProductId, stock]);\r\n\r\n  const filteredStock = useMemo(() => {\r\n    if (!search) return stock;\r\n    const query = search.toLowerCase();\r\n    return stock.filter(\r\n      (item) =>\r\n        item.productName.toLowerCase().includes(query) ||\r\n        item.productSku.toLowerCase().includes(query)\r\n    );\r\n  }, [stock, search]);\r\n\r\n  const totalCost = useMemo(() => {\r\n    return usageItems.reduce((sum, item) => sum + item.usedQty * item.unitCost, 0);\r\n  }, [usageItems]);\r\n\r\n  const addItem = useCallback(\r\n    (stockItem: VehicleStock) => {\r\n      if (usageItems.some((u) => u.productId === stockItem.productId)) {\r\n        // Already added, focus on quantity\r\n        return;\r\n      }\r\n\r\n      setUsageItems((prev) => [\r\n        ...prev,\r\n        {\r\n          stockId: stockItem.id,\r\n          productId: stockItem.productId,\r\n          productName: stockItem.productName,\r\n          productSku: stockItem.productSku,\r\n          availableQty: stockItem.quantity,\r\n          usedQty: 1,\r\n          unitCost: stockItem.unitCost,\r\n        },\r\n      ]);\r\n    },\r\n    [usageItems]\r\n  );\r\n\r\n  const updateQuantity = useCallback((productId: string, qty: number) => {\r\n    setUsageItems((prev) =>\r\n      prev.map((item) =>\r\n        item.productId === productId\r\n          ? { ...item, usedQty: Math.max(0, Math.min(qty, item.availableQty)) }\r\n          : item\r\n      )\r\n    );\r\n  }, []);\r\n\r\n  const removeItem = useCallback((productId: string) => {\r\n    setUsageItems((prev) => prev.filter((item) => item.productId !== productId));\r\n  }, []);\r\n\r\n  const handleScan = useCallback(\r\n    async (barcode: string) => {\r\n      setScannerVisible(false);\r\n\r\n      // Find product in vehicle stock by SKU or searching\r\n      const stockItem = stock.find(\r\n        (s) => s.productSku === barcode || s.productId === barcode\r\n      );\r\n\r\n      if (!stockItem) {\r\n        Alert.alert('No encontrado', 'Este producto no est├í en tu veh├¡culo');\r\n        return;\r\n      }\r\n\r\n      if (stockItem.quantity <= 0) {\r\n        Alert.alert('Sin stock', 'No tienes stock disponible de este producto');\r\n        return;\r\n      }\r\n\r\n      addItem(stockItem);\r\n    },\r\n    [stock, addItem]\r\n  );\r\n\r\n  const handleSubmit = useCallback(async () => {\r\n    if (usageItems.length === 0) {\r\n      Alert.alert('Error', 'Agrega al menos un producto');\r\n      return;\r\n    }\r\n\r\n    if (!selectedJob) {\r\n      Alert.alert('Error', 'Selecciona un trabajo');\r\n      return;\r\n    }\r\n\r\n    // Get job info for the deduction record\r\n    const selectedJobRecord = activeJobs.find((j) => j.serverId === selectedJob);\r\n    // Use serverId as jobNumber since local Job model doesn't have jobNumber\r\n    const jobNumber = selectedJobRecord?.serverId || selectedJob;\r\n\r\n    // Validate quantities\r\n    for (const item of usageItems) {\r\n      if (item.usedQty <= 0) {\r\n        Alert.alert('Error', `Cantidad inv├ílida para ${item.productName}`);\r\n        return;\r\n      }\r\n      if (item.usedQty > item.availableQty) {\r\n        Alert.alert(\r\n          'Error',\r\n          `Stock insuficiente para ${item.productName}. Disponible: ${item.availableQty}`\r\n        );\r\n        return;\r\n      }\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      // Phase 2.2.4.4: Offline-first approach\r\n      // 1. Update local vehicle stock immediately\r\n      // 2. Try to sync with server -> if fails, queue for later\r\n\r\n      // Update local vehicle stock first (optimistic update)\r\n      await database.write(async () => {\r\n        for (const item of usageItems) {\r\n          const stockRecord = await vehicleStockCollection.find(item.stockId);\r\n          await stockRecord.update((record) => {\r\n            record.quantity = record.quantity - item.usedQty;\r\n            record.needsReplenishment = record.quantity <= record.minQuantity;\r\n          });\r\n        }\r\n      });\r\n\r\n      // Try to call the cascade API\r\n      let syncedSuccessfully = false;\r\n      let syncError: string | null = null;\r\n\r\n      try {\r\n        const { api } = await import('../../../lib/api/client');\r\n        const response = await api.inventory.useMaterials(\r\n          selectedJob,\r\n          usageItems.map((item) => ({\r\n            productId: item.productId,\r\n            quantity: item.usedQty,\r\n          }))\r\n        );\r\n\r\n        if (response.success) {\r\n          syncedSuccessfully = true;\r\n        } else {\r\n          syncError = response.error?.message || 'Error del servidor';\r\n        }\r\n      } catch (apiError) {\r\n        syncError = apiError instanceof Error ? apiError.message : 'Error de conexi├│n';\r\n        console.log('[Usage] API call failed, will queue for later sync:', syncError);\r\n      }\r\n\r\n      // Create pending deduction record for tracking\r\n      const pendingDeductionsCollection = database.get('pending_stock_deductions');\r\n      await database.write(async () => {\r\n        await pendingDeductionsCollection.create((record: any) => {\r\n          record.jobId = selectedJob;\r\n          record.jobNumber = jobNumber;\r\n          record.items = JSON.stringify(\r\n            usageItems.map((item) => ({\r\n              productId: item.productId,\r\n              productName: item.productName,\r\n              quantity: item.usedQty,\r\n            }))\r\n          );\r\n          record.notes = notes || null;\r\n          record.deductionStatus = syncedSuccessfully ? 'synced' : 'pending';\r\n          record.syncError = syncError;\r\n          record.retryCount = 0;\r\n          record.syncedAt = syncedSuccessfully ? Date.now() : null;\r\n        });\r\n      });\r\n\r\n      // Show appropriate message\r\n      if (syncedSuccessfully) {\r\n        Alert.alert(\r\n          'Uso registrado',\r\n          'El consumo de materiales ha sido registrado correctamente',\r\n          [{ text: 'OK', onPress: () => router.back() }]\r\n        );\r\n      } else {\r\n        Alert.alert(\r\n          'Guardado localmente',\r\n          'El consumo se guard├│ en tu dispositivo y se sincronizar├í cuando tengas conexi├│n.',\r\n          [{ text: 'OK', onPress: () => router.back() }]\r\n        );\r\n      }\r\n\r\n      // Trigger sync in background to update any other local data\r\n      performSync().catch(console.error);\r\n    } catch (error) {\r\n      console.error('Error recording usage:', error);\r\n      Alert.alert('Error', 'No se pudo registrar el uso');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  }, [usageItems, selectedJob, notes, router, activeJobs]);\r\n\r\n  return (\r\n    <KeyboardAvoidingView\r\n      style={styles.container}\r\n      behavior={Platform.OS === 'ios' ? 'padding' : undefined}\r\n    >\r\n      <BarcodeScanner\r\n        visible={scannerVisible}\r\n        onClose={() => setScannerVisible(false)}\r\n        onScan={handleScan}\r\n      />\r\n\r\n      <ScrollView style={styles.scrollView} contentContainerStyle={styles.scrollContent}>\r\n        {/* Job selection */}\r\n        <View style={styles.section}>\r\n          <Text style={styles.sectionLabel}>Trabajo *</Text>\r\n          <View style={styles.jobSelector}>\r\n            {activeJobs.length === 0 ? (\r\n              <View style={styles.noJobs}>\r\n                <Feather name=\"alert-circle\" size={20} color=\"#f59e0b\" />\r\n                <Text style={styles.noJobsText}>No hay trabajos activos</Text>\r\n              </View>\r\n            ) : (\r\n              <ScrollView\r\n                horizontal\r\n                showsHorizontalScrollIndicator={false}\r\n                contentContainerStyle={styles.jobList}\r\n              >\r\n                {activeJobs.map((job) => (\r\n                  <TouchableOpacity\r\n                    key={job.id}\r\n                    style={[\r\n                      styles.jobCard,\r\n                      selectedJob === job.serverId && styles.jobCardSelected,\r\n                    ]}\r\n                    onPress={() => setSelectedJob(job.serverId)}\r\n                  >\r\n                    <Text\r\n                      style={[\r\n                        styles.jobNumber,\r\n                        selectedJob === job.serverId && styles.jobNumberSelected,\r\n                      ]}\r\n                    >\r\n                      {job.jobNumber}\r\n                    </Text>\r\n                    <Text\r\n                      style={[\r\n                        styles.jobCustomer,\r\n                        selectedJob === job.serverId && styles.jobCustomerSelected,\r\n                      ]}\r\n                      numberOfLines={1}\r\n                    >\r\n                      {job.customerName}\r\n                    </Text>\r\n                  </TouchableOpacity>\r\n                ))}\r\n              </ScrollView>\r\n            )}\r\n          </View>\r\n        </View>\r\n\r\n        {/* Add products */}\r\n        <View style={styles.section}>\r\n          <View style={styles.sectionHeader}>\r\n            <Text style={styles.sectionLabel}>Materiales usados *</Text>\r\n            <TouchableOpacity\r\n              style={styles.scanButton}\r\n              onPress={() => setScannerVisible(true)}\r\n            >\r\n              <Feather name=\"camera\" size={16} color=\"#16a34a\" />\r\n              <Text style={styles.scanButtonText}>Escanear</Text>\r\n            </TouchableOpacity>\r\n          </View>\r\n\r\n          {/* Search */}\r\n          <View style={styles.searchContainer}>\r\n            <Feather name=\"search\" size={18} color=\"#9ca3af\" />\r\n            <TextInput\r\n              style={styles.searchInput}\r\n              placeholder=\"Buscar producto...\"\r\n              value={search}\r\n              onChangeText={setSearch}\r\n              placeholderTextColor=\"#9ca3af\"\r\n            />\r\n            {search.length > 0 && (\r\n              <TouchableOpacity onPress={() => setSearch('')}>\r\n                <Feather name=\"x\" size={18} color=\"#9ca3af\" />\r\n              </TouchableOpacity>\r\n            )}\r\n          </View>\r\n\r\n          {/* Stock list */}\r\n          <View style={styles.stockList}>\r\n            {filteredStock.map((item) => {\r\n              const isAdded = usageItems.some((u) => u.productId === item.productId);\r\n              const usageItem = usageItems.find((u) => u.productId === item.productId);\r\n\r\n              return (\r\n                <TouchableOpacity\r\n                  key={item.id}\r\n                  style={[styles.stockItem, isAdded && styles.stockItemSelected]}\r\n                  onPress={() => (isAdded ? removeItem(item.productId) : addItem(item))}\r\n                  disabled={item.quantity <= 0}\r\n                >\r\n                  <View style={styles.stockItemInfo}>\r\n                    <Text\r\n                      style={[\r\n                        styles.stockItemName,\r\n                        item.quantity <= 0 && styles.stockItemNameDisabled,\r\n                      ]}\r\n                    >\r\n                      {item.productName}\r\n                    </Text>\r\n                    <Text style={styles.stockItemSku}>\r\n                      {item.productSku} ΓÇó Disponible: {item.quantity}\r\n                    </Text>\r\n                  </View>\r\n\r\n                  {isAdded ? (\r\n                    <View style={styles.quantityControl}>\r\n                      <TouchableOpacity\r\n                        style={styles.qtyButton}\r\n                        onPress={() =>\r\n                          updateQuantity(item.productId, (usageItem?.usedQty || 1) - 1)\r\n                        }\r\n                      >\r\n                        <Feather name=\"minus\" size={16} color=\"#6b7280\" />\r\n                      </TouchableOpacity>\r\n                      <TextInput\r\n                        style={styles.qtyInput}\r\n                        value={String(usageItem?.usedQty || 0)}\r\n                        onChangeText={(text) => {\r\n                          const num = parseInt(text, 10);\r\n                          if (!isNaN(num)) updateQuantity(item.productId, num);\r\n                        }}\r\n                        keyboardType=\"number-pad\"\r\n                      />\r\n                      <TouchableOpacity\r\n                        style={styles.qtyButton}\r\n                        onPress={() =>\r\n                          updateQuantity(item.productId, (usageItem?.usedQty || 1) + 1)\r\n                        }\r\n                      >\r\n                        <Feather name=\"plus\" size={16} color=\"#6b7280\" />\r\n                      </TouchableOpacity>\r\n                    </View>\r\n                  ) : item.quantity > 0 ? (\r\n                    <Feather name=\"plus-circle\" size={24} color=\"#16a34a\" />\r\n                  ) : (\r\n                    <Text style={styles.outOfStock}>Agotado</Text>\r\n                  )}\r\n                </TouchableOpacity>\r\n              );\r\n            })}\r\n          </View>\r\n        </View>\r\n\r\n        {/* Notes */}\r\n        <View style={styles.section}>\r\n          <Text style={styles.sectionLabel}>Notas (opcional)</Text>\r\n          <TextInput\r\n            style={styles.notesInput}\r\n            placeholder=\"Agregar notas sobre el uso...\"\r\n            value={notes}\r\n            onChangeText={setNotes}\r\n            multiline\r\n            numberOfLines={3}\r\n            placeholderTextColor=\"#9ca3af\"\r\n          />\r\n        </View>\r\n\r\n        {/* Summary */}\r\n        {usageItems.length > 0 && (\r\n          <View style={styles.summary}>\r\n            <View style={styles.summaryRow}>\r\n              <Text style={styles.summaryLabel}>Productos:</Text>\r\n              <Text style={styles.summaryValue}>{usageItems.length}</Text>\r\n            </View>\r\n            <View style={styles.summaryRow}>\r\n              <Text style={styles.summaryLabel}>Cantidad total:</Text>\r\n              <Text style={styles.summaryValue}>\r\n                {usageItems.reduce((sum, i) => sum + i.usedQty, 0)}\r\n              </Text>\r\n            </View>\r\n            <View style={styles.summaryRow}>\r\n              <Text style={styles.summaryLabelBold}>Costo total:</Text>\r\n              <Text style={styles.summaryValueBold}>\r\n                ${totalCost.toLocaleString()}\r\n              </Text>\r\n            </View>\r\n          </View>\r\n        )}\r\n      </ScrollView>\r\n\r\n      {/* Submit button */}\r\n      <View style={styles.footer}>\r\n        <TouchableOpacity\r\n          style={[\r\n            styles.submitButton,\r\n            (usageItems.length === 0 || !selectedJob || isSubmitting) &&\r\n            styles.submitButtonDisabled,\r\n          ]}\r\n          onPress={handleSubmit}\r\n          disabled={usageItems.length === 0 || !selectedJob || isSubmitting}\r\n        >\r\n          <Feather name=\"check\" size={20} color=\"#fff\" />\r\n          <Text style={styles.submitButtonText}>\r\n            {isSubmitting ? 'Guardando...' : 'Registrar uso'}\r\n          </Text>\r\n        </TouchableOpacity>\r\n      </View>\r\n    </KeyboardAvoidingView>\r\n  );\r\n}\r\n\r\n// Observe data from WatermelonDB\r\nconst enhance = withObservables([], () => ({\r\n  stock: vehicleStockCollection.query(\r\n    Q.where('quantity', Q.gt(0)),\r\n    Q.sortBy('product_name', Q.asc)\r\n  ),\r\n  activeJobs: jobCollection.query(\r\n    Q.where('status', Q.oneOf(['scheduled', 'in_progress'])),\r\n    Q.sortBy('scheduled_date', Q.desc)\r\n  ),\r\n}));\r\n\r\nexport default enhance(MaterialUsageScreen);\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  scrollView: {\r\n    flex: 1,\r\n  },\r\n  scrollContent: {\r\n    paddingBottom: 100,\r\n  },\r\n  section: {\r\n    backgroundColor: '#fff',\r\n    marginTop: 8,\r\n    paddingVertical: 16,\r\n  },\r\n  sectionHeader: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    paddingHorizontal: 16,\r\n    marginBottom: 12,\r\n  },\r\n  sectionLabel: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    paddingHorizontal: 16,\r\n    marginBottom: 8,\r\n  },\r\n  jobSelector: {\r\n    paddingHorizontal: 16,\r\n  },\r\n  noJobs: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    padding: 16,\r\n    backgroundColor: '#fef3c7',\r\n    borderRadius: 8,\r\n    gap: 8,\r\n  },\r\n  noJobsText: {\r\n    fontSize: 14,\r\n    color: '#92400e',\r\n  },\r\n  jobList: {\r\n    gap: 12,\r\n  },\r\n  jobCard: {\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    backgroundColor: '#fff',\r\n    minWidth: 140,\r\n  },\r\n  jobCardSelected: {\r\n    borderColor: '#16a34a',\r\n    backgroundColor: '#f0fdf4',\r\n  },\r\n  jobNumber: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n  },\r\n  jobNumberSelected: {\r\n    color: '#16a34a',\r\n  },\r\n  jobCustomer: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  jobCustomerSelected: {\r\n    color: '#16a34a',\r\n  },\r\n  scanButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 6,\r\n    borderRadius: 6,\r\n    borderWidth: 1,\r\n    borderColor: '#16a34a',\r\n    marginRight: 16,\r\n  },\r\n  scanButtonText: {\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n    color: '#16a34a',\r\n  },\r\n  searchContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    marginHorizontal: 16,\r\n    marginBottom: 12,\r\n    paddingHorizontal: 12,\r\n    backgroundColor: '#f9fafb',\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  searchInput: {\r\n    flex: 1,\r\n    paddingVertical: 10,\r\n    paddingHorizontal: 8,\r\n    fontSize: 15,\r\n    color: '#111827',\r\n  },\r\n  stockList: {\r\n    marginHorizontal: 16,\r\n  },\r\n  stockItem: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    paddingVertical: 12,\r\n    paddingHorizontal: 12,\r\n    borderRadius: 8,\r\n    marginBottom: 8,\r\n    backgroundColor: '#f9fafb',\r\n  },\r\n  stockItemSelected: {\r\n    backgroundColor: '#f0fdf4',\r\n    borderWidth: 1,\r\n    borderColor: '#16a34a',\r\n  },\r\n  stockItemInfo: {\r\n    flex: 1,\r\n  },\r\n  stockItemName: {\r\n    fontSize: 15,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  stockItemNameDisabled: {\r\n    color: '#9ca3af',\r\n  },\r\n  stockItemSku: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  outOfStock: {\r\n    fontSize: 12,\r\n    color: '#ef4444',\r\n    fontWeight: '500',\r\n  },\r\n  quantityControl: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  qtyButton: {\r\n    padding: 8,\r\n  },\r\n  qtyInput: {\r\n    width: 40,\r\n    textAlign: 'center',\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  notesInput: {\r\n    marginHorizontal: 16,\r\n    padding: 12,\r\n    backgroundColor: '#f9fafb',\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    fontSize: 15,\r\n    color: '#111827',\r\n    minHeight: 80,\r\n    textAlignVertical: 'top',\r\n  },\r\n  summary: {\r\n    backgroundColor: '#fff',\r\n    marginTop: 8,\r\n    padding: 16,\r\n  },\r\n  summaryRow: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    paddingVertical: 8,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#f3f4f6',\r\n  },\r\n  summaryLabel: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n  },\r\n  summaryValue: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  summaryLabelBold: {\r\n    fontSize: 15,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  summaryValueBold: {\r\n    fontSize: 16,\r\n    fontWeight: '700',\r\n    color: '#16a34a',\r\n  },\r\n  footer: {\r\n    backgroundColor: '#fff',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#e5e7eb',\r\n  },\r\n  submitButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    backgroundColor: '#16a34a',\r\n    paddingVertical: 14,\r\n    borderRadius: 12,\r\n    gap: 8,\r\n  },\r\n  submitButtonDisabled: {\r\n    backgroundColor: '#9ca3af',\r\n  },\r\n  submitButtonText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\invoices\\_layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\invoices\\index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DollarSign' is defined but never used.","line":30,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Invoices List Screen\r\n * ====================\r\n *\r\n * Phase 9.10: Mobile-First Architecture\r\n * Invoice list with status filters and quick actions\r\n */\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  TextInput,\r\n  TouchableOpacity,\r\n  RefreshControl,\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\nimport { FlashList } from '@shopify/flash-list';\r\nimport { useRouter } from 'expo-router';\r\nimport {\r\n  Search,\r\n  Plus,\r\n  FileText,\r\n  ChevronRight,\r\n  Clock,\r\n  CheckCircle,\r\n  XCircle,\r\n  Send,\r\n  DollarSign,\r\n} from 'lucide-react-native';\r\n\r\n// Mock data\r\nconst MOCK_INVOICES = [\r\n  {\r\n    id: '1',\r\n    number: 'FAC-2024-001',\r\n    customer: 'Mar├¡a L├│pez',\r\n    date: '2024-12-09',\r\n    total: 85000,\r\n    status: 'paid',\r\n  },\r\n  {\r\n    id: '2',\r\n    number: 'FAC-2024-002',\r\n    customer: 'Pedro Garc├¡a',\r\n    date: '2024-12-08',\r\n    total: 45000,\r\n    status: 'pending',\r\n  },\r\n  {\r\n    id: '3',\r\n    number: 'FAC-2024-003',\r\n    customer: 'Ana Ruiz',\r\n    date: '2024-12-07',\r\n    total: 120000,\r\n    status: 'sent',\r\n  },\r\n  {\r\n    id: '4',\r\n    number: 'FAC-2024-004',\r\n    customer: 'Carlos Mendez',\r\n    date: '2024-12-05',\r\n    total: 65000,\r\n    status: 'overdue',\r\n  },\r\n];\r\n\r\nconst STATUS_CONFIG: Record<string, { label: string; color: string; bg: string; icon: any }> = {\r\n  draft: { label: 'Borrador', color: '#6b7280', bg: '#f3f4f6', icon: FileText },\r\n  pending: { label: 'Pendiente', color: '#f59e0b', bg: '#fef3c7', icon: Clock },\r\n  sent: { label: 'Enviada', color: '#3b82f6', bg: '#dbeafe', icon: Send },\r\n  paid: { label: 'Pagada', color: '#059669', bg: '#d1fae5', icon: CheckCircle },\r\n  overdue: { label: 'Vencida', color: '#ef4444', bg: '#fee2e2', icon: XCircle },\r\n};\r\n\r\ninterface Invoice {\r\n  id: string;\r\n  number: string;\r\n  customer: string;\r\n  date: string;\r\n  total: number;\r\n  status: string;\r\n}\r\n\r\nexport default function InvoicesScreen() {\r\n  const router = useRouter();\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [selectedStatus, setSelectedStatus] = useState<string | null>(null);\r\n  const [invoices] = useState<Invoice[]>(MOCK_INVOICES);\r\n\r\n  const filteredInvoices = invoices.filter((invoice) => {\r\n    if (selectedStatus && invoice.status !== selectedStatus) {\r\n      return false;\r\n    }\r\n    if (!searchQuery) return true;\r\n    const query = searchQuery.toLowerCase();\r\n    return (\r\n      invoice.number.toLowerCase().includes(query) ||\r\n      invoice.customer.toLowerCase().includes(query)\r\n    );\r\n  });\r\n\r\n  const onRefresh = useCallback(async () => {\r\n    setRefreshing(true);\r\n    setTimeout(() => setRefreshing(false), 1000);\r\n  }, []);\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return new Intl.NumberFormat('es-AR', {\r\n      style: 'currency',\r\n      currency: 'ARS',\r\n      minimumFractionDigits: 0,\r\n    }).format(amount);\r\n  };\r\n\r\n  const formatDate = (dateStr: string) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('es-AR', {\r\n      day: '2-digit',\r\n      month: 'short',\r\n    });\r\n  };\r\n\r\n  const renderInvoice = ({ item: invoice }: { item: Invoice }) => {\r\n    const status = STATUS_CONFIG[invoice.status] || STATUS_CONFIG.draft;\r\n    const StatusIcon = status.icon;\r\n\r\n    return (\r\n      <TouchableOpacity\r\n        style={styles.invoiceCard}\r\n        onPress={() => router.push(`/invoices/${invoice.id}` as any)}\r\n      >\r\n        <View style={[styles.statusIndicator, { backgroundColor: status.color }]} />\r\n\r\n        <View style={styles.invoiceContent}>\r\n          <View style={styles.invoiceHeader}>\r\n            <Text style={styles.invoiceNumber}>{invoice.number}</Text>\r\n            <View style={[styles.statusBadge, { backgroundColor: status.bg }]}>\r\n              <StatusIcon size={12} color={status.color} />\r\n              <Text style={[styles.statusText, { color: status.color }]}>\r\n                {status.label}\r\n              </Text>\r\n            </View>\r\n          </View>\r\n\r\n          <Text style={styles.customerName}>{invoice.customer}</Text>\r\n\r\n          <View style={styles.invoiceFooter}>\r\n            <Text style={styles.invoiceDate}>{formatDate(invoice.date)}</Text>\r\n            <Text style={styles.invoiceTotal}>{formatCurrency(invoice.total)}</Text>\r\n          </View>\r\n        </View>\r\n\r\n        <ChevronRight size={20} color=\"#9ca3af\" />\r\n      </TouchableOpacity>\r\n    );\r\n  };\r\n\r\n  const statusFilters = ['pending', 'sent', 'paid', 'overdue'];\r\n\r\n  return (\r\n    <SafeAreaView style={styles.container} edges={['top']}>\r\n      {/* Header */}\r\n      <View style={styles.header}>\r\n        <View style={styles.headerRow}>\r\n          <View>\r\n            <Text style={styles.title}>Facturas</Text>\r\n            <Text style={styles.subtitle}>{invoices.length} facturas</Text>\r\n          </View>\r\n          <TouchableOpacity\r\n            style={styles.addButton}\r\n            onPress={() => router.push('/invoices/create' as any)}\r\n          >\r\n            <Plus size={20} color=\"#fff\" />\r\n            <Text style={styles.addButtonText}>Nueva</Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n      </View>\r\n\r\n      {/* Search */}\r\n      <View style={styles.searchContainer}>\r\n        <Search size={20} color=\"#9ca3af\" />\r\n        <TextInput\r\n          style={styles.searchInput}\r\n          placeholder=\"Buscar por n├║mero o cliente...\"\r\n          placeholderTextColor=\"#9ca3af\"\r\n          value={searchQuery}\r\n          onChangeText={setSearchQuery}\r\n        />\r\n      </View>\r\n\r\n      {/* Status Filters */}\r\n      <View style={styles.filterContainer}>\r\n        <TouchableOpacity\r\n          style={[\r\n            styles.filterChip,\r\n            !selectedStatus && styles.filterChipActive,\r\n          ]}\r\n          onPress={() => setSelectedStatus(null)}\r\n        >\r\n          <Text\r\n            style={[\r\n              styles.filterChipText,\r\n              !selectedStatus && styles.filterChipTextActive,\r\n            ]}\r\n          >\r\n            Todas\r\n          </Text>\r\n        </TouchableOpacity>\r\n\r\n        {statusFilters.map((status) => {\r\n          const config = STATUS_CONFIG[status];\r\n          return (\r\n            <TouchableOpacity\r\n              key={status}\r\n              style={[\r\n                styles.filterChip,\r\n                selectedStatus === status && styles.filterChipActive,\r\n              ]}\r\n              onPress={() =>\r\n                setSelectedStatus(selectedStatus === status ? null : status)\r\n              }\r\n            >\r\n              <Text\r\n                style={[\r\n                  styles.filterChipText,\r\n                  selectedStatus === status && styles.filterChipTextActive,\r\n                ]}\r\n              >\r\n                {config.label}\r\n              </Text>\r\n            </TouchableOpacity>\r\n          );\r\n        })}\r\n      </View>\r\n\r\n      {/* Invoice List */}\r\n      <View style={styles.listContainer}>\r\n        <FlashList\r\n          data={filteredInvoices}\r\n          renderItem={renderInvoice}\r\n          keyExtractor={(item) => item.id}\r\n          refreshControl={\r\n            <RefreshControl\r\n              refreshing={refreshing}\r\n              onRefresh={onRefresh}\r\n              tintColor=\"#059669\"\r\n            />\r\n          }\r\n          ListEmptyComponent={\r\n            <View style={styles.emptyState}>\r\n              <FileText size={48} color=\"#d1d5db\" />\r\n              <Text style={styles.emptyTitle}>\r\n                {searchQuery || selectedStatus ? 'Sin resultados' : 'Sin facturas'}\r\n              </Text>\r\n              <Text style={styles.emptySubtitle}>\r\n                {searchQuery || selectedStatus\r\n                  ? 'Prob├í con otros filtros'\r\n                  : 'Cre├í tu primera factura'}\r\n              </Text>\r\n            </View>\r\n          }\r\n          ItemSeparatorComponent={() => <View style={styles.separator} />}\r\n        />\r\n      </View>\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f9fafb',\r\n  },\r\n  header: {\r\n    paddingHorizontal: 16,\r\n    paddingTop: 16,\r\n    paddingBottom: 8,\r\n  },\r\n  headerRow: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'flex-start',\r\n  },\r\n  title: {\r\n    fontSize: 28,\r\n    fontWeight: '700',\r\n    color: '#111827',\r\n  },\r\n  subtitle: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n  },\r\n  addButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n    backgroundColor: '#059669',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 10,\r\n    borderRadius: 8,\r\n  },\r\n  addButtonText: {\r\n    color: '#fff',\r\n    fontWeight: '600',\r\n    fontSize: 14,\r\n  },\r\n  searchContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 12,\r\n    marginHorizontal: 16,\r\n    marginVertical: 12,\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  searchInput: {\r\n    flex: 1,\r\n    fontSize: 16,\r\n    color: '#111827',\r\n  },\r\n  filterContainer: {\r\n    flexDirection: 'row',\r\n    paddingHorizontal: 16,\r\n    gap: 8,\r\n    marginBottom: 12,\r\n  },\r\n  filterChip: {\r\n    paddingHorizontal: 14,\r\n    paddingVertical: 8,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 20,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  filterChipActive: {\r\n    backgroundColor: '#059669',\r\n    borderColor: '#059669',\r\n  },\r\n  filterChipText: {\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n    color: '#374151',\r\n  },\r\n  filterChipTextActive: {\r\n    color: '#fff',\r\n  },\r\n  listContainer: {\r\n    flex: 1,\r\n  },\r\n  invoiceCard: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    paddingRight: 16,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#fff',\r\n  },\r\n  statusIndicator: {\r\n    width: 4,\r\n    height: '100%',\r\n    marginRight: 16,\r\n  },\r\n  invoiceContent: {\r\n    flex: 1,\r\n  },\r\n  invoiceHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n  },\r\n  invoiceNumber: {\r\n    fontSize: 15,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  statusBadge: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 3,\r\n    borderRadius: 12,\r\n  },\r\n  statusText: {\r\n    fontSize: 11,\r\n    fontWeight: '600',\r\n  },\r\n  customerName: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n  },\r\n  invoiceFooter: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    marginTop: 8,\r\n  },\r\n  invoiceDate: {\r\n    fontSize: 13,\r\n    color: '#9ca3af',\r\n  },\r\n  invoiceTotal: {\r\n    fontSize: 16,\r\n    fontWeight: '700',\r\n    color: '#111827',\r\n  },\r\n  separator: {\r\n    height: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  emptyState: {\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    paddingVertical: 64,\r\n  },\r\n  emptyTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    marginTop: 16,\r\n  },\r\n  emptySubtitle: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginTop: 8,\r\n    textAlign: 'center',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\jobs\\[id].tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":27,"column":25,"nodeType":"Literal","endLine":27,"endColumn":45},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPhotos'. Either include it or remove the dependency array.","line":58,"column":6,"nodeType":"ArrayExpression","endLine":58,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [job.id, loadPhotos]","fix":{"range":[1748,1756],"text":"[job.id, loadPhotos]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":135,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":135,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":226,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":226,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":247,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":247,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Job Detail Screen\r\n * =================\r\n *\r\n * Shows job details with status actions and completion flow.\r\n *\r\n * Features:\r\n * - Customer info with contact options\r\n * - Status updates with GPS tracking integration\r\n * - Photo capture (before/during/after)\r\n * - Material usage logging\r\n * - Signature capture on completion\r\n */\r\n\r\nimport { useState, useCallback, useEffect } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  ScrollView,\r\n  TouchableOpacity,\r\n  Linking,\r\n  Alert,\r\n  Image,\r\n} from 'react-native';\r\nimport { useLocalSearchParams, useRouter, Stack } from 'expo-router';\r\nimport { Feather } from '@expo/vector-icons';\r\nimport { withObservables } from '@nozbe/watermelondb/react';\r\nimport { switchMap, of } from 'rxjs';\r\nimport { Q } from '@nozbe/watermelondb';\r\nimport * as ImagePicker from 'expo-image-picker';\r\n\r\nimport { jobsCollection, customersCollection, jobPhotosCollection, database } from '../../../watermelon/database';\r\nimport { Job, Customer } from '../../../watermelon/models';\r\nimport { enqueueOperation } from '../../../lib/sync/sync-engine';\r\nimport {\r\n  startTracking,\r\n  stopTracking,\r\n  isTrackingActive,\r\n} from '../../../lib/services/location';\r\nimport StatusButton from '../../../components/job/StatusButton';\r\n\r\ninterface JobPhoto {\r\n  id: string;\r\n  localUri: string;\r\n  type: 'before' | 'during' | 'after';\r\n}\r\n\r\nfunction JobDetailScreen({ job, customer }: { job: Job; customer: Customer | null }) {\r\n  const router = useRouter();\r\n  const [isUpdating, setIsUpdating] = useState(false);\r\n  const [photos, setPhotos] = useState<JobPhoto[]>([]);\r\n  const [showPhotos, setShowPhotos] = useState(false);\r\n\r\n  // Load existing photos for this job\r\n  useEffect(() => {\r\n    loadPhotos();\r\n  }, [job.id]);\r\n\r\n  const loadPhotos = async () => {\r\n    try {\r\n      const existingPhotos = await jobPhotosCollection\r\n        .query(Q.where('job_id', job.id))\r\n        .fetch();\r\n      setPhotos(\r\n        existingPhotos.map((p: any) => ({\r\n          id: p.id,\r\n          localUri: p.localUri,\r\n          type: p.type,\r\n        }))\r\n      );\r\n    } catch (error) {\r\n      console.error('Failed to load photos:', error);\r\n    }\r\n  };\r\n\r\n  const handleStatusChange = useCallback(\r\n    async (newStatus: string) => {\r\n      setIsUpdating(true);\r\n      try {\r\n        if (newStatus === 'en_camino') {\r\n          // Start GPS tracking when going EN_ROUTE\r\n          const trackingResult = await startTracking(job.serverId);\r\n          if (!trackingResult.success) {\r\n            // Show warning but don't block status change\r\n            Alert.alert(\r\n              'Ubicaci├│n',\r\n              'No se pudo activar el seguimiento GPS. El cliente no podr├í ver tu ubicaci├│n.',\r\n              [{ text: 'OK' }]\r\n            );\r\n          }\r\n          await job.startJob();\r\n        } else if (newStatus === 'working') {\r\n          await job.arriveAtJob();\r\n        } else if (newStatus === 'completed') {\r\n          // Stop GPS tracking when completing\r\n          if (isTrackingActive()) {\r\n            await stopTracking();\r\n          }\r\n          // Navigate to completion flow\r\n          router.push(`/(tabs)/jobs/complete?id=${job.id}`);\r\n          return;\r\n        } else if (newStatus === 'cancelled') {\r\n          Alert.prompt(\r\n            'Cancelar trabajo',\r\n            '┬┐Por qu├⌐ se cancela este trabajo?',\r\n            [\r\n              { text: 'No cancelar', style: 'cancel' },\r\n              {\r\n                text: 'Cancelar trabajo',\r\n                style: 'destructive',\r\n                onPress: async (reason) => {\r\n                  // Stop tracking on cancellation\r\n                  if (isTrackingActive()) {\r\n                    await stopTracking();\r\n                  }\r\n                  await job.cancelJob(reason || 'Sin motivo');\r\n                  await enqueueOperation('job', job.serverId, 'update', {\r\n                    status: 'cancelled',\r\n                    completionNotes: reason,\r\n                  });\r\n                },\r\n              },\r\n            ],\r\n            'plain-text'\r\n          );\r\n          return;\r\n        }\r\n\r\n        // Queue for sync\r\n        await enqueueOperation('job', job.serverId, 'update', {\r\n          status: newStatus,\r\n          actualStart: job.actualStart,\r\n        });\r\n      } catch (error) {\r\n        Alert.alert('Error', 'No se pudo actualizar el estado');\r\n      } finally {\r\n        setIsUpdating(false);\r\n      }\r\n    },\r\n    [job, router]\r\n  );\r\n\r\n  const handleCall = () => {\r\n    if (customer?.phone) {\r\n      Linking.openURL(`tel:${customer.phone}`);\r\n    }\r\n  };\r\n\r\n  const handleNavigate = () => {\r\n    const address = encodeURIComponent(job.address);\r\n    const url = `https://maps.google.com/?q=${address}`;\r\n    Linking.openURL(url);\r\n  };\r\n\r\n  const handleWhatsApp = () => {\r\n    if (customer?.phone) {\r\n      const phone = customer.phone.replace(/\\D/g, '');\r\n      Linking.openURL(`whatsapp://send?phone=${phone}`);\r\n    }\r\n  };\r\n\r\n  // Determine photo type based on job status\r\n  const getPhotoType = (): 'before' | 'during' | 'after' => {\r\n    if (job.status === 'pending' || job.status === 'scheduled' || job.status === 'en_camino') {\r\n      return 'before';\r\n    }\r\n    if (job.status === 'working') {\r\n      return 'during';\r\n    }\r\n    return 'after';\r\n  };\r\n\r\n  const handleTakePhoto = async () => {\r\n    const permission = await ImagePicker.requestCameraPermissionsAsync();\r\n    if (!permission.granted) {\r\n      Alert.alert('Permiso requerido', 'Necesitamos acceso a la c├ímara para tomar fotos');\r\n      return;\r\n    }\r\n\r\n    const result = await ImagePicker.launchCameraAsync({\r\n      mediaTypes: ImagePicker.MediaTypeOptions.Images,\r\n      quality: 0.8,\r\n      allowsEditing: false,\r\n    });\r\n\r\n    if (!result.canceled && result.assets[0]) {\r\n      await savePhoto(result.assets[0].uri);\r\n    }\r\n  };\r\n\r\n  const handlePickPhoto = async () => {\r\n    const permission = await ImagePicker.requestMediaLibraryPermissionsAsync();\r\n    if (!permission.granted) {\r\n      Alert.alert('Permiso requerido', 'Necesitamos acceso a la galer├¡a');\r\n      return;\r\n    }\r\n\r\n    const result = await ImagePicker.launchImageLibraryAsync({\r\n      mediaTypes: ImagePicker.MediaTypeOptions.Images,\r\n      quality: 0.8,\r\n      allowsMultipleSelection: true,\r\n      selectionLimit: 5 - photos.length,\r\n    });\r\n\r\n    if (!result.canceled) {\r\n      for (const asset of result.assets) {\r\n        await savePhoto(asset.uri);\r\n      }\r\n    }\r\n  };\r\n\r\n  const savePhoto = async (uri: string) => {\r\n    const photoType = getPhotoType();\r\n    try {\r\n      await database.write(async () => {\r\n        await jobPhotosCollection.create((photo: any) => {\r\n          photo.jobId = job.id;\r\n          photo.localUri = uri;\r\n          photo.type = photoType;\r\n          photo.uploaded = false;\r\n          photo.createdAt = new Date();\r\n        });\r\n      });\r\n      await loadPhotos();\r\n    } catch (error) {\r\n      Alert.alert('Error', 'No se pudo guardar la foto');\r\n    }\r\n  };\r\n\r\n  const handleRemovePhoto = async (photoId: string) => {\r\n    Alert.alert(\r\n      'Eliminar foto',\r\n      '┬┐Est├ís seguro de que quer├⌐s eliminar esta foto?',\r\n      [\r\n        { text: 'Cancelar', style: 'cancel' },\r\n        {\r\n          text: 'Eliminar',\r\n          style: 'destructive',\r\n          onPress: async () => {\r\n            try {\r\n              await database.write(async () => {\r\n                const photo = await jobPhotosCollection.find(photoId);\r\n                await photo.destroyPermanently();\r\n              });\r\n              await loadPhotos();\r\n            } catch (error) {\r\n              Alert.alert('Error', 'No se pudo eliminar la foto');\r\n            }\r\n          },\r\n        },\r\n      ]\r\n    );\r\n  };\r\n\r\n  const formatDate = (timestamp: number | null) => {\r\n    if (!timestamp) return '--';\r\n    return new Date(timestamp).toLocaleDateString('es-AR', {\r\n      weekday: 'long',\r\n      day: 'numeric',\r\n      month: 'long',\r\n    });\r\n  };\r\n\r\n  const formatTime = (timestamp: number | null) => {\r\n    if (!timestamp) return '--:--';\r\n    return new Date(timestamp).toLocaleTimeString('es-AR', {\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n  };\r\n\r\n  // Check if we can add photos (job is in progress)\r\n  const canAddPhotos = ['en_camino', 'working'].includes(job.status);\r\n  const photoTypeLabel = getPhotoType() === 'before' ? 'Antes' : getPhotoType() === 'during' ? 'Durante' : 'Despu├⌐s';\r\n\r\n  return (\r\n    <>\r\n      <Stack.Screen\r\n        options={{\r\n          headerTitle: job.serviceType,\r\n          headerStyle: { backgroundColor: '#16a34a' },\r\n          headerTintColor: '#fff',\r\n          headerRight: () => (\r\n            <TouchableOpacity onPress={() => {}} style={styles.headerButton}>\r\n              <Feather name=\"more-vertical\" size={20} color=\"#fff\" />\r\n            </TouchableOpacity>\r\n          ),\r\n        }}\r\n      />\r\n\r\n      <ScrollView style={styles.container} contentContainerStyle={styles.content}>\r\n        {/* Status card */}\r\n        <View style={styles.statusCard}>\r\n          <StatusButton\r\n            status={job.status}\r\n            onStatusChange={handleStatusChange}\r\n            isLoading={isUpdating}\r\n          />\r\n        </View>\r\n\r\n        {/* Photo capture card - shown during work */}\r\n        {canAddPhotos && (\r\n          <View style={styles.card}>\r\n            <TouchableOpacity\r\n              style={styles.cardHeader}\r\n              onPress={() => setShowPhotos(!showPhotos)}\r\n            >\r\n              <Feather name=\"camera\" size={18} color=\"#16a34a\" />\r\n              <Text style={styles.cardTitle}>\r\n                Fotos del trabajo ({photos.length})\r\n              </Text>\r\n              <View style={styles.photoBadge}>\r\n                <Text style={styles.photoBadgeText}>{photoTypeLabel}</Text>\r\n              </View>\r\n              <Feather\r\n                name={showPhotos ? 'chevron-up' : 'chevron-down'}\r\n                size={20}\r\n                color=\"#9ca3af\"\r\n              />\r\n            </TouchableOpacity>\r\n\r\n            {showPhotos && (\r\n              <View style={styles.photoSection}>\r\n                {/* Photo grid */}\r\n                {photos.length > 0 && (\r\n                  <View style={styles.photoGrid}>\r\n                    {photos.map((photo) => (\r\n                      <View key={photo.id} style={styles.photoItem}>\r\n                        <Image source={{ uri: photo.localUri }} style={styles.photo} />\r\n                        <View style={styles.photoTypeBadge}>\r\n                          <Text style={styles.photoTypeText}>\r\n                            {photo.type === 'before' ? 'A' : photo.type === 'during' ? 'D' : 'F'}\r\n                          </Text>\r\n                        </View>\r\n                        <TouchableOpacity\r\n                          style={styles.removePhoto}\r\n                          onPress={() => handleRemovePhoto(photo.id)}\r\n                        >\r\n                          <Feather name=\"x\" size={14} color=\"#fff\" />\r\n                        </TouchableOpacity>\r\n                      </View>\r\n                    ))}\r\n                  </View>\r\n                )}\r\n\r\n                {/* Add photo buttons */}\r\n                <View style={styles.addPhotoButtons}>\r\n                  <TouchableOpacity\r\n                    style={styles.addPhotoButton}\r\n                    onPress={handleTakePhoto}\r\n                  >\r\n                    <Feather name=\"camera\" size={20} color=\"#16a34a\" />\r\n                    <Text style={styles.addPhotoText}>Tomar foto</Text>\r\n                  </TouchableOpacity>\r\n                  <TouchableOpacity\r\n                    style={styles.addPhotoButton}\r\n                    onPress={handlePickPhoto}\r\n                  >\r\n                    <Feather name=\"image\" size={20} color=\"#16a34a\" />\r\n                    <Text style={styles.addPhotoText}>Galer├¡a</Text>\r\n                  </TouchableOpacity>\r\n                </View>\r\n\r\n                <Text style={styles.photoHint}>\r\n                  Las fotos se guardan localmente y se sincronizan cuando haya conexi├│n\r\n                </Text>\r\n              </View>\r\n            )}\r\n          </View>\r\n        )}\r\n\r\n        {/* Quick actions during work */}\r\n        {job.status === 'working' && (\r\n          <View style={styles.card}>\r\n            <View style={styles.cardHeader}>\r\n              <Feather name=\"tool\" size={18} color=\"#16a34a\" />\r\n              <Text style={styles.cardTitle}>Acciones r├ípidas</Text>\r\n            </View>\r\n            <View style={styles.quickActions}>\r\n              <TouchableOpacity\r\n                style={styles.quickAction}\r\n                onPress={() => router.push(`/(tabs)/inventory/usage?jobId=${job.id}`)}\r\n              >\r\n                <View style={styles.quickActionIcon}>\r\n                  <Feather name=\"package\" size={20} color=\"#3b82f6\" />\r\n                </View>\r\n                <Text style={styles.quickActionText}>Registrar materiales</Text>\r\n              </TouchableOpacity>\r\n              <TouchableOpacity\r\n                style={styles.quickAction}\r\n                onPress={handleTakePhoto}\r\n              >\r\n                <View style={styles.quickActionIcon}>\r\n                  <Feather name=\"camera\" size={20} color=\"#8b5cf6\" />\r\n                </View>\r\n                <Text style={styles.quickActionText}>Agregar foto</Text>\r\n              </TouchableOpacity>\r\n            </View>\r\n          </View>\r\n        )}\r\n\r\n        {/* Customer card */}\r\n        <View style={styles.card}>\r\n          <View style={styles.cardHeader}>\r\n            <Feather name=\"user\" size={18} color=\"#16a34a\" />\r\n            <Text style={styles.cardTitle}>Cliente</Text>\r\n          </View>\r\n          <Text style={styles.customerName}>{customer?.name || 'Cliente'}</Text>\r\n          {customer?.phone && (\r\n            <View style={styles.contactButtons}>\r\n              <TouchableOpacity style={styles.contactButton} onPress={handleCall}>\r\n                <Feather name=\"phone\" size={18} color=\"#16a34a\" />\r\n                <Text style={styles.contactButtonText}>Llamar</Text>\r\n              </TouchableOpacity>\r\n              <TouchableOpacity style={styles.contactButton} onPress={handleWhatsApp}>\r\n                <Feather name=\"message-circle\" size={18} color=\"#25d366\" />\r\n                <Text style={styles.contactButtonText}>WhatsApp</Text>\r\n              </TouchableOpacity>\r\n            </View>\r\n          )}\r\n        </View>\r\n\r\n        {/* Schedule card */}\r\n        <View style={styles.card}>\r\n          <View style={styles.cardHeader}>\r\n            <Feather name=\"calendar\" size={18} color=\"#16a34a\" />\r\n            <Text style={styles.cardTitle}>Horario</Text>\r\n          </View>\r\n          <Text style={styles.scheduleDate}>{formatDate(job.scheduledStart)}</Text>\r\n          <View style={styles.scheduleTimeRow}>\r\n            <View style={styles.scheduleTime}>\r\n              <Text style={styles.scheduleTimeLabel}>Inicio</Text>\r\n              <Text style={styles.scheduleTimeValue}>\r\n                {formatTime(job.scheduledStart)}\r\n              </Text>\r\n            </View>\r\n            <Feather name=\"arrow-right\" size={16} color=\"#d1d5db\" />\r\n            <View style={styles.scheduleTime}>\r\n              <Text style={styles.scheduleTimeLabel}>Fin estimado</Text>\r\n              <Text style={styles.scheduleTimeValue}>\r\n                {formatTime(job.scheduledEnd)}\r\n              </Text>\r\n            </View>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Location card */}\r\n        <View style={styles.card}>\r\n          <View style={styles.cardHeader}>\r\n            <Feather name=\"map-pin\" size={18} color=\"#16a34a\" />\r\n            <Text style={styles.cardTitle}>Ubicaci├│n</Text>\r\n          </View>\r\n          <Text style={styles.address}>{job.address}</Text>\r\n          <TouchableOpacity style={styles.navigateButton} onPress={handleNavigate}>\r\n            <Feather name=\"navigation\" size={18} color=\"#fff\" />\r\n            <Text style={styles.navigateButtonText}>Navegar</Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        {/* Notes card */}\r\n        {(job.notes || job.internalNotes) && (\r\n          <View style={styles.card}>\r\n            <View style={styles.cardHeader}>\r\n              <Feather name=\"file-text\" size={18} color=\"#16a34a\" />\r\n              <Text style={styles.cardTitle}>Notas</Text>\r\n            </View>\r\n            {job.notes && (\r\n              <View style={styles.noteSection}>\r\n                <Text style={styles.noteLabel}>Instrucciones del cliente</Text>\r\n                <Text style={styles.noteText}>{job.notes}</Text>\r\n              </View>\r\n            )}\r\n            {job.internalNotes && (\r\n              <View style={styles.noteSection}>\r\n                <Text style={styles.noteLabel}>Notas internas</Text>\r\n                <Text style={styles.noteText}>{job.internalNotes}</Text>\r\n              </View>\r\n            )}\r\n          </View>\r\n        )}\r\n\r\n        {/* Materials used (if any) */}\r\n        {job.parsedMaterialsUsed.length > 0 && (\r\n          <View style={styles.card}>\r\n            <View style={styles.cardHeader}>\r\n              <Feather name=\"package\" size={18} color=\"#16a34a\" />\r\n              <Text style={styles.cardTitle}>Materiales utilizados</Text>\r\n            </View>\r\n            {job.parsedMaterialsUsed.map((material, index) => (\r\n              <View key={index} style={styles.materialItem}>\r\n                <Text style={styles.materialName}>{material.name}</Text>\r\n                <Text style={styles.materialQty}>x{material.quantity}</Text>\r\n                <Text style={styles.materialPrice}>\r\n                  ${(material.quantity * material.price).toLocaleString('es-AR')}\r\n                </Text>\r\n              </View>\r\n            ))}\r\n          </View>\r\n        )}\r\n\r\n        {/* Completion info (if completed) */}\r\n        {job.isCompleted && job.completionNotes && (\r\n          <View style={styles.card}>\r\n            <View style={styles.cardHeader}>\r\n              <Feather name=\"check-circle\" size={18} color=\"#16a34a\" />\r\n              <Text style={styles.cardTitle}>Trabajo completado</Text>\r\n            </View>\r\n            <Text style={styles.noteText}>{job.completionNotes}</Text>\r\n            {job.total && (\r\n              <View style={styles.totalRow}>\r\n                <Text style={styles.totalLabel}>Total</Text>\r\n                <Text style={styles.totalValue}>\r\n                  ${job.total.toLocaleString('es-AR')}\r\n                </Text>\r\n              </View>\r\n            )}\r\n          </View>\r\n        )}\r\n\r\n        {/* Existing photos for completed jobs */}\r\n        {job.isCompleted && photos.length > 0 && (\r\n          <View style={styles.card}>\r\n            <View style={styles.cardHeader}>\r\n              <Feather name=\"image\" size={18} color=\"#16a34a\" />\r\n              <Text style={styles.cardTitle}>Fotos ({photos.length})</Text>\r\n            </View>\r\n            <View style={styles.photoGrid}>\r\n              {photos.map((photo) => (\r\n                <View key={photo.id} style={styles.photoItem}>\r\n                  <Image source={{ uri: photo.localUri }} style={styles.photo} />\r\n                  <View style={styles.photoTypeBadge}>\r\n                    <Text style={styles.photoTypeText}>\r\n                      {photo.type === 'before' ? 'A' : photo.type === 'during' ? 'D' : 'F'}\r\n                    </Text>\r\n                  </View>\r\n                </View>\r\n              ))}\r\n            </View>\r\n          </View>\r\n        )}\r\n\r\n        {/* Offline indicator */}\r\n        {job.isDirty && (\r\n          <View style={styles.offlineIndicator}>\r\n            <Feather name=\"cloud-off\" size={16} color=\"#f59e0b\" />\r\n            <Text style={styles.offlineText}>\r\n              Cambios pendientes de sincronizaci├│n\r\n            </Text>\r\n          </View>\r\n        )}\r\n      </ScrollView>\r\n    </>\r\n  );\r\n}\r\n\r\n// Enhance with WatermelonDB\r\nconst enhance = withObservables(['id'], ({ id }: { id: string }) => ({\r\n  job: jobsCollection.findAndObserve(id),\r\n  customer: jobsCollection.findAndObserve(id).pipe(\r\n    switchMap((job: Job) =>\r\n      job.customerId ? customersCollection.findAndObserve(job.customerId) : of(null)\r\n    )\r\n  ),\r\n}));\r\n\r\nexport default function JobDetailWrapper() {\r\n  const { id } = useLocalSearchParams<{ id: string }>();\r\n\r\n  if (!id) {\r\n    return (\r\n      <View style={styles.errorContainer}>\r\n        <Text>Job not found</Text>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  const EnhancedScreen = enhance(JobDetailScreen);\r\n  return <EnhancedScreen id={id} />;\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  content: {\r\n    padding: 16,\r\n    paddingBottom: 100,\r\n  },\r\n  headerButton: {\r\n    padding: 8,\r\n  },\r\n  statusCard: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 16,\r\n    padding: 20,\r\n    marginBottom: 12,\r\n    alignItems: 'center',\r\n  },\r\n  card: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 16,\r\n    padding: 16,\r\n    marginBottom: 12,\r\n  },\r\n  cardHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n    marginBottom: 12,\r\n  },\r\n  cardTitle: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#6b7280',\r\n    flex: 1,\r\n  },\r\n  customerName: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginBottom: 12,\r\n  },\r\n  contactButtons: {\r\n    flexDirection: 'row',\r\n    gap: 12,\r\n  },\r\n  contactButton: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#f3f4f6',\r\n    borderRadius: 12,\r\n  },\r\n  contactButtonText: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#374151',\r\n  },\r\n  scheduleDate: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginBottom: 12,\r\n    textTransform: 'capitalize',\r\n  },\r\n  scheduleTimeRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n  },\r\n  scheduleTime: {\r\n    alignItems: 'center',\r\n  },\r\n  scheduleTimeLabel: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginBottom: 4,\r\n  },\r\n  scheduleTimeValue: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  address: {\r\n    fontSize: 16,\r\n    color: '#374151',\r\n    lineHeight: 24,\r\n    marginBottom: 12,\r\n  },\r\n  navigateButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#3b82f6',\r\n    paddingVertical: 14,\r\n    borderRadius: 12,\r\n  },\r\n  navigateButtonText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  noteSection: {\r\n    marginBottom: 12,\r\n  },\r\n  noteLabel: {\r\n    fontSize: 12,\r\n    fontWeight: '500',\r\n    color: '#6b7280',\r\n    marginBottom: 4,\r\n  },\r\n  noteText: {\r\n    fontSize: 14,\r\n    color: '#374151',\r\n    lineHeight: 20,\r\n  },\r\n  // Photo styles\r\n  photoBadge: {\r\n    backgroundColor: '#f0fdf4',\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 4,\r\n    borderRadius: 6,\r\n  },\r\n  photoBadgeText: {\r\n    fontSize: 12,\r\n    fontWeight: '500',\r\n    color: '#16a34a',\r\n  },\r\n  photoSection: {\r\n    marginTop: 8,\r\n  },\r\n  photoGrid: {\r\n    flexDirection: 'row',\r\n    flexWrap: 'wrap',\r\n    gap: 8,\r\n    marginBottom: 12,\r\n  },\r\n  photoItem: {\r\n    position: 'relative',\r\n    width: '30%',\r\n    aspectRatio: 1,\r\n  },\r\n  photo: {\r\n    width: '100%',\r\n    height: '100%',\r\n    borderRadius: 8,\r\n  },\r\n  photoTypeBadge: {\r\n    position: 'absolute',\r\n    bottom: 4,\r\n    left: 4,\r\n    backgroundColor: 'rgba(0,0,0,0.6)',\r\n    paddingHorizontal: 6,\r\n    paddingVertical: 2,\r\n    borderRadius: 4,\r\n  },\r\n  photoTypeText: {\r\n    color: '#fff',\r\n    fontSize: 10,\r\n    fontWeight: '600',\r\n  },\r\n  removePhoto: {\r\n    position: 'absolute',\r\n    top: -6,\r\n    right: -6,\r\n    backgroundColor: '#ef4444',\r\n    borderRadius: 10,\r\n    padding: 4,\r\n  },\r\n  addPhotoButtons: {\r\n    flexDirection: 'row',\r\n    gap: 12,\r\n  },\r\n  addPhotoButton: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#f0fdf4',\r\n    borderRadius: 12,\r\n    borderWidth: 1,\r\n    borderColor: '#dcfce7',\r\n    borderStyle: 'dashed',\r\n  },\r\n  addPhotoText: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#16a34a',\r\n  },\r\n  photoHint: {\r\n    fontSize: 12,\r\n    color: '#9ca3af',\r\n    textAlign: 'center',\r\n    marginTop: 8,\r\n  },\r\n  // Quick actions\r\n  quickActions: {\r\n    flexDirection: 'row',\r\n    gap: 12,\r\n  },\r\n  quickAction: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    paddingVertical: 12,\r\n    backgroundColor: '#f9fafb',\r\n    borderRadius: 12,\r\n  },\r\n  quickActionIcon: {\r\n    width: 40,\r\n    height: 40,\r\n    borderRadius: 20,\r\n    backgroundColor: '#fff',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    marginBottom: 8,\r\n  },\r\n  quickActionText: {\r\n    fontSize: 12,\r\n    fontWeight: '500',\r\n    color: '#374151',\r\n    textAlign: 'center',\r\n  },\r\n  // Materials\r\n  materialItem: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    paddingVertical: 8,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#f3f4f6',\r\n  },\r\n  materialName: {\r\n    flex: 1,\r\n    fontSize: 14,\r\n    color: '#374151',\r\n  },\r\n  materialQty: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginRight: 12,\r\n  },\r\n  materialPrice: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#16a34a',\r\n  },\r\n  // Total\r\n  totalRow: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    marginTop: 12,\r\n    paddingTop: 12,\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#e5e7eb',\r\n  },\r\n  totalLabel: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#6b7280',\r\n  },\r\n  totalValue: {\r\n    fontSize: 20,\r\n    fontWeight: '700',\r\n    color: '#16a34a',\r\n  },\r\n  offlineIndicator: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#fffbeb',\r\n    padding: 12,\r\n    borderRadius: 12,\r\n    marginTop: 8,\r\n  },\r\n  offlineText: {\r\n    fontSize: 13,\r\n    color: '#f59e0b',\r\n  },\r\n  errorContainer: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\jobs\\_layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\jobs\\complete.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":25,"column":25,"nodeType":"Literal","endLine":25,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":298,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":298,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Job Completion Screen\r\n * =====================\r\n *\r\n * Multi-step flow for completing a job:\r\n * 1. Notes and materials used (with Voice-to-Invoice AI option)\r\n * 2. Photo capture\r\n * 3. Signature capture\r\n */\r\n\r\nimport { useState, useRef, useCallback, useEffect } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  ScrollView,\r\n  TextInput,\r\n  TouchableOpacity,\r\n  Image,\r\n  Alert,\r\n  KeyboardAvoidingView,\r\n  Platform,\r\n} from 'react-native';\r\nimport { useLocalSearchParams, useRouter, Stack } from 'expo-router';\r\nimport { Feather } from '@expo/vector-icons';\r\nimport * as ImagePicker from 'expo-image-picker';\r\nimport SignatureCanvas from 'react-native-signature-canvas';\r\n\r\nimport { jobsCollection, jobPhotosCollection, database } from '../../../watermelon/database';\r\nimport { Job } from '../../../watermelon/models';\r\nimport * as SecureStore from 'expo-secure-store';\r\nimport { enqueueOperation } from '../../../lib/sync/sync-engine';\r\nimport VoiceInput from '../../../components/voice/VoiceInput';\r\nimport { useAuth } from '../../../lib/auth/auth-context';\r\n\r\ntype Step = 'notes' | 'photos' | 'signature';\r\n\r\ninterface Material {\r\n  name: string;\r\n  quantity: number;\r\n  price: number;\r\n}\r\n\r\nexport default function CompleteJobScreen() {\r\n  const { id } = useLocalSearchParams<{ id: string }>();\r\n  const router = useRouter();\r\n  const signatureRef = useRef<any>(null);\r\n  const { user } = useAuth();\r\n  const organizationId = user?.organizationId;\r\n\r\n  const [step, setStep] = useState<Step>('notes');\r\n  const [notes, setNotes] = useState('');\r\n  const [materials, setMaterials] = useState<Material[]>([]);\r\n  const [newMaterial, setNewMaterial] = useState({ name: '', quantity: '1', price: '' });\r\n  const [photos, setPhotos] = useState<string[]>([]);\r\n  const [signature, setSignature] = useState<string | null>(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  // Voice-to-Invoice AI state\r\n  const [useVoiceInput, setUseVoiceInput] = useState(false);\r\n  const [voiceTranscription, setVoiceTranscription] = useState<string | null>(null);\r\n  const [isExtractingInvoice, setIsExtractingInvoice] = useState(false);\r\n\r\n  // Per-visit pricing state (Phase 1 - Jan 2026)\r\n  const [jobPricingMode, setJobPricingMode] = useState<string | null>(null);\r\n  const [visitEstimatedPrice, setVisitEstimatedPrice] = useState<number | null>(null);\r\n  const [visitActualPrice, setVisitActualPrice] = useState('');\r\n  const [priceVarianceReason, setPriceVarianceReason] = useState('');\r\n\r\n  // Voice-to-Invoice: Extract invoice data from transcription\r\n  const handleVoiceInvoiceExtraction = async (transcription: string) => {\r\n    if (!id || !organizationId) return;\r\n\r\n    setVoiceTranscription(transcription);\r\n    setIsExtractingInvoice(true);\r\n\r\n    try {\r\n      const apiUrl = process.env.EXPO_PUBLIC_API_URL || 'http://localhost:3000';\r\n      const response = await fetch(`${apiUrl}/api/jobs/${id}/voice-invoice`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${await SecureStore.getItemAsync('auth_token')}`,\r\n        },\r\n        body: JSON.stringify({\r\n          transcription,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Error al extraer datos');\r\n      }\r\n\r\n      const data = await response.json();\r\n\r\n      if (data.success && data.suggestion) {\r\n        // Auto-populate notes with job summary\r\n        if (data.suggestion.extraction?.workPerformed) {\r\n          setNotes(data.suggestion.extraction.workPerformed);\r\n        } else if (data.suggestion.extraction?.jobSummary) {\r\n          setNotes(data.suggestion.extraction.jobSummary);\r\n        }\r\n\r\n        // Auto-populate materials from extracted line items\r\n        const extractedMaterials: Material[] = data.suggestion.lineItems\r\n          .filter((item: any) => item.unitPrice !== null)\r\n          .map((item: any) => ({\r\n            name: item.description,\r\n            quantity: item.quantity,\r\n            price: item.unitPrice,\r\n          }));\r\n\r\n        if (extractedMaterials.length > 0) {\r\n          setMaterials(extractedMaterials);\r\n          Alert.alert(\r\n            'IA Extracci├│n Completada',\r\n            `Se extrajeron ${extractedMaterials.length} items.\\nTotal estimado: $${data.suggestion.total.toLocaleString('es-AR')}\\n\\nRevis├í los items antes de continuar.`,\r\n            [{ text: 'Revisar', style: 'default' }]\r\n          );\r\n        } else {\r\n          Alert.alert(\r\n            'Sin items encontrados',\r\n            'La IA no pudo extraer items con precios. Agreg├í los materiales manualmente.',\r\n            [{ text: 'OK' }]\r\n          );\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Voice invoice extraction error:', error);\r\n      // Just use the transcription as notes if extraction fails\r\n      setNotes(transcription);\r\n      Alert.alert(\r\n        'Extracci├│n no disponible',\r\n        'Se guard├│ la transcripci├│n como notas. Agreg├í los materiales manualmente.',\r\n        [{ text: 'OK' }]\r\n      );\r\n    } finally {\r\n      setIsExtractingInvoice(false);\r\n    }\r\n  };\r\n\r\n  // Load job pricing data (Phase 1 - Jan 2026)\r\n  const loadJobPricingData = useCallback(async () => {\r\n    if (!id) return;\r\n    try {\r\n      const job = await jobsCollection.find(id) as Job;\r\n      if (job) {\r\n        setJobPricingMode(job.pricingMode);\r\n        setVisitEstimatedPrice(job.visitEstimatedPrice);\r\n        // Pre-fill actual price with estimated if available\r\n        if (job.visitEstimatedPrice !== null) {\r\n          setVisitActualPrice(job.visitEstimatedPrice.toString());\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading job pricing data:', error);\r\n    }\r\n  }, [id]);\r\n\r\n  // Load job pricing on mount\r\n  useEffect(() => {\r\n    loadJobPricingData();\r\n  }, [loadJobPricingData]);\r\n\r\n  const handleAddMaterial = () => {\r\n    if (!newMaterial.name || !newMaterial.price) {\r\n      Alert.alert('Error', 'Complet├í nombre y precio del material');\r\n      return;\r\n    }\r\n\r\n    setMaterials([\r\n      ...materials,\r\n      {\r\n        name: newMaterial.name,\r\n        quantity: parseInt(newMaterial.quantity) || 1,\r\n        price: parseFloat(newMaterial.price) || 0,\r\n      },\r\n    ]);\r\n    setNewMaterial({ name: '', quantity: '1', price: '' });\r\n  };\r\n\r\n  const handleRemoveMaterial = (index: number) => {\r\n    setMaterials(materials.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleTakePhoto = async () => {\r\n    const permission = await ImagePicker.requestCameraPermissionsAsync();\r\n    if (!permission.granted) {\r\n      Alert.alert('Permiso requerido', 'Necesitamos acceso a la c├ímara');\r\n      return;\r\n    }\r\n\r\n    const result = await ImagePicker.launchCameraAsync({\r\n      mediaTypes: ImagePicker.MediaTypeOptions.Images,\r\n      quality: 0.8,\r\n      allowsEditing: true,\r\n    });\r\n\r\n    if (!result.canceled && result.assets[0]) {\r\n      setPhotos([...photos, result.assets[0].uri]);\r\n    }\r\n  };\r\n\r\n  const handlePickPhoto = async () => {\r\n    const permission = await ImagePicker.requestMediaLibraryPermissionsAsync();\r\n    if (!permission.granted) {\r\n      Alert.alert('Permiso requerido', 'Necesitamos acceso a las fotos');\r\n      return;\r\n    }\r\n\r\n    const result = await ImagePicker.launchImageLibraryAsync({\r\n      mediaTypes: ImagePicker.MediaTypeOptions.Images,\r\n      quality: 0.8,\r\n      allowsMultipleSelection: true,\r\n      selectionLimit: 5,\r\n    });\r\n\r\n    if (!result.canceled) {\r\n      setPhotos([...photos, ...result.assets.map((a) => a.uri)]);\r\n    }\r\n  };\r\n\r\n  const handleRemovePhoto = (index: number) => {\r\n    setPhotos(photos.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleSignatureEnd = () => {\r\n    signatureRef.current?.readSignature();\r\n  };\r\n\r\n  const handleSignatureOK = (sig: string) => {\r\n    setSignature(sig);\r\n  };\r\n\r\n  const handleClearSignature = () => {\r\n    signatureRef.current?.clearSignature();\r\n    setSignature(null);\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!id) return;\r\n\r\n    setIsSubmitting(true);\r\n    try {\r\n      // Get the job\r\n      const job = (await jobsCollection.find(id)) as Job;\r\n\r\n      // Build per-visit pricing data (Phase 1 - Jan 2026)\r\n      const visitPricing = job.isPerVisitPricing && visitActualPrice\r\n        ? {\r\n          actualPrice: parseFloat(visitActualPrice),\r\n          priceVarianceReason: priceVarianceReason || undefined,\r\n        }\r\n        : undefined;\r\n\r\n      // Complete the job with per-visit pricing\r\n      await job.completeJob(notes, materials, signature || undefined, visitPricing);\r\n\r\n      // Save photos to local database\r\n      await database.write(async () => {\r\n        for (const photoUri of photos) {\r\n          await jobPhotosCollection.create((photo: any) => {\r\n            photo.jobId = id;\r\n            photo.localUri = photoUri;\r\n            photo.type = 'after';\r\n            photo.uploaded = false;\r\n            photo.createdAt = new Date();\r\n          });\r\n        }\r\n      });\r\n\r\n      // Queue for sync - include per-visit pricing (Phase 1 - Jan 2026)\r\n      const syncPayload: Record<string, any> = {\r\n        status: 'completed',\r\n        completionNotes: notes,\r\n        materialsUsed: materials,\r\n        signatureUrl: signature,\r\n        actualEnd: Date.now(),\r\n      };\r\n\r\n      // Add per-visit pricing to sync payload\r\n      if (visitPricing) {\r\n        syncPayload.visitActualPrice = visitPricing.actualPrice;\r\n        syncPayload.priceVarianceReason = visitPricing.priceVarianceReason;\r\n      }\r\n\r\n      await enqueueOperation(\r\n        'job',\r\n        job.serverId,\r\n        'update',\r\n        syncPayload,\r\n        10 // High priority\r\n      );\r\n\r\n      Alert.alert('Trabajo completado', 'Los datos se sincronizar├ín cuando haya conexi├│n', [\r\n        { text: 'OK', onPress: () => router.back() },\r\n      ]);\r\n    } catch (error) {\r\n      Alert.alert('Error', 'No se pudo completar el trabajo');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const calculateTotal = () => {\r\n    const subtotal = materials.reduce((sum, m) => sum + m.quantity * m.price, 0);\r\n    const tax = subtotal * 0.21;\r\n    return { subtotal, tax, total: subtotal + tax };\r\n  };\r\n\r\n  const totals = calculateTotal();\r\n\r\n  const renderStepIndicator = () => (\r\n    <View style={styles.stepIndicator}>\r\n      {(['notes', 'photos', 'signature'] as Step[]).map((s, i) => (\r\n        <View key={s} style={styles.stepItem}>\r\n          <View\r\n            style={[\r\n              styles.stepDot,\r\n              step === s && styles.stepDotActive,\r\n              (['notes', 'photos', 'signature'].indexOf(step) > i) && styles.stepDotCompleted,\r\n            ]}\r\n          >\r\n            {['notes', 'photos', 'signature'].indexOf(step) > i ? (\r\n              <Feather name=\"check\" size={12} color=\"#fff\" />\r\n            ) : (\r\n              <Text style={[styles.stepNumber, step === s && styles.stepNumberActive]}>\r\n                {i + 1}\r\n              </Text>\r\n            )}\r\n          </View>\r\n          <Text style={[styles.stepLabel, step === s && styles.stepLabelActive]}>\r\n            {s === 'notes' && 'Notas'}\r\n            {s === 'photos' && 'Fotos'}\r\n            {s === 'signature' && 'Firma'}\r\n          </Text>\r\n        </View>\r\n      ))}\r\n    </View>\r\n  );\r\n\r\n  return (\r\n    <>\r\n      <Stack.Screen\r\n        options={{\r\n          headerTitle: 'Completar trabajo',\r\n          headerStyle: { backgroundColor: '#16a34a' },\r\n          headerTintColor: '#fff',\r\n        }}\r\n      />\r\n\r\n      <KeyboardAvoidingView\r\n        behavior={Platform.OS === 'ios' ? 'padding' : 'height'}\r\n        style={styles.container}\r\n      >\r\n        {renderStepIndicator()}\r\n\r\n        <ScrollView style={styles.content} contentContainerStyle={styles.scrollContent}>\r\n          {/* Step 1: Notes */}\r\n          {step === 'notes' && (\r\n            <View style={styles.stepContent}>\r\n              {/* Voice/Text Input Toggle */}\r\n              <View style={styles.inputModeToggle}>\r\n                <Text style={styles.sectionTitle}>Notas del trabajo</Text>\r\n                <TouchableOpacity\r\n                  style={[\r\n                    styles.voiceToggle,\r\n                    useVoiceInput && styles.voiceToggleActive,\r\n                  ]}\r\n                  onPress={() => setUseVoiceInput(!useVoiceInput)}\r\n                >\r\n                  <Feather\r\n                    name={useVoiceInput ? 'mic' : 'edit-3'}\r\n                    size={16}\r\n                    color={useVoiceInput ? '#16a34a' : '#6b7280'}\r\n                  />\r\n                  <Text\r\n                    style={[\r\n                      styles.voiceToggleText,\r\n                      useVoiceInput && styles.voiceToggleTextActive,\r\n                    ]}\r\n                  >\r\n                    {useVoiceInput ? 'Voz IA' : 'Texto'}\r\n                  </Text>\r\n                </TouchableOpacity>\r\n              </View>\r\n\r\n              {/* Voice Input Mode */}\r\n              {useVoiceInput ? (\r\n                <View style={styles.voiceInputContainer}>\r\n                  <Text style={styles.voiceHint}>\r\n                    Grab├í un mensaje describiendo el trabajo realizado, los materiales usados y el tiempo trabajado.\r\n                    La IA extraer├í los items autom├íticamente.\r\n                  </Text>\r\n\r\n                  {isExtractingInvoice ? (\r\n                    <View style={styles.extractingContainer}>\r\n                      <Feather name=\"loader\" size={24} color=\"#16a34a\" />\r\n                      <Text style={styles.extractingText}>\r\n                        Extrayendo datos con IA...\r\n                      </Text>\r\n                    </View>\r\n                  ) : (\r\n                    <VoiceInput\r\n                      onRecordingComplete={async (_uri: string, _duration: number) => {\r\n                        // Recording uploaded, waiting for transcription\r\n                      }}\r\n                      onTranscriptionComplete={handleVoiceInvoiceExtraction}\r\n                      maxDuration={180}\r\n                      showTranscription={true}\r\n                      placeholder=\"Manten├⌐ presionado para grabar reporte\"\r\n                    />\r\n                  )}\r\n\r\n                  {voiceTranscription && (\r\n                    <View style={styles.transcriptionPreview}>\r\n                      <Text style={styles.transcriptionLabel}>Transcripci├│n:</Text>\r\n                      <Text style={styles.transcriptionText}>{voiceTranscription}</Text>\r\n                    </View>\r\n                  )}\r\n                </View>\r\n              ) : (\r\n                /* Text Input Mode */\r\n                <TextInput\r\n                  style={styles.textArea}\r\n                  placeholder=\"Descripci├│n del trabajo realizado...\"\r\n                  placeholderTextColor=\"#9ca3af\"\r\n                  value={notes}\r\n                  onChangeText={setNotes}\r\n                  multiline\r\n                  numberOfLines={4}\r\n                />\r\n              )}\r\n\r\n              <Text style={styles.sectionTitle}>Materiales utilizados</Text>\r\n              {materials.map((material, index) => (\r\n                <View key={index} style={styles.materialItem}>\r\n                  <View style={styles.materialInfo}>\r\n                    <Text style={styles.materialName}>{material.name}</Text>\r\n                    <Text style={styles.materialDetails}>\r\n                      {material.quantity} x ${material.price.toLocaleString('es-AR')}\r\n                    </Text>\r\n                  </View>\r\n                  <Text style={styles.materialTotal}>\r\n                    ${(material.quantity * material.price).toLocaleString('es-AR')}\r\n                  </Text>\r\n                  <TouchableOpacity onPress={() => handleRemoveMaterial(index)}>\r\n                    <Feather name=\"x\" size={20} color=\"#ef4444\" />\r\n                  </TouchableOpacity>\r\n                </View>\r\n              ))}\r\n\r\n              <View style={styles.addMaterialForm}>\r\n                <TextInput\r\n                  style={styles.materialInput}\r\n                  placeholder=\"Material\"\r\n                  placeholderTextColor=\"#9ca3af\"\r\n                  value={newMaterial.name}\r\n                  onChangeText={(text) => setNewMaterial({ ...newMaterial, name: text })}\r\n                />\r\n                <TextInput\r\n                  style={[styles.materialInput, styles.smallInput]}\r\n                  placeholder=\"Cant\"\r\n                  placeholderTextColor=\"#9ca3af\"\r\n                  value={newMaterial.quantity}\r\n                  onChangeText={(text) => setNewMaterial({ ...newMaterial, quantity: text })}\r\n                  keyboardType=\"numeric\"\r\n                />\r\n                <TextInput\r\n                  style={[styles.materialInput, styles.smallInput]}\r\n                  placeholder=\"Precio\"\r\n                  placeholderTextColor=\"#9ca3af\"\r\n                  value={newMaterial.price}\r\n                  onChangeText={(text) => setNewMaterial({ ...newMaterial, price: text })}\r\n                  keyboardType=\"decimal-pad\"\r\n                />\r\n                <TouchableOpacity style={styles.addButton} onPress={handleAddMaterial}>\r\n                  <Feather name=\"plus\" size={20} color=\"#16a34a\" />\r\n                </TouchableOpacity>\r\n              </View>\r\n\r\n              {materials.length > 0 && (\r\n                <View style={styles.totals}>\r\n                  <View style={styles.totalRow}>\r\n                    <Text style={styles.totalLabel}>Subtotal</Text>\r\n                    <Text style={styles.totalValue}>\r\n                      ${totals.subtotal.toLocaleString('es-AR')}\r\n                    </Text>\r\n                  </View>\r\n                  <View style={styles.totalRow}>\r\n                    <Text style={styles.totalLabel}>IVA (21%)</Text>\r\n                    <Text style={styles.totalValue}>\r\n                      ${totals.tax.toLocaleString('es-AR')}\r\n                    </Text>\r\n                  </View>\r\n                  <View style={[styles.totalRow, styles.grandTotal]}>\r\n                    <Text style={styles.grandTotalLabel}>Total</Text>\r\n                    <Text style={styles.grandTotalValue}>\r\n                      ${totals.total.toLocaleString('es-AR')}\r\n                    </Text>\r\n                  </View>\r\n                </View>\r\n              )}\r\n\r\n              {/* Per-Visit Pricing Section (Phase 1 - Jan 2026) */}\r\n              {jobPricingMode && jobPricingMode !== 'FIXED_TOTAL' && (\r\n                <View style={styles.pricingSection}>\r\n                  <Text style={styles.sectionTitle}>Precio de esta visita</Text>\r\n\r\n                  <View style={styles.priceRow}>\r\n                    <Text style={styles.priceLabel}>Estimado:</Text>\r\n                    <Text style={styles.priceValue}>\r\n                      ${visitEstimatedPrice?.toLocaleString('es-AR') ?? '-'}\r\n                    </Text>\r\n                  </View>\r\n\r\n                  <View style={styles.priceRow}>\r\n                    <Text style={styles.priceLabel}>Precio real:</Text>\r\n                    <TextInput\r\n                      value={visitActualPrice}\r\n                      onChangeText={setVisitActualPrice}\r\n                      keyboardType=\"decimal-pad\"\r\n                      placeholder={visitEstimatedPrice?.toString() ?? '0'}\r\n                      placeholderTextColor=\"#9ca3af\"\r\n                      style={styles.priceInput}\r\n                    />\r\n                  </View>\r\n\r\n                  {visitActualPrice &&\r\n                    visitEstimatedPrice !== null &&\r\n                    parseFloat(visitActualPrice) !== visitEstimatedPrice && (\r\n                      <View style={styles.varianceSection}>\r\n                        <Text style={styles.varianceLabel}>\r\n                          ┬┐Por qu├⌐ cambi├│ el precio?\r\n                        </Text>\r\n                        <TextInput\r\n                          value={priceVarianceReason}\r\n                          onChangeText={setPriceVarianceReason}\r\n                          placeholder=\"Ej: Materiales adicionales, mayor complejidad...\"\r\n                          placeholderTextColor=\"#9ca3af\"\r\n                          multiline\r\n                          style={styles.reasonInput}\r\n                        />\r\n                        {Math.abs(parseFloat(visitActualPrice) - visitEstimatedPrice) / visitEstimatedPrice > 0.1 && (\r\n                          <Text style={styles.varianceWarning}>\r\n                            ΓÜá∩╕Å Variaci├│n mayor al 10% requiere justificaci├│n\r\n                          </Text>\r\n                        )}\r\n                      </View>\r\n                    )}\r\n                </View>\r\n              )}\r\n            </View>\r\n          )}\r\n\r\n          {/* Step 2: Photos */}\r\n          {step === 'photos' && (\r\n            <View style={styles.stepContent}>\r\n              <Text style={styles.sectionTitle}>Fotos del trabajo</Text>\r\n              <Text style={styles.hint}>\r\n                Tom├í fotos del trabajo completado para documentaci├│n\r\n              </Text>\r\n\r\n              <View style={styles.photoGrid}>\r\n                {photos.map((uri, index) => (\r\n                  <View key={index} style={styles.photoItem}>\r\n                    <Image source={{ uri }} style={styles.photo} />\r\n                    <TouchableOpacity\r\n                      style={styles.removePhoto}\r\n                      onPress={() => handleRemovePhoto(index)}\r\n                    >\r\n                      <Feather name=\"x\" size={16} color=\"#fff\" />\r\n                    </TouchableOpacity>\r\n                  </View>\r\n                ))}\r\n                {photos.length < 5 && (\r\n                  <View style={styles.addPhotoButtons}>\r\n                    <TouchableOpacity style={styles.addPhotoButton} onPress={handleTakePhoto}>\r\n                      <Feather name=\"camera\" size={24} color=\"#6b7280\" />\r\n                      <Text style={styles.addPhotoText}>C├ímara</Text>\r\n                    </TouchableOpacity>\r\n                    <TouchableOpacity style={styles.addPhotoButton} onPress={handlePickPhoto}>\r\n                      <Feather name=\"image\" size={24} color=\"#6b7280\" />\r\n                      <Text style={styles.addPhotoText}>Galer├¡a</Text>\r\n                    </TouchableOpacity>\r\n                  </View>\r\n                )}\r\n              </View>\r\n            </View>\r\n          )}\r\n\r\n          {/* Step 3: Signature */}\r\n          {step === 'signature' && (\r\n            <View style={styles.stepContent}>\r\n              <Text style={styles.sectionTitle}>Firma del cliente</Text>\r\n              <Text style={styles.hint}>\r\n                Ped├¡ al cliente que firme para confirmar la finalizaci├│n del trabajo\r\n              </Text>\r\n\r\n              <View style={styles.signatureContainer}>\r\n                <SignatureCanvas\r\n                  ref={signatureRef}\r\n                  onOK={handleSignatureOK}\r\n                  onEnd={handleSignatureEnd}\r\n                  webStyle={`\r\n                    .m-signature-pad {\r\n                      box-shadow: none;\r\n                      border: 1px solid #e5e7eb;\r\n                      border-radius: 12px;\r\n                    }\r\n                    .m-signature-pad--body {\r\n                      border: none;\r\n                    }\r\n                  `}\r\n                  descriptionText=\"\"\r\n                  clearText=\"Borrar\"\r\n                  confirmText=\"Guardar\"\r\n                  backgroundColor=\"#fff\"\r\n                  penColor=\"#111827\"\r\n                />\r\n              </View>\r\n\r\n              <TouchableOpacity style={styles.clearSignature} onPress={handleClearSignature}>\r\n                <Feather name=\"trash-2\" size={16} color=\"#ef4444\" />\r\n                <Text style={styles.clearSignatureText}>Borrar firma</Text>\r\n              </TouchableOpacity>\r\n            </View>\r\n          )}\r\n        </ScrollView>\r\n\r\n        {/* Navigation buttons */}\r\n        <View style={styles.footer}>\r\n          {step !== 'notes' && (\r\n            <TouchableOpacity\r\n              style={styles.backButton}\r\n              onPress={() =>\r\n                setStep(step === 'signature' ? 'photos' : 'notes')\r\n              }\r\n            >\r\n              <Feather name=\"arrow-left\" size={20} color=\"#6b7280\" />\r\n              <Text style={styles.backButtonText}>Anterior</Text>\r\n            </TouchableOpacity>\r\n          )}\r\n\r\n          <TouchableOpacity\r\n            style={[\r\n              styles.nextButton,\r\n              step === 'notes' && styles.nextButtonFull,\r\n              isSubmitting && styles.buttonDisabled,\r\n            ]}\r\n            onPress={() => {\r\n              if (step === 'notes') setStep('photos');\r\n              else if (step === 'photos') setStep('signature');\r\n              else handleSubmit();\r\n            }}\r\n            disabled={isSubmitting}\r\n          >\r\n            <Text style={styles.nextButtonText}>\r\n              {step === 'signature' ? 'Completar trabajo' : 'Siguiente'}\r\n            </Text>\r\n            <Feather\r\n              name={step === 'signature' ? 'check' : 'arrow-right'}\r\n              size={20}\r\n              color=\"#fff\"\r\n            />\r\n          </TouchableOpacity>\r\n        </View>\r\n      </KeyboardAvoidingView>\r\n    </>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  stepIndicator: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    gap: 32,\r\n    paddingVertical: 16,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  stepItem: {\r\n    alignItems: 'center',\r\n    gap: 4,\r\n  },\r\n  stepDot: {\r\n    width: 28,\r\n    height: 28,\r\n    borderRadius: 14,\r\n    backgroundColor: '#e5e7eb',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  stepDotActive: {\r\n    backgroundColor: '#16a34a',\r\n  },\r\n  stepDotCompleted: {\r\n    backgroundColor: '#16a34a',\r\n  },\r\n  stepNumber: {\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n    color: '#6b7280',\r\n  },\r\n  stepNumberActive: {\r\n    color: '#fff',\r\n  },\r\n  stepLabel: {\r\n    fontSize: 12,\r\n    color: '#9ca3af',\r\n  },\r\n  stepLabelActive: {\r\n    color: '#16a34a',\r\n    fontWeight: '500',\r\n  },\r\n  content: {\r\n    flex: 1,\r\n  },\r\n  scrollContent: {\r\n    padding: 16,\r\n    paddingBottom: 100,\r\n  },\r\n  stepContent: {},\r\n  sectionTitle: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginBottom: 8,\r\n  },\r\n  hint: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginBottom: 16,\r\n  },\r\n  textArea: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    padding: 16,\r\n    fontSize: 16,\r\n    color: '#111827',\r\n    minHeight: 100,\r\n    textAlignVertical: 'top',\r\n    marginBottom: 24,\r\n  },\r\n  materialItem: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    padding: 12,\r\n    borderRadius: 8,\r\n    marginBottom: 8,\r\n  },\r\n  materialInfo: {\r\n    flex: 1,\r\n  },\r\n  materialName: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  materialDetails: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n  },\r\n  materialTotal: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#16a34a',\r\n    marginRight: 12,\r\n  },\r\n  addMaterialForm: {\r\n    flexDirection: 'row',\r\n    gap: 8,\r\n    marginTop: 8,\r\n  },\r\n  materialInput: {\r\n    flex: 1,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 8,\r\n    padding: 12,\r\n    fontSize: 14,\r\n    color: '#111827',\r\n  },\r\n  smallInput: {\r\n    flex: 0.3,\r\n  },\r\n  addButton: {\r\n    backgroundColor: '#f0fdf4',\r\n    padding: 12,\r\n    borderRadius: 8,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  totals: {\r\n    marginTop: 16,\r\n    padding: 16,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n  },\r\n  totalRow: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    marginBottom: 8,\r\n  },\r\n  totalLabel: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n  },\r\n  totalValue: {\r\n    fontSize: 14,\r\n    color: '#374151',\r\n  },\r\n  grandTotal: {\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#e5e7eb',\r\n    paddingTop: 12,\r\n    marginTop: 4,\r\n  },\r\n  grandTotalLabel: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  grandTotalValue: {\r\n    fontSize: 18,\r\n    fontWeight: '700',\r\n    color: '#16a34a',\r\n  },\r\n  photoGrid: {\r\n    flexDirection: 'row',\r\n    flexWrap: 'wrap',\r\n    gap: 12,\r\n  },\r\n  photoItem: {\r\n    position: 'relative',\r\n    width: '30%',\r\n    aspectRatio: 1,\r\n  },\r\n  photo: {\r\n    width: '100%',\r\n    height: '100%',\r\n    borderRadius: 12,\r\n  },\r\n  removePhoto: {\r\n    position: 'absolute',\r\n    top: -8,\r\n    right: -8,\r\n    backgroundColor: '#ef4444',\r\n    borderRadius: 12,\r\n    padding: 4,\r\n  },\r\n  addPhotoButtons: {\r\n    flexDirection: 'row',\r\n    gap: 12,\r\n  },\r\n  addPhotoButton: {\r\n    width: 100,\r\n    aspectRatio: 1,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    borderWidth: 2,\r\n    borderColor: '#e5e7eb',\r\n    borderStyle: 'dashed',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  addPhotoText: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n  },\r\n  signatureContainer: {\r\n    height: 300,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    overflow: 'hidden',\r\n  },\r\n  clearSignature: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    marginTop: 16,\r\n    padding: 12,\r\n  },\r\n  clearSignatureText: {\r\n    fontSize: 14,\r\n    color: '#ef4444',\r\n  },\r\n  footer: {\r\n    flexDirection: 'row',\r\n    padding: 16,\r\n    paddingBottom: 32,\r\n    backgroundColor: '#fff',\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#e5e7eb',\r\n    gap: 12,\r\n  },\r\n  backButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    paddingVertical: 16,\r\n    paddingHorizontal: 24,\r\n    borderRadius: 12,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  backButtonText: {\r\n    fontSize: 16,\r\n    fontWeight: '500',\r\n    color: '#6b7280',\r\n  },\r\n  nextButton: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    paddingVertical: 16,\r\n    backgroundColor: '#16a34a',\r\n    borderRadius: 12,\r\n  },\r\n  nextButtonFull: {\r\n    flex: 1,\r\n  },\r\n  nextButtonText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  buttonDisabled: {\r\n    opacity: 0.7,\r\n  },\r\n  // Voice-to-Invoice styles\r\n  inputModeToggle: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    marginBottom: 8,\r\n  },\r\n  voiceToggle: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 6,\r\n    borderRadius: 16,\r\n    backgroundColor: '#f3f4f6',\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  voiceToggleActive: {\r\n    backgroundColor: '#dcfce7',\r\n    borderColor: '#16a34a',\r\n  },\r\n  voiceToggleText: {\r\n    fontSize: 12,\r\n    fontWeight: '500',\r\n    color: '#6b7280',\r\n  },\r\n  voiceToggleTextActive: {\r\n    color: '#16a34a',\r\n  },\r\n  voiceInputContainer: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    padding: 16,\r\n    marginBottom: 24,\r\n  },\r\n  voiceHint: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginBottom: 16,\r\n    lineHeight: 20,\r\n  },\r\n  extractingContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 12,\r\n    paddingVertical: 24,\r\n  },\r\n  extractingText: {\r\n    fontSize: 14,\r\n    color: '#16a34a',\r\n    fontWeight: '500',\r\n  },\r\n  transcriptionPreview: {\r\n    marginTop: 16,\r\n    padding: 12,\r\n    backgroundColor: '#f9fafb',\r\n    borderRadius: 8,\r\n  },\r\n  transcriptionLabel: {\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n    color: '#6b7280',\r\n    marginBottom: 4,\r\n  },\r\n  transcriptionText: {\r\n    fontSize: 14,\r\n    color: '#374151',\r\n    fontStyle: 'italic',\r\n    lineHeight: 20,\r\n  },\r\n  // Per-visit pricing styles (Phase 1 - Jan 2026)\r\n  pricingSection: {\r\n    marginTop: 24,\r\n    padding: 16,\r\n    backgroundColor: '#ecfdf5',\r\n    borderRadius: 12,\r\n    borderWidth: 1,\r\n    borderColor: '#a7f3d0',\r\n  },\r\n  priceRow: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    marginBottom: 12,\r\n  },\r\n  priceLabel: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#374151',\r\n  },\r\n  priceValue: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#16a34a',\r\n  },\r\n  priceInput: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 8,\r\n    padding: 10,\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    borderWidth: 1,\r\n    borderColor: '#d1d5db',\r\n    minWidth: 120,\r\n    textAlign: 'right',\r\n  },\r\n  varianceSection: {\r\n    marginTop: 8,\r\n    paddingTop: 12,\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#a7f3d0',\r\n  },\r\n  varianceLabel: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#374151',\r\n    marginBottom: 8,\r\n  },\r\n  reasonInput: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 8,\r\n    padding: 12,\r\n    fontSize: 14,\r\n    color: '#111827',\r\n    borderWidth: 1,\r\n    borderColor: '#d1d5db',\r\n    minHeight: 60,\r\n    textAlignVertical: 'top',\r\n  },\r\n  varianceWarning: {\r\n    marginTop: 8,\r\n    fontSize: 12,\r\n    color: '#d97706',\r\n    fontWeight: '500',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\jobs\\index.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":24,"column":25,"nodeType":"Literal","endLine":24,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":47,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":95,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":95,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Jobs Management Screen (Dispatcher/Owner)\r\n * ==========================================\r\n *\r\n * Phase 2.4.1: Job Management Screen\r\n * Shows all jobs with filtering by status, date, and technician.\r\n * Supports job creation and assignment.\r\n */\r\n\r\nimport { useState, useCallback, useMemo } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  RefreshControl,\r\n  TouchableOpacity,\r\n  TextInput,\r\n  Modal,\r\n  ScrollView,\r\n  Alert,\r\n} from 'react-native';\r\nimport { FlashList } from '@shopify/flash-list';\r\nimport { useRouter } from 'expo-router';\r\nimport { Feather } from '@expo/vector-icons';\r\nimport { withObservables } from '@nozbe/watermelondb/react';\r\nimport { Q } from '@nozbe/watermelondb';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\n\r\nimport { jobsCollection, database } from '../../../watermelon/database';\r\nimport { Job } from '../../../watermelon/models';\r\nimport { performSync, enqueueOperation } from '../../../lib/sync/sync-engine';\r\nimport { useSyncStatus } from '../../../lib/hooks/use-sync-status';\r\nimport { useAuth } from '../../../lib/auth/auth-context';\r\nimport JobCard from '../../../components/job/JobCard';\r\n\r\ntype StatusFilter = 'all' | 'pending' | 'active' | 'completed' | 'unassigned';\r\n\r\n// Mock technicians - in production from API\r\nconst MOCK_TECHNICIANS = [\r\n  { id: 'tech-1', name: 'Carlos Rodriguez' },\r\n  { id: 'tech-2', name: 'Mar├¡a Garc├¡a' },\r\n  { id: 'tech-3', name: 'Juan P├⌐rez' },\r\n];\r\n\r\nfunction JobsManagementScreen({ jobs }: { jobs: Job[] }) {\r\n  const router = useRouter();\r\n  const { user } = useAuth();\r\n  const syncStatus = useSyncStatus();\r\n  const isSyncing = syncStatus.isSyncing;\r\n  const [search, setSearch] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState<StatusFilter>('all');\r\n  const [technicianFilter, setTechnicianFilter] = useState<string | null>(null);\r\n  const [showTechnicianPicker, setShowTechnicianPicker] = useState(false);\r\n  const [showAssignModal, setShowAssignModal] = useState(false);\r\n  const [selectedJobId, setSelectedJobId] = useState<string | null>(null);\r\n\r\n  const handleRefresh = useCallback(async () => {\r\n    await performSync();\r\n  }, []);\r\n\r\n  const handleJobPress = useCallback(\r\n    (job: Job) => {\r\n      router.push(`/(tabs)/jobs/${job.id}`);\r\n    },\r\n    [router]\r\n  );\r\n\r\n  const handleCreateJob = useCallback(() => {\r\n    router.push('/(tabs)/jobs/create');\r\n  }, [router]);\r\n\r\n  const handleAssignJob = useCallback((jobId: string) => {\r\n    setSelectedJobId(jobId);\r\n    setShowAssignModal(true);\r\n  }, []);\r\n\r\n  const handleConfirmAssign = useCallback(\r\n    async (technicianId: string, technicianName: string) => {\r\n      if (!selectedJobId) return;\r\n\r\n      try {\r\n        const job = await jobsCollection.find(selectedJobId);\r\n        await database.write(async () => {\r\n          await job.update((j: any) => {\r\n            j.assignedToId = technicianId;\r\n            j.isDirty = true;\r\n          });\r\n        });\r\n\r\n        await enqueueOperation('job', (job as Job).serverId, 'update', {\r\n          assignedToId: technicianId,\r\n        });\r\n\r\n        Alert.alert('Asignado', `Trabajo asignado a ${technicianName}`);\r\n      } catch (error) {\r\n        Alert.alert('Error', 'No se pudo asignar el trabajo');\r\n      } finally {\r\n        setShowAssignModal(false);\r\n        setSelectedJobId(null);\r\n      }\r\n    },\r\n    [selectedJobId]\r\n  );\r\n\r\n  const filteredJobs = useMemo(() => {\r\n    return jobs.filter((job) => {\r\n      // Status filter\r\n      if (statusFilter === 'pending' && job.status !== 'pending' && job.status !== 'scheduled') {\r\n        return false;\r\n      }\r\n      if (statusFilter === 'active' && job.status !== 'en_camino' && job.status !== 'working') {\r\n        return false;\r\n      }\r\n      if (statusFilter === 'completed' && job.status !== 'completed') {\r\n        return false;\r\n      }\r\n      if (statusFilter === 'unassigned' && job.assignedToId) {\r\n        return false;\r\n      }\r\n\r\n      // Technician filter\r\n      if (technicianFilter && job.assignedToId !== technicianFilter) {\r\n        return false;\r\n      }\r\n\r\n      // Search filter\r\n      if (search) {\r\n        const query = search.toLowerCase();\r\n        return (\r\n          job.serviceType.toLowerCase().includes(query) ||\r\n          job.address.toLowerCase().includes(query)\r\n        );\r\n      }\r\n\r\n      return true;\r\n    });\r\n  }, [jobs, statusFilter, technicianFilter, search]);\r\n\r\n  const counts = useMemo(\r\n    () => ({\r\n      all: jobs.length,\r\n      pending: jobs.filter((j) => j.status === 'pending' || j.status === 'scheduled').length,\r\n      active: jobs.filter((j) => j.status === 'en_camino' || j.status === 'working').length,\r\n      completed: jobs.filter((j) => j.status === 'completed').length,\r\n      unassigned: jobs.filter((j) => !j.assignedToId).length,\r\n    }),\r\n    [jobs]\r\n  );\r\n\r\n  const FilterButton = ({\r\n    label,\r\n    value,\r\n    count,\r\n    warning,\r\n  }: {\r\n    label: string;\r\n    value: StatusFilter;\r\n    count: number;\r\n    warning?: boolean;\r\n  }) => (\r\n    <TouchableOpacity\r\n      style={[styles.filterButton, statusFilter === value && styles.filterButtonActive]}\r\n      onPress={() => setStatusFilter(value)}\r\n    >\r\n      <Text\r\n        style={[\r\n          styles.filterButtonText,\r\n          statusFilter === value && styles.filterButtonTextActive,\r\n        ]}\r\n      >\r\n        {label}\r\n      </Text>\r\n      <View\r\n        style={[\r\n          styles.filterBadge,\r\n          statusFilter === value && styles.filterBadgeActive,\r\n          warning && count > 0 && styles.filterBadgeWarning,\r\n        ]}\r\n      >\r\n        <Text\r\n          style={[\r\n            styles.filterBadgeText,\r\n            statusFilter === value && styles.filterBadgeTextActive,\r\n            warning && count > 0 && styles.filterBadgeTextWarning,\r\n          ]}\r\n        >\r\n          {count}\r\n        </Text>\r\n      </View>\r\n    </TouchableOpacity>\r\n  );\r\n\r\n  const selectedTechnician = MOCK_TECHNICIANS.find((t) => t.id === technicianFilter);\r\n\r\n  return (\r\n    <SafeAreaView style={styles.container} edges={[]}>\r\n      {/* Header with create button */}\r\n      <View style={styles.header}>\r\n        <Text style={styles.headerTitle}>Gesti├│n de Trabajos</Text>\r\n        <TouchableOpacity style={styles.createButton} onPress={handleCreateJob}>\r\n          <Feather name=\"plus\" size={20} color=\"#fff\" />\r\n          <Text style={styles.createButtonText}>Nuevo</Text>\r\n        </TouchableOpacity>\r\n      </View>\r\n\r\n      {/* Search bar */}\r\n      <View style={styles.searchContainer}>\r\n        <Feather name=\"search\" size={18} color=\"#9ca3af\" />\r\n        <TextInput\r\n          style={styles.searchInput}\r\n          placeholder=\"Buscar trabajos...\"\r\n          placeholderTextColor=\"#9ca3af\"\r\n          value={search}\r\n          onChangeText={setSearch}\r\n        />\r\n        {search ? (\r\n          <TouchableOpacity onPress={() => setSearch('')}>\r\n            <Feather name=\"x\" size={18} color=\"#9ca3af\" />\r\n          </TouchableOpacity>\r\n        ) : null}\r\n      </View>\r\n\r\n      {/* Technician filter */}\r\n      <TouchableOpacity\r\n        style={styles.technicianFilter}\r\n        onPress={() => setShowTechnicianPicker(true)}\r\n      >\r\n        <Feather name=\"user\" size={16} color=\"#6b7280\" />\r\n        <Text style={styles.technicianFilterText}>\r\n          {selectedTechnician ? selectedTechnician.name : 'Todos los t├⌐cnicos'}\r\n        </Text>\r\n        <Feather name=\"chevron-down\" size={16} color=\"#6b7280\" />\r\n        {technicianFilter && (\r\n          <TouchableOpacity\r\n            style={styles.clearTechFilter}\r\n            onPress={() => setTechnicianFilter(null)}\r\n          >\r\n            <Feather name=\"x\" size={14} color=\"#6b7280\" />\r\n          </TouchableOpacity>\r\n        )}\r\n      </TouchableOpacity>\r\n\r\n      {/* Filter tabs */}\r\n      <ScrollView\r\n        horizontal\r\n        showsHorizontalScrollIndicator={false}\r\n        style={styles.filterScrollView}\r\n        contentContainerStyle={styles.filterContainer}\r\n      >\r\n        <FilterButton label=\"Todos\" value=\"all\" count={counts.all} />\r\n        <FilterButton label=\"Pendientes\" value=\"pending\" count={counts.pending} />\r\n        <FilterButton label=\"Activos\" value=\"active\" count={counts.active} />\r\n        <FilterButton label=\"Completados\" value=\"completed\" count={counts.completed} />\r\n        <FilterButton label=\"Sin asignar\" value=\"unassigned\" count={counts.unassigned} warning />\r\n      </ScrollView>\r\n\r\n      {/* Jobs list */}\r\n      <FlashList\r\n        data={filteredJobs}\r\n        renderItem={({ item }) => (\r\n          <View style={styles.jobCardContainer}>\r\n            <JobCard job={item} onPress={() => handleJobPress(item)} />\r\n            {!item.assignedToId && (\r\n              <TouchableOpacity\r\n                style={styles.assignButton}\r\n                onPress={() => handleAssignJob(item.id)}\r\n              >\r\n                <Feather name=\"user-plus\" size={14} color=\"#f59e0b\" />\r\n                <Text style={styles.assignButtonText}>Asignar</Text>\r\n              </TouchableOpacity>\r\n            )}\r\n          </View>\r\n        )}\r\n        refreshControl={\r\n          <RefreshControl\r\n            refreshing={isSyncing}\r\n            onRefresh={handleRefresh}\r\n            colors={['#16a34a']}\r\n            tintColor=\"#16a34a\"\r\n          />\r\n        }\r\n        ListEmptyComponent={\r\n          <View style={styles.empty}>\r\n            <Feather name=\"inbox\" size={48} color=\"#d1d5db\" />\r\n            <Text style={styles.emptyText}>No hay trabajos</Text>\r\n            <TouchableOpacity style={styles.emptyButton} onPress={handleCreateJob}>\r\n              <Feather name=\"plus\" size={16} color=\"#fff\" />\r\n              <Text style={styles.emptyButtonText}>Crear trabajo</Text>\r\n            </TouchableOpacity>\r\n          </View>\r\n        }\r\n        contentContainerStyle={styles.listContent}\r\n      />\r\n\r\n      {/* Technician Picker Modal */}\r\n      <Modal\r\n        visible={showTechnicianPicker}\r\n        transparent\r\n        animationType=\"fade\"\r\n        onRequestClose={() => setShowTechnicianPicker(false)}\r\n      >\r\n        <TouchableOpacity\r\n          style={styles.modalOverlay}\r\n          activeOpacity={1}\r\n          onPress={() => setShowTechnicianPicker(false)}\r\n        >\r\n          <View style={styles.pickerModal}>\r\n            <Text style={styles.pickerTitle}>Filtrar por t├⌐cnico</Text>\r\n            <TouchableOpacity\r\n              style={styles.pickerOption}\r\n              onPress={() => {\r\n                setTechnicianFilter(null);\r\n                setShowTechnicianPicker(false);\r\n              }}\r\n            >\r\n              <Text style={styles.pickerOptionText}>Todos los t├⌐cnicos</Text>\r\n              {!technicianFilter && <Feather name=\"check\" size={18} color=\"#16a34a\" />}\r\n            </TouchableOpacity>\r\n            {MOCK_TECHNICIANS.map((tech) => (\r\n              <TouchableOpacity\r\n                key={tech.id}\r\n                style={styles.pickerOption}\r\n                onPress={() => {\r\n                  setTechnicianFilter(tech.id);\r\n                  setShowTechnicianPicker(false);\r\n                }}\r\n              >\r\n                <Text style={styles.pickerOptionText}>{tech.name}</Text>\r\n                {technicianFilter === tech.id && (\r\n                  <Feather name=\"check\" size={18} color=\"#16a34a\" />\r\n                )}\r\n              </TouchableOpacity>\r\n            ))}\r\n          </View>\r\n        </TouchableOpacity>\r\n      </Modal>\r\n\r\n      {/* Assign Job Modal */}\r\n      <Modal\r\n        visible={showAssignModal}\r\n        transparent\r\n        animationType=\"slide\"\r\n        onRequestClose={() => setShowAssignModal(false)}\r\n      >\r\n        <View style={styles.modalOverlay}>\r\n          <View style={styles.assignModal}>\r\n            <View style={styles.assignModalHeader}>\r\n              <Text style={styles.assignModalTitle}>Asignar trabajo</Text>\r\n              <TouchableOpacity onPress={() => setShowAssignModal(false)}>\r\n                <Feather name=\"x\" size={24} color=\"#6b7280\" />\r\n              </TouchableOpacity>\r\n            </View>\r\n            <Text style={styles.assignModalSubtitle}>\r\n              Seleccion├í un t├⌐cnico para este trabajo\r\n            </Text>\r\n            {MOCK_TECHNICIANS.map((tech) => (\r\n              <TouchableOpacity\r\n                key={tech.id}\r\n                style={styles.technicianOption}\r\n                onPress={() => handleConfirmAssign(tech.id, tech.name)}\r\n              >\r\n                <View style={styles.technicianAvatar}>\r\n                  <Text style={styles.technicianAvatarText}>\r\n                    {tech.name.charAt(0).toUpperCase()}\r\n                  </Text>\r\n                </View>\r\n                <Text style={styles.technicianName}>{tech.name}</Text>\r\n                <Feather name=\"chevron-right\" size={20} color=\"#9ca3af\" />\r\n              </TouchableOpacity>\r\n            ))}\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\n// Observe jobs from WatermelonDB\r\nconst enhance = withObservables([], () => ({\r\n  jobs: jobsCollection.query(Q.sortBy('scheduled_start', Q.desc)),\r\n}));\r\n\r\nexport default enhance(JobsManagementScreen);\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  headerTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  createButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n    backgroundColor: '#16a34a',\r\n    paddingHorizontal: 14,\r\n    paddingVertical: 8,\r\n    borderRadius: 8,\r\n  },\r\n  createButtonText: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  searchContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    marginHorizontal: 16,\r\n    marginTop: 12,\r\n    paddingHorizontal: 12,\r\n    borderRadius: 12,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  searchInput: {\r\n    flex: 1,\r\n    paddingVertical: 12,\r\n    paddingHorizontal: 8,\r\n    fontSize: 16,\r\n    color: '#111827',\r\n  },\r\n  technicianFilter: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n    marginHorizontal: 16,\r\n    marginTop: 12,\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 10,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 10,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  technicianFilterText: {\r\n    flex: 1,\r\n    fontSize: 14,\r\n    color: '#374151',\r\n  },\r\n  clearTechFilter: {\r\n    padding: 4,\r\n  },\r\n  filterScrollView: {\r\n    maxHeight: 50,\r\n    marginTop: 12,\r\n  },\r\n  filterContainer: {\r\n    flexDirection: 'row',\r\n    paddingHorizontal: 16,\r\n    gap: 8,\r\n  },\r\n  filterButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n    paddingVertical: 8,\r\n    paddingHorizontal: 12,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 20,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  filterButtonActive: {\r\n    backgroundColor: '#16a34a',\r\n    borderColor: '#16a34a',\r\n  },\r\n  filterButtonText: {\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n    color: '#6b7280',\r\n  },\r\n  filterButtonTextActive: {\r\n    color: '#fff',\r\n  },\r\n  filterBadge: {\r\n    minWidth: 22,\r\n    height: 22,\r\n    borderRadius: 11,\r\n    backgroundColor: '#f3f4f6',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    paddingHorizontal: 6,\r\n  },\r\n  filterBadgeActive: {\r\n    backgroundColor: 'rgba(255,255,255,0.25)',\r\n  },\r\n  filterBadgeWarning: {\r\n    backgroundColor: '#fef3c7',\r\n  },\r\n  filterBadgeText: {\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n    color: '#6b7280',\r\n  },\r\n  filterBadgeTextActive: {\r\n    color: '#fff',\r\n  },\r\n  filterBadgeTextWarning: {\r\n    color: '#b45309',\r\n  },\r\n  jobCardContainer: {\r\n    position: 'relative',\r\n  },\r\n  assignButton: {\r\n    position: 'absolute',\r\n    top: 12,\r\n    right: 28,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n    backgroundColor: '#fffbeb',\r\n    paddingHorizontal: 10,\r\n    paddingVertical: 6,\r\n    borderRadius: 6,\r\n    borderWidth: 1,\r\n    borderColor: '#fde68a',\r\n  },\r\n  assignButtonText: {\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n    color: '#b45309',\r\n  },\r\n  listContent: {\r\n    paddingTop: 12,\r\n    paddingBottom: 100,\r\n  },\r\n  empty: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    paddingVertical: 64,\r\n  },\r\n  emptyText: {\r\n    fontSize: 16,\r\n    color: '#6b7280',\r\n    marginTop: 16,\r\n  },\r\n  emptyButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n    backgroundColor: '#16a34a',\r\n    paddingHorizontal: 20,\r\n    paddingVertical: 12,\r\n    borderRadius: 8,\r\n    marginTop: 20,\r\n  },\r\n  emptyButtonText: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  // Modals\r\n  modalOverlay: {\r\n    flex: 1,\r\n    backgroundColor: 'rgba(0,0,0,0.5)',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  pickerModal: {\r\n    width: '80%',\r\n    backgroundColor: '#fff',\r\n    borderRadius: 16,\r\n    padding: 20,\r\n  },\r\n  pickerTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginBottom: 16,\r\n  },\r\n  pickerOption: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingVertical: 14,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#f3f4f6',\r\n  },\r\n  pickerOptionText: {\r\n    fontSize: 16,\r\n    color: '#374151',\r\n  },\r\n  assignModal: {\r\n    width: '90%',\r\n    backgroundColor: '#fff',\r\n    borderRadius: 16,\r\n    padding: 20,\r\n  },\r\n  assignModalHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    marginBottom: 8,\r\n  },\r\n  assignModalTitle: {\r\n    fontSize: 20,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  assignModalSubtitle: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginBottom: 20,\r\n  },\r\n  technicianOption: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    paddingVertical: 14,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#f3f4f6',\r\n  },\r\n  technicianAvatar: {\r\n    width: 44,\r\n    height: 44,\r\n    borderRadius: 22,\r\n    backgroundColor: '#e5e7eb',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    marginRight: 12,\r\n  },\r\n  technicianAvatarText: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#6b7280',\r\n  },\r\n  technicianName: {\r\n    flex: 1,\r\n    fontSize: 16,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\jobs\\map.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":23,"column":25,"nodeType":"Literal","endLine":23,"endColumn":45}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Live Map Screen (Dispatcher)\r\n * ============================\r\n *\r\n * Phase 2.4.2: Live Map Screen\r\n * Shows all active technicians on a map with real-time location updates.\r\n * Displays job markers and allows quick access to job details.\r\n */\r\n\r\nimport { useState, useEffect, useCallback, useRef } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  TouchableOpacity,\r\n  Modal,\r\n  ScrollView,\r\n  Dimensions,\r\n  Platform,\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\nimport { useRouter } from 'expo-router';\r\nimport { Feather } from '@expo/vector-icons';\r\nimport MapView, { Marker, Callout, PROVIDER_GOOGLE } from 'react-native-maps';\r\nimport { withObservables } from '@nozbe/watermelondb/react';\r\nimport { Q } from '@nozbe/watermelondb';\r\n\r\nimport { jobsCollection } from '../../../watermelon/database';\r\nimport { Job } from '../../../watermelon/models';\r\nimport { api } from '../../../lib/api/client';\r\n\r\nconst { width, height } = Dimensions.get('window');\r\nconst ASPECT_RATIO = width / height;\r\nconst LATITUDE_DELTA = 0.0922;\r\nconst LONGITUDE_DELTA = LATITUDE_DELTA * ASPECT_RATIO;\r\n\r\n// Buenos Aires default location\r\nconst DEFAULT_REGION = {\r\n  latitude: -34.6037,\r\n  longitude: -58.3816,\r\n  latitudeDelta: LATITUDE_DELTA,\r\n  longitudeDelta: LONGITUDE_DELTA,\r\n};\r\n\r\n// Polling interval for real-time updates (10 seconds)\r\nconst LOCATION_POLL_INTERVAL = 10000;\r\n\r\ninterface TechnicianLocation {\r\n  id: string;\r\n  name: string;\r\n  latitude: number;\r\n  longitude: number;\r\n  status: string;\r\n  currentJobId: string | null;\r\n  lastUpdate: Date;\r\n}\r\n\r\nfunction LiveMapScreen({ jobs }: { jobs: Job[] }) {\r\n  const router = useRouter();\r\n  const mapRef = useRef<MapView>(null);\r\n  const [technicians, setTechnicians] = useState<TechnicianLocation[]>([]);\r\n  const [selectedTechnician, setSelectedTechnician] = useState<TechnicianLocation | null>(null);\r\n  const [selectedJob, setSelectedJob] = useState<Job | null>(null);\r\n  const [showLegend, setShowLegend] = useState(false);\r\n  const [mapType, setMapType] = useState<'standard' | 'satellite'>('standard');\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Fetch technician locations from API\r\n  const fetchTechnicianLocations = useCallback(async () => {\r\n    try {\r\n      const response = await api.map.getTechnicianLocations({ onlineOnly: false });\r\n\r\n      if (response.success && response.data) {\r\n        // Map API response to component's TechnicianLocation interface\r\n        const mappedTechnicians: TechnicianLocation[] = response.data.technicians\r\n          .filter((t) => t.location !== null)\r\n          .map((t) => {\r\n            // Map API status to component status\r\n            let status = 'available';\r\n            if (t.currentJob?.status === 'EN_ROUTE') {\r\n              status = 'en_route';\r\n            } else if (t.currentJob?.status === 'IN_PROGRESS') {\r\n              status = 'working';\r\n            } else if (!t.isOnline) {\r\n              status = 'offline';\r\n            }\r\n\r\n            return {\r\n              id: t.id,\r\n              name: t.name,\r\n              latitude: t.location!.lat,\r\n              longitude: t.location!.lng,\r\n              status,\r\n              currentJobId: t.currentJob?.id || null,\r\n              lastUpdate: t.lastSeen ? new Date(t.lastSeen) : new Date(),\r\n            };\r\n          });\r\n\r\n        setTechnicians(mappedTechnicians);\r\n        setError(null);\r\n      } else {\r\n        console.warn('[LiveMap] Failed to fetch technicians:', response.error);\r\n        setError(response.error?.message || 'Error cargando ubicaciones');\r\n      }\r\n    } catch (err) {\r\n      console.error('[LiveMap] Error fetching technician locations:', err);\r\n      setError('Error de conexi├│n');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // Fetch locations on mount and poll for updates\r\n  useEffect(() => {\r\n    fetchTechnicianLocations();\r\n\r\n    const interval = setInterval(fetchTechnicianLocations, LOCATION_POLL_INTERVAL);\r\n    return () => clearInterval(interval);\r\n  }, [fetchTechnicianLocations]);\r\n\r\n  // Get active jobs with locations\r\n  const jobsWithLocation = jobs.filter(\r\n    (j) => j.latitude && j.longitude && (j.status === 'scheduled' || j.status === 'pending')\r\n  );\r\n\r\n  // Fit map to show all markers\r\n  const fitToMarkers = useCallback(() => {\r\n    if (!mapRef.current) return;\r\n\r\n    const coordinates = [\r\n      ...technicians.map((t) => ({ latitude: t.latitude, longitude: t.longitude })),\r\n      ...jobsWithLocation\r\n        .filter((j) => j.latitude && j.longitude)\r\n        .map((j) => ({ latitude: j.latitude!, longitude: j.longitude! })),\r\n    ];\r\n\r\n    if (coordinates.length > 0) {\r\n      mapRef.current.fitToCoordinates(coordinates, {\r\n        edgePadding: { top: 100, right: 50, bottom: 100, left: 50 },\r\n        animated: true,\r\n      });\r\n    }\r\n  }, [technicians, jobsWithLocation]);\r\n\r\n  const handleTechnicianPress = (technician: TechnicianLocation) => {\r\n    setSelectedTechnician(technician);\r\n    setSelectedJob(null);\r\n\r\n    // Center map on technician\r\n    mapRef.current?.animateToRegion({\r\n      latitude: technician.latitude,\r\n      longitude: technician.longitude,\r\n      latitudeDelta: 0.01,\r\n      longitudeDelta: 0.01,\r\n    });\r\n  };\r\n\r\n  const handleJobPress = (job: Job) => {\r\n    setSelectedJob(job);\r\n    setSelectedTechnician(null);\r\n\r\n    if (job.latitude && job.longitude) {\r\n      mapRef.current?.animateToRegion({\r\n        latitude: job.latitude,\r\n        longitude: job.longitude,\r\n        latitudeDelta: 0.01,\r\n        longitudeDelta: 0.01,\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleViewJobDetails = (jobId: string) => {\r\n    router.push(`/(tabs)/jobs/${jobId}`);\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case 'en_route':\r\n        return '#3b82f6'; // Blue\r\n      case 'working':\r\n        return '#16a34a'; // Green\r\n      case 'available':\r\n        return '#9ca3af'; // Gray\r\n      case 'offline':\r\n        return '#ef4444'; // Red\r\n      default:\r\n        return '#6b7280';\r\n    }\r\n  };\r\n\r\n  const getStatusLabel = (status: string) => {\r\n    switch (status) {\r\n      case 'en_route':\r\n        return 'En camino';\r\n      case 'working':\r\n        return 'Trabajando';\r\n      case 'available':\r\n        return 'Disponible';\r\n      case 'offline':\r\n        return 'Sin conexi├│n';\r\n      default:\r\n        return status;\r\n    }\r\n  };\r\n\r\n  // Show loading state\r\n  if (isLoading && technicians.length === 0) {\r\n    return (\r\n      <SafeAreaView style={styles.container} edges={['top']}>\r\n        <View style={styles.loadingContainer}>\r\n          <View style={styles.loadingSpinner} />\r\n          <Text style={styles.loadingText}>Cargando ubicaciones...</Text>\r\n        </View>\r\n      </SafeAreaView>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <SafeAreaView style={styles.container} edges={['top']}>\r\n      {/* Header */}\r\n      <View style={styles.header}>\r\n        <Text style={styles.headerTitle}>Mapa en vivo</Text>\r\n        <View style={styles.headerActions}>\r\n          <TouchableOpacity\r\n            style={styles.headerButton}\r\n            onPress={fetchTechnicianLocations}\r\n          >\r\n            <Feather name=\"refresh-cw\" size={20} color=\"#374151\" />\r\n          </TouchableOpacity>\r\n          <TouchableOpacity\r\n            style={styles.headerButton}\r\n            onPress={() => setMapType(mapType === 'standard' ? 'satellite' : 'standard')}\r\n          >\r\n            <Feather\r\n              name={mapType === 'standard' ? 'globe' : 'map'}\r\n              size={20}\r\n              color=\"#374151\"\r\n            />\r\n          </TouchableOpacity>\r\n          <TouchableOpacity style={styles.headerButton} onPress={fitToMarkers}>\r\n            <Feather name=\"maximize\" size={20} color=\"#374151\" />\r\n          </TouchableOpacity>\r\n          <TouchableOpacity style={styles.headerButton} onPress={() => setShowLegend(true)}>\r\n            <Feather name=\"info\" size={20} color=\"#374151\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n      </View>\r\n\r\n      {/* Error banner */}\r\n      {error && (\r\n        <View style={styles.errorBanner}>\r\n          <Text style={styles.errorText}>{error}</Text>\r\n          <TouchableOpacity onPress={fetchTechnicianLocations}>\r\n            <Feather name=\"refresh-cw\" size={16} color=\"#fff\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n      )}\r\n\r\n      {/* Stats bar */}\r\n      <View style={styles.statsBar}>\r\n        <View style={styles.stat}>\r\n          <View style={[styles.statDot, { backgroundColor: '#3b82f6' }]} />\r\n          <Text style={styles.statText}>\r\n            {technicians.filter((t) => t.status === 'en_route').length} en camino\r\n          </Text>\r\n        </View>\r\n        <View style={styles.stat}>\r\n          <View style={[styles.statDot, { backgroundColor: '#16a34a' }]} />\r\n          <Text style={styles.statText}>\r\n            {technicians.filter((t) => t.status === 'working').length} trabajando\r\n          </Text>\r\n        </View>\r\n        <View style={styles.stat}>\r\n          <View style={[styles.statDot, { backgroundColor: '#9ca3af' }]} />\r\n          <Text style={styles.statText}>\r\n            {technicians.filter((t) => t.status === 'available').length} disponible\r\n          </Text>\r\n        </View>\r\n      </View>\r\n\r\n      {/* Map */}\r\n      <View style={styles.mapContainer}>\r\n        <MapView\r\n          ref={mapRef}\r\n          style={styles.map}\r\n          provider={Platform.OS === 'android' ? PROVIDER_GOOGLE : undefined}\r\n          initialRegion={DEFAULT_REGION}\r\n          mapType={mapType}\r\n          showsUserLocation\r\n          showsMyLocationButton={false}\r\n        >\r\n          {/* Technician markers */}\r\n          {technicians.map((tech) => (\r\n            <Marker\r\n              key={`tech-${tech.id}`}\r\n              coordinate={{\r\n                latitude: tech.latitude,\r\n                longitude: tech.longitude,\r\n              }}\r\n              onPress={() => handleTechnicianPress(tech)}\r\n            >\r\n              <View style={styles.technicianMarker}>\r\n                <View\r\n                  style={[\r\n                    styles.technicianMarkerInner,\r\n                    { backgroundColor: getStatusColor(tech.status) },\r\n                  ]}\r\n                >\r\n                  <Feather name=\"truck\" size={16} color=\"#fff\" />\r\n                </View>\r\n              </View>\r\n              <Callout tooltip>\r\n                <View style={styles.callout}>\r\n                  <Text style={styles.calloutTitle}>{tech.name}</Text>\r\n                  <Text style={styles.calloutStatus}>{getStatusLabel(tech.status)}</Text>\r\n                </View>\r\n              </Callout>\r\n            </Marker>\r\n          ))}\r\n\r\n          {/* Job markers */}\r\n          {jobsWithLocation.map((job) => (\r\n            <Marker\r\n              key={`job-${job.id}`}\r\n              coordinate={{\r\n                latitude: job.latitude!,\r\n                longitude: job.longitude!,\r\n              }}\r\n              onPress={() => handleJobPress(job)}\r\n            >\r\n              <View style={styles.jobMarker}>\r\n                <Feather\r\n                  name=\"briefcase\"\r\n                  size={14}\r\n                  color={job.assignedToId ? '#374151' : '#f59e0b'}\r\n                />\r\n              </View>\r\n              <Callout tooltip>\r\n                <View style={styles.callout}>\r\n                  <Text style={styles.calloutTitle}>{job.serviceType}</Text>\r\n                  <Text style={styles.calloutAddress} numberOfLines={1}>\r\n                    {job.address}\r\n                  </Text>\r\n                </View>\r\n              </Callout>\r\n            </Marker>\r\n          ))}\r\n        </MapView>\r\n\r\n        {/* My location button */}\r\n        <TouchableOpacity\r\n          style={styles.myLocationButton}\r\n          onPress={() => {\r\n            // In production, would use device location\r\n            mapRef.current?.animateToRegion(DEFAULT_REGION);\r\n          }}\r\n        >\r\n          <Feather name=\"crosshair\" size={20} color=\"#374151\" />\r\n        </TouchableOpacity>\r\n      </View>\r\n\r\n      {/* Technician list at bottom */}\r\n      <View style={styles.technicianList}>\r\n        <Text style={styles.technicianListTitle}>T├⌐cnicos activos</Text>\r\n        <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n          {technicians.map((tech) => (\r\n            <TouchableOpacity\r\n              key={tech.id}\r\n              style={[\r\n                styles.technicianCard,\r\n                selectedTechnician?.id === tech.id && styles.technicianCardSelected,\r\n              ]}\r\n              onPress={() => handleTechnicianPress(tech)}\r\n            >\r\n              <View\r\n                style={[\r\n                  styles.technicianCardDot,\r\n                  { backgroundColor: getStatusColor(tech.status) },\r\n                ]}\r\n              />\r\n              <Text style={styles.technicianCardName} numberOfLines={1}>\r\n                {tech.name.split(' ')[0]}\r\n              </Text>\r\n              <Text style={styles.technicianCardStatus}>{getStatusLabel(tech.status)}</Text>\r\n            </TouchableOpacity>\r\n          ))}\r\n        </ScrollView>\r\n      </View>\r\n\r\n      {/* Selected technician details */}\r\n      {selectedTechnician && (\r\n        <View style={styles.detailCard}>\r\n          <View style={styles.detailHeader}>\r\n            <View style={styles.detailInfo}>\r\n              <View\r\n                style={[\r\n                  styles.detailAvatar,\r\n                  { backgroundColor: getStatusColor(selectedTechnician.status) },\r\n                ]}\r\n              >\r\n                <Text style={styles.detailAvatarText}>\r\n                  {selectedTechnician.name.charAt(0)}\r\n                </Text>\r\n              </View>\r\n              <View>\r\n                <Text style={styles.detailName}>{selectedTechnician.name}</Text>\r\n                <Text style={styles.detailStatus}>\r\n                  {getStatusLabel(selectedTechnician.status)}\r\n                </Text>\r\n              </View>\r\n            </View>\r\n            <TouchableOpacity onPress={() => setSelectedTechnician(null)}>\r\n              <Feather name=\"x\" size={24} color=\"#6b7280\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n          <View style={styles.detailActions}>\r\n            <TouchableOpacity style={styles.detailAction}>\r\n              <Feather name=\"phone\" size={18} color=\"#16a34a\" />\r\n              <Text style={styles.detailActionText}>Llamar</Text>\r\n            </TouchableOpacity>\r\n            <TouchableOpacity style={styles.detailAction}>\r\n              <Feather name=\"message-circle\" size={18} color=\"#3b82f6\" />\r\n              <Text style={styles.detailActionText}>Mensaje</Text>\r\n            </TouchableOpacity>\r\n            {selectedTechnician.currentJobId && (\r\n              <TouchableOpacity\r\n                style={styles.detailAction}\r\n                onPress={() => handleViewJobDetails(selectedTechnician.currentJobId!)}\r\n              >\r\n                <Feather name=\"briefcase\" size={18} color=\"#8b5cf6\" />\r\n                <Text style={styles.detailActionText}>Ver trabajo</Text>\r\n              </TouchableOpacity>\r\n            )}\r\n          </View>\r\n        </View>\r\n      )}\r\n\r\n      {/* Selected job details */}\r\n      {selectedJob && (\r\n        <View style={styles.detailCard}>\r\n          <View style={styles.detailHeader}>\r\n            <View style={styles.detailInfo}>\r\n              <View style={[styles.detailAvatar, { backgroundColor: '#f59e0b' }]}>\r\n                <Feather name=\"briefcase\" size={18} color=\"#fff\" />\r\n              </View>\r\n              <View style={{ flex: 1 }}>\r\n                <Text style={styles.detailName}>{selectedJob.serviceType}</Text>\r\n                <Text style={styles.detailStatus} numberOfLines={1}>\r\n                  {selectedJob.address}\r\n                </Text>\r\n              </View>\r\n            </View>\r\n            <TouchableOpacity onPress={() => setSelectedJob(null)}>\r\n              <Feather name=\"x\" size={24} color=\"#6b7280\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n          <TouchableOpacity\r\n            style={styles.viewJobButton}\r\n            onPress={() => handleViewJobDetails(selectedJob.id)}\r\n          >\r\n            <Text style={styles.viewJobButtonText}>Ver detalles del trabajo</Text>\r\n            <Feather name=\"chevron-right\" size={18} color=\"#fff\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n      )}\r\n\r\n      {/* Legend Modal */}\r\n      <Modal\r\n        visible={showLegend}\r\n        transparent\r\n        animationType=\"fade\"\r\n        onRequestClose={() => setShowLegend(false)}\r\n      >\r\n        <TouchableOpacity\r\n          style={styles.modalOverlay}\r\n          activeOpacity={1}\r\n          onPress={() => setShowLegend(false)}\r\n        >\r\n          <View style={styles.legendModal}>\r\n            <Text style={styles.legendTitle}>Leyenda del mapa</Text>\r\n\r\n            <Text style={styles.legendSection}>T├⌐cnicos</Text>\r\n            <View style={styles.legendItem}>\r\n              <View style={[styles.legendMarker, { backgroundColor: '#3b82f6' }]}>\r\n                <Feather name=\"truck\" size={12} color=\"#fff\" />\r\n              </View>\r\n              <Text style={styles.legendText}>En camino</Text>\r\n            </View>\r\n            <View style={styles.legendItem}>\r\n              <View style={[styles.legendMarker, { backgroundColor: '#16a34a' }]}>\r\n                <Feather name=\"truck\" size={12} color=\"#fff\" />\r\n              </View>\r\n              <Text style={styles.legendText}>Trabajando</Text>\r\n            </View>\r\n            <View style={styles.legendItem}>\r\n              <View style={[styles.legendMarker, { backgroundColor: '#9ca3af' }]}>\r\n                <Feather name=\"truck\" size={12} color=\"#fff\" />\r\n              </View>\r\n              <Text style={styles.legendText}>Disponible</Text>\r\n            </View>\r\n\r\n            <Text style={[styles.legendSection, { marginTop: 16 }]}>Trabajos</Text>\r\n            <View style={styles.legendItem}>\r\n              <View style={styles.jobMarkerLegend}>\r\n                <Feather name=\"briefcase\" size={12} color=\"#374151\" />\r\n              </View>\r\n              <Text style={styles.legendText}>Trabajo asignado</Text>\r\n            </View>\r\n            <View style={styles.legendItem}>\r\n              <View style={[styles.jobMarkerLegend, { borderColor: '#f59e0b' }]}>\r\n                <Feather name=\"briefcase\" size={12} color=\"#f59e0b\" />\r\n              </View>\r\n              <Text style={styles.legendText}>Sin asignar</Text>\r\n            </View>\r\n          </View>\r\n        </TouchableOpacity>\r\n      </Modal>\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\n// Observe jobs from WatermelonDB\r\nconst enhance = withObservables([], () => ({\r\n  jobs: jobsCollection.query(\r\n    Q.or(Q.where('status', 'scheduled'), Q.where('status', 'pending'))\r\n  ),\r\n}));\r\n\r\nexport default enhance(LiveMapScreen);\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#fff',\r\n  },\r\n  loadingContainer: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  loadingSpinner: {\r\n    width: 40,\r\n    height: 40,\r\n    borderRadius: 20,\r\n    borderWidth: 3,\r\n    borderColor: '#e5e7eb',\r\n    borderTopColor: '#16a34a',\r\n  },\r\n  loadingText: {\r\n    marginTop: 12,\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n  },\r\n  errorBanner: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    backgroundColor: '#ef4444',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 8,\r\n  },\r\n  errorText: {\r\n    fontSize: 13,\r\n    color: '#fff',\r\n    flex: 1,\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  headerTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  headerActions: {\r\n    flexDirection: 'row',\r\n    gap: 8,\r\n  },\r\n  headerButton: {\r\n    width: 40,\r\n    height: 40,\r\n    borderRadius: 20,\r\n    backgroundColor: '#f3f4f6',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  statsBar: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'center',\r\n    gap: 24,\r\n    paddingVertical: 10,\r\n    backgroundColor: '#f9fafb',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  stat: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n  },\r\n  statDot: {\r\n    width: 8,\r\n    height: 8,\r\n    borderRadius: 4,\r\n  },\r\n  statText: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n  },\r\n  mapContainer: {\r\n    flex: 1,\r\n  },\r\n  map: {\r\n    flex: 1,\r\n  },\r\n  myLocationButton: {\r\n    position: 'absolute',\r\n    right: 16,\r\n    bottom: 16,\r\n    width: 44,\r\n    height: 44,\r\n    borderRadius: 22,\r\n    backgroundColor: '#fff',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    elevation: 4,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 2 },\r\n    shadowOpacity: 0.25,\r\n    shadowRadius: 4,\r\n  },\r\n  technicianMarker: {\r\n    alignItems: 'center',\r\n  },\r\n  technicianMarkerInner: {\r\n    width: 36,\r\n    height: 36,\r\n    borderRadius: 18,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    borderWidth: 3,\r\n    borderColor: '#fff',\r\n    elevation: 4,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 2 },\r\n    shadowOpacity: 0.25,\r\n    shadowRadius: 4,\r\n  },\r\n  jobMarker: {\r\n    width: 28,\r\n    height: 28,\r\n    borderRadius: 14,\r\n    backgroundColor: '#fff',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    borderWidth: 2,\r\n    borderColor: '#e5e7eb',\r\n    elevation: 2,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 1 },\r\n    shadowOpacity: 0.15,\r\n    shadowRadius: 2,\r\n  },\r\n  callout: {\r\n    backgroundColor: '#fff',\r\n    padding: 10,\r\n    borderRadius: 8,\r\n    minWidth: 120,\r\n  },\r\n  calloutTitle: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  calloutStatus: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  calloutAddress: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  technicianList: {\r\n    backgroundColor: '#fff',\r\n    paddingVertical: 12,\r\n    paddingLeft: 16,\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#e5e7eb',\r\n  },\r\n  technicianListTitle: {\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n    color: '#6b7280',\r\n    marginBottom: 10,\r\n    textTransform: 'uppercase',\r\n    letterSpacing: 0.5,\r\n  },\r\n  technicianCard: {\r\n    backgroundColor: '#f9fafb',\r\n    borderRadius: 12,\r\n    padding: 12,\r\n    marginRight: 10,\r\n    minWidth: 100,\r\n    alignItems: 'center',\r\n  },\r\n  technicianCardSelected: {\r\n    backgroundColor: '#dcfce7',\r\n    borderWidth: 1,\r\n    borderColor: '#16a34a',\r\n  },\r\n  technicianCardDot: {\r\n    width: 10,\r\n    height: 10,\r\n    borderRadius: 5,\r\n    marginBottom: 6,\r\n  },\r\n  technicianCardName: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  technicianCardStatus: {\r\n    fontSize: 11,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  detailCard: {\r\n    position: 'absolute',\r\n    bottom: 100,\r\n    left: 16,\r\n    right: 16,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 16,\r\n    padding: 16,\r\n    elevation: 8,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 4 },\r\n    shadowOpacity: 0.2,\r\n    shadowRadius: 8,\r\n  },\r\n  detailHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n  },\r\n  detailInfo: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    flex: 1,\r\n  },\r\n  detailAvatar: {\r\n    width: 48,\r\n    height: 48,\r\n    borderRadius: 24,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    marginRight: 12,\r\n  },\r\n  detailAvatarText: {\r\n    fontSize: 20,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  detailName: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  detailStatus: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  detailActions: {\r\n    flexDirection: 'row',\r\n    marginTop: 16,\r\n    gap: 12,\r\n  },\r\n  detailAction: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 6,\r\n    paddingVertical: 10,\r\n    backgroundColor: '#f3f4f6',\r\n    borderRadius: 8,\r\n  },\r\n  detailActionText: {\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n    color: '#374151',\r\n  },\r\n  viewJobButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 6,\r\n    marginTop: 16,\r\n    backgroundColor: '#16a34a',\r\n    paddingVertical: 12,\r\n    borderRadius: 10,\r\n  },\r\n  viewJobButtonText: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  modalOverlay: {\r\n    flex: 1,\r\n    backgroundColor: 'rgba(0,0,0,0.5)',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  legendModal: {\r\n    width: '80%',\r\n    backgroundColor: '#fff',\r\n    borderRadius: 16,\r\n    padding: 20,\r\n  },\r\n  legendTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginBottom: 16,\r\n  },\r\n  legendSection: {\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n    color: '#6b7280',\r\n    textTransform: 'uppercase',\r\n    letterSpacing: 0.5,\r\n    marginBottom: 10,\r\n  },\r\n  legendItem: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 12,\r\n    marginBottom: 10,\r\n  },\r\n  legendMarker: {\r\n    width: 28,\r\n    height: 28,\r\n    borderRadius: 14,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  legendText: {\r\n    fontSize: 14,\r\n    color: '#374151',\r\n  },\r\n  jobMarkerLegend: {\r\n    width: 28,\r\n    height: 28,\r\n    borderRadius: 14,\r\n    backgroundColor: '#fff',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    borderWidth: 2,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\profile\\_layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\profile\\badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\profile\\index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":30,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":80,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":80,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Profile Screen\r\n * ==============\r\n *\r\n * User profile with settings and app configuration\r\n */\r\n\r\nimport { useState } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  ScrollView,\r\n  TouchableOpacity,\r\n  Switch,\r\n  Alert,\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\nimport {\r\n  User,\r\n  Settings,\r\n  Bell,\r\n  Wifi,\r\n  WifiOff,\r\n  RefreshCw,\r\n  LogOut,\r\n  ChevronRight,\r\n  Moon,\r\n  MapPin,\r\n  Clock,\r\n  Shield,\r\n  QrCode,\r\n} from 'lucide-react-native';\r\nimport { router } from 'expo-router';\r\nimport { useAuth } from '../../../lib/auth/auth-context';\r\nimport { useSyncStatus, useForceSync } from '../../../lib/hooks/use-sync-status';\r\n\r\nexport default function ProfileScreen() {\r\n  const { user, logout } = useAuth();\r\n  const status = useSyncStatus();\r\n  const forceSync = useForceSync();\r\n\r\n  const [advancedMode, setAdvancedMode] = useState(false);\r\n  const [darkMode, setDarkMode] = useState(false);\r\n  const [notifications, setNotifications] = useState(true);\r\n  const [locationTracking, setLocationTracking] = useState(true);\r\n\r\n  const handleLogout = () => {\r\n    Alert.alert(\r\n      'Cerrar sesion',\r\n      'Estas seguro que queres salir? Los datos no sincronizados se perderan.',\r\n      [\r\n        { text: 'Cancelar', style: 'cancel' },\r\n        {\r\n          text: 'Salir',\r\n          style: 'destructive',\r\n          onPress: logout,\r\n        },\r\n      ]\r\n    );\r\n  };\r\n\r\n  const handleForceSync = async () => {\r\n    if (!status.isOnline) {\r\n      Alert.alert('Sin conexion', 'Necesitas conexion a internet para sincronizar.');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const result = await forceSync();\r\n      if (result.success) {\r\n        Alert.alert(\r\n          'Sincronizacion completada',\r\n          `Enviados: ${result.pushed}\\nRecibidos: ${result.pulled}${result.conflicts > 0 ? `\\nConflictos: ${result.conflicts}` : ''\r\n          }`\r\n        );\r\n      } else {\r\n        Alert.alert('Error', result.error || 'No se pudo sincronizar');\r\n      }\r\n    } catch (error) {\r\n      Alert.alert('Error', 'Ocurrio un error al sincronizar');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <SafeAreaView style={styles.container} edges={['top']}>\r\n      <ScrollView>\r\n        {/* Header */}\r\n        <View style={styles.header}>\r\n          <View style={styles.avatar}>\r\n            <Text style={styles.avatarText}>\r\n              {user?.name?.[0]?.toUpperCase() || 'T'}\r\n            </Text>\r\n          </View>\r\n          <Text style={styles.userName}>{user?.name || 'Tecnico'}</Text>\r\n          <Text style={styles.userPhone}>{user?.phone || ''}</Text>\r\n          <View style={styles.roleBadge}>\r\n            <Shield size={14} color=\"#059669\" />\r\n            <Text style={styles.roleText}>Tecnico de Campo</Text>\r\n          </View>\r\n\r\n          {/* Digital Badge Button */}\r\n          <TouchableOpacity\r\n            style={styles.badgeButton}\r\n            onPress={() => router.push('/profile/badge')}\r\n          >\r\n            <QrCode size={18} color=\"#fff\" />\r\n            <Text style={styles.badgeButtonText}>Mi Credencial Digital</Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        {/* Sync Status */}\r\n        <View style={styles.section}>\r\n          <Text style={styles.sectionTitle}>Estado de sincronizacion</Text>\r\n          <View style={styles.syncCard}>\r\n            <View style={styles.syncRow}>\r\n              {status.isOnline ? (\r\n                <Wifi size={20} color=\"#059669\" />\r\n              ) : (\r\n                <WifiOff size={20} color=\"#dc2626\" />\r\n              )}\r\n              <Text style={styles.syncText}>\r\n                {status.isOnline ? 'Conectado' : 'Sin conexion'}\r\n              </Text>\r\n            </View>\r\n\r\n            <View style={styles.syncDivider} />\r\n\r\n            <View style={styles.syncStats}>\r\n              <View style={styles.syncStat}>\r\n                <Text style={styles.syncStatValue}>{status.pendingOperations}</Text>\r\n                <Text style={styles.syncStatLabel}>Pendientes</Text>\r\n              </View>\r\n              <View style={styles.syncStat}>\r\n                <Text style={styles.syncStatValue}>{status.conflicts}</Text>\r\n                <Text style={styles.syncStatLabel}>Conflictos</Text>\r\n              </View>\r\n              <View style={styles.syncStat}>\r\n                <Text style={styles.syncStatValue}>\r\n                  {status.lastSync\r\n                    ? new Date(status.lastSync).toLocaleTimeString('es-AR', {\r\n                      hour: '2-digit',\r\n                      minute: '2-digit',\r\n                    })\r\n                    : '--:--'}\r\n                </Text>\r\n                <Text style={styles.syncStatLabel}>Ultima sync</Text>\r\n              </View>\r\n            </View>\r\n\r\n            <TouchableOpacity\r\n              style={[styles.syncButton, status.isSyncing && styles.syncButtonDisabled]}\r\n              onPress={handleForceSync}\r\n              disabled={status.isSyncing}\r\n            >\r\n              <RefreshCw\r\n                size={18}\r\n                color=\"#fff\"\r\n                style={status.isSyncing ? styles.rotating : undefined}\r\n              />\r\n              <Text style={styles.syncButtonText}>\r\n                {status.isSyncing ? 'Sincronizando...' : 'Sincronizar ahora'}\r\n              </Text>\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Settings */}\r\n        <View style={styles.section}>\r\n          <Text style={styles.sectionTitle}>Configuracion</Text>\r\n\r\n          <View style={styles.settingsCard}>\r\n            <View style={styles.settingRow}>\r\n              <View style={styles.settingLeft}>\r\n                <Settings size={20} color=\"#6b7280\" />\r\n                <Text style={styles.settingLabel}>Modo avanzado</Text>\r\n              </View>\r\n              <Switch\r\n                value={advancedMode}\r\n                onValueChange={setAdvancedMode}\r\n                trackColor={{ false: '#d1d5db', true: '#86efac' }}\r\n                thumbColor={advancedMode ? '#059669' : '#f4f4f5'}\r\n              />\r\n            </View>\r\n            <Text style={styles.settingHint}>\r\n              Acceso a clientes, historial completo y mas opciones\r\n            </Text>\r\n\r\n            <View style={styles.settingDivider} />\r\n\r\n            <View style={styles.settingRow}>\r\n              <View style={styles.settingLeft}>\r\n                <Bell size={20} color=\"#6b7280\" />\r\n                <Text style={styles.settingLabel}>Notificaciones</Text>\r\n              </View>\r\n              <Switch\r\n                value={notifications}\r\n                onValueChange={setNotifications}\r\n                trackColor={{ false: '#d1d5db', true: '#86efac' }}\r\n                thumbColor={notifications ? '#059669' : '#f4f4f5'}\r\n              />\r\n            </View>\r\n\r\n            <View style={styles.settingDivider} />\r\n\r\n            <View style={styles.settingRow}>\r\n              <View style={styles.settingLeft}>\r\n                <MapPin size={20} color=\"#6b7280\" />\r\n                <Text style={styles.settingLabel}>Seguimiento GPS</Text>\r\n              </View>\r\n              <Switch\r\n                value={locationTracking}\r\n                onValueChange={setLocationTracking}\r\n                trackColor={{ false: '#d1d5db', true: '#86efac' }}\r\n                thumbColor={locationTracking ? '#059669' : '#f4f4f5'}\r\n              />\r\n            </View>\r\n\r\n            <View style={styles.settingDivider} />\r\n\r\n            <View style={styles.settingRow}>\r\n              <View style={styles.settingLeft}>\r\n                <Moon size={20} color=\"#6b7280\" />\r\n                <Text style={styles.settingLabel}>Modo oscuro</Text>\r\n              </View>\r\n              <Switch\r\n                value={darkMode}\r\n                onValueChange={setDarkMode}\r\n                trackColor={{ false: '#d1d5db', true: '#86efac' }}\r\n                thumbColor={darkMode ? '#059669' : '#f4f4f5'}\r\n              />\r\n            </View>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Info */}\r\n        <View style={styles.section}>\r\n          <Text style={styles.sectionTitle}>Informacion</Text>\r\n\r\n          <View style={styles.settingsCard}>\r\n            <TouchableOpacity style={styles.infoRow}>\r\n              <Text style={styles.infoLabel}>Organizacion</Text>\r\n              <View style={styles.infoRight}>\r\n                <Text style={styles.infoValue}>{user?.organizationId || 'CampoTech'}</Text>\r\n                <ChevronRight size={18} color=\"#9ca3af\" />\r\n              </View>\r\n            </TouchableOpacity>\r\n\r\n            <View style={styles.settingDivider} />\r\n\r\n            <TouchableOpacity style={styles.infoRow}>\r\n              <Text style={styles.infoLabel}>Version de la app</Text>\r\n              <View style={styles.infoRight}>\r\n                <Text style={styles.infoValue}>1.0.0</Text>\r\n                <ChevronRight size={18} color=\"#9ca3af\" />\r\n              </View>\r\n            </TouchableOpacity>\r\n\r\n            <View style={styles.settingDivider} />\r\n\r\n            <TouchableOpacity style={styles.infoRow}>\r\n              <Text style={styles.infoLabel}>Terminos y condiciones</Text>\r\n              <ChevronRight size={18} color=\"#9ca3af\" />\r\n            </TouchableOpacity>\r\n\r\n            <View style={styles.settingDivider} />\r\n\r\n            <TouchableOpacity style={styles.infoRow}>\r\n              <Text style={styles.infoLabel}>Politica de privacidad</Text>\r\n              <ChevronRight size={18} color=\"#9ca3af\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Logout */}\r\n        <TouchableOpacity style={styles.logoutButton} onPress={handleLogout}>\r\n          <LogOut size={20} color=\"#dc2626\" />\r\n          <Text style={styles.logoutText}>Cerrar sesion</Text>\r\n        </TouchableOpacity>\r\n\r\n        <View style={styles.footer} />\r\n      </ScrollView>\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f9fafb',\r\n  },\r\n  header: {\r\n    alignItems: 'center',\r\n    paddingVertical: 24,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  avatar: {\r\n    width: 80,\r\n    height: 80,\r\n    borderRadius: 40,\r\n    backgroundColor: '#059669',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    marginBottom: 12,\r\n  },\r\n  avatarText: {\r\n    fontSize: 32,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  userName: {\r\n    fontSize: 20,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  userPhone: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n  },\r\n  roleBadge: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n    marginTop: 12,\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 6,\r\n    backgroundColor: '#ecfdf5',\r\n    borderRadius: 16,\r\n  },\r\n  roleText: {\r\n    fontSize: 12,\r\n    fontWeight: '500',\r\n    color: '#059669',\r\n  },\r\n  badgeButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    marginTop: 16,\r\n    paddingHorizontal: 20,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#059669',\r\n    borderRadius: 24,\r\n  },\r\n  badgeButtonText: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  section: {\r\n    paddingHorizontal: 16,\r\n    paddingTop: 24,\r\n  },\r\n  sectionTitle: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#6b7280',\r\n    marginBottom: 12,\r\n    textTransform: 'uppercase',\r\n    letterSpacing: 0.5,\r\n  },\r\n  syncCard: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    padding: 16,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 1 },\r\n    shadowOpacity: 0.05,\r\n    shadowRadius: 2,\r\n    elevation: 1,\r\n  },\r\n  syncRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n  },\r\n  syncText: {\r\n    fontSize: 16,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  syncDivider: {\r\n    height: 1,\r\n    backgroundColor: '#e5e7eb',\r\n    marginVertical: 16,\r\n  },\r\n  syncStats: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-around',\r\n  },\r\n  syncStat: {\r\n    alignItems: 'center',\r\n  },\r\n  syncStatValue: {\r\n    fontSize: 24,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  syncStatLabel: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n  },\r\n  syncButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#059669',\r\n    paddingVertical: 12,\r\n    borderRadius: 8,\r\n    marginTop: 16,\r\n  },\r\n  syncButtonDisabled: {\r\n    opacity: 0.7,\r\n  },\r\n  syncButtonText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  rotating: {\r\n    // Animation would be handled differently in RN\r\n  },\r\n  settingsCard: {\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    padding: 16,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 1 },\r\n    shadowOpacity: 0.05,\r\n    shadowRadius: 2,\r\n    elevation: 1,\r\n  },\r\n  settingRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n  },\r\n  settingLeft: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 12,\r\n  },\r\n  settingLabel: {\r\n    fontSize: 16,\r\n    color: '#111827',\r\n  },\r\n  settingHint: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n    marginLeft: 32,\r\n  },\r\n  settingDivider: {\r\n    height: 1,\r\n    backgroundColor: '#f3f4f6',\r\n    marginVertical: 12,\r\n  },\r\n  infoRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingVertical: 4,\r\n  },\r\n  infoLabel: {\r\n    fontSize: 16,\r\n    color: '#111827',\r\n  },\r\n  infoRight: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n  },\r\n  infoValue: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n  },\r\n  logoutButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    marginHorizontal: 16,\r\n    marginTop: 24,\r\n    paddingVertical: 14,\r\n    backgroundColor: '#fef2f2',\r\n    borderRadius: 12,\r\n    borderWidth: 1,\r\n    borderColor: '#fecaca',\r\n  },\r\n  logoutText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#dc2626',\r\n  },\r\n  footer: {\r\n    height: 40,\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\team\\_layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\team\\add.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Shield' is defined but never used.","line":28,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Wrench' is defined but never used.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":99,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":99,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Add Team Member Screen\r\n * ======================\r\n *\r\n * Phase 9.10: Mobile-First Architecture\r\n * Form for adding new team members\r\n */\r\n\r\nimport { useState } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  TextInput,\r\n  TouchableOpacity,\r\n  ScrollView,\r\n  Alert,\r\n  KeyboardAvoidingView,\r\n  Platform,\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\nimport { useRouter } from 'expo-router';\r\nimport {\r\n  ArrowLeft,\r\n  User,\r\n  Phone,\r\n  Mail,\r\n  Shield,\r\n  Wrench,\r\n  Check,\r\n  MessageCircle,\r\n} from 'lucide-react-native';\r\n\r\nconst ROLES = [\r\n  { value: 'TECHNICIAN', label: 'T├⌐cnico', description: 'Realiza trabajos asignados' },\r\n  { value: 'DISPATCHER', label: 'Despachador', description: 'Asigna trabajos al equipo' },\r\n  { value: 'ADMIN', label: 'Administrador', description: 'Acceso completo excepto facturaci├│n' },\r\n];\r\n\r\nconst SKILL_LEVELS = [\r\n  { value: 'AYUDANTE', label: 'Ayudante', description: 'En formaci├│n' },\r\n  { value: 'MEDIO_OFICIAL', label: 'Medio Oficial', description: '1-3 a├▒os experiencia' },\r\n  { value: 'OFICIAL', label: 'Oficial', description: '3-5 a├▒os experiencia' },\r\n  { value: 'OFICIAL_ESPECIALIZADO', label: 'Oficial Especializado', description: '+5 a├▒os, certificado' },\r\n];\r\n\r\nconst SPECIALTIES = [\r\n  'Instalaci├│n de splits',\r\n  'Reparaci├│n de aires',\r\n  'Mantenimiento preventivo',\r\n  'Instalaci├│n de calefactores',\r\n  'Refrigeraci├│n comercial',\r\n  'Otro',\r\n];\r\n\r\nexport default function AddTeamMemberScreen() {\r\n  const router = useRouter();\r\n\r\n  const [name, setName] = useState('');\r\n  const [phone, setPhone] = useState('');\r\n  const [email, setEmail] = useState('');\r\n  const [role, setRole] = useState('TECHNICIAN');\r\n  const [skillLevel, setSkillLevel] = useState('MEDIO_OFICIAL');\r\n  const [specialty, setSpecialty] = useState('');\r\n  const [sendWhatsAppInvite, setSendWhatsAppInvite] = useState(true);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleSubmit = async () => {\r\n    if (!name.trim()) {\r\n      Alert.alert('Error', 'El nombre es obligatorio');\r\n      return;\r\n    }\r\n\r\n    if (!phone.trim()) {\r\n      Alert.alert('Error', 'El tel├⌐fono es obligatorio');\r\n      return;\r\n    }\r\n\r\n    // Validate phone format\r\n    const cleanPhone = phone.replace(/\\D/g, '');\r\n    if (cleanPhone.length < 10) {\r\n      Alert.alert('Error', 'El tel├⌐fono debe tener al menos 10 d├¡gitos');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      // In production, this would call the API\r\n      await new Promise((resolve) => setTimeout(resolve, 1000));\r\n\r\n      Alert.alert(\r\n        'Miembro agregado',\r\n        sendWhatsAppInvite\r\n          ? `${name} fue agregado al equipo. Se envi├│ una invitaci├│n por WhatsApp.`\r\n          : `${name} fue agregado al equipo.`,\r\n        [{ text: 'OK', onPress: () => router.back() }]\r\n      );\r\n    } catch (error) {\r\n      Alert.alert('Error', 'No se pudo agregar el miembro. Intent├í de nuevo.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <SafeAreaView style={styles.container} edges={['top']}>\r\n      <KeyboardAvoidingView\r\n        behavior={Platform.OS === 'ios' ? 'padding' : 'height'}\r\n        style={styles.container}\r\n      >\r\n        {/* Header */}\r\n        <View style={styles.header}>\r\n          <TouchableOpacity style={styles.backButton} onPress={() => router.back()}>\r\n            <ArrowLeft size={24} color=\"#111827\" />\r\n          </TouchableOpacity>\r\n          <Text style={styles.title}>Agregar T├⌐cnico</Text>\r\n          <View style={styles.headerSpacer} />\r\n        </View>\r\n\r\n        <ScrollView\r\n          style={styles.form}\r\n          contentContainerStyle={styles.formContent}\r\n          showsVerticalScrollIndicator={false}\r\n        >\r\n          {/* Name */}\r\n          <View style={styles.field}>\r\n            <Text style={styles.label}>Nombre *</Text>\r\n            <View style={styles.inputContainer}>\r\n              <User size={20} color=\"#9ca3af\" />\r\n              <TextInput\r\n                style={styles.input}\r\n                value={name}\r\n                onChangeText={setName}\r\n                placeholder=\"Juan P├⌐rez\"\r\n                placeholderTextColor=\"#9ca3af\"\r\n                autoCapitalize=\"words\"\r\n              />\r\n            </View>\r\n          </View>\r\n\r\n          {/* Phone */}\r\n          <View style={styles.field}>\r\n            <Text style={styles.label}>Tel├⌐fono *</Text>\r\n            <View style={styles.inputContainer}>\r\n              <Phone size={20} color=\"#9ca3af\" />\r\n              <TextInput\r\n                style={styles.input}\r\n                value={phone}\r\n                onChangeText={setPhone}\r\n                placeholder=\"11 5678 1234\"\r\n                placeholderTextColor=\"#9ca3af\"\r\n                keyboardType=\"phone-pad\"\r\n              />\r\n            </View>\r\n          </View>\r\n\r\n          {/* Email */}\r\n          <View style={styles.field}>\r\n            <Text style={styles.label}>Email (opcional)</Text>\r\n            <View style={styles.inputContainer}>\r\n              <Mail size={20} color=\"#9ca3af\" />\r\n              <TextInput\r\n                style={styles.input}\r\n                value={email}\r\n                onChangeText={setEmail}\r\n                placeholder=\"juan@email.com\"\r\n                placeholderTextColor=\"#9ca3af\"\r\n                keyboardType=\"email-address\"\r\n                autoCapitalize=\"none\"\r\n              />\r\n            </View>\r\n          </View>\r\n\r\n          {/* Role */}\r\n          <View style={styles.field}>\r\n            <Text style={styles.label}>Rol</Text>\r\n            <View style={styles.optionGroup}>\r\n              {ROLES.map((r) => (\r\n                <TouchableOpacity\r\n                  key={r.value}\r\n                  style={[\r\n                    styles.optionCard,\r\n                    role === r.value && styles.optionCardSelected,\r\n                  ]}\r\n                  onPress={() => setRole(r.value)}\r\n                >\r\n                  <View style={styles.optionHeader}>\r\n                    <Text\r\n                      style={[\r\n                        styles.optionLabel,\r\n                        role === r.value && styles.optionLabelSelected,\r\n                      ]}\r\n                    >\r\n                      {r.label}\r\n                    </Text>\r\n                    {role === r.value && <Check size={16} color=\"#059669\" />}\r\n                  </View>\r\n                  <Text style={styles.optionDescription}>{r.description}</Text>\r\n                </TouchableOpacity>\r\n              ))}\r\n            </View>\r\n          </View>\r\n\r\n          {/* Skill Level */}\r\n          <View style={styles.field}>\r\n            <Text style={styles.label}>Nivel de habilidad (UOCRA)</Text>\r\n            <View style={styles.optionGroup}>\r\n              {SKILL_LEVELS.map((s) => (\r\n                <TouchableOpacity\r\n                  key={s.value}\r\n                  style={[\r\n                    styles.optionCard,\r\n                    skillLevel === s.value && styles.optionCardSelected,\r\n                  ]}\r\n                  onPress={() => setSkillLevel(s.value)}\r\n                >\r\n                  <View style={styles.optionHeader}>\r\n                    <Text\r\n                      style={[\r\n                        styles.optionLabel,\r\n                        skillLevel === s.value && styles.optionLabelSelected,\r\n                      ]}\r\n                    >\r\n                      {s.label}\r\n                    </Text>\r\n                    {skillLevel === s.value && <Check size={16} color=\"#059669\" />}\r\n                  </View>\r\n                  <Text style={styles.optionDescription}>{s.description}</Text>\r\n                </TouchableOpacity>\r\n              ))}\r\n            </View>\r\n          </View>\r\n\r\n          {/* Specialty */}\r\n          <View style={styles.field}>\r\n            <Text style={styles.label}>Especialidad</Text>\r\n            <View style={styles.chipGroup}>\r\n              {SPECIALTIES.map((s) => (\r\n                <TouchableOpacity\r\n                  key={s}\r\n                  style={[styles.chip, specialty === s && styles.chipSelected]}\r\n                  onPress={() => setSpecialty(specialty === s ? '' : s)}\r\n                >\r\n                  <Text\r\n                    style={[\r\n                      styles.chipText,\r\n                      specialty === s && styles.chipTextSelected,\r\n                    ]}\r\n                  >\r\n                    {s}\r\n                  </Text>\r\n                </TouchableOpacity>\r\n              ))}\r\n            </View>\r\n          </View>\r\n\r\n          {/* WhatsApp Invite */}\r\n          <TouchableOpacity\r\n            style={styles.checkboxRow}\r\n            onPress={() => setSendWhatsAppInvite(!sendWhatsAppInvite)}\r\n          >\r\n            <View\r\n              style={[styles.checkbox, sendWhatsAppInvite && styles.checkboxChecked]}\r\n            >\r\n              {sendWhatsAppInvite && <Check size={14} color=\"#fff\" />}\r\n            </View>\r\n            <MessageCircle size={20} color=\"#25D366\" />\r\n            <Text style={styles.checkboxLabel}>Enviar invitaci├│n por WhatsApp</Text>\r\n          </TouchableOpacity>\r\n\r\n          {/* Submit Button */}\r\n          <TouchableOpacity\r\n            style={[styles.submitButton, loading && styles.submitButtonDisabled]}\r\n            onPress={handleSubmit}\r\n            disabled={loading}\r\n          >\r\n            <Text style={styles.submitButtonText}>\r\n              {loading ? 'Agregando...' : 'Agregar miembro'}\r\n            </Text>\r\n          </TouchableOpacity>\r\n        </ScrollView>\r\n      </KeyboardAvoidingView>\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f9fafb',\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  backButton: {\r\n    width: 40,\r\n    height: 40,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  title: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  headerSpacer: {\r\n    width: 40,\r\n  },\r\n  form: {\r\n    flex: 1,\r\n  },\r\n  formContent: {\r\n    padding: 16,\r\n    paddingBottom: 40,\r\n  },\r\n  field: {\r\n    marginBottom: 20,\r\n  },\r\n  label: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    marginBottom: 8,\r\n  },\r\n  inputContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 12,\r\n    backgroundColor: '#fff',\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    borderRadius: 12,\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n  },\r\n  input: {\r\n    flex: 1,\r\n    fontSize: 16,\r\n    color: '#111827',\r\n  },\r\n  optionGroup: {\r\n    gap: 8,\r\n  },\r\n  optionCard: {\r\n    backgroundColor: '#fff',\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    borderRadius: 12,\r\n    padding: 12,\r\n  },\r\n  optionCardSelected: {\r\n    borderColor: '#059669',\r\n    backgroundColor: '#f0fdf4',\r\n  },\r\n  optionHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n  },\r\n  optionLabel: {\r\n    fontSize: 15,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n  },\r\n  optionLabelSelected: {\r\n    color: '#059669',\r\n  },\r\n  optionDescription: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n  },\r\n  chipGroup: {\r\n    flexDirection: 'row',\r\n    flexWrap: 'wrap',\r\n    gap: 8,\r\n  },\r\n  chip: {\r\n    backgroundColor: '#fff',\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    borderRadius: 20,\r\n    paddingHorizontal: 14,\r\n    paddingVertical: 8,\r\n  },\r\n  chipSelected: {\r\n    backgroundColor: '#059669',\r\n    borderColor: '#059669',\r\n  },\r\n  chipText: {\r\n    fontSize: 14,\r\n    color: '#374151',\r\n  },\r\n  chipTextSelected: {\r\n    color: '#fff',\r\n  },\r\n  checkboxRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 12,\r\n    backgroundColor: '#fff',\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    borderRadius: 12,\r\n    padding: 16,\r\n    marginBottom: 24,\r\n  },\r\n  checkbox: {\r\n    width: 22,\r\n    height: 22,\r\n    borderRadius: 4,\r\n    borderWidth: 2,\r\n    borderColor: '#d1d5db',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  checkboxChecked: {\r\n    backgroundColor: '#059669',\r\n    borderColor: '#059669',\r\n  },\r\n  checkboxLabel: {\r\n    flex: 1,\r\n    fontSize: 15,\r\n    color: '#374151',\r\n  },\r\n  submitButton: {\r\n    backgroundColor: '#059669',\r\n    borderRadius: 12,\r\n    paddingVertical: 16,\r\n    alignItems: 'center',\r\n  },\r\n  submitButtonDisabled: {\r\n    opacity: 0.6,\r\n  },\r\n  submitButtonText: {\r\n    color: '#fff',\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\team\\index.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":30,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used.","line":33,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Shield' is defined but never used.","line":35,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Wrench' is defined but never used.","line":36,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Check' is defined but never used.","line":38,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreVertical' is defined but never used.","line":45,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Activity' is defined but never used.","line":49,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'withObservables' is defined but never used.","line":54,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Q' is defined but never used.","line":55,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'database' is defined but never used.","line":56,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":187,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":187,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showFilterModal' is assigned a value but never used.","line":192,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":192,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Team Management Screen - Enhanced for Owners\r\n * =============================================\r\n *\r\n * Phase 2.5.1: Team Management\r\n * - Performance metrics per technician\r\n * - Status indicators (active, on job, available)\r\n * - Role management\r\n * - Invite functionality\r\n * - Workload visualization\r\n */\r\n\r\nimport { useState, useCallback, useMemo } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  TextInput,\r\n  TouchableOpacity,\r\n  RefreshControl,\r\n  Modal,\r\n  ScrollView,\r\n  Alert,\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\nimport { FlashList } from '@shopify/flash-list';\r\nimport { useRouter } from 'expo-router';\r\nimport {\r\n  Search,\r\n  Plus,\r\n  Phone,\r\n  Mail,\r\n  ChevronRight,\r\n  User,\r\n  Shield,\r\n  Wrench,\r\n  X,\r\n  Check,\r\n  Star,\r\n  TrendingUp,\r\n  Clock,\r\n  MapPin,\r\n  Filter,\r\n  UserPlus,\r\n  MoreVertical,\r\n  Edit2,\r\n  Trash2,\r\n  Send,\r\n  Activity,\r\n  CheckCircle2,\r\n  AlertCircle,\r\n} from 'lucide-react-native';\r\nimport * as Linking from 'expo-linking';\r\nimport { withObservables } from '@nozbe/watermelondb/react';\r\nimport { Q } from '@nozbe/watermelondb';\r\nimport { database } from '../../../watermelon/database';\r\nimport { useAuth } from '../../../lib/auth/auth-context';\r\n\r\n// Role definitions\r\nconst ROLES = ['OWNER', 'ADMIN', 'DISPATCHER', 'TECHNICIAN', 'VIEWER'] as const;\r\ntype Role = typeof ROLES[number];\r\n\r\nconst ROLE_LABELS: Record<string, string> = {\r\n  OWNER: 'Due├▒o',\r\n  ADMIN: 'Administrador',\r\n  DISPATCHER: 'Despachador',\r\n  TECHNICIAN: 'T├⌐cnico',\r\n  VIEWER: 'Solo lectura',\r\n};\r\n\r\nconst SKILL_LABELS: Record<string, string> = {\r\n  AYUDANTE: 'Ayudante',\r\n  MEDIO_OFICIAL: 'Medio Oficial',\r\n  OFICIAL: 'Oficial',\r\n  OFICIAL_ESPECIALIZADO: 'Oficial Especializado',\r\n};\r\n\r\nconst STATUS_COLORS = {\r\n  available: '#10b981',\r\n  on_job: '#3b82f6',\r\n  offline: '#9ca3af',\r\n  busy: '#f59e0b',\r\n};\r\n\r\ninterface TeamMember {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  email: string | null;\r\n  role: Role;\r\n  specialty: string;\r\n  skillLevel: string;\r\n  isVerified: boolean;\r\n  status: 'available' | 'on_job' | 'offline' | 'busy';\r\n  currentJobId?: string;\r\n  metrics: {\r\n    completedJobs: number;\r\n    avgRating: number;\r\n    avgCompletionTime: number; // in minutes\r\n    onTimeRate: number; // percentage\r\n  };\r\n  location?: {\r\n    lat: number;\r\n    lng: number;\r\n    lastUpdate: string;\r\n  };\r\n}\r\n\r\n// Mock data with enhanced metrics\r\nconst MOCK_TEAM: TeamMember[] = [\r\n  {\r\n    id: '1',\r\n    name: 'Carlos Rodriguez',\r\n    phone: '+5491155551234',\r\n    email: 'carlos@example.com',\r\n    role: 'TECHNICIAN',\r\n    specialty: 'Instalaci├│n de splits',\r\n    skillLevel: 'OFICIAL',\r\n    isVerified: true,\r\n    status: 'on_job',\r\n    currentJobId: 'job-123',\r\n    metrics: {\r\n      completedJobs: 156,\r\n      avgRating: 4.8,\r\n      avgCompletionTime: 95,\r\n      onTimeRate: 94,\r\n    },\r\n    location: { lat: -34.6037, lng: -58.3816, lastUpdate: new Date().toISOString() },\r\n  },\r\n  {\r\n    id: '2',\r\n    name: 'Mar├¡a Garc├¡a',\r\n    phone: '+5491155555678',\r\n    email: 'maria@example.com',\r\n    role: 'TECHNICIAN',\r\n    specialty: 'Reparaci├│n de aires',\r\n    skillLevel: 'MEDIO_OFICIAL',\r\n    isVerified: true,\r\n    status: 'available',\r\n    metrics: {\r\n      completedJobs: 89,\r\n      avgRating: 4.6,\r\n      avgCompletionTime: 110,\r\n      onTimeRate: 88,\r\n    },\r\n  },\r\n  {\r\n    id: '3',\r\n    name: 'Juan P├⌐rez',\r\n    phone: '+5491155559012',\r\n    email: null,\r\n    role: 'TECHNICIAN',\r\n    specialty: 'Mantenimiento',\r\n    skillLevel: 'AYUDANTE',\r\n    isVerified: false,\r\n    status: 'offline',\r\n    metrics: {\r\n      completedJobs: 34,\r\n      avgRating: 4.2,\r\n      avgCompletionTime: 130,\r\n      onTimeRate: 76,\r\n    },\r\n  },\r\n  {\r\n    id: '4',\r\n    name: 'Diego Mart├¡nez',\r\n    phone: '+5491155553456',\r\n    email: 'diego@example.com',\r\n    role: 'DISPATCHER',\r\n    specialty: 'Coordinaci├│n',\r\n    skillLevel: 'OFICIAL',\r\n    isVerified: true,\r\n    status: 'available',\r\n    metrics: {\r\n      completedJobs: 0,\r\n      avgRating: 0,\r\n      avgCompletionTime: 0,\r\n      onTimeRate: 0,\r\n    },\r\n  },\r\n];\r\n\r\ntype FilterType = 'all' | 'available' | 'on_job' | 'technicians' | 'staff';\r\n\r\nexport default function TeamManagementScreen() {\r\n  const router = useRouter();\r\n  const { user } = useAuth();\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [team] = useState<TeamMember[]>(MOCK_TEAM);\r\n  const [filter, setFilter] = useState<FilterType>('all');\r\n  const [showFilterModal, setShowFilterModal] = useState(false);\r\n  const [showInviteModal, setShowInviteModal] = useState(false);\r\n  const [showMemberModal, setShowMemberModal] = useState(false);\r\n  const [selectedMember, setSelectedMember] = useState<TeamMember | null>(null);\r\n  const [inviteEmail, setInviteEmail] = useState('');\r\n  const [inviteRole, setInviteRole] = useState<Role>('TECHNICIAN');\r\n\r\n  // Calculate team stats\r\n  const teamStats = useMemo(() => {\r\n    const technicians = team.filter((m) => m.role === 'TECHNICIAN');\r\n    return {\r\n      total: team.length,\r\n      available: team.filter((m) => m.status === 'available').length,\r\n      onJob: team.filter((m) => m.status === 'on_job').length,\r\n      technicians: technicians.length,\r\n      avgRating: technicians.length > 0\r\n        ? technicians.reduce((sum, m) => sum + m.metrics.avgRating, 0) / technicians.length\r\n        : 0,\r\n      totalCompleted: technicians.reduce((sum, m) => sum + m.metrics.completedJobs, 0),\r\n    };\r\n  }, [team]);\r\n\r\n  // Filter team\r\n  const filteredTeam = useMemo(() => {\r\n    let result = team;\r\n\r\n    // Apply filter\r\n    switch (filter) {\r\n      case 'available':\r\n        result = result.filter((m) => m.status === 'available');\r\n        break;\r\n      case 'on_job':\r\n        result = result.filter((m) => m.status === 'on_job');\r\n        break;\r\n      case 'technicians':\r\n        result = result.filter((m) => m.role === 'TECHNICIAN');\r\n        break;\r\n      case 'staff':\r\n        result = result.filter((m) => m.role !== 'TECHNICIAN');\r\n        break;\r\n    }\r\n\r\n    // Apply search\r\n    if (searchQuery) {\r\n      const query = searchQuery.toLowerCase();\r\n      result = result.filter(\r\n        (member) =>\r\n          member.name.toLowerCase().includes(query) ||\r\n          member.phone?.toLowerCase().includes(query) ||\r\n          member.email?.toLowerCase().includes(query) ||\r\n          member.specialty?.toLowerCase().includes(query)\r\n      );\r\n    }\r\n\r\n    return result;\r\n  }, [team, filter, searchQuery]);\r\n\r\n  const onRefresh = useCallback(async () => {\r\n    setRefreshing(true);\r\n    setTimeout(() => setRefreshing(false), 1000);\r\n  }, []);\r\n\r\n  const handleCall = (phone: string) => {\r\n    Linking.openURL(`tel:${phone}`);\r\n  };\r\n\r\n  const handleEmail = (email: string) => {\r\n    Linking.openURL(`mailto:${email}`);\r\n  };\r\n\r\n  const handleMemberPress = (member: TeamMember) => {\r\n    setSelectedMember(member);\r\n    setShowMemberModal(true);\r\n  };\r\n\r\n  const handleInvite = () => {\r\n    if (!inviteEmail.includes('@')) {\r\n      Alert.alert('Error', 'Ingres├í un email v├ílido');\r\n      return;\r\n    }\r\n    // In production, send invite via API\r\n    Alert.alert(\r\n      'Invitaci├│n enviada',\r\n      `Se envi├│ una invitaci├│n a ${inviteEmail} como ${ROLE_LABELS[inviteRole]}`\r\n    );\r\n    setShowInviteModal(false);\r\n    setInviteEmail('');\r\n  };\r\n\r\n  const handleRemoveMember = (member: TeamMember) => {\r\n    Alert.alert(\r\n      'Eliminar miembro',\r\n      `┬┐Seguro que quer├⌐s eliminar a ${member.name} del equipo?`,\r\n      [\r\n        { text: 'Cancelar', style: 'cancel' },\r\n        {\r\n          text: 'Eliminar',\r\n          style: 'destructive',\r\n          onPress: () => {\r\n            // In production, remove via API\r\n            setShowMemberModal(false);\r\n          },\r\n        },\r\n      ]\r\n    );\r\n  };\r\n\r\n  const getStatusLabel = (status: TeamMember['status']) => {\r\n    switch (status) {\r\n      case 'available':\r\n        return 'Disponible';\r\n      case 'on_job':\r\n        return 'En trabajo';\r\n      case 'offline':\r\n        return 'Desconectado';\r\n      case 'busy':\r\n        return 'Ocupado';\r\n    }\r\n  };\r\n\r\n  const renderMember = ({ item: member }: { item: TeamMember }) => (\r\n    <TouchableOpacity\r\n      style={styles.memberCard}\r\n      onPress={() => handleMemberPress(member)}\r\n    >\r\n      <View style={styles.memberAvatar}>\r\n        <Text style={styles.memberAvatarText}>\r\n          {member.name[0]?.toUpperCase() || '?'}\r\n        </Text>\r\n        <View\r\n          style={[\r\n            styles.statusDot,\r\n            { backgroundColor: STATUS_COLORS[member.status] },\r\n          ]}\r\n        />\r\n      </View>\r\n\r\n      <View style={styles.memberInfo}>\r\n        <View style={styles.memberHeader}>\r\n          <Text style={styles.memberName}>{member.name}</Text>\r\n          <View style={[styles.roleBadge, getRoleBadgeStyle(member.role)]}>\r\n            <Text style={styles.roleBadgeText}>\r\n              {ROLE_LABELS[member.role] || member.role}\r\n            </Text>\r\n          </View>\r\n        </View>\r\n\r\n        <View style={styles.memberDetail}>\r\n          <Text style={[styles.statusText, { color: STATUS_COLORS[member.status] }]}>\r\n            {getStatusLabel(member.status)}\r\n          </Text>\r\n          {member.specialty && (\r\n            <>\r\n              <Text style={styles.detailDivider}>ΓÇó</Text>\r\n              <Text style={styles.memberDetailText}>{member.specialty}</Text>\r\n            </>\r\n          )}\r\n        </View>\r\n\r\n        {member.role === 'TECHNICIAN' && (\r\n          <View style={styles.metricsRow}>\r\n            <View style={styles.metricBadge}>\r\n              <Star size={10} color=\"#f59e0b\" />\r\n              <Text style={styles.metricText}>{member.metrics.avgRating.toFixed(1)}</Text>\r\n            </View>\r\n            <View style={styles.metricBadge}>\r\n              <CheckCircle2 size={10} color=\"#10b981\" />\r\n              <Text style={styles.metricText}>{member.metrics.completedJobs}</Text>\r\n            </View>\r\n            <View style={styles.metricBadge}>\r\n              <Clock size={10} color=\"#6b7280\" />\r\n              <Text style={styles.metricText}>{member.metrics.onTimeRate}%</Text>\r\n            </View>\r\n          </View>\r\n        )}\r\n      </View>\r\n\r\n      <View style={styles.memberActions}>\r\n        <TouchableOpacity\r\n          style={styles.actionButton}\r\n          onPress={() => handleCall(member.phone)}\r\n        >\r\n          <Phone size={16} color=\"#059669\" />\r\n        </TouchableOpacity>\r\n      </View>\r\n    </TouchableOpacity>\r\n  );\r\n\r\n  return (\r\n    <SafeAreaView style={styles.container} edges={['top']}>\r\n      {/* Header */}\r\n      <View style={styles.header}>\r\n        <View style={styles.headerRow}>\r\n          <View>\r\n            <Text style={styles.title}>Equipo</Text>\r\n            <Text style={styles.subtitle}>{team.length} miembros</Text>\r\n          </View>\r\n          <TouchableOpacity\r\n            style={styles.addButton}\r\n            onPress={() => setShowInviteModal(true)}\r\n          >\r\n            <UserPlus size={18} color=\"#fff\" />\r\n            <Text style={styles.addButtonText}>Invitar</Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n      </View>\r\n\r\n      {/* Stats Bar */}\r\n      <View style={styles.statsBar}>\r\n        <View style={styles.stat}>\r\n          <Text style={styles.statValue}>{teamStats.available}</Text>\r\n          <Text style={styles.statLabel}>Disponibles</Text>\r\n        </View>\r\n        <View style={styles.statDivider} />\r\n        <View style={styles.stat}>\r\n          <Text style={[styles.statValue, { color: '#3b82f6' }]}>{teamStats.onJob}</Text>\r\n          <Text style={styles.statLabel}>En trabajo</Text>\r\n        </View>\r\n        <View style={styles.statDivider} />\r\n        <View style={styles.stat}>\r\n          <View style={styles.ratingValue}>\r\n            <Star size={12} color=\"#f59e0b\" />\r\n            <Text style={styles.statValue}>{teamStats.avgRating.toFixed(1)}</Text>\r\n          </View>\r\n          <Text style={styles.statLabel}>Promedio</Text>\r\n        </View>\r\n        <View style={styles.statDivider} />\r\n        <View style={styles.stat}>\r\n          <Text style={[styles.statValue, { color: '#10b981' }]}>\r\n            {teamStats.totalCompleted}\r\n          </Text>\r\n          <Text style={styles.statLabel}>Completados</Text>\r\n        </View>\r\n      </View>\r\n\r\n      {/* Search and Filter */}\r\n      <View style={styles.searchRow}>\r\n        <View style={styles.searchContainer}>\r\n          <Search size={18} color=\"#9ca3af\" />\r\n          <TextInput\r\n            style={styles.searchInput}\r\n            placeholder=\"Buscar miembros...\"\r\n            placeholderTextColor=\"#9ca3af\"\r\n            value={searchQuery}\r\n            onChangeText={setSearchQuery}\r\n          />\r\n        </View>\r\n        <TouchableOpacity\r\n          style={[styles.filterButton, filter !== 'all' && styles.filterButtonActive]}\r\n          onPress={() => setShowFilterModal(true)}\r\n        >\r\n          <Filter size={18} color={filter !== 'all' ? '#fff' : '#6b7280'} />\r\n        </TouchableOpacity>\r\n      </View>\r\n\r\n      {/* Filter Pills */}\r\n      <ScrollView\r\n        horizontal\r\n        showsHorizontalScrollIndicator={false}\r\n        style={styles.filterPills}\r\n        contentContainerStyle={styles.filterPillsContent}\r\n      >\r\n        {[\r\n          { key: 'all', label: 'Todos' },\r\n          { key: 'available', label: 'Disponibles' },\r\n          { key: 'on_job', label: 'En trabajo' },\r\n          { key: 'technicians', label: 'T├⌐cnicos' },\r\n          { key: 'staff', label: 'Staff' },\r\n        ].map((f) => (\r\n          <TouchableOpacity\r\n            key={f.key}\r\n            style={[\r\n              styles.filterPill,\r\n              filter === f.key && styles.filterPillActive,\r\n            ]}\r\n            onPress={() => setFilter(f.key as FilterType)}\r\n          >\r\n            <Text\r\n              style={[\r\n                styles.filterPillText,\r\n                filter === f.key && styles.filterPillTextActive,\r\n              ]}\r\n            >\r\n              {f.label}\r\n            </Text>\r\n          </TouchableOpacity>\r\n        ))}\r\n      </ScrollView>\r\n\r\n      {/* Team List */}\r\n      <View style={styles.listContainer}>\r\n        <FlashList\r\n          data={filteredTeam}\r\n          renderItem={renderMember}\r\n          keyExtractor={(item) => item.id}\r\n          refreshControl={\r\n            <RefreshControl\r\n              refreshing={refreshing}\r\n              onRefresh={onRefresh}\r\n              tintColor=\"#059669\"\r\n            />\r\n          }\r\n          ListEmptyComponent={\r\n            <View style={styles.emptyState}>\r\n              <User size={48} color=\"#d1d5db\" />\r\n              <Text style={styles.emptyTitle}>\r\n                {searchQuery ? 'Sin resultados' : 'No hay miembros'}\r\n              </Text>\r\n              <Text style={styles.emptySubtitle}>\r\n                {searchQuery\r\n                  ? 'Prob├í con otra b├║squeda'\r\n                  : 'Invit├í a tu primer miembro del equipo'}\r\n              </Text>\r\n            </View>\r\n          }\r\n          ItemSeparatorComponent={() => <View style={styles.separator} />}\r\n        />\r\n      </View>\r\n\r\n      {/* Invite Modal */}\r\n      <Modal\r\n        visible={showInviteModal}\r\n        transparent\r\n        animationType=\"slide\"\r\n        onRequestClose={() => setShowInviteModal(false)}\r\n      >\r\n        <View style={styles.modalOverlay}>\r\n          <View style={styles.modalContent}>\r\n            <View style={styles.modalHeader}>\r\n              <Text style={styles.modalTitle}>Invitar miembro</Text>\r\n              <TouchableOpacity\r\n                style={styles.modalClose}\r\n                onPress={() => setShowInviteModal(false)}\r\n              >\r\n                <X size={24} color=\"#6b7280\" />\r\n              </TouchableOpacity>\r\n            </View>\r\n\r\n            <View style={styles.modalBody}>\r\n              <Text style={styles.inputLabel}>Email</Text>\r\n              <TextInput\r\n                style={styles.textInput}\r\n                placeholder=\"email@ejemplo.com\"\r\n                placeholderTextColor=\"#9ca3af\"\r\n                keyboardType=\"email-address\"\r\n                autoCapitalize=\"none\"\r\n                value={inviteEmail}\r\n                onChangeText={setInviteEmail}\r\n              />\r\n\r\n              <Text style={[styles.inputLabel, { marginTop: 16 }]}>Rol</Text>\r\n              <View style={styles.roleSelector}>\r\n                {ROLES.filter((r) => r !== 'OWNER').map((role) => (\r\n                  <TouchableOpacity\r\n                    key={role}\r\n                    style={[\r\n                      styles.roleOption,\r\n                      inviteRole === role && styles.roleOptionActive,\r\n                    ]}\r\n                    onPress={() => setInviteRole(role)}\r\n                  >\r\n                    <Text\r\n                      style={[\r\n                        styles.roleOptionText,\r\n                        inviteRole === role && styles.roleOptionTextActive,\r\n                      ]}\r\n                    >\r\n                      {ROLE_LABELS[role]}\r\n                    </Text>\r\n                  </TouchableOpacity>\r\n                ))}\r\n              </View>\r\n\r\n              <TouchableOpacity style={styles.inviteButton} onPress={handleInvite}>\r\n                <Send size={18} color=\"#fff\" />\r\n                <Text style={styles.inviteButtonText}>Enviar invitaci├│n</Text>\r\n              </TouchableOpacity>\r\n            </View>\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n\r\n      {/* Member Detail Modal */}\r\n      <Modal\r\n        visible={showMemberModal}\r\n        transparent\r\n        animationType=\"slide\"\r\n        onRequestClose={() => setShowMemberModal(false)}\r\n      >\r\n        <View style={styles.modalOverlay}>\r\n          <View style={styles.modalContentLarge}>\r\n            <View style={styles.modalHeader}>\r\n              <Text style={styles.modalTitle}>Detalles del miembro</Text>\r\n              <TouchableOpacity\r\n                style={styles.modalClose}\r\n                onPress={() => setShowMemberModal(false)}\r\n              >\r\n                <X size={24} color=\"#6b7280\" />\r\n              </TouchableOpacity>\r\n            </View>\r\n\r\n            {selectedMember && (\r\n              <ScrollView style={styles.memberDetailContent}>\r\n                {/* Profile */}\r\n                <View style={styles.memberProfile}>\r\n                  <View style={styles.profileAvatar}>\r\n                    <Text style={styles.profileAvatarText}>\r\n                      {selectedMember.name[0]?.toUpperCase()}\r\n                    </Text>\r\n                    <View\r\n                      style={[\r\n                        styles.profileStatusDot,\r\n                        { backgroundColor: STATUS_COLORS[selectedMember.status] },\r\n                      ]}\r\n                    />\r\n                  </View>\r\n                  <Text style={styles.profileName}>{selectedMember.name}</Text>\r\n                  <View style={styles.profileBadges}>\r\n                    <View\r\n                      style={[styles.roleBadge, getRoleBadgeStyle(selectedMember.role)]}\r\n                    >\r\n                      <Text style={styles.roleBadgeText}>\r\n                        {ROLE_LABELS[selectedMember.role]}\r\n                      </Text>\r\n                    </View>\r\n                    <View style={styles.skillBadge}>\r\n                      <Text style={styles.skillBadgeText}>\r\n                        {SKILL_LABELS[selectedMember.skillLevel]}\r\n                      </Text>\r\n                    </View>\r\n                  </View>\r\n                  {!selectedMember.isVerified && (\r\n                    <View style={styles.unverifiedAlert}>\r\n                      <AlertCircle size={14} color=\"#f59e0b\" />\r\n                      <Text style={styles.unverifiedAlertText}>\r\n                        Cuenta no verificada\r\n                      </Text>\r\n                    </View>\r\n                  )}\r\n                </View>\r\n\r\n                {/* Contact Actions */}\r\n                <View style={styles.contactActions}>\r\n                  <TouchableOpacity\r\n                    style={styles.contactButton}\r\n                    onPress={() => handleCall(selectedMember.phone)}\r\n                  >\r\n                    <Phone size={20} color=\"#059669\" />\r\n                    <Text style={styles.contactButtonText}>Llamar</Text>\r\n                  </TouchableOpacity>\r\n                  {selectedMember.email && (\r\n                    <TouchableOpacity\r\n                      style={styles.contactButton}\r\n                      onPress={() => handleEmail(selectedMember.email!)}\r\n                    >\r\n                      <Mail size={20} color=\"#3b82f6\" />\r\n                      <Text style={styles.contactButtonText}>Email</Text>\r\n                    </TouchableOpacity>\r\n                  )}\r\n                  {selectedMember.location && (\r\n                    <TouchableOpacity style={styles.contactButton}>\r\n                      <MapPin size={20} color=\"#8b5cf6\" />\r\n                      <Text style={styles.contactButtonText}>Ubicaci├│n</Text>\r\n                    </TouchableOpacity>\r\n                  )}\r\n                </View>\r\n\r\n                {/* Performance Metrics */}\r\n                {selectedMember.role === 'TECHNICIAN' && (\r\n                  <View style={styles.metricsSection}>\r\n                    <Text style={styles.sectionTitle}>Rendimiento</Text>\r\n                    <View style={styles.metricsGrid}>\r\n                      <View style={styles.metricCard}>\r\n                        <View style={styles.metricCardHeader}>\r\n                          <Star size={16} color=\"#f59e0b\" />\r\n                          <Text style={styles.metricCardValue}>\r\n                            {selectedMember.metrics.avgRating.toFixed(1)}\r\n                          </Text>\r\n                        </View>\r\n                        <Text style={styles.metricCardLabel}>Calificaci├│n</Text>\r\n                      </View>\r\n                      <View style={styles.metricCard}>\r\n                        <View style={styles.metricCardHeader}>\r\n                          <CheckCircle2 size={16} color=\"#10b981\" />\r\n                          <Text style={styles.metricCardValue}>\r\n                            {selectedMember.metrics.completedJobs}\r\n                          </Text>\r\n                        </View>\r\n                        <Text style={styles.metricCardLabel}>Completados</Text>\r\n                      </View>\r\n                      <View style={styles.metricCard}>\r\n                        <View style={styles.metricCardHeader}>\r\n                          <Clock size={16} color=\"#6b7280\" />\r\n                          <Text style={styles.metricCardValue}>\r\n                            {selectedMember.metrics.avgCompletionTime}m\r\n                          </Text>\r\n                        </View>\r\n                        <Text style={styles.metricCardLabel}>Tiempo prom.</Text>\r\n                      </View>\r\n                      <View style={styles.metricCard}>\r\n                        <View style={styles.metricCardHeader}>\r\n                          <TrendingUp size={16} color=\"#3b82f6\" />\r\n                          <Text style={styles.metricCardValue}>\r\n                            {selectedMember.metrics.onTimeRate}%\r\n                          </Text>\r\n                        </View>\r\n                        <Text style={styles.metricCardLabel}>Puntualidad</Text>\r\n                      </View>\r\n                    </View>\r\n                  </View>\r\n                )}\r\n\r\n                {/* Actions */}\r\n                <View style={styles.memberActions2}>\r\n                  <TouchableOpacity\r\n                    style={styles.memberActionButton}\r\n                    onPress={() => router.push(`/team/${selectedMember.id}/edit` as any)}\r\n                  >\r\n                    <Edit2 size={18} color=\"#374151\" />\r\n                    <Text style={styles.memberActionText}>Editar perfil</Text>\r\n                  </TouchableOpacity>\r\n                  <TouchableOpacity\r\n                    style={[styles.memberActionButton, styles.memberActionDanger]}\r\n                    onPress={() => handleRemoveMember(selectedMember)}\r\n                  >\r\n                    <Trash2 size={18} color=\"#dc2626\" />\r\n                    <Text style={[styles.memberActionText, { color: '#dc2626' }]}>\r\n                      Eliminar\r\n                    </Text>\r\n                  </TouchableOpacity>\r\n                </View>\r\n              </ScrollView>\r\n            )}\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\nfunction getRoleBadgeStyle(role: string) {\r\n  switch (role) {\r\n    case 'OWNER':\r\n      return { backgroundColor: '#fef3c7' };\r\n    case 'ADMIN':\r\n      return { backgroundColor: '#dbeafe' };\r\n    case 'DISPATCHER':\r\n      return { backgroundColor: '#e0e7ff' };\r\n    default:\r\n      return { backgroundColor: '#f3f4f6' };\r\n  }\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f9fafb',\r\n  },\r\n  header: {\r\n    paddingHorizontal: 16,\r\n    paddingTop: 16,\r\n    paddingBottom: 8,\r\n    backgroundColor: '#fff',\r\n  },\r\n  headerRow: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'flex-start',\r\n  },\r\n  title: {\r\n    fontSize: 28,\r\n    fontWeight: '700',\r\n    color: '#111827',\r\n  },\r\n  subtitle: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n  },\r\n  addButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n    backgroundColor: '#059669',\r\n    paddingHorizontal: 14,\r\n    paddingVertical: 10,\r\n    borderRadius: 8,\r\n  },\r\n  addButtonText: {\r\n    color: '#fff',\r\n    fontWeight: '600',\r\n    fontSize: 14,\r\n  },\r\n  statsBar: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    paddingVertical: 12,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  stat: {\r\n    alignItems: 'center',\r\n    paddingHorizontal: 12,\r\n  },\r\n  statValue: {\r\n    fontSize: 18,\r\n    fontWeight: '700',\r\n    color: '#111827',\r\n  },\r\n  statLabel: {\r\n    fontSize: 10,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  statDivider: {\r\n    width: 1,\r\n    height: 24,\r\n    backgroundColor: '#e5e7eb',\r\n  },\r\n  ratingValue: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n  },\r\n  searchRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    paddingHorizontal: 16,\r\n    paddingTop: 12,\r\n    gap: 8,\r\n  },\r\n  searchContainer: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 10,\r\n    paddingHorizontal: 14,\r\n    paddingVertical: 10,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 10,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  searchInput: {\r\n    flex: 1,\r\n    fontSize: 15,\r\n    color: '#111827',\r\n  },\r\n  filterButton: {\r\n    width: 44,\r\n    height: 44,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 10,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  filterButtonActive: {\r\n    backgroundColor: '#059669',\r\n    borderColor: '#059669',\r\n  },\r\n  filterPills: {\r\n    maxHeight: 44,\r\n    marginTop: 8,\r\n  },\r\n  filterPillsContent: {\r\n    paddingHorizontal: 16,\r\n    gap: 8,\r\n  },\r\n  filterPill: {\r\n    paddingHorizontal: 14,\r\n    paddingVertical: 8,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 20,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    marginRight: 8,\r\n  },\r\n  filterPillActive: {\r\n    backgroundColor: '#059669',\r\n    borderColor: '#059669',\r\n  },\r\n  filterPillText: {\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n    color: '#6b7280',\r\n  },\r\n  filterPillTextActive: {\r\n    color: '#fff',\r\n  },\r\n  listContainer: {\r\n    flex: 1,\r\n    marginTop: 8,\r\n  },\r\n  memberCard: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#fff',\r\n  },\r\n  memberAvatar: {\r\n    width: 48,\r\n    height: 48,\r\n    borderRadius: 24,\r\n    backgroundColor: '#e5e7eb',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  memberAvatarText: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#6b7280',\r\n  },\r\n  statusDot: {\r\n    position: 'absolute',\r\n    bottom: 0,\r\n    right: 0,\r\n    width: 14,\r\n    height: 14,\r\n    borderRadius: 7,\r\n    borderWidth: 2,\r\n    borderColor: '#fff',\r\n  },\r\n  memberInfo: {\r\n    flex: 1,\r\n    marginLeft: 12,\r\n  },\r\n  memberHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n    flexWrap: 'wrap',\r\n  },\r\n  memberName: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  roleBadge: {\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 2,\r\n    borderRadius: 4,\r\n  },\r\n  roleBadgeText: {\r\n    fontSize: 10,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n  },\r\n  memberDetail: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    marginTop: 4,\r\n  },\r\n  statusText: {\r\n    fontSize: 12,\r\n    fontWeight: '500',\r\n  },\r\n  detailDivider: {\r\n    marginHorizontal: 6,\r\n    color: '#d1d5db',\r\n  },\r\n  memberDetailText: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    flex: 1,\r\n  },\r\n  metricsRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n    marginTop: 6,\r\n  },\r\n  metricBadge: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 3,\r\n    backgroundColor: '#f3f4f6',\r\n    paddingHorizontal: 6,\r\n    paddingVertical: 2,\r\n    borderRadius: 4,\r\n  },\r\n  metricText: {\r\n    fontSize: 11,\r\n    fontWeight: '500',\r\n    color: '#374151',\r\n  },\r\n  memberActions: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n  },\r\n  actionButton: {\r\n    width: 36,\r\n    height: 36,\r\n    borderRadius: 18,\r\n    backgroundColor: '#f3f4f6',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  separator: {\r\n    height: 1,\r\n    backgroundColor: '#f3f4f6',\r\n    marginLeft: 76,\r\n  },\r\n  emptyState: {\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    paddingVertical: 64,\r\n  },\r\n  emptyTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    marginTop: 16,\r\n  },\r\n  emptySubtitle: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginTop: 8,\r\n    textAlign: 'center',\r\n  },\r\n  // Modal styles\r\n  modalOverlay: {\r\n    flex: 1,\r\n    backgroundColor: 'rgba(0,0,0,0.5)',\r\n    justifyContent: 'flex-end',\r\n  },\r\n  modalContent: {\r\n    backgroundColor: '#fff',\r\n    borderTopLeftRadius: 20,\r\n    borderTopRightRadius: 20,\r\n  },\r\n  modalContentLarge: {\r\n    backgroundColor: '#fff',\r\n    borderTopLeftRadius: 20,\r\n    borderTopRightRadius: 20,\r\n    maxHeight: '85%',\r\n  },\r\n  modalHeader: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    padding: 16,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  modalTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  modalClose: {\r\n    width: 36,\r\n    height: 36,\r\n    borderRadius: 18,\r\n    backgroundColor: '#f3f4f6',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  modalBody: {\r\n    padding: 16,\r\n    paddingBottom: 32,\r\n  },\r\n  inputLabel: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#374151',\r\n    marginBottom: 8,\r\n  },\r\n  textInput: {\r\n    backgroundColor: '#f9fafb',\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    borderRadius: 10,\r\n    paddingHorizontal: 14,\r\n    paddingVertical: 12,\r\n    fontSize: 16,\r\n    color: '#111827',\r\n  },\r\n  roleSelector: {\r\n    flexDirection: 'row',\r\n    flexWrap: 'wrap',\r\n    gap: 8,\r\n  },\r\n  roleOption: {\r\n    paddingHorizontal: 14,\r\n    paddingVertical: 10,\r\n    backgroundColor: '#f3f4f6',\r\n    borderRadius: 8,\r\n    borderWidth: 2,\r\n    borderColor: 'transparent',\r\n  },\r\n  roleOptionActive: {\r\n    backgroundColor: '#ecfdf5',\r\n    borderColor: '#059669',\r\n  },\r\n  roleOptionText: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#6b7280',\r\n  },\r\n  roleOptionTextActive: {\r\n    color: '#059669',\r\n  },\r\n  inviteButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#059669',\r\n    paddingVertical: 14,\r\n    borderRadius: 10,\r\n    marginTop: 24,\r\n  },\r\n  inviteButtonText: {\r\n    color: '#fff',\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n  },\r\n  // Member detail modal\r\n  memberDetailContent: {\r\n    padding: 16,\r\n  },\r\n  memberProfile: {\r\n    alignItems: 'center',\r\n    paddingVertical: 16,\r\n  },\r\n  profileAvatar: {\r\n    width: 80,\r\n    height: 80,\r\n    borderRadius: 40,\r\n    backgroundColor: '#e5e7eb',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  profileAvatarText: {\r\n    fontSize: 32,\r\n    fontWeight: '600',\r\n    color: '#6b7280',\r\n  },\r\n  profileStatusDot: {\r\n    position: 'absolute',\r\n    bottom: 4,\r\n    right: 4,\r\n    width: 20,\r\n    height: 20,\r\n    borderRadius: 10,\r\n    borderWidth: 3,\r\n    borderColor: '#fff',\r\n  },\r\n  profileName: {\r\n    fontSize: 22,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginTop: 12,\r\n  },\r\n  profileBadges: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n    marginTop: 8,\r\n  },\r\n  skillBadge: {\r\n    backgroundColor: '#f3f4f6',\r\n    paddingHorizontal: 10,\r\n    paddingVertical: 4,\r\n    borderRadius: 6,\r\n  },\r\n  skillBadgeText: {\r\n    fontSize: 12,\r\n    fontWeight: '500',\r\n    color: '#6b7280',\r\n  },\r\n  unverifiedAlert: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n    backgroundColor: '#fef3c7',\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 6,\r\n    borderRadius: 6,\r\n    marginTop: 12,\r\n  },\r\n  unverifiedAlertText: {\r\n    fontSize: 12,\r\n    fontWeight: '500',\r\n    color: '#92400e',\r\n  },\r\n  contactActions: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'center',\r\n    gap: 16,\r\n    paddingVertical: 16,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  contactButton: {\r\n    alignItems: 'center',\r\n    gap: 6,\r\n    paddingHorizontal: 20,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#f9fafb',\r\n    borderRadius: 12,\r\n  },\r\n  contactButtonText: {\r\n    fontSize: 12,\r\n    fontWeight: '500',\r\n    color: '#374151',\r\n  },\r\n  metricsSection: {\r\n    paddingVertical: 16,\r\n  },\r\n  sectionTitle: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginBottom: 12,\r\n  },\r\n  metricsGrid: {\r\n    flexDirection: 'row',\r\n    flexWrap: 'wrap',\r\n    gap: 12,\r\n  },\r\n  metricCard: {\r\n    flex: 1,\r\n    minWidth: '45%',\r\n    backgroundColor: '#f9fafb',\r\n    padding: 12,\r\n    borderRadius: 10,\r\n  },\r\n  metricCardHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n  },\r\n  metricCardValue: {\r\n    fontSize: 20,\r\n    fontWeight: '700',\r\n    color: '#111827',\r\n  },\r\n  metricCardLabel: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n  },\r\n  memberActions2: {\r\n    gap: 12,\r\n    paddingVertical: 16,\r\n    paddingBottom: 32,\r\n  },\r\n  memberActionButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#f3f4f6',\r\n    paddingVertical: 14,\r\n    borderRadius: 10,\r\n  },\r\n  memberActionDanger: {\r\n    backgroundColor: '#fee2e2',\r\n  },\r\n  memberActionText: {\r\n    fontSize: 15,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\(tabs)\\today.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TouchableOpacity' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":19},{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":22,"column":25,"nodeType":"Literal","endLine":22,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'database' is defined but never used.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":18},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":48,"column":15,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":48,"endColumn":78,"fix":{"range":[1588,1651],"text":"{ url: string; jobIds: string[]; segmentNumber: number }[]"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\r\n * Today's Jobs Screen\r\n * ===================\r\n *\r\n * Shows jobs scheduled for today with quick status updates.\r\n *\r\n * Role-based filtering:\r\n * - TECHNICIAN: Only sees their assigned jobs\r\n * - OWNER/DISPATCHER: Sees all organization jobs\r\n */\r\n\r\nimport { useCallback, useMemo, useState, useEffect } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  RefreshControl,\r\n  TouchableOpacity,\r\n} from 'react-native';\r\nimport { FlashList } from '@shopify/flash-list';\r\nimport { useRouter } from 'expo-router';\r\nimport { Feather } from '@expo/vector-icons';\r\nimport { withObservables } from '@nozbe/watermelondb/react';\r\nimport { Q } from '@nozbe/watermelondb';\r\n\r\nimport { database, jobsCollection } from '../../watermelon/database';\r\nimport { Job } from '../../watermelon/models';\r\nimport { performSync } from '../../lib/sync/sync-engine';\r\nimport { useSyncStatus } from '../../lib/hooks/use-sync-status';\r\nimport { useAuth } from '../../lib/auth/auth-context';\r\nimport JobCard from '../../components/job/JobCard';\r\nimport RouteButton, { NewRouteBanner } from '../../components/RouteButton';\r\nimport { api } from '../../lib/api/client';\r\n\r\n// Get today's date range\r\nfunction getTodayRange() {\r\n  const start = new Date();\r\n  start.setHours(0, 0, 0, 0);\r\n  const end = new Date();\r\n  end.setHours(23, 59, 59, 999);\r\n  return { start: start.getTime(), end: end.getTime() };\r\n}\r\n\r\nfunction TodayScreen({ jobs }: { jobs: Job[] }) {\r\n  const router = useRouter();\r\n  const { isSyncing, pendingOperations } = useSyncStatus();\r\n  const [route, setRoute] = useState<{\r\n    segments: Array<{ url: string; jobIds: string[]; segmentNumber: number }>;\r\n    totalJobs: number;\r\n    totalDistance: number;\r\n    totalDuration: number;\r\n    primaryUrl: string;\r\n    totalSegments: number;\r\n  } | null>(null);\r\n  const [showNewRouteBanner, setShowNewRouteBanner] = useState(false);\r\n\r\n  // Fetch today's route\r\n  useEffect(() => {\r\n    api.routes.getToday().then((response) => {\r\n      if (response.success && response.data) {\r\n        setRoute(response.data);\r\n      }\r\n    }).catch((err) => {\r\n      console.error('Failed to fetch route:', err);\r\n    });\r\n  }, []);\r\n\r\n  const handleRefresh = useCallback(async () => {\r\n    await performSync();\r\n    // Refresh route too\r\n    const routeResponse = await api.routes.getToday();\r\n    if (routeResponse.success && routeResponse.data) {\r\n      setRoute(routeResponse.data);\r\n    }\r\n  }, []);\r\n\r\n  const handleJobPress = useCallback(\r\n    (job: Job) => {\r\n      router.push(`/(tabs)/jobs/${job.id}`);\r\n    },\r\n    [router]\r\n  );\r\n\r\n  // Group jobs by status\r\n  const groupedJobs = useMemo(() => {\r\n    const groups = {\r\n      active: [] as Job[],\r\n      upcoming: [] as Job[],\r\n      completed: [] as Job[],\r\n    };\r\n\r\n    // Guard against undefined jobs (WatermelonDB may not be ready on web)\r\n    if (!jobs || !Array.isArray(jobs)) {\r\n      return groups;\r\n    }\r\n\r\n    jobs.forEach((job) => {\r\n      if (job.status === 'en_camino' || job.status === 'working') {\r\n        groups.active.push(job);\r\n      } else if (job.status === 'completed' || job.status === 'cancelled') {\r\n        groups.completed.push(job);\r\n      } else {\r\n        groups.upcoming.push(job);\r\n      }\r\n    });\r\n\r\n    // Sort by scheduled time\r\n    const sortByTime = (a: Job, b: Job) =>\r\n      (a.scheduledStart || 0) - (b.scheduledStart || 0);\r\n\r\n    groups.active.sort(sortByTime);\r\n    groups.upcoming.sort(sortByTime);\r\n    groups.completed.sort(sortByTime);\r\n\r\n    return groups;\r\n  }, [jobs]);\r\n\r\n  const renderSection = (title: string, data: Job[], icon: string, color: string) => {\r\n    if (data.length === 0) return null;\r\n\r\n    return (\r\n      <View style={styles.section}>\r\n        <View style={styles.sectionHeader}>\r\n          <Feather name={icon as any} size={16} color={color} />\r\n          <Text style={[styles.sectionTitle, { color }]}>{title}</Text>\r\n          <View style={[styles.badge, { backgroundColor: color }]}>\r\n            <Text style={styles.badgeText}>{data.length}</Text>\r\n          </View>\r\n        </View>\r\n        {data.map((job) => (\r\n          <JobCard\r\n            key={job.id}\r\n            job={job}\r\n            onPress={() => handleJobPress(job)}\r\n          />\r\n        ))}\r\n      </View>\r\n    );\r\n  };\r\n\r\n  const ListHeader = () => (\r\n    <>\r\n      <View style={styles.headerStats}>\r\n        <View style={styles.stat}>\r\n          <Text style={styles.statNumber}>{jobs?.length || 0}</Text>\r\n          <Text style={styles.statLabel}>Total</Text>\r\n        </View>\r\n        <View style={styles.stat}>\r\n          <Text style={[styles.statNumber, { color: '#16a34a' }]}>\r\n            {groupedJobs.completed.length}\r\n          </Text>\r\n          <Text style={styles.statLabel}>Completados</Text>\r\n        </View>\r\n        <View style={styles.stat}>\r\n          <Text style={[styles.statNumber, { color: '#f59e0b' }]}>\r\n            {groupedJobs.upcoming.length}\r\n          </Text>\r\n          <Text style={styles.statLabel}>Pendientes</Text>\r\n        </View>\r\n      </View>\r\n\r\n      {/* Route Navigation Button */}\r\n      {route && route.totalJobs > 0 && (\r\n        <View style={styles.routeContainer}>\r\n          <RouteButton\r\n            url={route.primaryUrl}\r\n            jobCount={route.totalJobs}\r\n            segmentNumber={1}\r\n            totalSegments={route.totalSegments}\r\n            distanceMeters={route.totalDistance}\r\n            durationSeconds={route.totalDuration}\r\n          />\r\n        </View>\r\n      )}\r\n\r\n      {/* New Route Banner (shown after milestone completion) */}\r\n      {showNewRouteBanner && route && (\r\n        <View style={styles.routeContainer}>\r\n          <NewRouteBanner\r\n            remainingJobs={groupedJobs.upcoming.length}\r\n            onPress={() => {\r\n              setShowNewRouteBanner(false);\r\n              if (route.primaryUrl) {\r\n                import('react-native').then(({ Linking }) => {\r\n                  Linking.openURL(route.primaryUrl);\r\n                });\r\n              }\r\n            }}\r\n          />\r\n        </View>\r\n      )}\r\n    </>\r\n  );\r\n\r\n  const ListEmpty = () => (\r\n    <View style={styles.empty}>\r\n      <Feather name=\"calendar\" size={48} color=\"#d1d5db\" />\r\n      <Text style={styles.emptyTitle}>No hay trabajos para hoy</Text>\r\n      <Text style={styles.emptyText}>\r\n        Los trabajos programados para hoy aparecer├ín aqu├¡\r\n      </Text>\r\n    </View>\r\n  );\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <FlashList\r\n        data={[1]} // Single item to render sections\r\n        renderItem={() => (\r\n          <>\r\n            <ListHeader />\r\n            {renderSection('En progreso', groupedJobs.active, 'play-circle', '#3b82f6')}\r\n            {renderSection('Pr├│ximos', groupedJobs.upcoming, 'clock', '#f59e0b')}\r\n            {renderSection('Completados', groupedJobs.completed, 'check-circle', '#16a34a')}\r\n          </>\r\n        )}\r\n        refreshControl={\r\n          <RefreshControl\r\n            refreshing={isSyncing}\r\n            onRefresh={handleRefresh}\r\n            colors={['#16a34a']}\r\n            tintColor=\"#16a34a\"\r\n          />\r\n        }\r\n        ListEmptyComponent={<ListEmpty />}\r\n        contentContainerStyle={styles.listContent}\r\n      />\r\n\r\n      {/* Pending sync indicator */}\r\n      {pendingOperations > 0 && (\r\n        <View style={styles.pendingBadge}>\r\n          <Feather name=\"cloud-off\" size={14} color=\"#fff\" />\r\n          <Text style={styles.pendingText}>\r\n            {pendingOperations} cambio{pendingOperations > 1 ? 's' : ''} pendiente\r\n            {pendingOperations > 1 ? 's' : ''}\r\n          </Text>\r\n        </View>\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n\r\n// Observe today's jobs from WatermelonDB with role-based filtering\r\nconst enhance = withObservables(\r\n  ['userId', 'userRole'],\r\n  ({ userId, userRole }: { userId: string; userRole: string }) => {\r\n    const { start, end } = getTodayRange();\r\n    const isTechnician = userRole?.toUpperCase() === 'TECHNICIAN';\r\n\r\n    // Build query conditions\r\n    const conditions = [\r\n      Q.where('scheduled_start', Q.gte(start)),\r\n      Q.where('scheduled_start', Q.lte(end)),\r\n    ];\r\n\r\n    // Technicians only see their assigned jobs\r\n    if (isTechnician && userId) {\r\n      conditions.push(Q.where('assigned_to_id', userId));\r\n    }\r\n\r\n    return {\r\n      jobs: jobsCollection.query(...conditions, Q.sortBy('scheduled_start', Q.asc)),\r\n    };\r\n  }\r\n);\r\n\r\n// Wrapper to inject auth context into the enhanced component\r\nfunction TodayScreenWrapper() {\r\n  const { user } = useAuth();\r\n  const EnhancedScreen = enhance(TodayScreen);\r\n\r\n  return (\r\n    <EnhancedScreen\r\n      userId={user?.id || ''}\r\n      userRole={user?.role || 'TECHNICIAN'}\r\n    />\r\n  );\r\n}\r\n\r\nexport default TodayScreenWrapper;\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  listContent: {\r\n    paddingBottom: 100,\r\n  },\r\n  headerStats: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-around',\r\n    backgroundColor: '#fff',\r\n    paddingVertical: 16,\r\n    marginBottom: 8,\r\n  },\r\n  stat: {\r\n    alignItems: 'center',\r\n  },\r\n  statNumber: {\r\n    fontSize: 24,\r\n    fontWeight: 'bold',\r\n    color: '#111827',\r\n  },\r\n  statLabel: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  section: {\r\n    marginBottom: 8,\r\n  },\r\n  sectionHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  sectionTitle: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    marginLeft: 8,\r\n    flex: 1,\r\n  },\r\n  badge: {\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 2,\r\n    borderRadius: 12,\r\n  },\r\n  badgeText: {\r\n    color: '#fff',\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n  },\r\n  empty: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    paddingVertical: 64,\r\n    paddingHorizontal: 32,\r\n  },\r\n  emptyTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    marginTop: 16,\r\n  },\r\n  emptyText: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    textAlign: 'center',\r\n    marginTop: 8,\r\n  },\r\n  pendingBadge: {\r\n    position: 'absolute',\r\n    bottom: 16,\r\n    left: 16,\r\n    right: 16,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#f59e0b',\r\n    paddingVertical: 12,\r\n    borderRadius: 12,\r\n  },\r\n  pendingText: {\r\n    color: '#fff',\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n  },\r\n  routeContainer: {\r\n    paddingHorizontal: 16,\r\n    paddingBottom: 8,\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\_layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\app\\settings\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\babel.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\RouteButton.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":12,"column":25,"nodeType":"Literal","endLine":12,"endColumn":45}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Route Button Component\r\n * =======================\r\n *\r\n * Phase 2.3 Task 2.3.5: Mobile App Route Integration\r\n *\r\n * Button that opens Google Maps with optimized route for\r\n * the technician's daily jobs.\r\n */\r\n\r\nimport { TouchableOpacity, View, Text, StyleSheet, Linking, Alert } from 'react-native';\r\nimport { Feather } from '@expo/vector-icons';\r\n\r\ninterface RouteButtonProps {\r\n    url: string;\r\n    jobCount: number;\r\n    segmentNumber?: number;\r\n    totalSegments?: number;\r\n    distanceMeters?: number;\r\n    durationSeconds?: number;\r\n    compact?: boolean;\r\n}\r\n\r\n/**\r\n * Format duration from seconds to human readable\r\n */\r\nfunction formatDuration(seconds: number): string {\r\n    if (seconds < 60) return `${seconds}s`;\r\n    const minutes = Math.floor(seconds / 60);\r\n    if (minutes < 60) return `${minutes} min`;\r\n    const hours = Math.floor(minutes / 60);\r\n    const remainingMinutes = minutes % 60;\r\n    return `${hours}h ${remainingMinutes}m`;\r\n}\r\n\r\n/**\r\n * Format distance from meters to km\r\n */\r\nfunction formatDistance(meters: number): string {\r\n    if (meters < 1000) return `${meters}m`;\r\n    const km = (meters / 1000).toFixed(1);\r\n    return `${km} km`;\r\n}\r\n\r\nexport default function RouteButton({\r\n    url,\r\n    jobCount,\r\n    segmentNumber,\r\n    totalSegments,\r\n    distanceMeters,\r\n    durationSeconds,\r\n    compact = false,\r\n}: RouteButtonProps) {\r\n    const handlePress = async () => {\r\n        try {\r\n            const canOpen = await Linking.canOpenURL(url);\r\n            if (canOpen) {\r\n                await Linking.openURL(url);\r\n            } else {\r\n                Alert.alert('Error', 'No se puede abrir Google Maps');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error opening maps:', error);\r\n            Alert.alert('Error', 'No se puede abrir Google Maps');\r\n        }\r\n    };\r\n\r\n    const hasMultipleSegments = totalSegments && totalSegments > 1;\r\n\r\n    if (compact) {\r\n        return (\r\n            <TouchableOpacity style={styles.compactButton} onPress={handlePress}>\r\n                <View style={styles.iconCircle}>\r\n                    <Feather name=\"navigation\" size={18} color=\"#fff\" />\r\n                </View>\r\n                <Text style={styles.compactButtonText}>Navegar</Text>\r\n            </TouchableOpacity>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <TouchableOpacity style={styles.button} onPress={handlePress}>\r\n            <View style={styles.content}>\r\n                <View style={styles.iconContainer}>\r\n                    <Feather name=\"navigation\" size={24} color=\"#fff\" />\r\n                </View>\r\n                <View style={styles.textContainer}>\r\n                    <Text style={styles.mainText}>\r\n                        Navegar todos ({jobCount} trabajos)\r\n                    </Text>\r\n                    {hasMultipleSegments && (\r\n                        <Text style={styles.segmentText}>\r\n                            Ruta {segmentNumber} de {totalSegments}\r\n                        </Text>\r\n                    )}\r\n                    {(distanceMeters || durationSeconds) && (\r\n                        <Text style={styles.detailText}>\r\n                            {distanceMeters && formatDistance(distanceMeters)}\r\n                            {distanceMeters && durationSeconds && ' ΓÇó '}\r\n                            {durationSeconds && formatDuration(durationSeconds)}\r\n                        </Text>\r\n                    )}\r\n                </View>\r\n                <Feather name=\"chevron-right\" size={24} color=\"#fff\" style={styles.chevron} />\r\n            </View>\r\n        </TouchableOpacity>\r\n    );\r\n}\r\n\r\n/**\r\n * New Route Banner - shown after 10th job completion\r\n */\r\nexport function NewRouteBanner({\r\n    remainingJobs,\r\n    onPress,\r\n}: {\r\n    remainingJobs: number;\r\n    onPress: () => void;\r\n}) {\r\n    return (\r\n        <TouchableOpacity style={styles.banner} onPress={onPress}>\r\n            <View style={styles.bannerIcon}>\r\n                <Text style={styles.bannerEmoji}>≡ƒÄë</Text>\r\n            </View>\r\n            <View style={styles.bannerContent}>\r\n                <Text style={styles.bannerTitle}>┬íNueva ruta generada!</Text>\r\n                <Text style={styles.bannerText}>\r\n                    {remainingJobs} trabajos restantes. Toca para ver la nueva ruta.\r\n                </Text>\r\n            </View>\r\n            <Feather name=\"chevron-right\" size={20} color=\"#16a34a\" />\r\n        </TouchableOpacity>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    button: {\r\n        backgroundColor: '#3b82f6',\r\n        borderRadius: 12,\r\n        padding: 16,\r\n        marginBottom: 16,\r\n    },\r\n    content: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n    },\r\n    iconContainer: {\r\n        width: 44,\r\n        height: 44,\r\n        borderRadius: 22,\r\n        backgroundColor: 'rgba(255, 255, 255, 0.2)',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        marginRight: 12,\r\n    },\r\n    textContainer: {\r\n        flex: 1,\r\n    },\r\n    mainText: {\r\n        fontSize: 16,\r\n        fontWeight: '600',\r\n        color: '#fff',\r\n    },\r\n    segmentText: {\r\n        fontSize: 13,\r\n        color: 'rgba(255, 255, 255, 0.8)',\r\n        marginTop: 2,\r\n    },\r\n    detailText: {\r\n        fontSize: 12,\r\n        color: 'rgba(255, 255, 255, 0.7)',\r\n        marginTop: 4,\r\n    },\r\n    chevron: {\r\n        opacity: 0.8,\r\n    },\r\n    // Compact style\r\n    compactButton: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        backgroundColor: '#3b82f6',\r\n        paddingVertical: 8,\r\n        paddingHorizontal: 12,\r\n        borderRadius: 8,\r\n        gap: 6,\r\n    },\r\n    iconCircle: {\r\n        width: 28,\r\n        height: 28,\r\n        borderRadius: 14,\r\n        backgroundColor: 'rgba(255, 255, 255, 0.2)',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n    },\r\n    compactButtonText: {\r\n        fontSize: 14,\r\n        fontWeight: '600',\r\n        color: '#fff',\r\n    },\r\n    // Banner styles\r\n    banner: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        backgroundColor: '#f0fdf4',\r\n        borderWidth: 1,\r\n        borderColor: '#bbf7d0',\r\n        borderRadius: 12,\r\n        padding: 12,\r\n        marginBottom: 16,\r\n    },\r\n    bannerIcon: {\r\n        marginRight: 12,\r\n    },\r\n    bannerEmoji: {\r\n        fontSize: 24,\r\n    },\r\n    bannerContent: {\r\n        flex: 1,\r\n    },\r\n    bannerTitle: {\r\n        fontSize: 15,\r\n        fontWeight: '600',\r\n        color: '#166534',\r\n    },\r\n    bannerText: {\r\n        fontSize: 13,\r\n        color: '#16a34a',\r\n        marginTop: 2,\r\n    },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\badge\\DigitalBadge.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileCheck' is defined but never used.","line":25,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":92,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":92,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":112,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":112,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Digital Badge Component\r\n * =======================\r\n * \r\n * Phase 4.3 Task 4.3.4: Mobile Badge Screen\r\n * \r\n * Displays a QR code badge for technicians to show when entering\r\n * gated communities (Countries). Shows ART insurance and\r\n * background check verification status.\r\n */\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n    View,\r\n    Text,\r\n    StyleSheet,\r\n    TouchableOpacity,\r\n    ActivityIndicator,\r\n    Alert,\r\n    Dimensions,\r\n} from 'react-native';\r\nimport {\r\n    QrCode,\r\n    Shield,\r\n    FileCheck,\r\n    AlertCircle,\r\n    CheckCircle,\r\n    XCircle,\r\n    Clock,\r\n    RefreshCw,\r\n} from 'lucide-react-native';\r\nimport { api } from '../../lib/api/client';\r\nimport { useAuth } from '../../lib/auth/auth-context';\r\n\r\n// Note: You'll need to install react-native-qrcode-svg:\r\n// pnpm add react-native-qrcode-svg react-native-svg\r\n// For now, we'll show a placeholder\r\n\r\ninterface BadgeVerification {\r\n    artStatus: 'valid' | 'expiring' | 'expired' | 'missing';\r\n    artExpiry: string | null;\r\n    artProvider: string | null;\r\n    artPolicyNumber: string | null;\r\n    backgroundCheck: 'pending' | 'approved' | 'rejected' | 'expired';\r\n    backgroundCheckDate: string | null;\r\n    backgroundCheckProvider: string | null;\r\n}\r\n\r\ninterface BadgeData {\r\n    technician: {\r\n        id: string;\r\n        name: string;\r\n        photo: string | null;\r\n        specialty: string | null;\r\n        phone: string;\r\n    };\r\n    organization: {\r\n        id: string;\r\n        name: string;\r\n        logo: string | null;\r\n    };\r\n    verification: BadgeVerification;\r\n    qrPayload: string;\r\n    generatedAt: string;\r\n    validUntil: string | null;\r\n    isValid: boolean;\r\n}\r\n\r\ninterface DigitalBadgeProps {\r\n    onClose?: () => void;\r\n}\r\n\r\nexport function DigitalBadge({ onClose }: DigitalBadgeProps) {\r\n    const { user } = useAuth();\r\n    const [badge, setBadge] = useState<BadgeData | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [refreshing, setRefreshing] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const loadBadge = useCallback(async () => {\r\n        if (!user?.id) return;\r\n\r\n        try {\r\n            setError(null);\r\n            const response = await api.badge.get(user.id);\r\n\r\n            if (response.success && response.data) {\r\n                setBadge(response.data);\r\n            } else {\r\n                setError(response.error?.message || 'Error cargando credencial');\r\n            }\r\n        } catch (err) {\r\n            setError('Error de conexi├│n');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [user?.id]);\r\n\r\n    const handleRefresh = async () => {\r\n        if (!user?.id) return;\r\n\r\n        setRefreshing(true);\r\n        try {\r\n            const response = await api.badge.refresh(user.id);\r\n\r\n            if (response.success && response.data) {\r\n                setBadge(response.data);\r\n                Alert.alert('Credencial renovada', 'Tu credencial ha sido renovada correctamente');\r\n            } else {\r\n                Alert.alert('Error', response.error?.message || 'No se pudo renovar la credencial');\r\n            }\r\n        } catch (err) {\r\n            Alert.alert('Error', 'Error de conexi├│n al renovar');\r\n        } finally {\r\n            setRefreshing(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadBadge();\r\n    }, [loadBadge]);\r\n\r\n    const getARTStatusDisplay = (status: BadgeVerification['artStatus']) => {\r\n        switch (status) {\r\n            case 'valid':\r\n                return { icon: CheckCircle, text: 'ART Vigente', color: '#059669', bgColor: '#ecfdf5' };\r\n            case 'expiring':\r\n                return { icon: AlertCircle, text: 'ART Por Vencer', color: '#d97706', bgColor: '#fffbeb' };\r\n            case 'expired':\r\n                return { icon: XCircle, text: 'ART Vencida', color: '#dc2626', bgColor: '#fef2f2' };\r\n            case 'missing':\r\n                return { icon: AlertCircle, text: 'Sin ART', color: '#6b7280', bgColor: '#f9fafb' };\r\n        }\r\n    };\r\n\r\n    const getBackgroundCheckDisplay = (status: BadgeVerification['backgroundCheck']) => {\r\n        switch (status) {\r\n            case 'approved':\r\n                return { icon: CheckCircle, text: 'Antecedentes Verificados', color: '#059669', bgColor: '#ecfdf5' };\r\n            case 'pending':\r\n                return { icon: Clock, text: 'Verificaci├│n Pendiente', color: '#d97706', bgColor: '#fffbeb' };\r\n            case 'rejected':\r\n                return { icon: XCircle, text: 'Verificaci├│n Rechazada', color: '#dc2626', bgColor: '#fef2f2' };\r\n            case 'expired':\r\n                return { icon: AlertCircle, text: 'Verificaci├│n Expirada', color: '#d97706', bgColor: '#fffbeb' };\r\n        }\r\n    };\r\n\r\n    const formatDate = (dateStr: string | null) => {\r\n        if (!dateStr) return null;\r\n        return new Date(dateStr).toLocaleDateString('es-AR');\r\n    };\r\n\r\n    const getDaysUntilExpiry = (dateStr: string | null) => {\r\n        if (!dateStr) return null;\r\n        const expiry = new Date(dateStr);\r\n        const now = new Date();\r\n        const diffMs = expiry.getTime() - now.getTime();\r\n        return Math.ceil(diffMs / (1000 * 60 * 60 * 24));\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <View style={styles.loadingContainer}>\r\n                <ActivityIndicator size=\"large\" color=\"#059669\" />\r\n                <Text style={styles.loadingText}>Cargando credencial...</Text>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    if (error) {\r\n        return (\r\n            <View style={styles.errorContainer}>\r\n                <AlertCircle size={48} color=\"#dc2626\" />\r\n                <Text style={styles.errorText}>{error}</Text>\r\n                <TouchableOpacity style={styles.retryButton} onPress={loadBadge}>\r\n                    <Text style={styles.retryButtonText}>Reintentar</Text>\r\n                </TouchableOpacity>\r\n            </View>\r\n        );\r\n    }\r\n\r\n    if (!badge) {\r\n        return null;\r\n    }\r\n\r\n    const artStatus = getARTStatusDisplay(badge.verification.artStatus);\r\n    const bgCheckStatus = getBackgroundCheckDisplay(badge.verification.backgroundCheck);\r\n    const ARTIcon = artStatus.icon;\r\n    const BGCheckIcon = bgCheckStatus.icon;\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            {/* Header */}\r\n            <View style={[styles.header, { backgroundColor: badge.isValid ? '#059669' : '#d97706' }]}>\r\n                <Shield size={24} color=\"#fff\" />\r\n                <Text style={styles.headerTitle}>\r\n                    {badge.isValid ? 'CREDENCIAL V├üLIDA' : 'CREDENCIAL PARCIAL'}\r\n                </Text>\r\n            </View>\r\n\r\n            {/* QR Code */}\r\n            <View style={styles.qrContainer}>\r\n                <View style={styles.qrPlaceholder}>\r\n                    <QrCode size={120} color=\"#111827\" />\r\n                    <Text style={styles.qrHint}>QR Code</Text>\r\n                </View>\r\n                <Text style={styles.qrInstruction}>\r\n                    Mostr├í este c├│digo al ingresar a countries o barrios cerrados\r\n                </Text>\r\n            </View>\r\n\r\n            {/* Technician Info */}\r\n            <View style={styles.infoSection}>\r\n                <View style={styles.avatar}>\r\n                    <Text style={styles.avatarText}>\r\n                        {badge.technician.name[0].toUpperCase()}\r\n                    </Text>\r\n                </View>\r\n                <Text style={styles.techName}>{badge.technician.name}</Text>\r\n                {badge.technician.specialty && (\r\n                    <Text style={styles.techSpecialty}>{badge.technician.specialty}</Text>\r\n                )}\r\n                <Text style={styles.orgName}>{badge.organization.name}</Text>\r\n            </View>\r\n\r\n            {/* Verification Status */}\r\n            <View style={styles.verificationSection}>\r\n                {/* ART Status */}\r\n                <View style={[styles.statusCard, { backgroundColor: artStatus.bgColor }]}>\r\n                    <ARTIcon size={24} color={artStatus.color} />\r\n                    <View style={styles.statusInfo}>\r\n                        <Text style={[styles.statusText, { color: artStatus.color }]}>\r\n                            {artStatus.text}\r\n                        </Text>\r\n                        {badge.verification.artProvider && (\r\n                            <Text style={styles.statusDetail}>\r\n                                {badge.verification.artProvider}\r\n                                {badge.verification.artExpiry && (\r\n                                    <>\r\n                                        {' '}ΓÇó Vence {formatDate(badge.verification.artExpiry)}\r\n                                        {badge.verification.artStatus === 'expiring' && (\r\n                                            <Text style={{ color: '#d97706' }}>\r\n                                                {' '}({getDaysUntilExpiry(badge.verification.artExpiry)} d├¡as)\r\n                                            </Text>\r\n                                        )}\r\n                                    </>\r\n                                )}\r\n                            </Text>\r\n                        )}\r\n                    </View>\r\n                </View>\r\n\r\n                {/* Background Check Status */}\r\n                <View style={[styles.statusCard, { backgroundColor: bgCheckStatus.bgColor }]}>\r\n                    <BGCheckIcon size={24} color={bgCheckStatus.color} />\r\n                    <View style={styles.statusInfo}>\r\n                        <Text style={[styles.statusText, { color: bgCheckStatus.color }]}>\r\n                            {bgCheckStatus.text}\r\n                        </Text>\r\n                        {badge.verification.backgroundCheckDate && (\r\n                            <Text style={styles.statusDetail}>\r\n                                Verificado el {formatDate(badge.verification.backgroundCheckDate)}\r\n                                {badge.verification.backgroundCheckProvider && (\r\n                                    <> por {badge.verification.backgroundCheckProvider}</>\r\n                                )}\r\n                            </Text>\r\n                        )}\r\n                    </View>\r\n                </View>\r\n            </View>\r\n\r\n            {/* Validity */}\r\n            {badge.validUntil && (\r\n                <View style={styles.validitySection}>\r\n                    <Clock size={16} color=\"#6b7280\" />\r\n                    <Text style={styles.validityText}>\r\n                        V├ílida hasta: {formatDate(badge.validUntil)}\r\n                    </Text>\r\n                </View>\r\n            )}\r\n\r\n            {/* Refresh Button */}\r\n            <TouchableOpacity\r\n                style={styles.refreshButton}\r\n                onPress={handleRefresh}\r\n                disabled={refreshing}\r\n            >\r\n                <RefreshCw\r\n                    size={18}\r\n                    color=\"#fff\"\r\n                    style={refreshing ? styles.rotating : undefined}\r\n                />\r\n                <Text style={styles.refreshButtonText}>\r\n                    {refreshing ? 'Renovando...' : 'Renovar credencial'}\r\n                </Text>\r\n            </TouchableOpacity>\r\n\r\n            {/* Footer */}\r\n            <Text style={styles.footer}>\r\n                Credencial emitida por CampoTech\r\n            </Text>\r\n        </View>\r\n    );\r\n}\r\n\r\nconst { width } = Dimensions.get('window');\r\nconst qrSize = Math.min(width * 0.5, 200);\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n        backgroundColor: '#fff',\r\n    },\r\n    loadingContainer: {\r\n        flex: 1,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        gap: 16,\r\n    },\r\n    loadingText: {\r\n        fontSize: 16,\r\n        color: '#6b7280',\r\n    },\r\n    errorContainer: {\r\n        flex: 1,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        padding: 24,\r\n        gap: 16,\r\n    },\r\n    errorText: {\r\n        fontSize: 16,\r\n        color: '#dc2626',\r\n        textAlign: 'center',\r\n    },\r\n    retryButton: {\r\n        paddingHorizontal: 24,\r\n        paddingVertical: 12,\r\n        backgroundColor: '#059669',\r\n        borderRadius: 8,\r\n    },\r\n    retryButtonText: {\r\n        color: '#fff',\r\n        fontSize: 16,\r\n        fontWeight: '600',\r\n    },\r\n    header: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        gap: 12,\r\n        paddingVertical: 16,\r\n    },\r\n    headerTitle: {\r\n        fontSize: 18,\r\n        fontWeight: '700',\r\n        color: '#fff',\r\n    },\r\n    qrContainer: {\r\n        alignItems: 'center',\r\n        paddingVertical: 24,\r\n    },\r\n    qrPlaceholder: {\r\n        width: qrSize,\r\n        height: qrSize,\r\n        backgroundColor: '#f9fafb',\r\n        borderWidth: 1,\r\n        borderColor: '#e5e7eb',\r\n        borderRadius: 12,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n    },\r\n    qrHint: {\r\n        marginTop: 8,\r\n        fontSize: 12,\r\n        color: '#9ca3af',\r\n    },\r\n    qrInstruction: {\r\n        marginTop: 16,\r\n        fontSize: 14,\r\n        color: '#6b7280',\r\n        textAlign: 'center',\r\n        paddingHorizontal: 24,\r\n    },\r\n    infoSection: {\r\n        alignItems: 'center',\r\n        paddingBottom: 16,\r\n        borderBottomWidth: 1,\r\n        borderBottomColor: '#e5e7eb',\r\n        marginHorizontal: 16,\r\n    },\r\n    avatar: {\r\n        width: 56,\r\n        height: 56,\r\n        borderRadius: 28,\r\n        backgroundColor: '#059669',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        marginBottom: 12,\r\n    },\r\n    avatarText: {\r\n        fontSize: 24,\r\n        fontWeight: '600',\r\n        color: '#fff',\r\n    },\r\n    techName: {\r\n        fontSize: 20,\r\n        fontWeight: '600',\r\n        color: '#111827',\r\n    },\r\n    techSpecialty: {\r\n        fontSize: 14,\r\n        color: '#6b7280',\r\n        marginTop: 4,\r\n    },\r\n    orgName: {\r\n        fontSize: 14,\r\n        color: '#9ca3af',\r\n        marginTop: 4,\r\n    },\r\n    verificationSection: {\r\n        padding: 16,\r\n        gap: 12,\r\n    },\r\n    statusCard: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        padding: 16,\r\n        borderRadius: 12,\r\n        gap: 12,\r\n    },\r\n    statusInfo: {\r\n        flex: 1,\r\n    },\r\n    statusText: {\r\n        fontSize: 16,\r\n        fontWeight: '600',\r\n    },\r\n    statusDetail: {\r\n        fontSize: 13,\r\n        color: '#6b7280',\r\n        marginTop: 2,\r\n    },\r\n    validitySection: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        gap: 8,\r\n        paddingVertical: 12,\r\n        marginHorizontal: 16,\r\n        backgroundColor: '#f9fafb',\r\n        borderRadius: 8,\r\n    },\r\n    validityText: {\r\n        fontSize: 14,\r\n        color: '#6b7280',\r\n    },\r\n    refreshButton: {\r\n        flexDirection: 'row',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        gap: 8,\r\n        backgroundColor: '#059669',\r\n        marginHorizontal: 16,\r\n        marginTop: 16,\r\n        paddingVertical: 14,\r\n        borderRadius: 12,\r\n    },\r\n    refreshButtonText: {\r\n        fontSize: 16,\r\n        fontWeight: '600',\r\n        color: '#fff',\r\n    },\r\n    rotating: {\r\n        // Animation would be handled with Animated API in production\r\n    },\r\n    footer: {\r\n        textAlign: 'center',\r\n        fontSize: 12,\r\n        color: '#9ca3af',\r\n        marginTop: 16,\r\n        marginBottom: 24,\r\n    },\r\n});\r\n\r\nexport default DigitalBadge;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\badge\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\common\\LazyScreen.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\consumer\\BadgeList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\consumer\\BusinessCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\consumer\\CategoryGrid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\consumer\\QuoteCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\consumer\\RatingStars.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\consumer\\ReviewCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\consumer\\ServiceRequestCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\consumer\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\inventory\\BarcodeScanner.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":20,"column":25,"nodeType":"Literal","endLine":20,"endColumn":45}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Barcode Scanner Component\r\n * =========================\r\n *\r\n * Camera-based barcode scanner for quick product lookup.\r\n * Uses dynamic imports to prevent expo-camera web code from loading on native.\r\n */\r\n\r\nimport { useState, useEffect, useCallback, useRef } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  TouchableOpacity,\r\n  Modal,\r\n  Dimensions,\r\n  Platform,\r\n  ActivityIndicator,\r\n} from 'react-native';\r\nimport { Feather } from '@expo/vector-icons';\r\n\r\n// Types for expo-camera (defined locally to avoid import-time issues)\r\ninterface BarcodeScanningResult {\r\n  data: string;\r\n  type: string;\r\n}\r\n\r\ninterface PermissionResponse {\r\n  granted: boolean;\r\n  canAskAgain: boolean;\r\n}\r\n\r\ninterface BarcodeScannerProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  onScan: (barcode: string, type: string) => void;\r\n}\r\n\r\nexport default function BarcodeScanner({\r\n  visible,\r\n  onClose,\r\n  onScan,\r\n}: BarcodeScannerProps) {\r\n  const [cameraModule, setCameraModule] = useState<any>(null);\r\n  const [permission, setPermission] = useState<PermissionResponse | null>(null);\r\n  const [scanned, setScanned] = useState(false);\r\n  const [torch, setTorch] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const moduleLoadAttempted = useRef(false);\r\n\r\n  // Dynamically load expo-camera only when component mounts\r\n  useEffect(() => {\r\n    if (moduleLoadAttempted.current) return;\r\n    moduleLoadAttempted.current = true;\r\n\r\n    // Only load expo-camera on native platforms\r\n    if (Platform.OS === 'web') {\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    import('expo-camera')\r\n      .then((module) => {\r\n        setCameraModule(module);\r\n        setIsLoading(false);\r\n      })\r\n      .catch((err) => {\r\n        console.error('Failed to load expo-camera:', err);\r\n        setIsLoading(false);\r\n      });\r\n  }, []);\r\n\r\n  // Request permissions when camera module is loaded and modal becomes visible\r\n  useEffect(() => {\r\n    if (!cameraModule || !visible) return;\r\n\r\n    const checkAndRequestPermission = async () => {\r\n      try {\r\n        const currentPermission = await cameraModule.Camera.getCameraPermissionsAsync();\r\n        if (currentPermission.granted) {\r\n          setPermission(currentPermission);\r\n        } else {\r\n          const newPermission = await cameraModule.Camera.requestCameraPermissionsAsync();\r\n          setPermission(newPermission);\r\n        }\r\n      } catch (err) {\r\n        console.error('Permission error:', err);\r\n      }\r\n    };\r\n\r\n    checkAndRequestPermission();\r\n  }, [cameraModule, visible]);\r\n\r\n  // Reset scanned state when modal opens\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setScanned(false);\r\n    }\r\n  }, [visible]);\r\n\r\n  const handleBarCodeScanned = useCallback(\r\n    (result: BarcodeScanningResult) => {\r\n      if (scanned) return;\r\n\r\n      setScanned(true);\r\n      onScan(result.data, result.type);\r\n    },\r\n    [scanned, onScan]\r\n  );\r\n\r\n  const handleScanAgain = useCallback(() => {\r\n    setScanned(false);\r\n  }, []);\r\n\r\n  const requestPermission = useCallback(async () => {\r\n    if (!cameraModule) return;\r\n    try {\r\n      const newPermission = await cameraModule.Camera.requestCameraPermissionsAsync();\r\n      setPermission(newPermission);\r\n    } catch (err) {\r\n      console.error('Permission request error:', err);\r\n    }\r\n  }, [cameraModule]);\r\n\r\n  if (!visible) return null;\r\n\r\n  // Loading state while expo-camera loads\r\n  if (isLoading) {\r\n    return (\r\n      <Modal visible={visible} animationType=\"slide\" onRequestClose={onClose}>\r\n        <View style={styles.container}>\r\n          <View style={styles.permissionContainer}>\r\n            <ActivityIndicator size=\"large\" color=\"#16a34a\" />\r\n            <Text style={styles.permissionTitle}>Cargando c├ímara...</Text>\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  // Web platform fallback\r\n  if (Platform.OS === 'web' || !cameraModule) {\r\n    return (\r\n      <Modal visible={visible} animationType=\"slide\" onRequestClose={onClose}>\r\n        <View style={styles.container}>\r\n          <View style={styles.permissionContainer}>\r\n            <Feather name=\"camera-off\" size={64} color=\"#9ca3af\" />\r\n            <Text style={styles.permissionTitle}>C├ímara no disponible</Text>\r\n            <Text style={styles.permissionText}>\r\n              El esc├íner de c├│digos no est├í disponible en esta plataforma\r\n            </Text>\r\n            <TouchableOpacity style={styles.closeButton} onPress={onClose}>\r\n              <Text style={styles.closeButtonText}>Cerrar</Text>\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  // Permission not granted\r\n  if (!permission?.granted) {\r\n    return (\r\n      <Modal visible={visible} animationType=\"slide\" onRequestClose={onClose}>\r\n        <View style={styles.container}>\r\n          <View style={styles.permissionContainer}>\r\n            <Feather name=\"camera-off\" size={64} color=\"#9ca3af\" />\r\n            <Text style={styles.permissionTitle}>Permiso de c├ímara</Text>\r\n            <Text style={styles.permissionText}>\r\n              Necesitamos acceso a la c├ímara para escanear c├│digos de barras\r\n            </Text>\r\n            <TouchableOpacity\r\n              style={styles.permissionButton}\r\n              onPress={requestPermission}\r\n            >\r\n              <Text style={styles.permissionButtonText}>Permitir acceso</Text>\r\n            </TouchableOpacity>\r\n            <TouchableOpacity style={styles.closeButton} onPress={onClose}>\r\n              <Text style={styles.closeButtonText}>Cancelar</Text>\r\n            </TouchableOpacity>\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  const CameraView = cameraModule.CameraView;\r\n\r\n  return (\r\n    <Modal visible={visible} animationType=\"slide\" onRequestClose={onClose}>\r\n      <View style={styles.container}>\r\n        <CameraView\r\n          style={StyleSheet.absoluteFillObject}\r\n          facing=\"back\"\r\n          enableTorch={torch}\r\n          barcodeScannerSettings={{\r\n            barcodeTypes: ['ean13', 'ean8', 'code128', 'code39', 'qr'],\r\n          }}\r\n          onBarcodeScanned={scanned ? undefined : handleBarCodeScanned}\r\n        />\r\n\r\n        {/* Overlay */}\r\n        <View style={styles.overlay}>\r\n          {/* Header */}\r\n          <View style={styles.header}>\r\n            <TouchableOpacity style={styles.headerButton} onPress={onClose}>\r\n              <Feather name=\"x\" size={24} color=\"#fff\" />\r\n            </TouchableOpacity>\r\n            <Text style={styles.headerTitle}>Escanear c├│digo</Text>\r\n            <TouchableOpacity\r\n              style={styles.headerButton}\r\n              onPress={() => setTorch(!torch)}\r\n            >\r\n              <Feather\r\n                name={torch ? 'zap-off' : 'zap'}\r\n                size={24}\r\n                color=\"#fff\"\r\n              />\r\n            </TouchableOpacity>\r\n          </View>\r\n\r\n          {/* Scanner frame */}\r\n          <View style={styles.frameContainer}>\r\n            <View style={styles.frame}>\r\n              <View style={[styles.corner, styles.cornerTopLeft]} />\r\n              <View style={[styles.corner, styles.cornerTopRight]} />\r\n              <View style={[styles.corner, styles.cornerBottomLeft]} />\r\n              <View style={[styles.corner, styles.cornerBottomRight]} />\r\n            </View>\r\n          </View>\r\n\r\n          {/* Instructions */}\r\n          <View style={styles.instructions}>\r\n            {scanned ? (\r\n              <TouchableOpacity\r\n                style={styles.scanAgainButton}\r\n                onPress={handleScanAgain}\r\n              >\r\n                <Feather name=\"refresh-cw\" size={20} color=\"#fff\" />\r\n                <Text style={styles.scanAgainText}>Escanear de nuevo</Text>\r\n              </TouchableOpacity>\r\n            ) : (\r\n              <Text style={styles.instructionText}>\r\n                Alinea el c├│digo de barras dentro del marco\r\n              </Text>\r\n            )}\r\n          </View>\r\n        </View>\r\n      </View>\r\n    </Modal>\r\n  );\r\n}\r\n\r\nconst { width } = Dimensions.get('window');\r\nconst FRAME_SIZE = width * 0.7;\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#000',\r\n  },\r\n  permissionContainer: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    padding: 32,\r\n  },\r\n  permissionTitle: {\r\n    fontSize: 20,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n    marginTop: 24,\r\n  },\r\n  permissionText: {\r\n    fontSize: 15,\r\n    color: '#9ca3af',\r\n    textAlign: 'center',\r\n    marginTop: 12,\r\n  },\r\n  permissionButton: {\r\n    backgroundColor: '#16a34a',\r\n    paddingHorizontal: 24,\r\n    paddingVertical: 12,\r\n    borderRadius: 8,\r\n    marginTop: 24,\r\n  },\r\n  permissionButtonText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  closeButton: {\r\n    marginTop: 16,\r\n  },\r\n  closeButtonText: {\r\n    fontSize: 16,\r\n    color: '#9ca3af',\r\n  },\r\n  overlay: {\r\n    ...StyleSheet.absoluteFillObject,\r\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingTop: 60,\r\n    paddingHorizontal: 16,\r\n  },\r\n  headerButton: {\r\n    padding: 8,\r\n  },\r\n  headerTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  frameContainer: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  frame: {\r\n    width: FRAME_SIZE,\r\n    height: FRAME_SIZE * 0.6,\r\n    position: 'relative',\r\n  },\r\n  corner: {\r\n    position: 'absolute',\r\n    width: 32,\r\n    height: 32,\r\n    borderColor: '#16a34a',\r\n  },\r\n  cornerTopLeft: {\r\n    top: 0,\r\n    left: 0,\r\n    borderTopWidth: 4,\r\n    borderLeftWidth: 4,\r\n  },\r\n  cornerTopRight: {\r\n    top: 0,\r\n    right: 0,\r\n    borderTopWidth: 4,\r\n    borderRightWidth: 4,\r\n  },\r\n  cornerBottomLeft: {\r\n    bottom: 0,\r\n    left: 0,\r\n    borderBottomWidth: 4,\r\n    borderLeftWidth: 4,\r\n  },\r\n  cornerBottomRight: {\r\n    bottom: 0,\r\n    right: 0,\r\n    borderBottomWidth: 4,\r\n    borderRightWidth: 4,\r\n  },\r\n  instructions: {\r\n    paddingVertical: 32,\r\n    alignItems: 'center',\r\n  },\r\n  instructionText: {\r\n    fontSize: 15,\r\n    color: '#fff',\r\n    opacity: 0.8,\r\n  },\r\n  scanAgainButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#16a34a',\r\n    paddingHorizontal: 24,\r\n    paddingVertical: 12,\r\n    borderRadius: 24,\r\n    gap: 8,\r\n  },\r\n  scanAgainText: {\r\n    fontSize: 16,\r\n    fontWeight: '500',\r\n    color: '#fff',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\inventory\\InventoryList.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":17,"column":25,"nodeType":"Literal","endLine":17,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'renderSectionHeader' is assigned a value but never used.","line":232,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":232,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Inventory List Component\r\n * ========================\r\n *\r\n * Reusable list component for displaying inventory items with filtering.\r\n */\r\n\r\nimport { useMemo, useCallback } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  TouchableOpacity,\r\n  FlatList,\r\n  RefreshControl,\r\n} from 'react-native';\r\nimport { Feather } from '@expo/vector-icons';\r\n\r\nimport { VehicleStock } from '../../watermelon/models';\r\n\r\ninterface InventoryListProps {\r\n  items: VehicleStock[];\r\n  isRefreshing?: boolean;\r\n  onRefresh?: () => void;\r\n  onItemPress?: (item: VehicleStock) => void;\r\n  onItemAction?: (item: VehicleStock, action: 'use' | 'adjust' | 'request') => void;\r\n  emptyMessage?: string;\r\n  showActions?: boolean;\r\n  filterLowStock?: boolean;\r\n  filterOutOfStock?: boolean;\r\n  groupByCategory?: boolean;\r\n  compact?: boolean;\r\n}\r\n\r\ninterface GroupedItems {\r\n  title: string;\r\n  data: VehicleStock[];\r\n}\r\n\r\nexport default function InventoryList({\r\n  items,\r\n  isRefreshing = false,\r\n  onRefresh,\r\n  onItemPress,\r\n  onItemAction,\r\n  emptyMessage = 'Sin productos en inventario',\r\n  showActions = false,\r\n  filterLowStock = false,\r\n  filterOutOfStock = false,\r\n  groupByCategory = false,\r\n  compact = false,\r\n}: InventoryListProps) {\r\n  // Filter items based on props\r\n  const filteredItems = useMemo(() => {\r\n    let result = items;\r\n\r\n    if (filterLowStock) {\r\n      result = result.filter(\r\n        (item) => item.needsReplenishment || item.quantity <= item.minQuantity\r\n      );\r\n    }\r\n\r\n    if (filterOutOfStock) {\r\n      result = result.filter((item) => item.quantity <= 0);\r\n    }\r\n\r\n    return result;\r\n  }, [items, filterLowStock, filterOutOfStock]);\r\n\r\n  // Group items by category if needed\r\n  const groupedData = useMemo(() => {\r\n    if (!groupByCategory) return null;\r\n\r\n    const groups: Record<string, VehicleStock[]> = {};\r\n\r\n    filteredItems.forEach((item) => {\r\n      // Using productSku prefix as pseudo-category for grouping\r\n      const category = item.productSku.split('-')[0] || 'Otros';\r\n      if (!groups[category]) {\r\n        groups[category] = [];\r\n      }\r\n      groups[category].push(item);\r\n    });\r\n\r\n    return Object.entries(groups)\r\n      .map(([title, data]) => ({ title, data }))\r\n      .sort((a, b) => a.title.localeCompare(b.title));\r\n  }, [filteredItems, groupByCategory]);\r\n\r\n  const getStockStatus = useCallback((item: VehicleStock) => {\r\n    if (item.quantity <= 0) return 'out';\r\n    if (item.quantity <= item.minQuantity || item.needsReplenishment) return 'low';\r\n    if (item.quantity >= item.maxQuantity) return 'full';\r\n    return 'ok';\r\n  }, []);\r\n\r\n  const getStatusColor = useCallback((status: string) => {\r\n    switch (status) {\r\n      case 'out':\r\n        return '#ef4444';\r\n      case 'low':\r\n        return '#f59e0b';\r\n      case 'full':\r\n        return '#3b82f6';\r\n      default:\r\n        return '#16a34a';\r\n    }\r\n  }, []);\r\n\r\n  const getStatusLabel = useCallback((status: string) => {\r\n    switch (status) {\r\n      case 'out':\r\n        return 'Agotado';\r\n      case 'low':\r\n        return 'Bajo';\r\n      case 'full':\r\n        return 'Completo';\r\n      default:\r\n        return 'OK';\r\n    }\r\n  }, []);\r\n\r\n  const renderItem = useCallback(\r\n    ({ item }: { item: VehicleStock }) => {\r\n      const status = getStockStatus(item);\r\n      const statusColor = getStatusColor(status);\r\n      const progress = item.maxQuantity > 0\r\n        ? Math.min(item.quantity / item.maxQuantity, 1)\r\n        : item.quantity > 0 ? 1 : 0;\r\n\r\n      return (\r\n        <TouchableOpacity\r\n          style={[styles.itemCard, compact && styles.itemCardCompact]}\r\n          onPress={() => onItemPress?.(item)}\r\n          activeOpacity={0.7}\r\n        >\r\n          <View style={styles.itemContent}>\r\n            {/* Product info */}\r\n            <View style={styles.itemInfo}>\r\n              <Text style={styles.itemName} numberOfLines={1}>\r\n                {item.productName}\r\n              </Text>\r\n              <Text style={styles.itemSku}>{item.productSku}</Text>\r\n            </View>\r\n\r\n            {/* Quantity display */}\r\n            <View style={styles.quantityContainer}>\r\n              <Text style={[styles.quantityText, { color: statusColor }]}>\r\n                {item.quantity}\r\n              </Text>\r\n              <Text style={styles.quantityLabel}>\r\n                / {item.maxQuantity}\r\n              </Text>\r\n            </View>\r\n\r\n            {/* Status badge */}\r\n            <View\r\n              style={[\r\n                styles.statusBadge,\r\n                { backgroundColor: `${statusColor}20` },\r\n              ]}\r\n            >\r\n              <Text style={[styles.statusText, { color: statusColor }]}>\r\n                {getStatusLabel(status)}\r\n              </Text>\r\n            </View>\r\n          </View>\r\n\r\n          {/* Progress bar */}\r\n          {!compact && (\r\n            <View style={styles.progressContainer}>\r\n              <View style={styles.progressBar}>\r\n                <View\r\n                  style={[\r\n                    styles.progressFill,\r\n                    {\r\n                      width: `${progress * 100}%`,\r\n                      backgroundColor: statusColor,\r\n                    },\r\n                  ]}\r\n                />\r\n              </View>\r\n              <Text style={styles.rangeText}>\r\n                Min: {item.minQuantity} | M├íx: {item.maxQuantity}\r\n              </Text>\r\n            </View>\r\n          )}\r\n\r\n          {/* Actions */}\r\n          {showActions && status !== 'out' && (\r\n            <View style={styles.actions}>\r\n              <TouchableOpacity\r\n                style={styles.actionButton}\r\n                onPress={() => onItemAction?.(item, 'use')}\r\n              >\r\n                <Feather name=\"minus-circle\" size={18} color=\"#6b7280\" />\r\n                <Text style={styles.actionText}>Usar</Text>\r\n              </TouchableOpacity>\r\n              <TouchableOpacity\r\n                style={styles.actionButton}\r\n                onPress={() => onItemAction?.(item, 'adjust')}\r\n              >\r\n                <Feather name=\"edit-3\" size={18} color=\"#6b7280\" />\r\n                <Text style={styles.actionText}>Ajustar</Text>\r\n              </TouchableOpacity>\r\n              {status === 'low' && (\r\n                <TouchableOpacity\r\n                  style={[styles.actionButton, styles.requestButton]}\r\n                  onPress={() => onItemAction?.(item, 'request')}\r\n                >\r\n                  <Feather name=\"refresh-cw\" size={18} color=\"#16a34a\" />\r\n                  <Text style={[styles.actionText, { color: '#16a34a' }]}>\r\n                    Reponer\r\n                  </Text>\r\n                </TouchableOpacity>\r\n              )}\r\n            </View>\r\n          )}\r\n\r\n          <Feather\r\n            name=\"chevron-right\"\r\n            size={20}\r\n            color=\"#9ca3af\"\r\n            style={styles.chevron}\r\n          />\r\n        </TouchableOpacity>\r\n      );\r\n    },\r\n    [compact, showActions, onItemPress, onItemAction, getStockStatus, getStatusColor, getStatusLabel]\r\n  );\r\n\r\n  const renderSectionHeader = useCallback(\r\n    ({ section }: { section: GroupedItems }) => (\r\n      <View style={styles.sectionHeader}>\r\n        <Text style={styles.sectionTitle}>{section.title}</Text>\r\n        <Text style={styles.sectionCount}>{section.data.length} items</Text>\r\n      </View>\r\n    ),\r\n    []\r\n  );\r\n\r\n  const renderEmpty = useCallback(\r\n    () => (\r\n      <View style={styles.emptyContainer}>\r\n        <Feather name=\"package\" size={48} color=\"#d1d5db\" />\r\n        <Text style={styles.emptyTitle}>{emptyMessage}</Text>\r\n        {filterLowStock && (\r\n          <Text style={styles.emptySubtitle}>\r\n            No hay productos con stock bajo\r\n          </Text>\r\n        )}\r\n      </View>\r\n    ),\r\n    [emptyMessage, filterLowStock]\r\n  );\r\n\r\n  const keyExtractor = useCallback((item: VehicleStock) => item.id, []);\r\n\r\n  // Use SectionList if grouped\r\n  if (groupByCategory && groupedData) {\r\n    return (\r\n      <FlatList\r\n        data={filteredItems}\r\n        renderItem={renderItem}\r\n        keyExtractor={keyExtractor}\r\n        ListEmptyComponent={renderEmpty}\r\n        refreshControl={\r\n          onRefresh ? (\r\n            <RefreshControl\r\n              refreshing={isRefreshing}\r\n              onRefresh={onRefresh}\r\n              colors={['#16a34a']}\r\n              tintColor=\"#16a34a\"\r\n            />\r\n          ) : undefined\r\n        }\r\n        contentContainerStyle={styles.listContent}\r\n        showsVerticalScrollIndicator={false}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <FlatList\r\n      data={filteredItems}\r\n      renderItem={renderItem}\r\n      keyExtractor={keyExtractor}\r\n      ListEmptyComponent={renderEmpty}\r\n      refreshControl={\r\n        onRefresh ? (\r\n          <RefreshControl\r\n            refreshing={isRefreshing}\r\n            onRefresh={onRefresh}\r\n            colors={['#16a34a']}\r\n            tintColor=\"#16a34a\"\r\n          />\r\n        ) : undefined\r\n      }\r\n      contentContainerStyle={styles.listContent}\r\n      showsVerticalScrollIndicator={false}\r\n    />\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  listContent: {\r\n    paddingBottom: 100,\r\n  },\r\n  sectionHeader: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 8,\r\n    backgroundColor: '#f3f4f6',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  sectionTitle: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n  },\r\n  sectionCount: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n  },\r\n  itemCard: {\r\n    backgroundColor: '#fff',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  itemCardCompact: {\r\n    paddingVertical: 8,\r\n  },\r\n  itemContent: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n  },\r\n  itemInfo: {\r\n    flex: 1,\r\n    marginRight: 12,\r\n  },\r\n  itemName: {\r\n    fontSize: 15,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  itemSku: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  quantityContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'baseline',\r\n    marginRight: 12,\r\n  },\r\n  quantityText: {\r\n    fontSize: 20,\r\n    fontWeight: 'bold',\r\n  },\r\n  quantityLabel: {\r\n    fontSize: 12,\r\n    color: '#9ca3af',\r\n    marginLeft: 2,\r\n  },\r\n  statusBadge: {\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 4,\r\n    borderRadius: 12,\r\n    marginRight: 8,\r\n  },\r\n  statusText: {\r\n    fontSize: 11,\r\n    fontWeight: '600',\r\n  },\r\n  progressContainer: {\r\n    marginTop: 8,\r\n  },\r\n  progressBar: {\r\n    height: 4,\r\n    backgroundColor: '#e5e7eb',\r\n    borderRadius: 2,\r\n    overflow: 'hidden',\r\n  },\r\n  progressFill: {\r\n    height: '100%',\r\n    borderRadius: 2,\r\n  },\r\n  rangeText: {\r\n    fontSize: 10,\r\n    color: '#9ca3af',\r\n    marginTop: 4,\r\n  },\r\n  actions: {\r\n    flexDirection: 'row',\r\n    marginTop: 10,\r\n    paddingTop: 10,\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#f3f4f6',\r\n    gap: 12,\r\n  },\r\n  actionButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n  },\r\n  requestButton: {\r\n    marginLeft: 'auto',\r\n  },\r\n  actionText: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n  },\r\n  chevron: {\r\n    position: 'absolute',\r\n    right: 16,\r\n    top: '50%',\r\n    marginTop: -10,\r\n  },\r\n  emptyContainer: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    paddingVertical: 64,\r\n    paddingHorizontal: 32,\r\n  },\r\n  emptyTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    marginTop: 16,\r\n    textAlign: 'center',\r\n  },\r\n  emptySubtitle: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginTop: 8,\r\n    textAlign: 'center',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\inventory\\JobMaterialsSelector.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":18,"column":25,"nodeType":"Literal","endLine":18,"endColumn":45}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Job Materials Selector Component\r\n * =================================\r\n *\r\n * Allows technicians to add materials to a job from their vehicle stock.\r\n */\r\n\r\nimport { useState, useCallback, useMemo } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  TouchableOpacity,\r\n  TextInput,\r\n  FlatList,\r\n  Modal,\r\n} from 'react-native';\r\nimport { Feather } from '@expo/vector-icons';\r\nimport { withObservables } from '@nozbe/watermelondb/react';\r\nimport { Q } from '@nozbe/watermelondb';\r\n\r\nimport { database } from '../../watermelon/database';\r\nimport { VehicleStock } from '../../watermelon/models';\r\nimport BarcodeScanner from './BarcodeScanner';\r\n\r\nconst vehicleStockCollection = database.get<VehicleStock>('vehicle_stock');\r\n\r\ninterface SelectedMaterial {\r\n  productId: string;\r\n  productName: string;\r\n  productSku: string;\r\n  quantity: number;\r\n  unitPrice: number;\r\n  availableQty: number;\r\n}\r\n\r\ninterface JobMaterialsSelectorProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  onConfirm: (materials: SelectedMaterial[]) => void;\r\n  stock: VehicleStock[];\r\n}\r\n\r\nfunction JobMaterialsSelector({\r\n  visible,\r\n  onClose,\r\n  onConfirm,\r\n  stock,\r\n}: JobMaterialsSelectorProps) {\r\n  const [search, setSearch] = useState('');\r\n  const [selectedMaterials, setSelectedMaterials] = useState<Map<string, SelectedMaterial>>(\r\n    new Map()\r\n  );\r\n  const [showScanner, setShowScanner] = useState(false);\r\n\r\n  const filteredStock = useMemo(() => {\r\n    if (!search) return stock;\r\n    const query = search.toLowerCase();\r\n    return stock.filter(\r\n      (item) =>\r\n        item.productName.toLowerCase().includes(query) ||\r\n        item.productSku.toLowerCase().includes(query)\r\n    );\r\n  }, [stock, search]);\r\n\r\n  const toggleMaterial = useCallback((item: VehicleStock) => {\r\n    setSelectedMaterials((prev) => {\r\n      const next = new Map(prev);\r\n      if (next.has(item.productId)) {\r\n        next.delete(item.productId);\r\n      } else {\r\n        next.set(item.productId, {\r\n          productId: item.productId,\r\n          productName: item.productName,\r\n          productSku: item.productSku,\r\n          quantity: 1,\r\n          unitPrice: item.unitCost,\r\n          availableQty: item.quantity,\r\n        });\r\n      }\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  const updateQuantity = useCallback((productId: string, quantity: number) => {\r\n    setSelectedMaterials((prev) => {\r\n      const next = new Map(prev);\r\n      const material = next.get(productId);\r\n      if (material && quantity > 0 && quantity <= material.availableQty) {\r\n        next.set(productId, { ...material, quantity });\r\n      }\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  const handleConfirm = useCallback(() => {\r\n    onConfirm(Array.from(selectedMaterials.values()));\r\n    setSelectedMaterials(new Map());\r\n    onClose();\r\n  }, [selectedMaterials, onConfirm, onClose]);\r\n\r\n  const handleScan = useCallback(\r\n    (barcode: string) => {\r\n      setShowScanner(false);\r\n      // Find product by barcode\r\n      const item = stock.find((s) => s.productSku === barcode);\r\n      if (item) {\r\n        toggleMaterial(item);\r\n      }\r\n    },\r\n    [stock, toggleMaterial]\r\n  );\r\n\r\n  const totalItems = selectedMaterials.size;\r\n  const totalAmount = useMemo(() => {\r\n    let total = 0;\r\n    selectedMaterials.forEach((m) => {\r\n      total += m.quantity * m.unitPrice;\r\n    });\r\n    return total;\r\n  }, [selectedMaterials]);\r\n\r\n  const renderItem = ({ item }: { item: VehicleStock }) => {\r\n    const selected = selectedMaterials.get(item.productId);\r\n    const isSelected = !!selected;\r\n\r\n    return (\r\n      <TouchableOpacity\r\n        style={[styles.itemCard, isSelected && styles.itemCardSelected]}\r\n        onPress={() => toggleMaterial(item)}\r\n        disabled={item.quantity === 0}\r\n      >\r\n        <View style={styles.itemCheckbox}>\r\n          {isSelected ? (\r\n            <Feather name=\"check-square\" size={22} color=\"#16a34a\" />\r\n          ) : (\r\n            <Feather\r\n              name=\"square\"\r\n              size={22}\r\n              color={item.quantity === 0 ? '#e5e7eb' : '#d1d5db'}\r\n            />\r\n          )}\r\n        </View>\r\n        <View style={styles.itemInfo}>\r\n          <Text\r\n            style={[styles.itemName, item.quantity === 0 && styles.itemDisabled]}\r\n          >\r\n            {item.productName}\r\n          </Text>\r\n          <Text style={styles.itemMeta}>\r\n            {item.productSku} ΓÇó Stock: {item.quantity}\r\n          </Text>\r\n        </View>\r\n        {isSelected && (\r\n          <View style={styles.quantityControls}>\r\n            <TouchableOpacity\r\n              style={styles.quantityButton}\r\n              onPress={() => updateQuantity(item.productId, selected.quantity - 1)}\r\n              disabled={selected.quantity <= 1}\r\n            >\r\n              <Feather\r\n                name=\"minus\"\r\n                size={16}\r\n                color={selected.quantity <= 1 ? '#e5e7eb' : '#6b7280'}\r\n              />\r\n            </TouchableOpacity>\r\n            <Text style={styles.quantityValue}>{selected.quantity}</Text>\r\n            <TouchableOpacity\r\n              style={styles.quantityButton}\r\n              onPress={() => updateQuantity(item.productId, selected.quantity + 1)}\r\n              disabled={selected.quantity >= item.quantity}\r\n            >\r\n              <Feather\r\n                name=\"plus\"\r\n                size={16}\r\n                color={selected.quantity >= item.quantity ? '#e5e7eb' : '#6b7280'}\r\n              />\r\n            </TouchableOpacity>\r\n          </View>\r\n        )}\r\n      </TouchableOpacity>\r\n    );\r\n  };\r\n\r\n  if (!visible) return null;\r\n\r\n  return (\r\n    <Modal visible={visible} animationType=\"slide\" onRequestClose={onClose}>\r\n      <View style={styles.container}>\r\n        {/* Header */}\r\n        <View style={styles.header}>\r\n          <TouchableOpacity style={styles.closeButton} onPress={onClose}>\r\n            <Feather name=\"x\" size={24} color=\"#374151\" />\r\n          </TouchableOpacity>\r\n          <Text style={styles.headerTitle}>Agregar materiales</Text>\r\n          <TouchableOpacity\r\n            style={styles.scanButton}\r\n            onPress={() => setShowScanner(true)}\r\n          >\r\n            <Feather name=\"maximize\" size={24} color=\"#16a34a\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        {/* Search */}\r\n        <View style={styles.searchContainer}>\r\n          <Feather name=\"search\" size={18} color=\"#9ca3af\" />\r\n          <TextInput\r\n            style={styles.searchInput}\r\n            placeholder=\"Buscar material...\"\r\n            value={search}\r\n            onChangeText={setSearch}\r\n            placeholderTextColor=\"#9ca3af\"\r\n          />\r\n          {search.length > 0 && (\r\n            <TouchableOpacity onPress={() => setSearch('')}>\r\n              <Feather name=\"x\" size={18} color=\"#9ca3af\" />\r\n            </TouchableOpacity>\r\n          )}\r\n        </View>\r\n\r\n        {/* List */}\r\n        <FlatList\r\n          data={filteredStock}\r\n          renderItem={renderItem}\r\n          keyExtractor={(item) => item.id}\r\n          contentContainerStyle={styles.listContent}\r\n          ItemSeparatorComponent={() => <View style={styles.separator} />}\r\n          ListEmptyComponent={() => (\r\n            <View style={styles.emptyContainer}>\r\n              <Feather name=\"package\" size={48} color=\"#d1d5db\" />\r\n              <Text style={styles.emptyText}>No hay materiales disponibles</Text>\r\n            </View>\r\n          )}\r\n        />\r\n\r\n        {/* Footer */}\r\n        {totalItems > 0 && (\r\n          <View style={styles.footer}>\r\n            <View style={styles.footerInfo}>\r\n              <Text style={styles.footerItems}>{totalItems} materiales</Text>\r\n              <Text style={styles.footerTotal}>\r\n                Total: ${totalAmount.toLocaleString()}\r\n              </Text>\r\n            </View>\r\n            <TouchableOpacity style={styles.confirmButton} onPress={handleConfirm}>\r\n              <Feather name=\"check\" size={20} color=\"#fff\" />\r\n              <Text style={styles.confirmButtonText}>Agregar</Text>\r\n            </TouchableOpacity>\r\n          </View>\r\n        )}\r\n\r\n        {/* Barcode Scanner */}\r\n        <BarcodeScanner\r\n          visible={showScanner}\r\n          onClose={() => setShowScanner(false)}\r\n          onScan={handleScan}\r\n        />\r\n      </View>\r\n    </Modal>\r\n  );\r\n}\r\n\r\n// HOC wrapper to provide stock data\r\nconst enhance = withObservables([], () => ({\r\n  stock: vehicleStockCollection.query(\r\n    Q.where('quantity', Q.gt(0)),\r\n    Q.sortBy('product_name', Q.asc)\r\n  ),\r\n}));\r\n\r\nexport default enhance(JobMaterialsSelector);\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingTop: 60,\r\n    paddingHorizontal: 16,\r\n    paddingBottom: 16,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  closeButton: {\r\n    padding: 4,\r\n  },\r\n  headerTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  scanButton: {\r\n    padding: 4,\r\n  },\r\n  searchContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    marginHorizontal: 16,\r\n    marginVertical: 12,\r\n    paddingHorizontal: 12,\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  searchInput: {\r\n    flex: 1,\r\n    paddingVertical: 10,\r\n    paddingHorizontal: 8,\r\n    fontSize: 15,\r\n    color: '#111827',\r\n  },\r\n  listContent: {\r\n    paddingBottom: 120,\r\n  },\r\n  separator: {\r\n    height: 1,\r\n    backgroundColor: '#e5e7eb',\r\n  },\r\n  itemCard: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 14,\r\n  },\r\n  itemCardSelected: {\r\n    backgroundColor: '#f0fdf4',\r\n  },\r\n  itemCheckbox: {\r\n    marginRight: 12,\r\n  },\r\n  itemInfo: {\r\n    flex: 1,\r\n  },\r\n  itemName: {\r\n    fontSize: 15,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  itemDisabled: {\r\n    color: '#9ca3af',\r\n  },\r\n  itemMeta: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  quantityControls: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    borderRadius: 6,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  quantityButton: {\r\n    padding: 8,\r\n  },\r\n  quantityValue: {\r\n    minWidth: 32,\r\n    textAlign: 'center',\r\n    fontSize: 15,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  emptyContainer: {\r\n    alignItems: 'center',\r\n    paddingVertical: 64,\r\n  },\r\n  emptyText: {\r\n    marginTop: 12,\r\n    fontSize: 15,\r\n    color: '#6b7280',\r\n  },\r\n  footer: {\r\n    position: 'absolute',\r\n    bottom: 0,\r\n    left: 0,\r\n    right: 0,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    paddingBottom: 32,\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#e5e7eb',\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: -2 },\r\n    shadowOpacity: 0.1,\r\n    shadowRadius: 4,\r\n    elevation: 5,\r\n  },\r\n  footerInfo: {\r\n    flex: 1,\r\n  },\r\n  footerItems: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n  },\r\n  footerTotal: {\r\n    fontSize: 17,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  confirmButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#16a34a',\r\n    paddingHorizontal: 20,\r\n    paddingVertical: 12,\r\n    borderRadius: 10,\r\n    gap: 6,\r\n  },\r\n  confirmButtonText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\inventory\\UsageForm.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":23,"column":25,"nodeType":"Literal","endLine":23,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Database' is defined but never used.","line":25,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Usage Form Component\r\n * ====================\r\n *\r\n * Form for recording material usage from vehicle stock during jobs.\r\n * Supports single and batch material usage with job association.\r\n */\r\n\r\nimport { useState, useCallback, useMemo, useEffect } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  TouchableOpacity,\r\n  TextInput,\r\n  ScrollView,\r\n  Modal,\r\n  Alert,\r\n  ActivityIndicator,\r\n  KeyboardAvoidingView,\r\n  Platform,\r\n} from 'react-native';\r\nimport { Feather } from '@expo/vector-icons';\r\nimport { withObservables } from '@nozbe/watermelondb/react';\r\nimport { Q, Database } from '@nozbe/watermelondb';\r\n\r\nimport { database } from '../../watermelon/database';\r\nimport { VehicleStock, Job } from '../../watermelon/models';\r\nimport BarcodeScanner from './BarcodeScanner';\r\n\r\nconst vehicleStockCollection = database.get<VehicleStock>('vehicle_stock');\r\nconst jobsCollection = database.get<Job>('jobs');\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// TYPES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport type UsageType = 'JOB' | 'WARRANTY' | 'INTERNAL' | 'LOSS' | 'OTHER';\r\n\r\nexport interface UsageEntry {\r\n  stockId: string;\r\n  productId: string;\r\n  productName: string;\r\n  productSku: string;\r\n  quantity: number;\r\n  availableQty: number;\r\n  unitCost: number;\r\n}\r\n\r\nexport interface UsageFormData {\r\n  entries: UsageEntry[];\r\n  usageType: UsageType;\r\n  jobId: string | null;\r\n  notes: string;\r\n}\r\n\r\ninterface UsageFormProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  onSubmit: (data: UsageFormData) => Promise<void>;\r\n  stock: VehicleStock[];\r\n  jobs?: Job[];\r\n  preselectedJobId?: string | null;\r\n  preselectedStock?: VehicleStock | null;\r\n}\r\n\r\nconst USAGE_TYPES: Record<UsageType, { label: string; icon: string; color: string }> = {\r\n  JOB: { label: 'Trabajo', icon: 'briefcase', color: '#16a34a' },\r\n  WARRANTY: { label: 'Garant├¡a', icon: 'shield', color: '#3b82f6' },\r\n  INTERNAL: { label: 'Uso Interno', icon: 'home', color: '#8b5cf6' },\r\n  LOSS: { label: 'P├⌐rdida/Da├▒o', icon: 'alert-triangle', color: '#ef4444' },\r\n  OTHER: { label: 'Otro', icon: 'more-horizontal', color: '#6b7280' },\r\n};\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// COMPONENT\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nfunction UsageForm({\r\n  visible,\r\n  onClose,\r\n  onSubmit,\r\n  stock,\r\n  jobs = [],\r\n  preselectedJobId = null,\r\n  preselectedStock = null,\r\n}: UsageFormProps) {\r\n  // Form state\r\n  const [entries, setEntries] = useState<Map<string, UsageEntry>>(new Map());\r\n  const [usageType, setUsageType] = useState<UsageType>('JOB');\r\n  const [selectedJobId, setSelectedJobId] = useState<string | null>(preselectedJobId);\r\n  const [notes, setNotes] = useState('');\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  // UI state\r\n  const [showStockPicker, setShowStockPicker] = useState(false);\r\n  const [showJobPicker, setShowJobPicker] = useState(false);\r\n  const [showScanner, setShowScanner] = useState(false);\r\n  const [stockSearch, setStockSearch] = useState('');\r\n  const [jobSearch, setJobSearch] = useState('');\r\n\r\n  // Reset form when modal opens\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setEntries(new Map());\r\n      setUsageType('JOB');\r\n      setSelectedJobId(preselectedJobId);\r\n      setNotes('');\r\n\r\n      // Pre-select stock if provided\r\n      if (preselectedStock) {\r\n        setEntries(new Map([[preselectedStock.id, {\r\n          stockId: preselectedStock.id,\r\n          productId: preselectedStock.productId,\r\n          productName: preselectedStock.productName,\r\n          productSku: preselectedStock.productSku,\r\n          quantity: 1,\r\n          availableQty: preselectedStock.quantity,\r\n          unitCost: preselectedStock.unitCost,\r\n        }]]));\r\n      }\r\n    }\r\n  }, [visible, preselectedJobId, preselectedStock]);\r\n\r\n  // Filter available stock (exclude already selected)\r\n  const availableStock = useMemo(() => {\r\n    let result = stock.filter(s => s.quantity > 0 && !entries.has(s.id));\r\n    if (stockSearch) {\r\n      const query = stockSearch.toLowerCase();\r\n      result = result.filter(\r\n        s => s.productName.toLowerCase().includes(query) ||\r\n             s.productSku.toLowerCase().includes(query)\r\n      );\r\n    }\r\n    return result;\r\n  }, [stock, entries, stockSearch]);\r\n\r\n  // Filter active jobs\r\n  const activeJobs = useMemo(() => {\r\n    let result = jobs.filter(j =>\r\n      j.status === 'IN_PROGRESS' || j.status === 'SCHEDULED'\r\n    );\r\n    if (jobSearch) {\r\n      const query = jobSearch.toLowerCase();\r\n      result = result.filter(\r\n        j => j.title?.toLowerCase().includes(query) ||\r\n             j.customerName?.toLowerCase().includes(query) ||\r\n             j.address?.toLowerCase().includes(query)\r\n      );\r\n    }\r\n    return result;\r\n  }, [jobs, jobSearch]);\r\n\r\n  const selectedJob = useMemo(() =>\r\n    jobs.find(j => j.id === selectedJobId),\r\n    [jobs, selectedJobId]\r\n  );\r\n\r\n  // Add stock to entries\r\n  const addStockEntry = useCallback((item: VehicleStock) => {\r\n    setEntries(prev => {\r\n      const next = new Map(prev);\r\n      next.set(item.id, {\r\n        stockId: item.id,\r\n        productId: item.productId,\r\n        productName: item.productName,\r\n        productSku: item.productSku,\r\n        quantity: 1,\r\n        availableQty: item.quantity,\r\n        unitCost: item.unitCost,\r\n      });\r\n      return next;\r\n    });\r\n    setShowStockPicker(false);\r\n    setStockSearch('');\r\n  }, []);\r\n\r\n  // Remove entry\r\n  const removeEntry = useCallback((stockId: string) => {\r\n    setEntries(prev => {\r\n      const next = new Map(prev);\r\n      next.delete(stockId);\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  // Update entry quantity\r\n  const updateQuantity = useCallback((stockId: string, quantity: number) => {\r\n    setEntries(prev => {\r\n      const next = new Map(prev);\r\n      const entry = next.get(stockId);\r\n      if (entry && quantity > 0 && quantity <= entry.availableQty) {\r\n        next.set(stockId, { ...entry, quantity });\r\n      }\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  // Handle barcode scan\r\n  const handleScan = useCallback((barcode: string) => {\r\n    setShowScanner(false);\r\n    const item = stock.find(s => s.productSku === barcode);\r\n    if (item) {\r\n      if (item.quantity > 0) {\r\n        addStockEntry(item);\r\n      } else {\r\n        Alert.alert('Sin stock', `${item.productName} no tiene stock disponible.`);\r\n      }\r\n    } else {\r\n      Alert.alert('No encontrado', 'No se encontr├│ un producto con ese c├│digo.');\r\n    }\r\n  }, [stock, addStockEntry]);\r\n\r\n  // Submit form\r\n  const handleSubmit = useCallback(async () => {\r\n    if (entries.size === 0) {\r\n      Alert.alert('Error', 'Debe agregar al menos un material.');\r\n      return;\r\n    }\r\n\r\n    if (usageType === 'JOB' && !selectedJobId) {\r\n      Alert.alert('Error', 'Debe seleccionar un trabajo para este tipo de uso.');\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n    try {\r\n      await onSubmit({\r\n        entries: Array.from(entries.values()),\r\n        usageType,\r\n        jobId: usageType === 'JOB' ? selectedJobId : null,\r\n        notes: notes.trim(),\r\n      });\r\n      onClose();\r\n    } catch (error) {\r\n      Alert.alert(\r\n        'Error',\r\n        error instanceof Error ? error.message : 'No se pudo registrar el uso.'\r\n      );\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  }, [entries, usageType, selectedJobId, notes, onSubmit, onClose]);\r\n\r\n  // Calculate totals\r\n  const totalQuantity = useMemo(() => {\r\n    let total = 0;\r\n    entries.forEach(e => total += e.quantity);\r\n    return total;\r\n  }, [entries]);\r\n\r\n  const totalCost = useMemo(() => {\r\n    let total = 0;\r\n    entries.forEach(e => total += e.quantity * e.unitCost);\r\n    return total;\r\n  }, [entries]);\r\n\r\n  if (!visible) return null;\r\n\r\n  return (\r\n    <Modal visible={visible} animationType=\"slide\" onRequestClose={onClose}>\r\n      <KeyboardAvoidingView\r\n        style={styles.container}\r\n        behavior={Platform.OS === 'ios' ? 'padding' : undefined}\r\n      >\r\n        {/* Header */}\r\n        <View style={styles.header}>\r\n          <TouchableOpacity style={styles.closeButton} onPress={onClose}>\r\n            <Feather name=\"x\" size={24} color=\"#374151\" />\r\n          </TouchableOpacity>\r\n          <Text style={styles.headerTitle}>Registrar Uso</Text>\r\n          <TouchableOpacity\r\n            style={styles.scanButton}\r\n            onPress={() => setShowScanner(true)}\r\n          >\r\n            <Feather name=\"maximize\" size={24} color=\"#16a34a\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        <ScrollView\r\n          style={styles.content}\r\n          keyboardShouldPersistTaps=\"handled\"\r\n          showsVerticalScrollIndicator={false}\r\n        >\r\n          {/* Usage Type Selector */}\r\n          <View style={styles.section}>\r\n            <Text style={styles.sectionTitle}>Tipo de uso</Text>\r\n            <View style={styles.usageTypeGrid}>\r\n              {(Object.keys(USAGE_TYPES) as UsageType[]).map((type) => {\r\n                const config = USAGE_TYPES[type];\r\n                const isSelected = usageType === type;\r\n                return (\r\n                  <TouchableOpacity\r\n                    key={type}\r\n                    style={[\r\n                      styles.usageTypeButton,\r\n                      isSelected && { borderColor: config.color, backgroundColor: `${config.color}10` },\r\n                    ]}\r\n                    onPress={() => setUsageType(type)}\r\n                  >\r\n                    <Feather\r\n                      name={config.icon as any}\r\n                      size={20}\r\n                      color={isSelected ? config.color : '#6b7280'}\r\n                    />\r\n                    <Text\r\n                      style={[\r\n                        styles.usageTypeLabel,\r\n                        isSelected && { color: config.color },\r\n                      ]}\r\n                    >\r\n                      {config.label}\r\n                    </Text>\r\n                  </TouchableOpacity>\r\n                );\r\n              })}\r\n            </View>\r\n          </View>\r\n\r\n          {/* Job Selector (only for JOB usage type) */}\r\n          {usageType === 'JOB' && (\r\n            <View style={styles.section}>\r\n              <Text style={styles.sectionTitle}>Trabajo asociado</Text>\r\n              <TouchableOpacity\r\n                style={styles.jobSelector}\r\n                onPress={() => setShowJobPicker(true)}\r\n              >\r\n                {selectedJob ? (\r\n                  <View style={styles.selectedJob}>\r\n                    <View style={styles.selectedJobInfo}>\r\n                      <Text style={styles.selectedJobTitle} numberOfLines={1}>\r\n                        {selectedJob.title || 'Sin t├¡tulo'}\r\n                      </Text>\r\n                      <Text style={styles.selectedJobMeta} numberOfLines={1}>\r\n                        {selectedJob.customerName} ΓÇó {selectedJob.address}\r\n                      </Text>\r\n                    </View>\r\n                    <TouchableOpacity onPress={() => setSelectedJobId(null)}>\r\n                      <Feather name=\"x\" size={20} color=\"#6b7280\" />\r\n                    </TouchableOpacity>\r\n                  </View>\r\n                ) : (\r\n                  <View style={styles.jobPlaceholder}>\r\n                    <Feather name=\"briefcase\" size={20} color=\"#9ca3af\" />\r\n                    <Text style={styles.jobPlaceholderText}>\r\n                      Seleccionar trabajo\r\n                    </Text>\r\n                    <Feather name=\"chevron-right\" size={20} color=\"#9ca3af\" />\r\n                  </View>\r\n                )}\r\n              </TouchableOpacity>\r\n            </View>\r\n          )}\r\n\r\n          {/* Materials */}\r\n          <View style={styles.section}>\r\n            <View style={styles.sectionHeader}>\r\n              <Text style={styles.sectionTitle}>Materiales</Text>\r\n              <TouchableOpacity\r\n                style={styles.addButton}\r\n                onPress={() => setShowStockPicker(true)}\r\n              >\r\n                <Feather name=\"plus\" size={18} color=\"#16a34a\" />\r\n                <Text style={styles.addButtonText}>Agregar</Text>\r\n              </TouchableOpacity>\r\n            </View>\r\n\r\n            {entries.size === 0 ? (\r\n              <View style={styles.emptyEntries}>\r\n                <Feather name=\"package\" size={32} color=\"#d1d5db\" />\r\n                <Text style={styles.emptyEntriesText}>\r\n                  No hay materiales agregados\r\n                </Text>\r\n                <Text style={styles.emptyEntriesHint}>\r\n                  Use el bot├│n + o escanee un c├│digo\r\n                </Text>\r\n              </View>\r\n            ) : (\r\n              <View style={styles.entriesList}>\r\n                {Array.from(entries.values()).map((entry) => (\r\n                  <View key={entry.stockId} style={styles.entryCard}>\r\n                    <View style={styles.entryInfo}>\r\n                      <Text style={styles.entryName} numberOfLines={1}>\r\n                        {entry.productName}\r\n                      </Text>\r\n                      <Text style={styles.entryMeta}>\r\n                        {entry.productSku} ΓÇó Stock: {entry.availableQty}\r\n                      </Text>\r\n                    </View>\r\n                    <View style={styles.entryControls}>\r\n                      <View style={styles.quantityControls}>\r\n                        <TouchableOpacity\r\n                          style={styles.quantityButton}\r\n                          onPress={() => updateQuantity(entry.stockId, entry.quantity - 1)}\r\n                          disabled={entry.quantity <= 1}\r\n                        >\r\n                          <Feather\r\n                            name=\"minus\"\r\n                            size={16}\r\n                            color={entry.quantity <= 1 ? '#e5e7eb' : '#374151'}\r\n                          />\r\n                        </TouchableOpacity>\r\n                        <TextInput\r\n                          style={styles.quantityInput}\r\n                          value={String(entry.quantity)}\r\n                          onChangeText={(text) => {\r\n                            const qty = parseInt(text, 10);\r\n                            if (!isNaN(qty)) updateQuantity(entry.stockId, qty);\r\n                          }}\r\n                          keyboardType=\"number-pad\"\r\n                          selectTextOnFocus\r\n                        />\r\n                        <TouchableOpacity\r\n                          style={styles.quantityButton}\r\n                          onPress={() => updateQuantity(entry.stockId, entry.quantity + 1)}\r\n                          disabled={entry.quantity >= entry.availableQty}\r\n                        >\r\n                          <Feather\r\n                            name=\"plus\"\r\n                            size={16}\r\n                            color={entry.quantity >= entry.availableQty ? '#e5e7eb' : '#374151'}\r\n                          />\r\n                        </TouchableOpacity>\r\n                      </View>\r\n                      <TouchableOpacity\r\n                        style={styles.removeButton}\r\n                        onPress={() => removeEntry(entry.stockId)}\r\n                      >\r\n                        <Feather name=\"trash-2\" size={18} color=\"#ef4444\" />\r\n                      </TouchableOpacity>\r\n                    </View>\r\n                  </View>\r\n                ))}\r\n              </View>\r\n            )}\r\n          </View>\r\n\r\n          {/* Notes */}\r\n          <View style={styles.section}>\r\n            <Text style={styles.sectionTitle}>Notas (opcional)</Text>\r\n            <TextInput\r\n              style={styles.notesInput}\r\n              value={notes}\r\n              onChangeText={setNotes}\r\n              placeholder=\"Agregar notas sobre el uso...\"\r\n              placeholderTextColor=\"#9ca3af\"\r\n              multiline\r\n              numberOfLines={3}\r\n              textAlignVertical=\"top\"\r\n            />\r\n          </View>\r\n\r\n          {/* Summary */}\r\n          {entries.size > 0 && (\r\n            <View style={styles.summary}>\r\n              <View style={styles.summaryRow}>\r\n                <Text style={styles.summaryLabel}>Total materiales:</Text>\r\n                <Text style={styles.summaryValue}>{entries.size}</Text>\r\n              </View>\r\n              <View style={styles.summaryRow}>\r\n                <Text style={styles.summaryLabel}>Cantidad total:</Text>\r\n                <Text style={styles.summaryValue}>{totalQuantity} unidades</Text>\r\n              </View>\r\n              <View style={styles.summaryRow}>\r\n                <Text style={styles.summaryLabel}>Costo estimado:</Text>\r\n                <Text style={styles.summaryValueHighlight}>\r\n                  ${totalCost.toLocaleString('es-AR', { minimumFractionDigits: 2 })}\r\n                </Text>\r\n              </View>\r\n            </View>\r\n          )}\r\n        </ScrollView>\r\n\r\n        {/* Footer */}\r\n        <View style={styles.footer}>\r\n          <TouchableOpacity\r\n            style={styles.cancelButton}\r\n            onPress={onClose}\r\n            disabled={isSubmitting}\r\n          >\r\n            <Text style={styles.cancelButtonText}>Cancelar</Text>\r\n          </TouchableOpacity>\r\n          <TouchableOpacity\r\n            style={[\r\n              styles.submitButton,\r\n              (entries.size === 0 || isSubmitting) && styles.submitButtonDisabled,\r\n            ]}\r\n            onPress={handleSubmit}\r\n            disabled={entries.size === 0 || isSubmitting}\r\n          >\r\n            {isSubmitting ? (\r\n              <ActivityIndicator color=\"#fff\" size=\"small\" />\r\n            ) : (\r\n              <>\r\n                <Feather name=\"check\" size={20} color=\"#fff\" />\r\n                <Text style={styles.submitButtonText}>Registrar uso</Text>\r\n              </>\r\n            )}\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        {/* Stock Picker Modal */}\r\n        <Modal\r\n          visible={showStockPicker}\r\n          animationType=\"slide\"\r\n          onRequestClose={() => setShowStockPicker(false)}\r\n        >\r\n          <View style={styles.pickerContainer}>\r\n            <View style={styles.pickerHeader}>\r\n              <TouchableOpacity onPress={() => setShowStockPicker(false)}>\r\n                <Feather name=\"arrow-left\" size={24} color=\"#374151\" />\r\n              </TouchableOpacity>\r\n              <Text style={styles.pickerTitle}>Seleccionar material</Text>\r\n              <View style={{ width: 24 }} />\r\n            </View>\r\n            <View style={styles.searchContainer}>\r\n              <Feather name=\"search\" size={18} color=\"#9ca3af\" />\r\n              <TextInput\r\n                style={styles.searchInput}\r\n                placeholder=\"Buscar material...\"\r\n                value={stockSearch}\r\n                onChangeText={setStockSearch}\r\n                placeholderTextColor=\"#9ca3af\"\r\n                autoFocus\r\n              />\r\n              {stockSearch.length > 0 && (\r\n                <TouchableOpacity onPress={() => setStockSearch('')}>\r\n                  <Feather name=\"x\" size={18} color=\"#9ca3af\" />\r\n                </TouchableOpacity>\r\n              )}\r\n            </View>\r\n            <ScrollView style={styles.pickerList}>\r\n              {availableStock.length === 0 ? (\r\n                <View style={styles.pickerEmpty}>\r\n                  <Feather name=\"package\" size={48} color=\"#d1d5db\" />\r\n                  <Text style={styles.pickerEmptyText}>\r\n                    No hay materiales disponibles\r\n                  </Text>\r\n                </View>\r\n              ) : (\r\n                availableStock.map((item) => (\r\n                  <TouchableOpacity\r\n                    key={item.id}\r\n                    style={styles.pickerItem}\r\n                    onPress={() => addStockEntry(item)}\r\n                  >\r\n                    <View style={styles.pickerItemInfo}>\r\n                      <Text style={styles.pickerItemName}>{item.productName}</Text>\r\n                      <Text style={styles.pickerItemMeta}>\r\n                        {item.productSku} ΓÇó Stock: {item.quantity}\r\n                      </Text>\r\n                    </View>\r\n                    <Feather name=\"plus-circle\" size={22} color=\"#16a34a\" />\r\n                  </TouchableOpacity>\r\n                ))\r\n              )}\r\n            </ScrollView>\r\n          </View>\r\n        </Modal>\r\n\r\n        {/* Job Picker Modal */}\r\n        <Modal\r\n          visible={showJobPicker}\r\n          animationType=\"slide\"\r\n          onRequestClose={() => setShowJobPicker(false)}\r\n        >\r\n          <View style={styles.pickerContainer}>\r\n            <View style={styles.pickerHeader}>\r\n              <TouchableOpacity onPress={() => setShowJobPicker(false)}>\r\n                <Feather name=\"arrow-left\" size={24} color=\"#374151\" />\r\n              </TouchableOpacity>\r\n              <Text style={styles.pickerTitle}>Seleccionar trabajo</Text>\r\n              <View style={{ width: 24 }} />\r\n            </View>\r\n            <View style={styles.searchContainer}>\r\n              <Feather name=\"search\" size={18} color=\"#9ca3af\" />\r\n              <TextInput\r\n                style={styles.searchInput}\r\n                placeholder=\"Buscar trabajo...\"\r\n                value={jobSearch}\r\n                onChangeText={setJobSearch}\r\n                placeholderTextColor=\"#9ca3af\"\r\n                autoFocus\r\n              />\r\n              {jobSearch.length > 0 && (\r\n                <TouchableOpacity onPress={() => setJobSearch('')}>\r\n                  <Feather name=\"x\" size={18} color=\"#9ca3af\" />\r\n                </TouchableOpacity>\r\n              )}\r\n            </View>\r\n            <ScrollView style={styles.pickerList}>\r\n              {activeJobs.length === 0 ? (\r\n                <View style={styles.pickerEmpty}>\r\n                  <Feather name=\"briefcase\" size={48} color=\"#d1d5db\" />\r\n                  <Text style={styles.pickerEmptyText}>\r\n                    No hay trabajos activos\r\n                  </Text>\r\n                </View>\r\n              ) : (\r\n                activeJobs.map((job) => (\r\n                  <TouchableOpacity\r\n                    key={job.id}\r\n                    style={styles.pickerItem}\r\n                    onPress={() => {\r\n                      setSelectedJobId(job.id);\r\n                      setShowJobPicker(false);\r\n                      setJobSearch('');\r\n                    }}\r\n                  >\r\n                    <View style={styles.pickerItemInfo}>\r\n                      <Text style={styles.pickerItemName}>\r\n                        {job.title || 'Sin t├¡tulo'}\r\n                      </Text>\r\n                      <Text style={styles.pickerItemMeta}>\r\n                        {job.customerName} ΓÇó {job.address}\r\n                      </Text>\r\n                    </View>\r\n                    <Feather name=\"chevron-right\" size={20} color=\"#9ca3af\" />\r\n                  </TouchableOpacity>\r\n                ))\r\n              )}\r\n            </ScrollView>\r\n          </View>\r\n        </Modal>\r\n\r\n        {/* Barcode Scanner */}\r\n        <BarcodeScanner\r\n          visible={showScanner}\r\n          onClose={() => setShowScanner(false)}\r\n          onScan={handleScan}\r\n        />\r\n      </KeyboardAvoidingView>\r\n    </Modal>\r\n  );\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// HOC WRAPPER\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nconst enhance = withObservables([], () => ({\r\n  stock: vehicleStockCollection.query(Q.sortBy('product_name', Q.asc)),\r\n  jobs: jobsCollection.query(\r\n    Q.or(\r\n      Q.where('status', 'IN_PROGRESS'),\r\n      Q.where('status', 'SCHEDULED')\r\n    ),\r\n    Q.sortBy('scheduled_date', Q.desc)\r\n  ),\r\n}));\r\n\r\nexport default enhance(UsageForm);\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// STYLES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingTop: 60,\r\n    paddingHorizontal: 16,\r\n    paddingBottom: 16,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  closeButton: {\r\n    padding: 4,\r\n  },\r\n  headerTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  scanButton: {\r\n    padding: 4,\r\n  },\r\n  content: {\r\n    flex: 1,\r\n  },\r\n  section: {\r\n    backgroundColor: '#fff',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 16,\r\n    marginBottom: 8,\r\n  },\r\n  sectionHeader: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    marginBottom: 12,\r\n  },\r\n  sectionTitle: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    marginBottom: 12,\r\n  },\r\n  usageTypeGrid: {\r\n    flexDirection: 'row',\r\n    flexWrap: 'wrap',\r\n    gap: 8,\r\n  },\r\n  usageTypeButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 10,\r\n    borderRadius: 8,\r\n    borderWidth: 1.5,\r\n    borderColor: '#e5e7eb',\r\n    backgroundColor: '#fff',\r\n    gap: 6,\r\n  },\r\n  usageTypeLabel: {\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n    color: '#6b7280',\r\n  },\r\n  jobSelector: {\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    borderRadius: 8,\r\n    overflow: 'hidden',\r\n  },\r\n  selectedJob: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    padding: 12,\r\n    backgroundColor: '#f0fdf4',\r\n  },\r\n  selectedJobInfo: {\r\n    flex: 1,\r\n    marginRight: 8,\r\n  },\r\n  selectedJobTitle: {\r\n    fontSize: 15,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  selectedJobMeta: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  jobPlaceholder: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    padding: 12,\r\n    backgroundColor: '#fff',\r\n    gap: 8,\r\n  },\r\n  jobPlaceholderText: {\r\n    flex: 1,\r\n    fontSize: 15,\r\n    color: '#9ca3af',\r\n  },\r\n  addButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n  },\r\n  addButtonText: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#16a34a',\r\n  },\r\n  emptyEntries: {\r\n    alignItems: 'center',\r\n    paddingVertical: 32,\r\n    backgroundColor: '#f9fafb',\r\n    borderRadius: 8,\r\n  },\r\n  emptyEntriesText: {\r\n    fontSize: 15,\r\n    color: '#6b7280',\r\n    marginTop: 8,\r\n  },\r\n  emptyEntriesHint: {\r\n    fontSize: 13,\r\n    color: '#9ca3af',\r\n    marginTop: 4,\r\n  },\r\n  entriesList: {\r\n    gap: 8,\r\n  },\r\n  entryCard: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    padding: 12,\r\n    backgroundColor: '#f9fafb',\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  entryInfo: {\r\n    flex: 1,\r\n    marginRight: 8,\r\n  },\r\n  entryName: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  entryMeta: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  entryControls: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n  },\r\n  quantityControls: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    borderRadius: 6,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  quantityButton: {\r\n    padding: 8,\r\n  },\r\n  quantityInput: {\r\n    minWidth: 40,\r\n    textAlign: 'center',\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    paddingVertical: 0,\r\n  },\r\n  removeButton: {\r\n    padding: 8,\r\n  },\r\n  notesInput: {\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    borderRadius: 8,\r\n    padding: 12,\r\n    fontSize: 14,\r\n    color: '#111827',\r\n    minHeight: 80,\r\n    backgroundColor: '#fff',\r\n  },\r\n  summary: {\r\n    backgroundColor: '#fff',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 16,\r\n    marginBottom: 8,\r\n    gap: 8,\r\n  },\r\n  summaryRow: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n  },\r\n  summaryLabel: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n  },\r\n  summaryValue: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  summaryValueHighlight: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#16a34a',\r\n  },\r\n  footer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    paddingBottom: 32,\r\n    backgroundColor: '#fff',\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#e5e7eb',\r\n    gap: 12,\r\n  },\r\n  cancelButton: {\r\n    paddingVertical: 14,\r\n    paddingHorizontal: 20,\r\n  },\r\n  cancelButtonText: {\r\n    fontSize: 15,\r\n    fontWeight: '500',\r\n    color: '#6b7280',\r\n  },\r\n  submitButton: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    backgroundColor: '#16a34a',\r\n    paddingVertical: 14,\r\n    borderRadius: 10,\r\n    gap: 8,\r\n  },\r\n  submitButtonDisabled: {\r\n    backgroundColor: '#9ca3af',\r\n  },\r\n  submitButtonText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  // Picker styles\r\n  pickerContainer: {\r\n    flex: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  pickerHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingTop: 60,\r\n    paddingHorizontal: 16,\r\n    paddingBottom: 16,\r\n    backgroundColor: '#fff',\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  pickerTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  searchContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    marginHorizontal: 16,\r\n    marginVertical: 12,\r\n    paddingHorizontal: 12,\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  searchInput: {\r\n    flex: 1,\r\n    paddingVertical: 10,\r\n    paddingHorizontal: 8,\r\n    fontSize: 15,\r\n    color: '#111827',\r\n  },\r\n  pickerList: {\r\n    flex: 1,\r\n  },\r\n  pickerItem: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: '#fff',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 14,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  pickerItemInfo: {\r\n    flex: 1,\r\n  },\r\n  pickerItemName: {\r\n    fontSize: 15,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  pickerItemMeta: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  pickerEmpty: {\r\n    alignItems: 'center',\r\n    paddingVertical: 64,\r\n  },\r\n  pickerEmptyText: {\r\n    fontSize: 15,\r\n    color: '#6b7280',\r\n    marginTop: 12,\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\inventory\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\job\\JobCard.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":9,"column":25,"nodeType":"Literal","endLine":9,"endColumn":45}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Job Card Component\r\n * ==================\r\n *\r\n * Displays a job summary in list views.\r\n */\r\n\r\nimport { View, Text, StyleSheet, TouchableOpacity } from 'react-native';\r\nimport { Feather } from '@expo/vector-icons';\r\nimport { withObservables } from '@nozbe/watermelondb/react';\r\n\r\nimport { Job, Customer } from '../../watermelon/models';\r\nimport { customersCollection } from '../../watermelon/database';\r\n\r\ninterface JobCardProps {\r\n  job: Job;\r\n  customer?: Customer;\r\n  onPress: () => void;\r\n}\r\n\r\nfunction JobCard({ job, customer, onPress }: JobCardProps) {\r\n  const statusConfig = getStatusConfig(job.status);\r\n\r\n  const formatTime = (timestamp: number | null) => {\r\n    if (!timestamp) return '--:--';\r\n    const date = new Date(timestamp);\r\n    return date.toLocaleTimeString('es-AR', {\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n  };\r\n\r\n  return (\r\n    <TouchableOpacity style={styles.container} onPress={onPress} activeOpacity={0.7}>\r\n      {/* Status indicator */}\r\n      <View style={[styles.statusBar, { backgroundColor: statusConfig.color }]} />\r\n\r\n      <View style={styles.content}>\r\n        {/* Header */}\r\n        <View style={styles.header}>\r\n          <View style={styles.timeContainer}>\r\n            <Feather name=\"clock\" size={14} color=\"#6b7280\" />\r\n            <Text style={styles.time}>{formatTime(job.scheduledStart)}</Text>\r\n          </View>\r\n          <View style={[styles.statusBadge, { backgroundColor: statusConfig.bgColor }]}>\r\n            <Text style={[styles.statusText, { color: statusConfig.color }]}>\r\n              {statusConfig.label}\r\n            </Text>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Service type */}\r\n        <Text style={styles.serviceType}>{job.serviceType}</Text>\r\n\r\n        {/* Customer name */}\r\n        <Text style={styles.customerName}>\r\n          {customer?.name || 'Cliente'}\r\n        </Text>\r\n\r\n        {/* Address */}\r\n        <View style={styles.addressContainer}>\r\n          <Feather name=\"map-pin\" size={14} color=\"#9ca3af\" />\r\n          <Text style={styles.address} numberOfLines={1}>\r\n            {job.address}\r\n          </Text>\r\n        </View>\r\n\r\n        {/* Footer */}\r\n        <View style={styles.footer}>\r\n          {job.priority === 'high' && (\r\n            <View style={styles.priorityBadge}>\r\n              <Feather name=\"alert-circle\" size={12} color=\"#ef4444\" />\r\n              <Text style={styles.priorityText}>Urgente</Text>\r\n            </View>\r\n          )}\r\n\r\n          {job.isDirty && (\r\n            <View style={styles.syncBadge}>\r\n              <Feather name=\"cloud-off\" size={12} color=\"#f59e0b\" />\r\n              <Text style={styles.syncText}>Pendiente</Text>\r\n            </View>\r\n          )}\r\n\r\n          <View style={styles.spacer} />\r\n\r\n          <Feather name=\"chevron-right\" size={20} color=\"#d1d5db\" />\r\n        </View>\r\n      </View>\r\n    </TouchableOpacity>\r\n  );\r\n}\r\n\r\nfunction getStatusConfig(status: string) {\r\n  switch (status) {\r\n    case 'pending':\r\n      return { label: 'Pendiente', color: '#9ca3af', bgColor: '#f3f4f6' };\r\n    case 'scheduled':\r\n      return { label: 'Programado', color: '#3b82f6', bgColor: '#eff6ff' };\r\n    case 'en_camino':\r\n      return { label: 'En camino', color: '#f59e0b', bgColor: '#fffbeb' };\r\n    case 'working':\r\n      return { label: 'En progreso', color: '#8b5cf6', bgColor: '#f5f3ff' };\r\n    case 'completed':\r\n      return { label: 'Completado', color: '#16a34a', bgColor: '#f0fdf4' };\r\n    case 'cancelled':\r\n      return { label: 'Cancelado', color: '#ef4444', bgColor: '#fef2f2' };\r\n    default:\r\n      return { label: status, color: '#6b7280', bgColor: '#f9fafb' };\r\n  }\r\n}\r\n\r\n// Enhance with customer data\r\nconst enhance = withObservables(['job'], ({ job }: { job: Job }) => ({\r\n  job,\r\n  customer: job.customerId ? customersCollection.findAndObserve(job.customerId) : null,\r\n}));\r\n\r\nexport default enhance(JobCard);\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flexDirection: 'row',\r\n    backgroundColor: '#fff',\r\n    marginHorizontal: 16,\r\n    marginVertical: 4,\r\n    borderRadius: 12,\r\n    overflow: 'hidden',\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 1 },\r\n    shadowOpacity: 0.05,\r\n    shadowRadius: 2,\r\n    elevation: 1,\r\n  },\r\n  statusBar: {\r\n    width: 4,\r\n  },\r\n  content: {\r\n    flex: 1,\r\n    padding: 12,\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'center',\r\n    marginBottom: 8,\r\n  },\r\n  timeContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n  },\r\n  time: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n  },\r\n  statusBadge: {\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 4,\r\n    borderRadius: 6,\r\n  },\r\n  statusText: {\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n  },\r\n  serviceType: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginBottom: 4,\r\n  },\r\n  customerName: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginBottom: 8,\r\n  },\r\n  addressContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n  },\r\n  address: {\r\n    flex: 1,\r\n    fontSize: 13,\r\n    color: '#9ca3af',\r\n  },\r\n  footer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    marginTop: 12,\r\n    paddingTop: 12,\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#f3f4f6',\r\n  },\r\n  priorityBadge: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 4,\r\n    backgroundColor: '#fef2f2',\r\n    borderRadius: 6,\r\n    marginRight: 8,\r\n  },\r\n  priorityText: {\r\n    fontSize: 12,\r\n    color: '#ef4444',\r\n    fontWeight: '500',\r\n  },\r\n  syncBadge: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 4,\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 4,\r\n    backgroundColor: '#fffbeb',\r\n    borderRadius: 6,\r\n  },\r\n  syncText: {\r\n    fontSize: 12,\r\n    color: '#f59e0b',\r\n    fontWeight: '500',\r\n  },\r\n  spacer: {\r\n    flex: 1,\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\job\\StatusButton.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":9,"column":25,"nodeType":"Literal","endLine":9,"endColumn":45}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Status Button Component\r\n * =======================\r\n *\r\n * Large action button for status transitions.\r\n */\r\n\r\nimport { View, Text, StyleSheet, TouchableOpacity, ActivityIndicator } from 'react-native';\r\nimport { Feather } from '@expo/vector-icons';\r\n\r\ninterface StatusButtonProps {\r\n  status: string;\r\n  onStatusChange: (newStatus: string) => void;\r\n  isLoading: boolean;\r\n}\r\n\r\nexport default function StatusButton({\r\n  status,\r\n  onStatusChange,\r\n  isLoading,\r\n}: StatusButtonProps) {\r\n  const config = getStatusConfig(status);\r\n\r\n  if (!config.nextAction) {\r\n    return (\r\n      <View style={styles.completedContainer}>\r\n        <Feather name={config.icon as any} size={32} color={config.color} />\r\n        <Text style={[styles.statusLabel, { color: config.color }]}>\r\n          {config.label}\r\n        </Text>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      {/* Current status */}\r\n      <View style={styles.currentStatus}>\r\n        <View style={[styles.statusDot, { backgroundColor: config.color }]} />\r\n        <Text style={styles.statusText}>{config.label}</Text>\r\n      </View>\r\n\r\n      {/* Action button */}\r\n      <TouchableOpacity\r\n        style={[styles.actionButton, { backgroundColor: config.actionColor }]}\r\n        onPress={() => onStatusChange(config.nextAction!)}\r\n        disabled={isLoading}\r\n        activeOpacity={0.8}\r\n      >\r\n        {isLoading ? (\r\n          <ActivityIndicator color=\"#fff\" size=\"small\" />\r\n        ) : (\r\n          <>\r\n            <Feather name={config.actionIcon as any} size={24} color=\"#fff\" />\r\n            <Text style={styles.actionText}>{config.actionLabel}</Text>\r\n          </>\r\n        )}\r\n      </TouchableOpacity>\r\n\r\n      {/* Quick actions */}\r\n      {config.showCancel && (\r\n        <TouchableOpacity\r\n          style={styles.cancelButton}\r\n          onPress={() => onStatusChange('cancelled')}\r\n          disabled={isLoading}\r\n        >\r\n          <Text style={styles.cancelText}>Cancelar trabajo</Text>\r\n        </TouchableOpacity>\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n\r\nfunction getStatusConfig(status: string) {\r\n  switch (status) {\r\n    case 'pending':\r\n    case 'scheduled':\r\n      return {\r\n        label: 'Programado',\r\n        color: '#3b82f6',\r\n        icon: 'clock',\r\n        nextAction: 'en_camino',\r\n        actionLabel: 'Salir hacia el trabajo',\r\n        actionIcon: 'navigation',\r\n        actionColor: '#16a34a',\r\n        showCancel: true,\r\n      };\r\n    case 'en_camino':\r\n      return {\r\n        label: 'En camino',\r\n        color: '#f59e0b',\r\n        icon: 'truck',\r\n        nextAction: 'working',\r\n        actionLabel: 'Llegu├⌐ al lugar',\r\n        actionIcon: 'map-pin',\r\n        actionColor: '#3b82f6',\r\n        showCancel: true,\r\n      };\r\n    case 'working':\r\n      return {\r\n        label: 'Trabajando',\r\n        color: '#8b5cf6',\r\n        icon: 'tool',\r\n        nextAction: 'completed',\r\n        actionLabel: 'Completar trabajo',\r\n        actionIcon: 'check-circle',\r\n        actionColor: '#16a34a',\r\n        showCancel: true,\r\n      };\r\n    case 'completed':\r\n      return {\r\n        label: 'Completado',\r\n        color: '#16a34a',\r\n        icon: 'check-circle',\r\n        nextAction: null,\r\n        actionLabel: null,\r\n        actionIcon: null,\r\n        actionColor: null,\r\n        showCancel: false,\r\n      };\r\n    case 'cancelled':\r\n      return {\r\n        label: 'Cancelado',\r\n        color: '#ef4444',\r\n        icon: 'x-circle',\r\n        nextAction: null,\r\n        actionLabel: null,\r\n        actionIcon: null,\r\n        actionColor: null,\r\n        showCancel: false,\r\n      };\r\n    default:\r\n      return {\r\n        label: status,\r\n        color: '#6b7280',\r\n        icon: 'help-circle',\r\n        nextAction: null,\r\n        actionLabel: null,\r\n        actionIcon: null,\r\n        actionColor: null,\r\n        showCancel: false,\r\n      };\r\n  }\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    width: '100%',\r\n    alignItems: 'center',\r\n  },\r\n  currentStatus: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n    marginBottom: 16,\r\n  },\r\n  statusDot: {\r\n    width: 12,\r\n    height: 12,\r\n    borderRadius: 6,\r\n  },\r\n  statusText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n  },\r\n  actionButton: {\r\n    width: '100%',\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 12,\r\n    paddingVertical: 18,\r\n    borderRadius: 16,\r\n  },\r\n  actionText: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  cancelButton: {\r\n    marginTop: 16,\r\n    paddingVertical: 12,\r\n  },\r\n  cancelText: {\r\n    fontSize: 14,\r\n    color: '#ef4444',\r\n    fontWeight: '500',\r\n  },\r\n  completedContainer: {\r\n    alignItems: 'center',\r\n    gap: 8,\r\n  },\r\n  statusLabel: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\offline\\ConflictResolver.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":15,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Check' is defined but never used.","line":28,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GitMerge' is defined but never used.","line":32,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":70,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":230,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":230,"endColumn":27},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":319,"column":59,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":323,"endColumn":3,"fix":{"range":[9542,9605],"text":"{\r\n  key: string;\r\n  label: string;\r\n  value: string;\r\n}[]"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\r\n * Conflict Resolver Component\r\n * ===========================\r\n *\r\n * Phase 2.3.5: Offline Support\r\n * UI for resolving sync conflicts between local and server data.\r\n *\r\n * Features:\r\n * - Single conflict resolution\r\n * - Batch resolution for multiple conflicts\r\n * - Visual diff between local and server data\r\n * - Progress tracking\r\n */\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  Modal,\r\n  ScrollView,\r\n  TouchableOpacity,\r\n  Alert,\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\nimport {\r\n  AlertTriangle,\r\n  Check,\r\n  X,\r\n  Cloud,\r\n  Smartphone,\r\n  GitMerge,\r\n  ChevronDown,\r\n  ChevronUp,\r\n} from 'lucide-react-native';\r\nimport { SyncConflict } from '../../watermelon/models';\r\nimport { resolveConflict, getUnresolvedConflicts } from '../../lib/sync/sync-engine';\r\n\r\ninterface ConflictResolverProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  conflicts: SyncConflict[];\r\n  onResolved: () => void;\r\n}\r\n\r\nexport function ConflictResolver({\r\n  visible,\r\n  onClose,\r\n  conflicts,\r\n  onResolved,\r\n}: ConflictResolverProps) {\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n  const [resolving, setResolving] = useState(false);\r\n\r\n  const currentConflict = conflicts[currentIndex];\r\n\r\n  const handleResolve = async (resolution: 'local' | 'server') => {\r\n    if (!currentConflict) return;\r\n\r\n    setResolving(true);\r\n    try {\r\n      await resolveConflict(currentConflict.id, resolution);\r\n\r\n      if (currentIndex < conflicts.length - 1) {\r\n        setCurrentIndex(currentIndex + 1);\r\n      } else {\r\n        onResolved();\r\n        onClose();\r\n      }\r\n    } catch (error) {\r\n      Alert.alert('Error', 'No se pudo resolver el conflicto');\r\n    } finally {\r\n      setResolving(false);\r\n    }\r\n  };\r\n\r\n  if (!currentConflict) {\r\n    return null;\r\n  }\r\n\r\n  const localData = currentConflict.parsedLocalData || {};\r\n  const serverData = currentConflict.parsedServerData || {};\r\n\r\n  return (\r\n    <Modal\r\n      visible={visible}\r\n      animationType=\"slide\"\r\n      presentationStyle=\"pageSheet\"\r\n      onRequestClose={onClose}\r\n    >\r\n      <SafeAreaView style={styles.container} edges={['top']}>\r\n        {/* Header */}\r\n        <View style={styles.header}>\r\n          <View style={styles.headerLeft}>\r\n            <AlertTriangle size={24} color=\"#f59e0b\" />\r\n            <Text style={styles.headerTitle}>Resolver conflicto</Text>\r\n          </View>\r\n          <TouchableOpacity onPress={onClose} style={styles.closeButton}>\r\n            <X size={24} color=\"#6b7280\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        {/* Progress */}\r\n        <View style={styles.progress}>\r\n          <Text style={styles.progressText}>\r\n            Conflicto {currentIndex + 1} de {conflicts.length}\r\n          </Text>\r\n          <View style={styles.progressBar}>\r\n            <View\r\n              style={[\r\n                styles.progressFill,\r\n                { width: `${((currentIndex + 1) / conflicts.length) * 100}%` },\r\n              ]}\r\n            />\r\n          </View>\r\n        </View>\r\n\r\n        {/* Conflict Info */}\r\n        <View style={styles.conflictInfo}>\r\n          <Text style={styles.conflictType}>\r\n            {getEntityTypeLabel(currentConflict.entityType)}\r\n          </Text>\r\n          <Text style={styles.conflictDesc}>\r\n            Este registro fue modificado tanto en tu dispositivo como en el servidor.\r\n            Elegi cual version mantener.\r\n          </Text>\r\n        </View>\r\n\r\n        <ScrollView style={styles.content}>\r\n          {/* Local Version */}\r\n          <ConflictVersion\r\n            title=\"Tu version (local)\"\r\n            icon={<Smartphone size={20} color=\"#3b82f6\" />}\r\n            data={localData}\r\n            color=\"#3b82f6\"\r\n            onSelect={() => handleResolve('local')}\r\n            disabled={resolving}\r\n          />\r\n\r\n          {/* Divider */}\r\n          <View style={styles.divider}>\r\n            <View style={styles.dividerLine} />\r\n            <Text style={styles.dividerText}>VS</Text>\r\n            <View style={styles.dividerLine} />\r\n          </View>\r\n\r\n          {/* Server Version */}\r\n          <ConflictVersion\r\n            title=\"Version del servidor\"\r\n            icon={<Cloud size={20} color=\"#059669\" />}\r\n            data={serverData}\r\n            color=\"#059669\"\r\n            onSelect={() => handleResolve('server')}\r\n            disabled={resolving}\r\n          />\r\n        </ScrollView>\r\n\r\n        {/* Batch Actions (when multiple conflicts) */}\r\n        {conflicts.length > 1 && (\r\n          <View style={styles.batchActions}>\r\n            <TouchableOpacity\r\n              style={styles.batchButton}\r\n              onPress={() => handleResolveAll('local')}\r\n              disabled={resolving}\r\n            >\r\n              <Text style={styles.batchButtonText}>Usar local para todos ({conflicts.length})</Text>\r\n            </TouchableOpacity>\r\n            <TouchableOpacity\r\n              style={styles.batchButton}\r\n              onPress={() => handleResolveAll('server')}\r\n              disabled={resolving}\r\n            >\r\n              <Text style={styles.batchButtonText}>Usar servidor para todos</Text>\r\n            </TouchableOpacity>\r\n          </View>\r\n        )}\r\n\r\n        {/* Actions */}\r\n        <View style={styles.actions}>\r\n          <TouchableOpacity\r\n            style={[styles.actionButton, styles.localButton]}\r\n            onPress={() => handleResolve('local')}\r\n            disabled={resolving}\r\n          >\r\n            <Smartphone size={20} color=\"#fff\" />\r\n            <Text style={styles.actionButtonText}>Usar mi version</Text>\r\n          </TouchableOpacity>\r\n\r\n          <TouchableOpacity\r\n            style={[styles.actionButton, styles.serverButton]}\r\n            onPress={() => handleResolve('server')}\r\n            disabled={resolving}\r\n          >\r\n            <Cloud size={20} color=\"#fff\" />\r\n            <Text style={styles.actionButtonText}>Usar del servidor</Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        {/* Skip button for multiple conflicts */}\r\n        {conflicts.length > 1 && currentIndex < conflicts.length - 1 && (\r\n          <TouchableOpacity\r\n            style={styles.skipButton}\r\n            onPress={() => setCurrentIndex(currentIndex + 1)}\r\n            disabled={resolving}\r\n          >\r\n            <Text style={styles.skipButtonText}>Omitir y ver siguiente</Text>\r\n          </TouchableOpacity>\r\n        )}\r\n      </SafeAreaView>\r\n    </Modal>\r\n  );\r\n\r\n  // Batch resolve handler\r\n  function handleResolveAll(resolution: 'local' | 'server') {\r\n    Alert.alert(\r\n      resolution === 'local' ? 'Usar datos locales' : 'Usar datos del servidor',\r\n      `┬┐Aplicar esta resoluci├│n a los ${conflicts.length} conflictos pendientes?`,\r\n      [\r\n        { text: 'Cancelar', style: 'cancel' },\r\n        {\r\n          text: 'Aplicar a todos',\r\n          onPress: async () => {\r\n            setResolving(true);\r\n            try {\r\n              for (const conflict of conflicts) {\r\n                await resolveConflict(conflict.id, resolution);\r\n              }\r\n              onResolved();\r\n              onClose();\r\n            } catch (error) {\r\n              Alert.alert('Error', 'No se pudieron resolver todos los conflictos');\r\n            } finally {\r\n              setResolving(false);\r\n            }\r\n          },\r\n        },\r\n      ]\r\n    );\r\n  }\r\n}\r\n\r\ninterface ConflictVersionProps {\r\n  title: string;\r\n  icon: React.ReactNode;\r\n  data: Record<string, unknown>;\r\n  color: string;\r\n  onSelect: () => void;\r\n  disabled: boolean;\r\n}\r\n\r\nfunction ConflictVersion({\r\n  title,\r\n  icon,\r\n  data,\r\n  color,\r\n  onSelect,\r\n  disabled,\r\n}: ConflictVersionProps) {\r\n  const [expanded, setExpanded] = useState(false);\r\n\r\n  // Get displayable fields\r\n  const displayFields = getDisplayFields(data);\r\n  const previewFields = displayFields.slice(0, 3);\r\n  const hasMore = displayFields.length > 3;\r\n\r\n  return (\r\n    <View style={[styles.versionCard, { borderColor: color }]}>\r\n      <View style={styles.versionHeader}>\r\n        {icon}\r\n        <Text style={[styles.versionTitle, { color }]}>{title}</Text>\r\n      </View>\r\n\r\n      <View style={styles.versionFields}>\r\n        {(expanded ? displayFields : previewFields).map((field) => (\r\n          <View key={field.key} style={styles.fieldRow}>\r\n            <Text style={styles.fieldLabel}>{field.label}</Text>\r\n            <Text style={styles.fieldValue} numberOfLines={expanded ? undefined : 1}>\r\n              {field.value}\r\n            </Text>\r\n          </View>\r\n        ))}\r\n      </View>\r\n\r\n      {hasMore && (\r\n        <TouchableOpacity\r\n          style={styles.expandButton}\r\n          onPress={() => setExpanded(!expanded)}\r\n        >\r\n          {expanded ? (\r\n            <>\r\n              <ChevronUp size={16} color=\"#6b7280\" />\r\n              <Text style={styles.expandText}>Ver menos</Text>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <ChevronDown size={16} color=\"#6b7280\" />\r\n              <Text style={styles.expandText}>\r\n                Ver {displayFields.length - 3} campos mas\r\n              </Text>\r\n            </>\r\n          )}\r\n        </TouchableOpacity>\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n\r\n// Helper functions\r\n\r\nfunction getEntityTypeLabel(type: string): string {\r\n  const labels: Record<string, string> = {\r\n    job: 'Trabajo',\r\n    customer: 'Cliente',\r\n    price_book_item: 'Item de precio',\r\n  };\r\n  return labels[type] || type;\r\n}\r\n\r\nfunction getDisplayFields(data: Record<string, unknown>): Array<{\r\n  key: string;\r\n  label: string;\r\n  value: string;\r\n}> {\r\n  const fieldLabels: Record<string, string> = {\r\n    status: 'Estado',\r\n    notes: 'Notas',\r\n    completionNotes: 'Notas de finalizacion',\r\n    address: 'Direccion',\r\n    scheduledStart: 'Inicio programado',\r\n    scheduledEnd: 'Fin programado',\r\n    actualStart: 'Inicio real',\r\n    actualEnd: 'Fin real',\r\n    subtotal: 'Subtotal',\r\n    tax: 'IVA',\r\n    total: 'Total',\r\n    name: 'Nombre',\r\n    phone: 'Telefono',\r\n    email: 'Email',\r\n  };\r\n\r\n  const hiddenFields = ['id', 'serverId', '_raw', 'syncedAt', 'isDirty', 'createdAt', 'updatedAt'];\r\n\r\n  return Object.entries(data)\r\n    .filter(([key]) => !hiddenFields.includes(key))\r\n    .map(([key, value]) => ({\r\n      key,\r\n      label: fieldLabels[key] || key,\r\n      value: formatValue(value),\r\n    }));\r\n}\r\n\r\nfunction formatValue(value: unknown): string {\r\n  if (value === null || value === undefined) return '-';\r\n  if (typeof value === 'boolean') return value ? 'Si' : 'No';\r\n  if (typeof value === 'number') {\r\n    // Check if it looks like a timestamp\r\n    if (value > 1000000000000) {\r\n      return new Date(value).toLocaleString('es-AR');\r\n    }\r\n    // Format as currency if it looks like money\r\n    if (value > 100) {\r\n      return `$${value.toLocaleString('es-AR')}`;\r\n    }\r\n    return value.toString();\r\n  }\r\n  if (typeof value === 'string') {\r\n    // Check if it's a date string\r\n    if (value.match(/^\\d{4}-\\d{2}-\\d{2}/)) {\r\n      return new Date(value).toLocaleString('es-AR');\r\n    }\r\n    return value;\r\n  }\r\n  if (Array.isArray(value)) return `${value.length} items`;\r\n  if (typeof value === 'object') return JSON.stringify(value);\r\n  return String(value);\r\n}\r\n\r\n/**\r\n * Hook for conflict resolution\r\n */\r\nexport function useConflictResolver() {\r\n  const [conflicts, setConflicts] = useState<SyncConflict[]>([]);\r\n  const [visible, setVisible] = useState(false);\r\n\r\n  const checkConflicts = async () => {\r\n    const unresolvedConflicts = await getUnresolvedConflicts();\r\n    if (unresolvedConflicts.length > 0) {\r\n      setConflicts(unresolvedConflicts);\r\n      setVisible(true);\r\n    }\r\n  };\r\n\r\n  const close = () => {\r\n    setVisible(false);\r\n    setConflicts([]);\r\n  };\r\n\r\n  const handleResolved = () => {\r\n    checkConflicts(); // Check if there are more\r\n  };\r\n\r\n  return {\r\n    conflicts,\r\n    visible,\r\n    checkConflicts,\r\n    close,\r\n    handleResolved,\r\n  };\r\n}\r\n\r\n/**\r\n * Conflict Badge Component\r\n * Shows a badge when there are unresolved conflicts\r\n */\r\ninterface ConflictBadgeProps {\r\n  onPress: () => void;\r\n}\r\n\r\nexport function ConflictBadge({ onPress }: ConflictBadgeProps) {\r\n  const [count, setCount] = useState(0);\r\n\r\n  // Check for conflicts on mount\r\n  useState(() => {\r\n    getUnresolvedConflicts().then((conflicts) => {\r\n      setCount(conflicts.length);\r\n    });\r\n  });\r\n\r\n  if (count === 0) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <TouchableOpacity style={styles.conflictBadge} onPress={onPress}>\r\n      <AlertTriangle size={14} color=\"#f59e0b\" />\r\n      <Text style={styles.conflictBadgeText}>\r\n        {count} conflicto{count !== 1 ? 's' : ''}\r\n      </Text>\r\n    </TouchableOpacity>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#fff',\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  headerLeft: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 12,\r\n  },\r\n  headerTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  closeButton: {\r\n    padding: 4,\r\n  },\r\n  progress: {\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n  },\r\n  progressText: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    marginBottom: 8,\r\n  },\r\n  progressBar: {\r\n    height: 4,\r\n    backgroundColor: '#e5e7eb',\r\n    borderRadius: 2,\r\n  },\r\n  progressFill: {\r\n    height: '100%',\r\n    backgroundColor: '#f59e0b',\r\n    borderRadius: 2,\r\n  },\r\n  conflictInfo: {\r\n    paddingHorizontal: 16,\r\n    paddingBottom: 16,\r\n  },\r\n  conflictType: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#374151',\r\n    textTransform: 'uppercase',\r\n    letterSpacing: 0.5,\r\n  },\r\n  conflictDesc: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    marginTop: 4,\r\n    lineHeight: 20,\r\n  },\r\n  content: {\r\n    flex: 1,\r\n    paddingHorizontal: 16,\r\n  },\r\n  versionCard: {\r\n    backgroundColor: '#f9fafb',\r\n    borderRadius: 12,\r\n    borderWidth: 2,\r\n    padding: 16,\r\n  },\r\n  versionHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n    marginBottom: 12,\r\n  },\r\n  versionTitle: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n  },\r\n  versionFields: {\r\n    gap: 8,\r\n  },\r\n  fieldRow: {\r\n    flexDirection: 'row',\r\n    justifyContent: 'space-between',\r\n    alignItems: 'flex-start',\r\n  },\r\n  fieldLabel: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    flex: 1,\r\n  },\r\n  fieldValue: {\r\n    fontSize: 14,\r\n    color: '#111827',\r\n    fontWeight: '500',\r\n    flex: 2,\r\n    textAlign: 'right',\r\n  },\r\n  expandButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 4,\r\n    marginTop: 12,\r\n    paddingTop: 12,\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#e5e7eb',\r\n  },\r\n  expandText: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n  },\r\n  divider: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    marginVertical: 16,\r\n  },\r\n  dividerLine: {\r\n    flex: 1,\r\n    height: 1,\r\n    backgroundColor: '#e5e7eb',\r\n  },\r\n  dividerText: {\r\n    marginHorizontal: 16,\r\n    fontSize: 12,\r\n    fontWeight: '600',\r\n    color: '#9ca3af',\r\n  },\r\n  actions: {\r\n    flexDirection: 'row',\r\n    gap: 12,\r\n    padding: 16,\r\n    borderTopWidth: 1,\r\n    borderTopColor: '#e5e7eb',\r\n  },\r\n  actionButton: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    paddingVertical: 14,\r\n    borderRadius: 12,\r\n  },\r\n  localButton: {\r\n    backgroundColor: '#3b82f6',\r\n  },\r\n  serverButton: {\r\n    backgroundColor: '#059669',\r\n  },\r\n  actionButtonText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  // Batch actions\r\n  batchActions: {\r\n    flexDirection: 'row',\r\n    gap: 8,\r\n    paddingHorizontal: 16,\r\n    paddingBottom: 12,\r\n  },\r\n  batchButton: {\r\n    flex: 1,\r\n    paddingVertical: 10,\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    alignItems: 'center',\r\n  },\r\n  batchButtonText: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n  },\r\n  // Skip button\r\n  skipButton: {\r\n    alignItems: 'center',\r\n    paddingVertical: 12,\r\n    paddingHorizontal: 16,\r\n  },\r\n  skipButtonText: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n  },\r\n  // Conflict badge\r\n  conflictBadge: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n    paddingHorizontal: 10,\r\n    paddingVertical: 6,\r\n    backgroundColor: '#fffbeb',\r\n    borderRadius: 12,\r\n    borderWidth: 1,\r\n    borderColor: '#fde68a',\r\n  },\r\n  conflictBadgeText: {\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n    color: '#b45309',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\offline\\OfflineBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\offline\\OfflineIndicator.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'pulseAnim'. Either include it or remove the dependency array.","line":66,"column":6,"nodeType":"ArrayExpression","endLine":66,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [pendingOperations, isSyncing, pulseAnim]","fix":{"range":[1716,1746],"text":"[pendingOperations, isSyncing, pulseAnim]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Offline Indicator Component\r\n * ===========================\r\n *\r\n * Phase 9.10: Mobile-First Architecture\r\n * Visual indicator for offline status with sync queue info.\r\n */\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  Animated,\r\n  TouchableOpacity,\r\n  Modal,\r\n} from 'react-native';\r\nimport {\r\n  WifiOff,\r\n  Cloud,\r\n  CloudOff,\r\n  RefreshCw,\r\n  AlertCircle,\r\n  Check,\r\n  X,\r\n} from 'lucide-react-native';\r\n\r\nimport { useSyncStatus } from '../../lib/hooks/use-sync-status';\r\nimport { performSync } from '../../lib/sync/sync-engine';\r\n\r\ninterface OfflineIndicatorProps {\r\n  showDetails?: boolean;\r\n  position?: 'top' | 'bottom' | 'floating';\r\n}\r\n\r\nexport function OfflineIndicator({\r\n  showDetails = true,\r\n  position = 'top',\r\n}: OfflineIndicatorProps) {\r\n  const { isOnline, pendingOperations, isSyncing, conflicts, lastSync } = useSyncStatus();\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [syncResult, setSyncResult] = useState<string | null>(null);\r\n  const fadeAnim = useRef(new Animated.Value(1)).current;\r\n  const pulseAnim = useRef(new Animated.Value(1)).current;\r\n\r\n  // Pulse animation for pending operations\r\n  useEffect(() => {\r\n    if (pendingOperations > 0 && !isSyncing) {\r\n      const pulse = Animated.loop(\r\n        Animated.sequence([\r\n          Animated.timing(pulseAnim, {\r\n            toValue: 1.1,\r\n            duration: 800,\r\n            useNativeDriver: true,\r\n          }),\r\n          Animated.timing(pulseAnim, {\r\n            toValue: 1,\r\n            duration: 800,\r\n            useNativeDriver: true,\r\n          }),\r\n        ])\r\n      );\r\n      pulse.start();\r\n      return () => pulse.stop();\r\n    }\r\n  }, [pendingOperations, isSyncing]);\r\n\r\n  // Auto-hide success message\r\n  useEffect(() => {\r\n    if (syncResult) {\r\n      const timer = setTimeout(() => setSyncResult(null), 3000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [syncResult]);\r\n\r\n  const handleManualSync = async () => {\r\n    if (isSyncing || !isOnline) return;\r\n\r\n    const result = await performSync();\r\n    if (result.success) {\r\n      setSyncResult(`Sincronizado: ${result.pushed} enviados, ${result.pulled} recibidos`);\r\n    } else {\r\n      setSyncResult(`Error: ${result.error}`);\r\n    }\r\n  };\r\n\r\n  const formatLastSync = () => {\r\n    if (!lastSync) return 'Nunca';\r\n    const diff = Date.now() - lastSync.getTime();\r\n    if (diff < 60000) return 'Hace un momento';\r\n    if (diff < 3600000) return `Hace ${Math.floor(diff / 60000)} min`;\r\n    if (diff < 86400000) return `Hace ${Math.floor(diff / 3600000)} horas`;\r\n    return lastSync.toLocaleDateString('es-AR');\r\n  };\r\n\r\n  // If online and no pending operations, show minimal indicator\r\n  if (isOnline && pendingOperations === 0 && conflicts === 0 && !syncResult) {\r\n    return null;\r\n  }\r\n\r\n  const containerStyle = [\r\n    styles.container,\r\n    position === 'bottom' && styles.containerBottom,\r\n    position === 'floating' && styles.containerFloating,\r\n    !isOnline && styles.containerOffline,\r\n    isSyncing && styles.containerSyncing,\r\n    syncResult && (syncResult.includes('Error') ? styles.containerError : styles.containerSuccess),\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <Animated.View style={[containerStyle, { opacity: fadeAnim }]}>\r\n        <TouchableOpacity\r\n          style={styles.content}\r\n          onPress={() => showDetails && setShowModal(true)}\r\n          onLongPress={handleManualSync}\r\n          disabled={!showDetails}\r\n        >\r\n          {/* Status Icon */}\r\n          <View style={styles.iconContainer}>\r\n            {!isOnline ? (\r\n              <WifiOff size={16} color=\"#fff\" />\r\n            ) : isSyncing ? (\r\n              <Animated.View style={{ transform: [{ rotate: '360deg' }] }}>\r\n                <RefreshCw size={16} color=\"#fff\" />\r\n              </Animated.View>\r\n            ) : conflicts > 0 ? (\r\n              <AlertCircle size={16} color=\"#fff\" />\r\n            ) : syncResult?.includes('Error') ? (\r\n              <X size={16} color=\"#fff\" />\r\n            ) : syncResult ? (\r\n              <Check size={16} color=\"#fff\" />\r\n            ) : (\r\n              <Cloud size={16} color=\"#fff\" />\r\n            )}\r\n          </View>\r\n\r\n          {/* Status Text */}\r\n          <Text style={styles.text}>\r\n            {!isOnline\r\n              ? 'Sin conexi├│n'\r\n              : isSyncing\r\n                ? 'Sincronizando...'\r\n                : syncResult\r\n                  ? syncResult\r\n                  : conflicts > 0\r\n                    ? `${conflicts} conflicto${conflicts > 1 ? 's' : ''}`\r\n                    : `${pendingOperations} pendiente${pendingOperations > 1 ? 's' : ''}`}\r\n          </Text>\r\n\r\n          {/* Pending Badge */}\r\n          {pendingOperations > 0 && !isSyncing && !syncResult && (\r\n            <Animated.View\r\n              style={[styles.badge, { transform: [{ scale: pulseAnim }] }]}\r\n            >\r\n              <Text style={styles.badgeText}>{pendingOperations}</Text>\r\n            </Animated.View>\r\n          )}\r\n        </TouchableOpacity>\r\n      </Animated.View>\r\n\r\n      {/* Details Modal */}\r\n      <Modal\r\n        visible={showModal}\r\n        transparent\r\n        animationType=\"slide\"\r\n        onRequestClose={() => setShowModal(false)}\r\n      >\r\n        <View style={styles.modalOverlay}>\r\n          <View style={styles.modalContent}>\r\n            <View style={styles.modalHeader}>\r\n              <Text style={styles.modalTitle}>Estado de Sincronizaci├│n</Text>\r\n              <TouchableOpacity onPress={() => setShowModal(false)}>\r\n                <X size={24} color=\"#6b7280\" />\r\n              </TouchableOpacity>\r\n            </View>\r\n\r\n            <View style={styles.modalBody}>\r\n              {/* Connection Status */}\r\n              <View style={styles.statusRow}>\r\n                <View style={styles.statusIcon}>\r\n                  {isOnline ? (\r\n                    <Cloud size={24} color=\"#059669\" />\r\n                  ) : (\r\n                    <CloudOff size={24} color=\"#ef4444\" />\r\n                  )}\r\n                </View>\r\n                <View style={styles.statusInfo}>\r\n                  <Text style={styles.statusLabel}>Conexi├│n</Text>\r\n                  <Text style={styles.statusValue}>\r\n                    {isOnline ? 'En l├¡nea' : 'Sin conexi├│n'}\r\n                  </Text>\r\n                </View>\r\n              </View>\r\n\r\n              {/* Last Sync */}\r\n              <View style={styles.statusRow}>\r\n                <View style={styles.statusIcon}>\r\n                  <RefreshCw size={24} color=\"#6b7280\" />\r\n                </View>\r\n                <View style={styles.statusInfo}>\r\n                  <Text style={styles.statusLabel}>├Ültima sincronizaci├│n</Text>\r\n                  <Text style={styles.statusValue}>{formatLastSync()}</Text>\r\n                </View>\r\n              </View>\r\n\r\n              {/* Pending Operations */}\r\n              <View style={styles.statusRow}>\r\n                <View style={styles.statusIcon}>\r\n                  <Cloud size={24} color={pendingOperations > 0 ? '#f59e0b' : '#6b7280'} />\r\n                </View>\r\n                <View style={styles.statusInfo}>\r\n                  <Text style={styles.statusLabel}>Operaciones pendientes</Text>\r\n                  <Text style={styles.statusValue}>{pendingOperations}</Text>\r\n                </View>\r\n              </View>\r\n\r\n              {/* Conflicts */}\r\n              {conflicts > 0 && (\r\n                <View style={styles.statusRow}>\r\n                  <View style={styles.statusIcon}>\r\n                    <AlertCircle size={24} color=\"#ef4444\" />\r\n                  </View>\r\n                  <View style={styles.statusInfo}>\r\n                    <Text style={styles.statusLabel}>Conflictos por resolver</Text>\r\n                    <Text style={[styles.statusValue, { color: '#ef4444' }]}>\r\n                      {conflicts}\r\n                    </Text>\r\n                  </View>\r\n                </View>\r\n              )}\r\n            </View>\r\n\r\n            {/* Actions */}\r\n            <View style={styles.modalActions}>\r\n              <TouchableOpacity\r\n                style={[\r\n                  styles.syncButton,\r\n                  (!isOnline || isSyncing) && styles.syncButtonDisabled,\r\n                ]}\r\n                onPress={handleManualSync}\r\n                disabled={!isOnline || isSyncing}\r\n              >\r\n                <RefreshCw\r\n                  size={20}\r\n                  color={!isOnline || isSyncing ? '#9ca3af' : '#fff'}\r\n                />\r\n                <Text\r\n                  style={[\r\n                    styles.syncButtonText,\r\n                    (!isOnline || isSyncing) && styles.syncButtonTextDisabled,\r\n                  ]}\r\n                >\r\n                  {isSyncing ? 'Sincronizando...' : 'Sincronizar ahora'}\r\n                </Text>\r\n              </TouchableOpacity>\r\n            </View>\r\n\r\n            {/* Help Text */}\r\n            <Text style={styles.helpText}>\r\n              Los cambios se guardan localmente y se sincronizan autom├íticamente\r\n              cuando hay conexi├│n.\r\n            </Text>\r\n          </View>\r\n        </View>\r\n      </Modal>\r\n    </>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    backgroundColor: '#3b82f6',\r\n    paddingVertical: 8,\r\n    paddingHorizontal: 16,\r\n  },\r\n  containerBottom: {\r\n    position: 'absolute',\r\n    bottom: 0,\r\n    left: 0,\r\n    right: 0,\r\n  },\r\n  containerFloating: {\r\n    position: 'absolute',\r\n    top: 60,\r\n    left: 16,\r\n    right: 16,\r\n    borderRadius: 12,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 2 },\r\n    shadowOpacity: 0.2,\r\n    shadowRadius: 4,\r\n    elevation: 4,\r\n  },\r\n  containerOffline: {\r\n    backgroundColor: '#ef4444',\r\n  },\r\n  containerSyncing: {\r\n    backgroundColor: '#059669',\r\n  },\r\n  containerError: {\r\n    backgroundColor: '#ef4444',\r\n  },\r\n  containerSuccess: {\r\n    backgroundColor: '#059669',\r\n  },\r\n  content: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n  },\r\n  iconContainer: {\r\n    width: 24,\r\n    height: 24,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  text: {\r\n    color: '#fff',\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n  },\r\n  badge: {\r\n    backgroundColor: '#fff',\r\n    paddingHorizontal: 8,\r\n    paddingVertical: 2,\r\n    borderRadius: 10,\r\n    marginLeft: 4,\r\n  },\r\n  badgeText: {\r\n    color: '#3b82f6',\r\n    fontSize: 12,\r\n    fontWeight: '700',\r\n  },\r\n  modalOverlay: {\r\n    flex: 1,\r\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n    justifyContent: 'flex-end',\r\n  },\r\n  modalContent: {\r\n    backgroundColor: '#fff',\r\n    borderTopLeftRadius: 20,\r\n    borderTopRightRadius: 20,\r\n    padding: 20,\r\n  },\r\n  modalHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    marginBottom: 20,\r\n  },\r\n  modalTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  modalBody: {\r\n    gap: 16,\r\n    marginBottom: 20,\r\n  },\r\n  statusRow: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 16,\r\n  },\r\n  statusIcon: {\r\n    width: 48,\r\n    height: 48,\r\n    backgroundColor: '#f3f4f6',\r\n    borderRadius: 12,\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n  },\r\n  statusInfo: {\r\n    flex: 1,\r\n  },\r\n  statusLabel: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n  },\r\n  statusValue: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    marginTop: 2,\r\n  },\r\n  modalActions: {\r\n    marginBottom: 16,\r\n  },\r\n  syncButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#059669',\r\n    paddingVertical: 14,\r\n    borderRadius: 12,\r\n  },\r\n  syncButtonDisabled: {\r\n    backgroundColor: '#e5e7eb',\r\n  },\r\n  syncButtonText: {\r\n    color: '#fff',\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n  },\r\n  syncButtonTextDisabled: {\r\n    color: '#9ca3af',\r\n  },\r\n  helpText: {\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n    textAlign: 'center',\r\n    lineHeight: 18,\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\offline\\QueueStatus.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Queue Status Component\r\n * ======================\r\n *\r\n * Shows offline queue status with retry capabilities\r\n */\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  StyleSheet,\r\n  TouchableOpacity,\r\n  Modal,\r\n  FlatList,\r\n  Alert,\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\nimport {\r\n  CloudOff,\r\n  RefreshCw,\r\n  Trash2,\r\n  X,\r\n  CheckCircle,\r\n  AlertCircle,\r\n  Clock,\r\n  ChevronRight,\r\n} from 'lucide-react-native';\r\nimport { Q } from '@nozbe/watermelondb';\r\nimport { syncQueueCollection, database } from '../../watermelon/database';\r\nimport { SyncQueue } from '../../watermelon/models';\r\nimport { performSync } from '../../lib/sync/sync-engine';\r\nimport { useSyncStatus } from '../../lib/hooks/use-sync-status';\r\n\r\ninterface QueueStatusProps {\r\n  compact?: boolean;\r\n}\r\n\r\nexport function QueueStatus({ compact = false }: QueueStatusProps) {\r\n  const status = useSyncStatus();\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [queueItems, setQueueItems] = useState<SyncQueue[]>([]);\r\n  const [syncing, setSyncing] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const subscription = syncQueueCollection\r\n      .query(Q.sortBy('created_at', Q.desc))\r\n      .observe()\r\n      .subscribe((items) => {\r\n        setQueueItems(items as SyncQueue[]);\r\n      });\r\n\r\n    return () => subscription.unsubscribe();\r\n  }, []);\r\n\r\n  const handleSync = async () => {\r\n    if (!status.isOnline) {\r\n      Alert.alert('Sin conexion', 'Necesitas conexion a internet para sincronizar.');\r\n      return;\r\n    }\r\n\r\n    setSyncing(true);\r\n    try {\r\n      const result = await performSync();\r\n      if (result.success) {\r\n        Alert.alert('Sincronizado', `${result.pushed} cambios enviados`);\r\n      } else {\r\n        Alert.alert('Error', result.error || 'No se pudo sincronizar');\r\n      }\r\n    } finally {\r\n      setSyncing(false);\r\n    }\r\n  };\r\n\r\n  const handleClearQueue = () => {\r\n    Alert.alert(\r\n      'Limpiar cola',\r\n      'Estas seguro? Se perderan todos los cambios pendientes.',\r\n      [\r\n        { text: 'Cancelar', style: 'cancel' },\r\n        {\r\n          text: 'Limpiar',\r\n          style: 'destructive',\r\n          onPress: async () => {\r\n            await database.write(async () => {\r\n              for (const item of queueItems) {\r\n                await item.destroyPermanently();\r\n              }\r\n            });\r\n          },\r\n        },\r\n      ]\r\n    );\r\n  };\r\n\r\n  const handleDeleteItem = (item: SyncQueue) => {\r\n    Alert.alert(\r\n      'Eliminar operacion',\r\n      'Este cambio no se sincronizara. Continuar?',\r\n      [\r\n        { text: 'Cancelar', style: 'cancel' },\r\n        {\r\n          text: 'Eliminar',\r\n          style: 'destructive',\r\n          onPress: async () => {\r\n            await database.write(async () => {\r\n              await item.destroyPermanently();\r\n            });\r\n          },\r\n        },\r\n      ]\r\n    );\r\n  };\r\n\r\n  if (queueItems.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  if (compact) {\r\n    return (\r\n      <TouchableOpacity\r\n        style={styles.compactContainer}\r\n        onPress={() => setShowModal(true)}\r\n      >\r\n        <CloudOff size={16} color=\"#f59e0b\" />\r\n        <Text style={styles.compactText}>{queueItems.length} pendientes</Text>\r\n        <ChevronRight size={16} color=\"#9ca3af\" />\r\n      </TouchableOpacity>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <View style={styles.container}>\r\n        <View style={styles.header}>\r\n          <View style={styles.headerLeft}>\r\n            <CloudOff size={20} color=\"#f59e0b\" />\r\n            <Text style={styles.title}>Cola de sincronizacion</Text>\r\n          </View>\r\n          <Text style={styles.count}>{queueItems.length} pendientes</Text>\r\n        </View>\r\n\r\n        <View style={styles.actions}>\r\n          <TouchableOpacity\r\n            style={[styles.syncButton, syncing && styles.buttonDisabled]}\r\n            onPress={handleSync}\r\n            disabled={syncing || !status.isOnline}\r\n          >\r\n            <RefreshCw size={18} color=\"#fff\" />\r\n            <Text style={styles.syncButtonText}>\r\n              {syncing ? 'Sincronizando...' : 'Sincronizar'}\r\n            </Text>\r\n          </TouchableOpacity>\r\n\r\n          <TouchableOpacity\r\n            style={styles.detailsButton}\r\n            onPress={() => setShowModal(true)}\r\n          >\r\n            <Text style={styles.detailsButtonText}>Ver detalles</Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n      </View>\r\n\r\n      {/* Queue Modal */}\r\n      <Modal\r\n        visible={showModal}\r\n        animationType=\"slide\"\r\n        presentationStyle=\"pageSheet\"\r\n        onRequestClose={() => setShowModal(false)}\r\n      >\r\n        <SafeAreaView style={styles.modalContainer} edges={['top']}>\r\n          <View style={styles.modalHeader}>\r\n            <Text style={styles.modalTitle}>Cola de sincronizacion</Text>\r\n            <TouchableOpacity onPress={() => setShowModal(false)}>\r\n              <X size={24} color=\"#6b7280\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n\r\n          <View style={styles.modalActions}>\r\n            <TouchableOpacity\r\n              style={[styles.modalSyncButton, syncing && styles.buttonDisabled]}\r\n              onPress={handleSync}\r\n              disabled={syncing || !status.isOnline}\r\n            >\r\n              <RefreshCw size={18} color=\"#fff\" />\r\n              <Text style={styles.modalSyncButtonText}>Sincronizar todo</Text>\r\n            </TouchableOpacity>\r\n\r\n            <TouchableOpacity\r\n              style={styles.clearButton}\r\n              onPress={handleClearQueue}\r\n            >\r\n              <Trash2 size={18} color=\"#dc2626\" />\r\n            </TouchableOpacity>\r\n          </View>\r\n\r\n          <FlatList\r\n            data={queueItems}\r\n            keyExtractor={(item) => item.id}\r\n            renderItem={({ item }) => (\r\n              <QueueItem item={item} onDelete={() => handleDeleteItem(item)} />\r\n            )}\r\n            ItemSeparatorComponent={() => <View style={styles.separator} />}\r\n            contentContainerStyle={styles.listContent}\r\n          />\r\n        </SafeAreaView>\r\n      </Modal>\r\n    </>\r\n  );\r\n}\r\n\r\ninterface QueueItemProps {\r\n  item: SyncQueue;\r\n  onDelete: () => void;\r\n}\r\n\r\nfunction QueueItem({ item, onDelete }: QueueItemProps) {\r\n  const getOperationLabel = (op: string) => {\r\n    const labels: Record<string, string> = {\r\n      create: 'Crear',\r\n      update: 'Actualizar',\r\n      delete: 'Eliminar',\r\n    };\r\n    return labels[op] || op;\r\n  };\r\n\r\n  const getEntityLabel = (entity: string) => {\r\n    const labels: Record<string, string> = {\r\n      job: 'Trabajo',\r\n      customer: 'Cliente',\r\n      job_photo: 'Foto',\r\n    };\r\n    return labels[entity] || entity;\r\n  };\r\n\r\n  const getStatusIcon = () => {\r\n    if (item.retryCount > 0) {\r\n      return <AlertCircle size={16} color=\"#f59e0b\" />;\r\n    }\r\n    return <Clock size={16} color=\"#6b7280\" />;\r\n  };\r\n\r\n  return (\r\n    <View style={styles.queueItem}>\r\n      <View style={styles.queueItemIcon}>{getStatusIcon()}</View>\r\n\r\n      <View style={styles.queueItemContent}>\r\n        <Text style={styles.queueItemTitle}>\r\n          {getOperationLabel(item.operation)} {getEntityLabel(item.entityType)}\r\n        </Text>\r\n        <Text style={styles.queueItemMeta}>\r\n          {item.createdAt.toLocaleString('es-AR')}\r\n          {item.retryCount > 0 && ` ΓÇó ${item.retryCount} intentos fallidos`}\r\n        </Text>\r\n      </View>\r\n\r\n      <TouchableOpacity style={styles.queueItemDelete} onPress={onDelete}>\r\n        <Trash2 size={18} color=\"#dc2626\" />\r\n      </TouchableOpacity>\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    backgroundColor: '#fffbeb',\r\n    borderRadius: 12,\r\n    padding: 16,\r\n    marginBottom: 16,\r\n    borderWidth: 1,\r\n    borderColor: '#fde68a',\r\n  },\r\n  header: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    marginBottom: 12,\r\n  },\r\n  headerLeft: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n  },\r\n  title: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#92400e',\r\n  },\r\n  count: {\r\n    fontSize: 14,\r\n    color: '#b45309',\r\n  },\r\n  actions: {\r\n    flexDirection: 'row',\r\n    gap: 12,\r\n  },\r\n  syncButton: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#f59e0b',\r\n    paddingVertical: 10,\r\n    borderRadius: 8,\r\n  },\r\n  buttonDisabled: {\r\n    opacity: 0.7,\r\n  },\r\n  syncButtonText: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  detailsButton: {\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 10,\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#fcd34d',\r\n  },\r\n  detailsButtonText: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#92400e',\r\n  },\r\n  compactContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 8,\r\n    backgroundColor: '#fffbeb',\r\n    borderRadius: 8,\r\n  },\r\n  compactText: {\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n    color: '#92400e',\r\n  },\r\n  modalContainer: {\r\n    flex: 1,\r\n    backgroundColor: '#fff',\r\n  },\r\n  modalHeader: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    borderBottomWidth: 1,\r\n    borderBottomColor: '#e5e7eb',\r\n  },\r\n  modalTitle: {\r\n    fontSize: 18,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  modalActions: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 12,\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n  },\r\n  modalSyncButton: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#059669',\r\n    paddingVertical: 12,\r\n    borderRadius: 8,\r\n  },\r\n  modalSyncButtonText: {\r\n    fontSize: 14,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  clearButton: {\r\n    width: 44,\r\n    height: 44,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    borderRadius: 8,\r\n    borderWidth: 1,\r\n    borderColor: '#fecaca',\r\n    backgroundColor: '#fef2f2',\r\n  },\r\n  listContent: {\r\n    paddingBottom: 24,\r\n  },\r\n  separator: {\r\n    height: 1,\r\n    backgroundColor: '#f3f4f6',\r\n  },\r\n  queueItem: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 14,\r\n  },\r\n  queueItemIcon: {\r\n    width: 32,\r\n    height: 32,\r\n    borderRadius: 16,\r\n    backgroundColor: '#f3f4f6',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  queueItemContent: {\r\n    flex: 1,\r\n    marginLeft: 12,\r\n  },\r\n  queueItemTitle: {\r\n    fontSize: 15,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  queueItemMeta: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n    marginTop: 2,\r\n  },\r\n  queueItemDelete: {\r\n    padding: 8,\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\offline\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\voice\\VoiceInput.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Platform' is defined but never used.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":11},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'stopRecording'. Either include it or remove the dependency array.","line":165,"column":6,"nodeType":"ArrayExpression","endLine":165,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [disabled, maxDuration, pulseAnim, stopRecording]","fix":{"range":[5181,5215],"text":"[disabled, maxDuration, pulseAnim, stopRecording]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'deleteRecording'. Either include it or remove the dependency array.","line":265,"column":6,"nodeType":"ArrayExpression","endLine":265,"endColumn":50,"suggestions":[{"desc":"Update the dependencies array to be: [recordedUri, onRecordingComplete, duration, deleteRecording]","fix":{"range":[7917,7961],"text":"[recordedUri, onRecordingComplete, duration, deleteRecording]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Voice Input Component\r\n * =====================\r\n *\r\n * Phase 9.10: Mobile-First Architecture\r\n * Voice note recording for job notes and customer communication.\r\n */\r\n\r\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  TouchableOpacity,\r\n  StyleSheet,\r\n  Animated,\r\n  Platform,\r\n  Alert,\r\n} from 'react-native';\r\nimport { Audio } from 'expo-av';\r\nimport * as FileSystem from 'expo-file-system';\r\nimport { Mic, Square, Send, Trash2, Play, Pause, Loader } from 'lucide-react-native';\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// TYPES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\ninterface VoiceInputProps {\r\n  onRecordingComplete: (uri: string, duration: number) => Promise<void>;\r\n  onTranscriptionComplete?: (text: string) => void;\r\n  maxDuration?: number; // Max recording duration in seconds\r\n  showTranscription?: boolean;\r\n  placeholder?: string;\r\n  disabled?: boolean;\r\n}\r\n\r\ntype RecordingState = 'idle' | 'recording' | 'recorded' | 'playing' | 'processing';\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// COMPONENT\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport default function VoiceInput({\r\n  onRecordingComplete,\r\n  onTranscriptionComplete,\r\n  maxDuration = 120, // 2 minutes default\r\n  showTranscription = true,\r\n  placeholder = 'Manten├⌐ presionado para grabar',\r\n  disabled = false,\r\n}: VoiceInputProps) {\r\n  const [state, setState] = useState<RecordingState>('idle');\r\n  const [duration, setDuration] = useState(0);\r\n  const [recordedUri, setRecordedUri] = useState<string | null>(null);\r\n  const [playbackPosition, setPlaybackPosition] = useState(0);\r\n  const [transcription, setTranscription] = useState<string | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const recordingRef = useRef<Audio.Recording | null>(null);\r\n  const soundRef = useRef<Audio.Sound | null>(null);\r\n  const timerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\r\n  const pulseAnim = useRef(new Animated.Value(1)).current;\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // PERMISSIONS\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  const requestPermissions = async (): Promise<boolean> => {\r\n    try {\r\n      const { status } = await Audio.requestPermissionsAsync();\r\n      if (status !== 'granted') {\r\n        Alert.alert(\r\n          'Permisos requeridos',\r\n          'Necesitamos acceso al micr├│fono para grabar notas de voz.',\r\n          [{ text: 'OK' }]\r\n        );\r\n        return false;\r\n      }\r\n      return true;\r\n    } catch (err) {\r\n      console.error('Permission error:', err);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // RECORDING\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  const startRecording = useCallback(async () => {\r\n    if (disabled) return;\r\n\r\n    const hasPermission = await requestPermissions();\r\n    if (!hasPermission) return;\r\n\r\n    try {\r\n      setError(null);\r\n\r\n      // Configure audio mode\r\n      await Audio.setAudioModeAsync({\r\n        allowsRecordingIOS: true,\r\n        playsInSilentModeIOS: true,\r\n        staysActiveInBackground: false,\r\n      });\r\n\r\n      // Start recording\r\n      const recording = new Audio.Recording();\r\n      await recording.prepareToRecordAsync({\r\n        android: {\r\n          extension: '.m4a',\r\n          outputFormat: Audio.AndroidOutputFormat.MPEG_4,\r\n          audioEncoder: Audio.AndroidAudioEncoder.AAC,\r\n          sampleRate: 44100,\r\n          numberOfChannels: 1,\r\n          bitRate: 128000,\r\n        },\r\n        ios: {\r\n          extension: '.m4a',\r\n          outputFormat: Audio.IOSOutputFormat.MPEG4AAC,\r\n          audioQuality: Audio.IOSAudioQuality.HIGH,\r\n          sampleRate: 44100,\r\n          numberOfChannels: 1,\r\n          bitRate: 128000,\r\n        },\r\n        web: {\r\n          mimeType: 'audio/webm',\r\n          bitsPerSecond: 128000,\r\n        },\r\n      });\r\n\r\n      await recording.startAsync();\r\n      recordingRef.current = recording;\r\n      setState('recording');\r\n      setDuration(0);\r\n\r\n      // Start timer\r\n      timerRef.current = setInterval(() => {\r\n        setDuration((prev) => {\r\n          const next = prev + 1;\r\n          if (next >= maxDuration) {\r\n            stopRecording();\r\n          }\r\n          return next;\r\n        });\r\n      }, 1000);\r\n\r\n      // Start pulse animation\r\n      Animated.loop(\r\n        Animated.sequence([\r\n          Animated.timing(pulseAnim, {\r\n            toValue: 1.2,\r\n            duration: 500,\r\n            useNativeDriver: true,\r\n          }),\r\n          Animated.timing(pulseAnim, {\r\n            toValue: 1,\r\n            duration: 500,\r\n            useNativeDriver: true,\r\n          }),\r\n        ])\r\n      ).start();\r\n    } catch (err) {\r\n      console.error('Start recording error:', err);\r\n      setError('Error al iniciar grabaci├│n');\r\n      setState('idle');\r\n    }\r\n  }, [disabled, maxDuration, pulseAnim]);\r\n\r\n  const stopRecording = useCallback(async () => {\r\n    if (!recordingRef.current) return;\r\n\r\n    try {\r\n      // Stop timer\r\n      if (timerRef.current) {\r\n        clearInterval(timerRef.current);\r\n        timerRef.current = null;\r\n      }\r\n\r\n      // Stop animation\r\n      pulseAnim.stopAnimation();\r\n      pulseAnim.setValue(1);\r\n\r\n      // Stop recording\r\n      await recordingRef.current.stopAndUnloadAsync();\r\n      const uri = recordingRef.current.getURI();\r\n      recordingRef.current = null;\r\n\r\n      // Reset audio mode\r\n      await Audio.setAudioModeAsync({\r\n        allowsRecordingIOS: false,\r\n      });\r\n\r\n      if (uri) {\r\n        setRecordedUri(uri);\r\n        setState('recorded');\r\n      } else {\r\n        setState('idle');\r\n        setError('Error guardando grabaci├│n');\r\n      }\r\n    } catch (err) {\r\n      console.error('Stop recording error:', err);\r\n      setError('Error al detener grabaci├│n');\r\n      setState('idle');\r\n    }\r\n  }, [pulseAnim]);\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // PLAYBACK\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  const playRecording = useCallback(async () => {\r\n    if (!recordedUri) return;\r\n\r\n    try {\r\n      if (soundRef.current) {\r\n        await soundRef.current.unloadAsync();\r\n      }\r\n\r\n      const { sound } = await Audio.Sound.createAsync(\r\n        { uri: recordedUri },\r\n        { shouldPlay: true },\r\n        (status) => {\r\n          if (status.isLoaded) {\r\n            setPlaybackPosition(status.positionMillis / 1000);\r\n            if (status.didJustFinish) {\r\n              setState('recorded');\r\n              setPlaybackPosition(0);\r\n            }\r\n          }\r\n        }\r\n      );\r\n\r\n      soundRef.current = sound;\r\n      setState('playing');\r\n    } catch (err) {\r\n      console.error('Playback error:', err);\r\n      setError('Error reproduciendo audio');\r\n    }\r\n  }, [recordedUri]);\r\n\r\n  const pausePlayback = useCallback(async () => {\r\n    if (soundRef.current) {\r\n      await soundRef.current.pauseAsync();\r\n      setState('recorded');\r\n    }\r\n  }, []);\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // ACTIONS\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  const sendRecording = useCallback(async () => {\r\n    if (!recordedUri) return;\r\n\r\n    setState('processing');\r\n\r\n    try {\r\n      await onRecordingComplete(recordedUri, duration);\r\n\r\n      // Clean up\r\n      await deleteRecording();\r\n    } catch (err) {\r\n      console.error('Send recording error:', err);\r\n      setError('Error enviando grabaci├│n');\r\n      setState('recorded');\r\n    }\r\n  }, [recordedUri, duration, onRecordingComplete]);\r\n\r\n  const deleteRecording = useCallback(async () => {\r\n    // Stop playback if playing\r\n    if (soundRef.current) {\r\n      await soundRef.current.unloadAsync();\r\n      soundRef.current = null;\r\n    }\r\n\r\n    // Delete file\r\n    if (recordedUri) {\r\n      try {\r\n        await FileSystem.deleteAsync(recordedUri, { idempotent: true });\r\n      } catch {\r\n        // Ignore delete errors\r\n      }\r\n    }\r\n\r\n    setRecordedUri(null);\r\n    setDuration(0);\r\n    setPlaybackPosition(0);\r\n    setTranscription(null);\r\n    setState('idle');\r\n  }, [recordedUri]);\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // CLEANUP\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (timerRef.current) {\r\n        clearInterval(timerRef.current);\r\n      }\r\n      if (soundRef.current) {\r\n        soundRef.current.unloadAsync();\r\n      }\r\n      if (recordingRef.current) {\r\n        recordingRef.current.stopAndUnloadAsync();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // RENDER\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  const formatTime = (seconds: number): string => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = Math.floor(seconds % 60);\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  if (state === 'idle') {\r\n    return (\r\n      <View style={styles.container}>\r\n        <TouchableOpacity\r\n          style={[styles.recordButton, disabled && styles.disabled]}\r\n          onPressIn={startRecording}\r\n          disabled={disabled}\r\n          activeOpacity={0.8}\r\n        >\r\n          <Mic size={24} color=\"#fff\" />\r\n        </TouchableOpacity>\r\n        <Text style={styles.hint}>{placeholder}</Text>\r\n        {error && <Text style={styles.error}>{error}</Text>}\r\n      </View>\r\n    );\r\n  }\r\n\r\n  if (state === 'recording') {\r\n    return (\r\n      <View style={styles.container}>\r\n        <Animated.View style={[styles.recordingIndicator, { transform: [{ scale: pulseAnim }] }]}>\r\n          <TouchableOpacity\r\n            style={styles.stopButton}\r\n            onPress={stopRecording}\r\n            activeOpacity={0.8}\r\n          >\r\n            <Square size={24} color=\"#fff\" fill=\"#fff\" />\r\n          </TouchableOpacity>\r\n        </Animated.View>\r\n        <Text style={styles.duration}>{formatTime(duration)}</Text>\r\n        <Text style={styles.recordingText}>Grabando...</Text>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  if (state === 'recorded' || state === 'playing') {\r\n    return (\r\n      <View style={styles.container}>\r\n        <View style={styles.recordedControls}>\r\n          <TouchableOpacity\r\n            style={styles.playButton}\r\n            onPress={state === 'playing' ? pausePlayback : playRecording}\r\n          >\r\n            {state === 'playing' ? (\r\n              <Pause size={20} color=\"#16a34a\" />\r\n            ) : (\r\n              <Play size={20} color=\"#16a34a\" />\r\n            )}\r\n          </TouchableOpacity>\r\n\r\n          <View style={styles.waveform}>\r\n            <View style={styles.waveformBar} />\r\n            <View style={[styles.waveformBar, { height: 16 }]} />\r\n            <View style={[styles.waveformBar, { height: 24 }]} />\r\n            <View style={[styles.waveformBar, { height: 12 }]} />\r\n            <View style={[styles.waveformBar, { height: 20 }]} />\r\n            <View style={[styles.waveformBar, { height: 8 }]} />\r\n            <View style={styles.waveformBar} />\r\n          </View>\r\n\r\n          <Text style={styles.duration}>\r\n            {state === 'playing' ? formatTime(playbackPosition) : formatTime(duration)}\r\n          </Text>\r\n\r\n          <TouchableOpacity style={styles.deleteButton} onPress={deleteRecording}>\r\n            <Trash2 size={18} color=\"#ef4444\" />\r\n          </TouchableOpacity>\r\n\r\n          <TouchableOpacity style={styles.sendButton} onPress={sendRecording}>\r\n            <Send size={18} color=\"#fff\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        {showTranscription && transcription && (\r\n          <Text style={styles.transcription}>{transcription}</Text>\r\n        )}\r\n      </View>\r\n    );\r\n  }\r\n\r\n  if (state === 'processing') {\r\n    return (\r\n      <View style={styles.container}>\r\n        <View style={styles.processingContainer}>\r\n          <Loader size={24} color=\"#16a34a\" />\r\n          <Text style={styles.processingText}>Enviando...</Text>\r\n        </View>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// STYLES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    alignItems: 'center',\r\n    padding: 16,\r\n  },\r\n  recordButton: {\r\n    width: 56,\r\n    height: 56,\r\n    borderRadius: 28,\r\n    backgroundColor: '#16a34a',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    elevation: 4,\r\n    shadowColor: '#000',\r\n    shadowOffset: { width: 0, height: 2 },\r\n    shadowOpacity: 0.25,\r\n    shadowRadius: 4,\r\n  },\r\n  disabled: {\r\n    backgroundColor: '#9ca3af',\r\n  },\r\n  hint: {\r\n    marginTop: 8,\r\n    fontSize: 12,\r\n    color: '#6b7280',\r\n  },\r\n  error: {\r\n    marginTop: 4,\r\n    fontSize: 12,\r\n    color: '#ef4444',\r\n  },\r\n  recordingIndicator: {\r\n    width: 72,\r\n    height: 72,\r\n    borderRadius: 36,\r\n    backgroundColor: 'rgba(239, 68, 68, 0.2)',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  stopButton: {\r\n    width: 56,\r\n    height: 56,\r\n    borderRadius: 28,\r\n    backgroundColor: '#ef4444',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  duration: {\r\n    marginTop: 8,\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n  },\r\n  recordingText: {\r\n    marginTop: 4,\r\n    fontSize: 12,\r\n    color: '#ef4444',\r\n  },\r\n  recordedControls: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 12,\r\n    backgroundColor: '#f3f4f6',\r\n    borderRadius: 24,\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 8,\r\n  },\r\n  playButton: {\r\n    width: 36,\r\n    height: 36,\r\n    borderRadius: 18,\r\n    backgroundColor: '#dcfce7',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  waveform: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 2,\r\n    height: 24,\r\n    flex: 1,\r\n  },\r\n  waveformBar: {\r\n    width: 3,\r\n    height: 12,\r\n    backgroundColor: '#16a34a',\r\n    borderRadius: 1.5,\r\n  },\r\n  deleteButton: {\r\n    padding: 8,\r\n  },\r\n  sendButton: {\r\n    width: 36,\r\n    height: 36,\r\n    borderRadius: 18,\r\n    backgroundColor: '#16a34a',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  transcription: {\r\n    marginTop: 12,\r\n    fontSize: 14,\r\n    color: '#374151',\r\n    fontStyle: 'italic',\r\n    textAlign: 'center',\r\n  },\r\n  processingContainer: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n  },\r\n  processingText: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\components\\voice\\VoiceReport.tsx","messages":[{"ruleId":"import/no-unresolved","severity":2,"message":"Unable to resolve path to module '@expo/vector-icons'.","line":25,"column":25,"nodeType":"Literal","endLine":25,"endColumn":45},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'stopRecording'. Either include it or remove the dependency array.","line":173,"column":6,"nodeType":"ArrayExpression","endLine":173,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [maxDuration, pulseAnim, stopRecording]","fix":{"range":[5151,5175],"text":"[maxDuration, pulseAnim, stopRecording]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Voice Report Component\r\n * ======================\r\n *\r\n * Phase 2.3.4: Voice Report Feature\r\n * Records audio and transcribes using Whisper API.\r\n * Allows editing of transcribed text before saving.\r\n */\r\n\r\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\r\nimport {\r\n  View,\r\n  Text,\r\n  TouchableOpacity,\r\n  StyleSheet,\r\n  Animated,\r\n  TextInput,\r\n  Alert,\r\n  ActivityIndicator,\r\n  KeyboardAvoidingView,\r\n  Platform,\r\n} from 'react-native';\r\nimport { Audio } from 'expo-av';\r\nimport * as FileSystem from 'expo-file-system';\r\nimport { Feather } from '@expo/vector-icons';\r\nimport { api } from '../../lib/api/client';\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// TYPES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\ninterface VoiceReportProps {\r\n  onComplete: (text: string, audioUri?: string) => void;\r\n  onCancel?: () => void;\r\n  placeholder?: string;\r\n  maxDuration?: number;\r\n  initialText?: string;\r\n  showAudioPreview?: boolean;\r\n}\r\n\r\ntype RecordingState =\r\n  | 'idle'\r\n  | 'recording'\r\n  | 'recorded'\r\n  | 'transcribing'\r\n  | 'editing'\r\n  | 'playing';\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// COMPONENT\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport default function VoiceReport({\r\n  onComplete,\r\n  onCancel,\r\n  placeholder = 'Grab├í tu reporte de voz...',\r\n  maxDuration = 120,\r\n  initialText = '',\r\n  showAudioPreview = true,\r\n}: VoiceReportProps) {\r\n  const [state, setState] = useState<RecordingState>(\r\n    initialText ? 'editing' : 'idle'\r\n  );\r\n  const [duration, setDuration] = useState(0);\r\n  const [recordedUri, setRecordedUri] = useState<string | null>(null);\r\n  const [transcribedText, setTranscribedText] = useState(initialText);\r\n  const [editedText, setEditedText] = useState(initialText);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [playbackPosition, setPlaybackPosition] = useState(0);\r\n\r\n  const recordingRef = useRef<Audio.Recording | null>(null);\r\n  const soundRef = useRef<Audio.Sound | null>(null);\r\n  const timerRef = useRef<ReturnType<typeof setInterval> | null>(null);\r\n  const pulseAnim = useRef(new Animated.Value(1)).current;\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // PERMISSIONS\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  const requestPermissions = async (): Promise<boolean> => {\r\n    try {\r\n      const { status } = await Audio.requestPermissionsAsync();\r\n      if (status !== 'granted') {\r\n        Alert.alert(\r\n          'Permisos requeridos',\r\n          'Necesitamos acceso al micr├│fono para grabar reportes de voz.',\r\n          [{ text: 'OK' }]\r\n        );\r\n        return false;\r\n      }\r\n      return true;\r\n    } catch (err) {\r\n      console.error('Permission error:', err);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // RECORDING\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  const startRecording = useCallback(async () => {\r\n    const hasPermission = await requestPermissions();\r\n    if (!hasPermission) return;\r\n\r\n    try {\r\n      setError(null);\r\n\r\n      await Audio.setAudioModeAsync({\r\n        allowsRecordingIOS: true,\r\n        playsInSilentModeIOS: true,\r\n        staysActiveInBackground: false,\r\n      });\r\n\r\n      const recording = new Audio.Recording();\r\n      await recording.prepareToRecordAsync({\r\n        android: {\r\n          extension: '.m4a',\r\n          outputFormat: Audio.AndroidOutputFormat.MPEG_4,\r\n          audioEncoder: Audio.AndroidAudioEncoder.AAC,\r\n          sampleRate: 44100,\r\n          numberOfChannels: 1,\r\n          bitRate: 128000,\r\n        },\r\n        ios: {\r\n          extension: '.m4a',\r\n          outputFormat: Audio.IOSOutputFormat.MPEG4AAC,\r\n          audioQuality: Audio.IOSAudioQuality.HIGH,\r\n          sampleRate: 44100,\r\n          numberOfChannels: 1,\r\n          bitRate: 128000,\r\n        },\r\n        web: {\r\n          mimeType: 'audio/webm',\r\n          bitsPerSecond: 128000,\r\n        },\r\n      });\r\n\r\n      await recording.startAsync();\r\n      recordingRef.current = recording;\r\n      setState('recording');\r\n      setDuration(0);\r\n\r\n      timerRef.current = setInterval(() => {\r\n        setDuration((prev) => {\r\n          const next = prev + 1;\r\n          if (next >= maxDuration) {\r\n            stopRecording();\r\n          }\r\n          return next;\r\n        });\r\n      }, 1000);\r\n\r\n      Animated.loop(\r\n        Animated.sequence([\r\n          Animated.timing(pulseAnim, {\r\n            toValue: 1.3,\r\n            duration: 600,\r\n            useNativeDriver: true,\r\n          }),\r\n          Animated.timing(pulseAnim, {\r\n            toValue: 1,\r\n            duration: 600,\r\n            useNativeDriver: true,\r\n          }),\r\n        ])\r\n      ).start();\r\n    } catch (err) {\r\n      console.error('Start recording error:', err);\r\n      setError('Error al iniciar grabaci├│n');\r\n      setState('idle');\r\n    }\r\n  }, [maxDuration, pulseAnim]);\r\n\r\n  const stopRecording = useCallback(async () => {\r\n    if (!recordingRef.current) return;\r\n\r\n    try {\r\n      if (timerRef.current) {\r\n        clearInterval(timerRef.current);\r\n        timerRef.current = null;\r\n      }\r\n\r\n      pulseAnim.stopAnimation();\r\n      pulseAnim.setValue(1);\r\n\r\n      await recordingRef.current.stopAndUnloadAsync();\r\n      const uri = recordingRef.current.getURI();\r\n      recordingRef.current = null;\r\n\r\n      await Audio.setAudioModeAsync({\r\n        allowsRecordingIOS: false,\r\n      });\r\n\r\n      if (uri) {\r\n        setRecordedUri(uri);\r\n        setState('recorded');\r\n      } else {\r\n        setState('idle');\r\n        setError('Error guardando grabaci├│n');\r\n      }\r\n    } catch (err) {\r\n      console.error('Stop recording error:', err);\r\n      setError('Error al detener grabaci├│n');\r\n      setState('idle');\r\n    }\r\n  }, [pulseAnim]);\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // TRANSCRIPTION (Whisper API)\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  const transcribeAudio = useCallback(async () => {\r\n    if (!recordedUri) return;\r\n\r\n    setState('transcribing');\r\n    setError(null);\r\n\r\n    try {\r\n      const response = await api.transcription.transcribe(recordedUri);\r\n\r\n      if (response.success && response.data) {\r\n        const text = response.data.text.trim();\r\n        setTranscribedText(text);\r\n        setEditedText(text);\r\n        setState('editing');\r\n      } else {\r\n        // Fallback: Allow manual text entry if transcription fails\r\n        setError(\r\n          response.error?.message ||\r\n          'No se pudo transcribir. Escrib├¡ el texto manualmente.'\r\n        );\r\n        setTranscribedText('');\r\n        setEditedText('');\r\n        setState('editing');\r\n      }\r\n    } catch (err) {\r\n      console.error('Transcription error:', err);\r\n      setError('Error de transcripci├│n. Escrib├¡ el texto manualmente.');\r\n      setState('editing');\r\n    }\r\n  }, [recordedUri]);\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // PLAYBACK\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  const playRecording = useCallback(async () => {\r\n    if (!recordedUri) return;\r\n\r\n    try {\r\n      if (soundRef.current) {\r\n        await soundRef.current.unloadAsync();\r\n      }\r\n\r\n      const { sound } = await Audio.Sound.createAsync(\r\n        { uri: recordedUri },\r\n        { shouldPlay: true },\r\n        (status) => {\r\n          if (status.isLoaded) {\r\n            setPlaybackPosition(status.positionMillis / 1000);\r\n            if (status.didJustFinish) {\r\n              setState('editing');\r\n              setPlaybackPosition(0);\r\n            }\r\n          }\r\n        }\r\n      );\r\n\r\n      soundRef.current = sound;\r\n      setState('playing');\r\n    } catch (err) {\r\n      console.error('Playback error:', err);\r\n      setError('Error reproduciendo audio');\r\n    }\r\n  }, [recordedUri]);\r\n\r\n  const stopPlayback = useCallback(async () => {\r\n    if (soundRef.current) {\r\n      await soundRef.current.stopAsync();\r\n      setState('editing');\r\n      setPlaybackPosition(0);\r\n    }\r\n  }, []);\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // ACTIONS\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  const handleSave = useCallback(() => {\r\n    if (!editedText.trim()) {\r\n      Alert.alert('Texto vac├¡o', 'Por favor escrib├¡ algo para guardar.');\r\n      return;\r\n    }\r\n    onComplete(editedText.trim(), recordedUri || undefined);\r\n  }, [editedText, recordedUri, onComplete]);\r\n\r\n  const handleCancel = useCallback(async () => {\r\n    if (soundRef.current) {\r\n      await soundRef.current.unloadAsync();\r\n      soundRef.current = null;\r\n    }\r\n\r\n    if (recordedUri) {\r\n      try {\r\n        await FileSystem.deleteAsync(recordedUri, { idempotent: true });\r\n      } catch {\r\n        // Ignore\r\n      }\r\n    }\r\n\r\n    onCancel?.();\r\n  }, [recordedUri, onCancel]);\r\n\r\n  const handleReRecord = useCallback(async () => {\r\n    if (soundRef.current) {\r\n      await soundRef.current.unloadAsync();\r\n      soundRef.current = null;\r\n    }\r\n\r\n    if (recordedUri) {\r\n      try {\r\n        await FileSystem.deleteAsync(recordedUri, { idempotent: true });\r\n      } catch {\r\n        // Ignore\r\n      }\r\n    }\r\n\r\n    setRecordedUri(null);\r\n    setTranscribedText('');\r\n    setEditedText('');\r\n    setDuration(0);\r\n    setState('idle');\r\n    setError(null);\r\n  }, [recordedUri]);\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // CLEANUP\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (timerRef.current) {\r\n        clearInterval(timerRef.current);\r\n      }\r\n      if (soundRef.current) {\r\n        soundRef.current.unloadAsync();\r\n      }\r\n      if (recordingRef.current) {\r\n        recordingRef.current.stopAndUnloadAsync();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // RENDER\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  const formatTime = (seconds: number): string => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = Math.floor(seconds % 60);\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  // IDLE STATE - Show record button\r\n  if (state === 'idle') {\r\n    return (\r\n      <View style={styles.container}>\r\n        <TouchableOpacity\r\n          style={styles.recordButton}\r\n          onPress={startRecording}\r\n          activeOpacity={0.8}\r\n        >\r\n          <Feather name=\"mic\" size={32} color=\"#fff\" />\r\n        </TouchableOpacity>\r\n        <Text style={styles.hint}>{placeholder}</Text>\r\n        {error && <Text style={styles.error}>{error}</Text>}\r\n\r\n        {onCancel && (\r\n          <TouchableOpacity style={styles.cancelLink} onPress={handleCancel}>\r\n            <Text style={styles.cancelLinkText}>Escribir manualmente</Text>\r\n          </TouchableOpacity>\r\n        )}\r\n      </View>\r\n    );\r\n  }\r\n\r\n  // RECORDING STATE\r\n  if (state === 'recording') {\r\n    return (\r\n      <View style={styles.container}>\r\n        <Animated.View\r\n          style={[\r\n            styles.recordingIndicator,\r\n            { transform: [{ scale: pulseAnim }] },\r\n          ]}\r\n        >\r\n          <TouchableOpacity\r\n            style={styles.stopButton}\r\n            onPress={stopRecording}\r\n            activeOpacity={0.8}\r\n          >\r\n            <Feather name=\"square\" size={28} color=\"#fff\" />\r\n          </TouchableOpacity>\r\n        </Animated.View>\r\n        <Text style={styles.duration}>{formatTime(duration)}</Text>\r\n        <Text style={styles.recordingText}>Grabando...</Text>\r\n        <Text style={styles.maxDurationHint}>\r\n          M├íximo {Math.floor(maxDuration / 60)} minutos\r\n        </Text>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  // RECORDED - Show transcribe button\r\n  if (state === 'recorded') {\r\n    return (\r\n      <View style={styles.container}>\r\n        <View style={styles.recordedInfo}>\r\n          <Feather name=\"check-circle\" size={24} color=\"#16a34a\" />\r\n          <Text style={styles.recordedText}>\r\n            Grabaci├│n completada ({formatTime(duration)})\r\n          </Text>\r\n        </View>\r\n\r\n        <View style={styles.recordedActions}>\r\n          <TouchableOpacity\r\n            style={styles.transcribeButton}\r\n            onPress={transcribeAudio}\r\n          >\r\n            <Feather name=\"type\" size={20} color=\"#fff\" />\r\n            <Text style={styles.transcribeButtonText}>Transcribir</Text>\r\n          </TouchableOpacity>\r\n\r\n          <TouchableOpacity\r\n            style={styles.reRecordButton}\r\n            onPress={handleReRecord}\r\n          >\r\n            <Feather name=\"rotate-ccw\" size={18} color=\"#6b7280\" />\r\n            <Text style={styles.reRecordButtonText}>Grabar de nuevo</Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  // TRANSCRIBING STATE\r\n  if (state === 'transcribing') {\r\n    return (\r\n      <View style={styles.container}>\r\n        <View style={styles.transcribingContainer}>\r\n          <ActivityIndicator size=\"large\" color=\"#16a34a\" />\r\n          <Text style={styles.transcribingText}>Transcribiendo audio...</Text>\r\n          <Text style={styles.transcribingHint}>\r\n            Esto puede tomar unos segundos\r\n          </Text>\r\n        </View>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  // EDITING STATE - Show editable text\r\n  if (state === 'editing' || state === 'playing') {\r\n    return (\r\n      <KeyboardAvoidingView\r\n        behavior={Platform.OS === 'ios' ? 'padding' : 'height'}\r\n        style={styles.editContainer}\r\n      >\r\n        {/* Audio playback controls */}\r\n        {showAudioPreview && recordedUri && (\r\n          <View style={styles.playbackBar}>\r\n            <TouchableOpacity\r\n              style={styles.playbackButton}\r\n              onPress={state === 'playing' ? stopPlayback : playRecording}\r\n            >\r\n              <Feather\r\n                name={state === 'playing' ? 'pause' : 'play'}\r\n                size={18}\r\n                color=\"#16a34a\"\r\n              />\r\n            </TouchableOpacity>\r\n            <View style={styles.playbackWaveform}>\r\n              {[...Array(12)].map((_, i) => (\r\n                <View\r\n                  key={i}\r\n                  style={[\r\n                    styles.waveformBar,\r\n                    { height: 8 + Math.random() * 16 },\r\n                  ]}\r\n                />\r\n              ))}\r\n            </View>\r\n            <Text style={styles.playbackTime}>\r\n              {state === 'playing'\r\n                ? formatTime(playbackPosition)\r\n                : formatTime(duration)}\r\n            </Text>\r\n          </View>\r\n        )}\r\n\r\n        {/* Editable text */}\r\n        <View style={styles.textInputContainer}>\r\n          {error && (\r\n            <View style={styles.errorBanner}>\r\n              <Feather name=\"alert-circle\" size={16} color=\"#f59e0b\" />\r\n              <Text style={styles.errorBannerText}>{error}</Text>\r\n            </View>\r\n          )}\r\n\r\n          {transcribedText && transcribedText !== editedText && (\r\n            <TouchableOpacity\r\n              style={styles.restoreButton}\r\n              onPress={() => setEditedText(transcribedText)}\r\n            >\r\n              <Feather name=\"rotate-ccw\" size={14} color=\"#6b7280\" />\r\n              <Text style={styles.restoreButtonText}>\r\n                Restaurar texto original\r\n              </Text>\r\n            </TouchableOpacity>\r\n          )}\r\n\r\n          <TextInput\r\n            style={styles.textInput}\r\n            value={editedText}\r\n            onChangeText={setEditedText}\r\n            placeholder=\"Escrib├¡ o edit├í el texto aqu├¡...\"\r\n            placeholderTextColor=\"#9ca3af\"\r\n            multiline\r\n            autoFocus={!transcribedText}\r\n            textAlignVertical=\"top\"\r\n          />\r\n        </View>\r\n\r\n        {/* Actions */}\r\n        <View style={styles.editActions}>\r\n          <TouchableOpacity\r\n            style={styles.reRecordSmallButton}\r\n            onPress={handleReRecord}\r\n          >\r\n            <Feather name=\"mic\" size={18} color=\"#6b7280\" />\r\n          </TouchableOpacity>\r\n\r\n          {onCancel && (\r\n            <TouchableOpacity\r\n              style={styles.cancelButton}\r\n              onPress={handleCancel}\r\n            >\r\n              <Text style={styles.cancelButtonText}>Cancelar</Text>\r\n            </TouchableOpacity>\r\n          )}\r\n\r\n          <TouchableOpacity\r\n            style={[\r\n              styles.saveButton,\r\n              !editedText.trim() && styles.saveButtonDisabled,\r\n            ]}\r\n            onPress={handleSave}\r\n            disabled={!editedText.trim()}\r\n          >\r\n            <Feather name=\"check\" size={18} color=\"#fff\" />\r\n            <Text style={styles.saveButtonText}>Guardar</Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n      </KeyboardAvoidingView>\r\n    );\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// STYLES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    alignItems: 'center',\r\n    padding: 24,\r\n  },\r\n  recordButton: {\r\n    width: 80,\r\n    height: 80,\r\n    borderRadius: 40,\r\n    backgroundColor: '#16a34a',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    elevation: 6,\r\n    shadowColor: '#16a34a',\r\n    shadowOffset: { width: 0, height: 4 },\r\n    shadowOpacity: 0.3,\r\n    shadowRadius: 8,\r\n  },\r\n  hint: {\r\n    marginTop: 16,\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n    textAlign: 'center',\r\n  },\r\n  error: {\r\n    marginTop: 8,\r\n    fontSize: 13,\r\n    color: '#ef4444',\r\n    textAlign: 'center',\r\n  },\r\n  cancelLink: {\r\n    marginTop: 16,\r\n    padding: 8,\r\n  },\r\n  cancelLinkText: {\r\n    fontSize: 14,\r\n    color: '#3b82f6',\r\n    textDecorationLine: 'underline',\r\n  },\r\n  recordingIndicator: {\r\n    width: 100,\r\n    height: 100,\r\n    borderRadius: 50,\r\n    backgroundColor: 'rgba(239, 68, 68, 0.15)',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  stopButton: {\r\n    width: 72,\r\n    height: 72,\r\n    borderRadius: 36,\r\n    backgroundColor: '#ef4444',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  duration: {\r\n    marginTop: 16,\r\n    fontSize: 32,\r\n    fontWeight: '600',\r\n    color: '#111827',\r\n    fontVariant: ['tabular-nums'],\r\n  },\r\n  recordingText: {\r\n    marginTop: 8,\r\n    fontSize: 16,\r\n    color: '#ef4444',\r\n    fontWeight: '500',\r\n  },\r\n  maxDurationHint: {\r\n    marginTop: 4,\r\n    fontSize: 12,\r\n    color: '#9ca3af',\r\n  },\r\n  recordedInfo: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n    marginBottom: 20,\r\n  },\r\n  recordedText: {\r\n    fontSize: 16,\r\n    color: '#16a34a',\r\n    fontWeight: '500',\r\n  },\r\n  recordedActions: {\r\n    width: '100%',\r\n    gap: 12,\r\n  },\r\n  transcribeButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#16a34a',\r\n    paddingVertical: 14,\r\n    borderRadius: 12,\r\n  },\r\n  transcribeButtonText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n  reRecordButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 6,\r\n    paddingVertical: 12,\r\n  },\r\n  reRecordButtonText: {\r\n    fontSize: 14,\r\n    color: '#6b7280',\r\n  },\r\n  transcribingContainer: {\r\n    alignItems: 'center',\r\n    gap: 12,\r\n  },\r\n  transcribingText: {\r\n    fontSize: 16,\r\n    fontWeight: '500',\r\n    color: '#111827',\r\n  },\r\n  transcribingHint: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n  },\r\n  // Edit state\r\n  editContainer: {\r\n    flex: 1,\r\n    padding: 16,\r\n  },\r\n  playbackBar: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 12,\r\n    backgroundColor: '#f0fdf4',\r\n    borderRadius: 12,\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 10,\r\n    marginBottom: 16,\r\n  },\r\n  playbackButton: {\r\n    width: 36,\r\n    height: 36,\r\n    borderRadius: 18,\r\n    backgroundColor: '#dcfce7',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  playbackWaveform: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 2,\r\n    height: 24,\r\n  },\r\n  waveformBar: {\r\n    width: 3,\r\n    backgroundColor: '#16a34a',\r\n    borderRadius: 1.5,\r\n  },\r\n  playbackTime: {\r\n    fontSize: 13,\r\n    fontWeight: '500',\r\n    color: '#16a34a',\r\n    fontVariant: ['tabular-nums'],\r\n  },\r\n  textInputContainer: {\r\n    flex: 1,\r\n    backgroundColor: '#fff',\r\n    borderRadius: 12,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n    padding: 12,\r\n  },\r\n  errorBanner: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#fffbeb',\r\n    paddingHorizontal: 12,\r\n    paddingVertical: 8,\r\n    borderRadius: 8,\r\n    marginBottom: 12,\r\n  },\r\n  errorBannerText: {\r\n    flex: 1,\r\n    fontSize: 13,\r\n    color: '#b45309',\r\n  },\r\n  restoreButton: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 6,\r\n    alignSelf: 'flex-start',\r\n    paddingVertical: 6,\r\n    marginBottom: 8,\r\n  },\r\n  restoreButtonText: {\r\n    fontSize: 13,\r\n    color: '#6b7280',\r\n  },\r\n  textInput: {\r\n    flex: 1,\r\n    fontSize: 16,\r\n    color: '#111827',\r\n    lineHeight: 24,\r\n  },\r\n  editActions: {\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    gap: 12,\r\n    marginTop: 16,\r\n  },\r\n  reRecordSmallButton: {\r\n    width: 44,\r\n    height: 44,\r\n    borderRadius: 22,\r\n    backgroundColor: '#f3f4f6',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n  cancelButton: {\r\n    paddingHorizontal: 16,\r\n    paddingVertical: 12,\r\n    borderRadius: 10,\r\n    borderWidth: 1,\r\n    borderColor: '#e5e7eb',\r\n  },\r\n  cancelButtonText: {\r\n    fontSize: 14,\r\n    fontWeight: '500',\r\n    color: '#6b7280',\r\n  },\r\n  saveButton: {\r\n    flex: 1,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    gap: 8,\r\n    backgroundColor: '#16a34a',\r\n    paddingVertical: 14,\r\n    borderRadius: 12,\r\n  },\r\n  saveButtonDisabled: {\r\n    backgroundColor: '#9ca3af',\r\n  },\r\n  saveButtonText: {\r\n    fontSize: 16,\r\n    fontWeight: '600',\r\n    color: '#fff',\r\n  },\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\expo-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\api\\client.ts","messages":[{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":219,"column":24,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":219,"endColumn":80,"fix":{"range":[5985,6041],"text":"{ name: string; quantity: number; price: number }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":263,"column":14,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":263,"endColumn":60,"fix":{"range":[7347,7393],"text":"{ productId: string; quantity: number }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":266,"column":21,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":272,"endColumn":11,"fix":{"range":[7445,7630],"text":"{\r\n          productId: string;\r\n          productName: string;\r\n          quantity: number;\r\n          source: 'vehicle' | 'warehouse';\r\n          sourceName: string;\r\n        }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":286,"column":14,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":286,"endColumn":60,"fix":{"range":[7940,7986],"text":"{ productId: string; quantity: number }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":290,"column":18,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":298,"endColumn":11,"fix":{"range":[8064,8352],"text":"{\r\n          productId: string;\r\n          productName: string;\r\n          required: number;\r\n          vehicleAvailable: number;\r\n          warehouseAvailable: number;\r\n          canFulfill: boolean;\r\n          suggestedSource: 'vehicle' | 'warehouse' | 'insufficient';\r\n        }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":314,"column":19,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":323,"endColumn":11,"fix":{"range":[8691,8959],"text":"{\r\n          segmentNumber: number;\r\n          jobIds: string[];\r\n          origin: string;\r\n          destination: string;\r\n          waypoints: string[];\r\n          url: string;\r\n          distanceMeters: number;\r\n          durationSeconds: number;\r\n        }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":334,"column":19,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":340,"endColumn":11,"fix":{"range":[9274,9451],"text":"{\r\n          segmentNumber: number;\r\n          jobIds: string[];\r\n          url: string;\r\n          distanceMeters: number;\r\n          durationSeconds: number;\r\n        }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":364,"column":24,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":364,"endColumn":78,"fix":{"range":[10040,10094],"text":"{ type: string; entity: string; data: unknown }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":367,"column":20,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":371,"endColumn":11,"fix":{"range":[10167,10278],"text":"{\r\n          entityType: string;\r\n          entityId: string;\r\n          serverData: unknown;\r\n        }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":444,"column":22,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":444,"endColumn":76,"fix":{"range":[12206,12260],"text":"{ lat: number; lng: number; timestamp: string }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":504,"column":22,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":536,"endColumn":11,"fix":{"range":[14049,15039],"text":"{\r\n          id: string;\r\n          name: string;\r\n          phone: string;\r\n          avatar: string | null;\r\n          specialty: string | null;\r\n          skillLevel: string | null;\r\n          isOnline: boolean;\r\n          lastSeen: string | null;\r\n          location: {\r\n            lat: number;\r\n            lng: number;\r\n            accuracy: number | null;\r\n            heading: number | null;\r\n            speed: number | null;\r\n          } | null;\r\n          currentJob: {\r\n            id: string;\r\n            jobNumber: string;\r\n            status: string;\r\n            description: string | null;\r\n            scheduledDate: string;\r\n            scheduledTimeSlot: unknown | null;\r\n            customerName: string | null;\r\n            address: string | null;\r\n          } | null;\r\n          tracking: {\r\n            sessionId: string;\r\n            status: string;\r\n            etaMinutes: number | null;\r\n            movementMode: string;\r\n          } | null;\r\n        }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":554,"column":20,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":564,"endColumn":11,"fix":{"range":[15680,15951],"text":"{\r\n          id: string;\r\n          name: string;\r\n          lat: number;\r\n          lng: number;\r\n          address: string;\r\n          phone: string;\r\n          jobCount: number;\r\n          lastJobDate: string | null;\r\n          hasActiveJob: boolean;\r\n        }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":565,"column":22,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":587,"endColumn":11,"fix":{"range":[15975,16746],"text":"{\r\n          id: string;\r\n          name: string;\r\n          lat: number;\r\n          lng: number;\r\n          status: 'en_linea' | 'en_camino' | 'trabajando' | 'sin_conexion';\r\n          currentJobId: string | null;\r\n          currentJobNumber: string | null;\r\n          lastUpdated: string | null;\r\n          avatarUrl: string | null;\r\n          specialty: string | null;\r\n          phone: string;\r\n          currentCustomerName: string | null;\r\n          etaMinutes: number | null;\r\n          heading: number | null;\r\n          locationSource: 'current' | 'home' | 'office';\r\n          nextJob: {\r\n            id: string;\r\n            jobNumber: string;\r\n            customerName: string;\r\n            scheduledTime: string | null;\r\n          } | null;\r\n        }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":588,"column":20,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":604,"endColumn":11,"fix":{"range":[16768,17265],"text":"{\r\n          id: string;\r\n          jobNumber: string;\r\n          lat: number;\r\n          lng: number;\r\n          status: string;\r\n          customerId: string;\r\n          customerName: string;\r\n          customerPhone: string;\r\n          technicianId: string | null;\r\n          technicianName: string | null;\r\n          scheduledTime: string | null;\r\n          arrivedAt: string | null;\r\n          address: string;\r\n          description: string;\r\n          serviceType: string;\r\n        }[]"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":14,"source":"/**\r\n * API Client\r\n * ==========\r\n *\r\n * HTTP client for server communication with automatic token refresh.\r\n */\r\n\r\nimport { Platform } from 'react-native';\r\nimport * as SecureStore from '../storage/secure-store';\r\n\r\n// For development: Use localhost for web, LAN IP for native devices\r\n// Find your IP with: ipconfig (Windows) or ifconfig (Mac/Linux)\r\nconst DEV_API_URL_NATIVE = 'http://192.168.0.19:3000/api';  // Update this to your computer's IP\r\nconst DEV_API_URL_WEB = 'http://localhost:3000/api';\r\n\r\n// Auto-detect: use localhost for web browsers, LAN IP for native\r\nconst DEV_API_URL = Platform.OS === 'web' ? DEV_API_URL_WEB : DEV_API_URL_NATIVE;\r\n\r\nconst API_BASE_URL = process.env.EXPO_PUBLIC_API_URL || DEV_API_URL;\r\n\r\n// Debug: Log the API URL on startup\r\nconsole.log('[API Client] Platform:', Platform.OS);\r\nconsole.log('[API Client] Using API_BASE_URL:', API_BASE_URL);\r\nconsole.log('[API Client] EXPO_PUBLIC_API_URL env:', process.env.EXPO_PUBLIC_API_URL);\r\n\r\ninterface ApiResponse<T> {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: {\r\n    code: string;\r\n    message: string;\r\n  };\r\n}\r\n\r\ninterface RequestOptions {\r\n  method?: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';\r\n  body?: unknown;\r\n  headers?: Record<string, string>;\r\n  auth?: boolean;\r\n}\r\n\r\nlet isRefreshing = false;\r\nlet refreshPromise: Promise<boolean> | null = null;\r\n\r\nasync function refreshAccessToken(): Promise<boolean> {\r\n  if (isRefreshing && refreshPromise) {\r\n    return refreshPromise;\r\n  }\r\n\r\n  isRefreshing = true;\r\n  refreshPromise = (async () => {\r\n    try {\r\n      const refreshToken = await SecureStore.getRefreshToken();\r\n      if (!refreshToken) return false;\r\n\r\n      const response = await fetch(`${API_BASE_URL}/auth/refresh`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ refreshToken }),\r\n      });\r\n\r\n      if (!response.ok) return false;\r\n\r\n      const data = await response.json();\r\n      if (data.success && data.data) {\r\n        await SecureStore.setTokens(\r\n          data.data.accessToken,\r\n          data.data.refreshToken\r\n        );\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    } catch {\r\n      return false;\r\n    } finally {\r\n      isRefreshing = false;\r\n      refreshPromise = null;\r\n    }\r\n  })();\r\n\r\n  return refreshPromise;\r\n}\r\n\r\nexport async function apiRequest<T>(\r\n  endpoint: string,\r\n  options: RequestOptions = {}\r\n): Promise<ApiResponse<T>> {\r\n  const { method = 'GET', body, headers = {}, auth = true } = options;\r\n\r\n  const requestHeaders: Record<string, string> = {\r\n    'Content-Type': 'application/json',\r\n    ...headers,\r\n  };\r\n\r\n  if (auth) {\r\n    const token = await SecureStore.getAccessToken();\r\n    if (token) {\r\n      requestHeaders['Authorization'] = `Bearer ${token}`;\r\n    }\r\n  }\r\n\r\n  try {\r\n    let response = await fetch(`${API_BASE_URL}${endpoint}`, {\r\n      method,\r\n      headers: requestHeaders,\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    });\r\n\r\n    // Handle token refresh on 401\r\n    if (response.status === 401 && auth) {\r\n      const refreshed = await refreshAccessToken();\r\n      if (refreshed) {\r\n        const newToken = await SecureStore.getAccessToken();\r\n        requestHeaders['Authorization'] = `Bearer ${newToken}`;\r\n        response = await fetch(`${API_BASE_URL}${endpoint}`, {\r\n          method,\r\n          headers: requestHeaders,\r\n          body: body ? JSON.stringify(body) : undefined,\r\n        });\r\n      } else {\r\n        await SecureStore.clearAuth();\r\n        return {\r\n          success: false,\r\n          error: { code: 'AUTH_EXPIRED', message: 'Session expired' },\r\n        };\r\n      }\r\n    }\r\n\r\n    const data = await response.json();\r\n    return data;\r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      error: {\r\n        code: 'NETWORK_ERROR',\r\n        message: error instanceof Error ? error.message : 'Network error',\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\n// API Methods\r\nexport const api = {\r\n  // Auth\r\n  auth: {\r\n    requestOtp: (phone: string) =>\r\n      apiRequest<{ sent: boolean }>('/auth/otp/request', {\r\n        method: 'POST',\r\n        body: { phone },\r\n        auth: false,\r\n      }),\r\n\r\n    verifyOtp: (phone: string, code: string) =>\r\n      apiRequest<{\r\n        accessToken: string;\r\n        refreshToken: string;\r\n        user: {\r\n          id: string;\r\n          name: string;\r\n          phone: string;\r\n          role: string;\r\n          organizationId: string;\r\n        };\r\n      }>('/auth/otp/verify', {\r\n        method: 'POST',\r\n        body: { phone, code },\r\n        auth: false,\r\n      }),\r\n\r\n    logout: () => apiRequest('/auth/logout', { method: 'POST' }),\r\n\r\n    me: () =>\r\n      apiRequest<{\r\n        id: string;\r\n        name: string;\r\n        phone: string;\r\n        role: string;\r\n        organizationId: string;\r\n      }>('/auth/me'),\r\n\r\n    registerPushToken: (data: { token: string; platform: string; deviceId: string }) =>\r\n      apiRequest('/auth/push-token', {\r\n        method: 'POST',\r\n        body: data,\r\n      }),\r\n\r\n    unregisterPushToken: (deviceId: string) =>\r\n      apiRequest(`/auth/push-token/${deviceId}`, {\r\n        method: 'DELETE',\r\n      }),\r\n  },\r\n\r\n  // Jobs\r\n  jobs: {\r\n    list: (params?: { status?: string; date?: string; customerId?: string; limit?: number }) => {\r\n      const query = params\r\n        ? `?${new URLSearchParams(\r\n          Object.entries(params)\r\n            .filter(([, v]) => v !== undefined)\r\n            .map(([k, v]) => [k, String(v)]) as [string, string][]\r\n        )}`\r\n        : '';\r\n      return apiRequest<unknown[]>(`/jobs${query}`);\r\n    },\r\n\r\n    get: (id: string) => apiRequest<unknown>(`/jobs/${id}`),\r\n\r\n    updateStatus: (id: string, status: string, data?: Record<string, unknown>) =>\r\n      apiRequest(`/jobs/${id}/status`, {\r\n        method: 'PATCH',\r\n        body: { status, ...data },\r\n      }),\r\n\r\n    complete: (\r\n      id: string,\r\n      data: {\r\n        completionNotes: string;\r\n        materialsUsed: Array<{ name: string; quantity: number; price: number }>;\r\n        signatureUrl?: string;\r\n        photos?: string[];\r\n      }\r\n    ) =>\r\n      apiRequest(`/jobs/${id}/complete`, {\r\n        method: 'POST',\r\n        body: data,\r\n      }),\r\n\r\n    today: () => apiRequest<unknown[]>('/jobs/today'),\r\n\r\n    assigned: () => apiRequest<unknown[]>('/jobs/assigned'),\r\n  },\r\n\r\n  // Customers\r\n  customers: {\r\n    list: (params?: { limit?: number; offset?: number; search?: string }) => {\r\n      const query = params\r\n        ? `?${new URLSearchParams(\r\n          Object.entries(params)\r\n            .filter(([, v]) => v !== undefined)\r\n            .map(([k, v]) => [k, String(v)]) as [string, string][]\r\n        )}`\r\n        : '';\r\n      return apiRequest<unknown[]>(`/customers${query}`);\r\n    },\r\n    get: (id: string) => apiRequest<unknown>(`/customers/${id}`),\r\n    search: (query: string) =>\r\n      apiRequest<unknown[]>(`/customers/search?q=${encodeURIComponent(query)}`),\r\n    delete: (id: string) =>\r\n      apiRequest('/customers/${id}', { method: 'DELETE' }),\r\n  },\r\n\r\n  // Price Book\r\n  pricebook: {\r\n    list: () => apiRequest<unknown[]>('/pricebook'),\r\n  },\r\n\r\n  // Inventory (Phase 2.2 - Cascade deduction)\r\n  inventory: {\r\n    // Use materials with automatic cascade (vehicle first, then warehouse)\r\n    useMaterials: (\r\n      jobId: string,\r\n      items: Array<{ productId: string; quantity: number }>\r\n    ) =>\r\n      apiRequest<{\r\n        deductions: Array<{\r\n          productId: string;\r\n          productName: string;\r\n          quantity: number;\r\n          source: 'vehicle' | 'warehouse';\r\n          sourceName: string;\r\n        }>;\r\n        summary: string;\r\n      }>('/inventory/job-materials', {\r\n        method: 'POST',\r\n        body: {\r\n          action: 'useCascade',\r\n          jobId,\r\n          items,\r\n        },\r\n      }),\r\n\r\n    // Check availability before deduction\r\n    checkAvailability: (\r\n      jobId: string,\r\n      items: Array<{ productId: string; quantity: number }>\r\n    ) =>\r\n      apiRequest<{\r\n        available: boolean;\r\n        details: Array<{\r\n          productId: string;\r\n          productName: string;\r\n          required: number;\r\n          vehicleAvailable: number;\r\n          warehouseAvailable: number;\r\n          canFulfill: boolean;\r\n          suggestedSource: 'vehicle' | 'warehouse' | 'insufficient';\r\n        }>;\r\n      }>('/inventory/job-materials', {\r\n        method: 'POST',\r\n        body: {\r\n          action: 'checkAvailability',\r\n          jobId,\r\n          items,\r\n        },\r\n      }),\r\n  },\r\n\r\n  // Routes (Phase 2.3 - Multi-Stop Navigation)\r\n  routes: {\r\n    // Get today's route\r\n    getToday: () =>\r\n      apiRequest<{\r\n        segments: Array<{\r\n          segmentNumber: number;\r\n          jobIds: string[];\r\n          origin: string;\r\n          destination: string;\r\n          waypoints: string[];\r\n          url: string;\r\n          distanceMeters: number;\r\n          durationSeconds: number;\r\n        }>;\r\n        totalJobs: number;\r\n        totalDistance: number;\r\n        totalDuration: number;\r\n        primaryUrl: string;\r\n        totalSegments: number;\r\n      } | null>('/routes'),\r\n\r\n    // Generate route for a date\r\n    generate: (technicianId: string, date?: string) =>\r\n      apiRequest<{\r\n        segments: Array<{\r\n          segmentNumber: number;\r\n          jobIds: string[];\r\n          url: string;\r\n          distanceMeters: number;\r\n          durationSeconds: number;\r\n        }>;\r\n        totalJobs: number;\r\n        totalDistance: number;\r\n        totalDuration: number;\r\n        primaryUrl: string;\r\n        totalSegments: number;\r\n      }>('/routes', {\r\n        method: 'POST',\r\n        body: { technicianId, date },\r\n      }),\r\n  },\r\n\r\n  // Sync\r\n  sync: {\r\n    pull: (lastSync?: number) => {\r\n      const query = lastSync ? `?since=${lastSync}` : '';\r\n      return apiRequest<{\r\n        jobs: unknown[];\r\n        customers: unknown[];\r\n        priceBook: unknown[];\r\n        serverTime: number;\r\n      }>(`/sync/pull${query}`);\r\n    },\r\n\r\n    push: (operations: Array<{ type: string; entity: string; data: unknown }>) =>\r\n      apiRequest<{\r\n        processed: number;\r\n        conflicts: Array<{\r\n          entityType: string;\r\n          entityId: string;\r\n          serverData: unknown;\r\n        }>;\r\n      }>('/sync/push', {\r\n        method: 'POST',\r\n        body: { operations },\r\n      }),\r\n\r\n    uploadPhoto: async (localUri: string, jobId: string, type: string) => {\r\n      // This would use FormData for file upload\r\n      return apiRequest<{ url: string }>('/sync/upload-photo', {\r\n        method: 'POST',\r\n        body: { localUri, jobId, type },\r\n      });\r\n    },\r\n  },\r\n\r\n  // Push notifications\r\n  notifications: {\r\n    register: (token: string, platform: string) =>\r\n      apiRequest('/notifications/register', {\r\n        method: 'POST',\r\n        body: { token, platform },\r\n      }),\r\n\r\n    unregister: () =>\r\n      apiRequest('/notifications/unregister', { method: 'POST' }),\r\n  },\r\n\r\n  // GPS Tracking\r\n  tracking: {\r\n    start: (jobId: string, initialLat: number, initialLng: number) =>\r\n      apiRequest<{\r\n        sessionId: string;\r\n        token: string;\r\n        trackingUrl: string;\r\n        expiresAt: string;\r\n      }>('/tracking/start', {\r\n        method: 'POST',\r\n        body: { jobId, initialLat, initialLng },\r\n      }),\r\n\r\n    update: (data: {\r\n      lat: number;\r\n      lng: number;\r\n      jobId?: string | null;\r\n      sessionId?: string | null;\r\n      speed?: number | null;\r\n      heading?: number | null;\r\n      accuracy?: number | null;\r\n      altitude?: number | null;\r\n    }) =>\r\n      apiRequest<{\r\n        recorded: boolean;\r\n        sessionId?: string;\r\n        etaMinutes?: number;\r\n        arrived?: boolean;\r\n        movementMode?: string;\r\n      }>('/tracking/update', {\r\n        method: 'POST',\r\n        body: data,\r\n      }),\r\n\r\n    stop: (sessionId: string) =>\r\n      apiRequest('/tracking/status', {\r\n        method: 'POST',\r\n        body: { sessionId, status: 'COMPLETED' },\r\n      }),\r\n\r\n    getSession: (sessionId: string) =>\r\n      apiRequest<{\r\n        sessionId: string;\r\n        jobId: string;\r\n        status: string;\r\n        startedAt: string;\r\n        coordinates: Array<{ lat: number; lng: number; timestamp: string }>;\r\n      }>(`/tracking/session/${sessionId}`),\r\n\r\n    updateLocation: (sessionId: string, data: {\r\n      lat: number;\r\n      lng: number;\r\n      speed?: number | null;\r\n      heading?: number | null;\r\n      accuracy?: number | null;\r\n      timestamp?: string;\r\n    }) =>\r\n      apiRequest('/tracking/location', {\r\n        method: 'POST',\r\n        body: { sessionId, ...data },\r\n      }),\r\n  },\r\n\r\n  // Voice transcription (Whisper API)\r\n  transcription: {\r\n    transcribe: async (audioUri: string) => {\r\n      // Upload audio file for transcription\r\n      const token = await SecureStore.getAccessToken();\r\n\r\n      const formData = new FormData();\r\n      formData.append('audio', {\r\n        uri: audioUri,\r\n        type: 'audio/m4a',\r\n        name: 'voice_note.m4a',\r\n      } as any);\r\n\r\n      try {\r\n        const response = await fetch(`${API_BASE_URL}/transcription/whisper`, {\r\n          method: 'POST',\r\n          headers: {\r\n            Authorization: `Bearer ${token}`,\r\n          },\r\n          body: formData,\r\n        });\r\n\r\n        const data = await response.json();\r\n        return data as ApiResponse<{ text: string; duration: number; language: string }>;\r\n      } catch (error) {\r\n        return {\r\n          success: false,\r\n          error: {\r\n            code: 'TRANSCRIPTION_ERROR',\r\n            message: error instanceof Error ? error.message : 'Transcription failed',\r\n          },\r\n        } as ApiResponse<{ text: string; duration: number; language: string }>;\r\n      }\r\n    },\r\n  },\r\n\r\n  // Map data (dispatcher live map)\r\n  map: {\r\n    getTechnicianLocations: (params?: { onlineOnly?: boolean }) => {\r\n      const query = params?.onlineOnly !== undefined\r\n        ? `?onlineOnly=${params.onlineOnly}`\r\n        : '';\r\n      return apiRequest<{\r\n        technicians: Array<{\r\n          id: string;\r\n          name: string;\r\n          phone: string;\r\n          avatar: string | null;\r\n          specialty: string | null;\r\n          skillLevel: string | null;\r\n          isOnline: boolean;\r\n          lastSeen: string | null;\r\n          location: {\r\n            lat: number;\r\n            lng: number;\r\n            accuracy: number | null;\r\n            heading: number | null;\r\n            speed: number | null;\r\n          } | null;\r\n          currentJob: {\r\n            id: string;\r\n            jobNumber: string;\r\n            status: string;\r\n            description: string | null;\r\n            scheduledDate: string;\r\n            scheduledTimeSlot: unknown | null;\r\n            customerName: string | null;\r\n            address: string | null;\r\n          } | null;\r\n          tracking: {\r\n            sessionId: string;\r\n            status: string;\r\n            etaMinutes: number | null;\r\n            movementMode: string;\r\n          } | null;\r\n        }>;\r\n        stats: {\r\n          total: number;\r\n          online: number;\r\n          enRoute: number;\r\n          working: number;\r\n          available: number;\r\n        };\r\n        updatedAt: string;\r\n      }>(`/tracking/locations${query}`);\r\n    },\r\n\r\n    getMapData: (params?: { layers?: string[]; date?: string }) => {\r\n      const queryParams = new URLSearchParams();\r\n      if (params?.layers) queryParams.set('layers', params.layers.join(','));\r\n      if (params?.date) queryParams.set('date', params.date);\r\n      const query = queryParams.toString() ? `?${queryParams.toString()}` : '';\r\n      return apiRequest<{\r\n        customers: Array<{\r\n          id: string;\r\n          name: string;\r\n          lat: number;\r\n          lng: number;\r\n          address: string;\r\n          phone: string;\r\n          jobCount: number;\r\n          lastJobDate: string | null;\r\n          hasActiveJob: boolean;\r\n        }>;\r\n        technicians: Array<{\r\n          id: string;\r\n          name: string;\r\n          lat: number;\r\n          lng: number;\r\n          status: 'en_linea' | 'en_camino' | 'trabajando' | 'sin_conexion';\r\n          currentJobId: string | null;\r\n          currentJobNumber: string | null;\r\n          lastUpdated: string | null;\r\n          avatarUrl: string | null;\r\n          specialty: string | null;\r\n          phone: string;\r\n          currentCustomerName: string | null;\r\n          etaMinutes: number | null;\r\n          heading: number | null;\r\n          locationSource: 'current' | 'home' | 'office';\r\n          nextJob: {\r\n            id: string;\r\n            jobNumber: string;\r\n            customerName: string;\r\n            scheduledTime: string | null;\r\n          } | null;\r\n        }>;\r\n        todayJobs: Array<{\r\n          id: string;\r\n          jobNumber: string;\r\n          lat: number;\r\n          lng: number;\r\n          status: string;\r\n          customerId: string;\r\n          customerName: string;\r\n          customerPhone: string;\r\n          technicianId: string | null;\r\n          technicianName: string | null;\r\n          scheduledTime: string | null;\r\n          arrivedAt: string | null;\r\n          address: string;\r\n          description: string;\r\n          serviceType: string;\r\n        }>;\r\n        stats: {\r\n          totalCustomers: number;\r\n          customersWithLocation: number;\r\n          totalTechnicians: number;\r\n          techniciansOnline: number;\r\n          techniciansEnRoute: number;\r\n          techniciansWorking: number;\r\n          techniciansOffline: number;\r\n          todayJobsTotal: number;\r\n          todayJobsPending: number;\r\n          todayJobsInProgress: number;\r\n          todayJobsCompleted: number;\r\n        };\r\n        updatedAt: string;\r\n      }>(`/map/data${query}`);\r\n    },\r\n  },\r\n\r\n  // Employee invites\r\n  invites: {\r\n    get: (token: string) =>\r\n      apiRequest<{\r\n        organizationName: string;\r\n        organizationLogo?: string;\r\n        role: string;\r\n        invitedBy: string;\r\n        expiresAt: string;\r\n      }>(`/invites/${token}`, {\r\n        auth: false,\r\n      }),\r\n\r\n    requestOtp: (token: string, phone: string) =>\r\n      apiRequest<{ sent: boolean }>(`/invites/${token}/request-otp`, {\r\n        method: 'POST',\r\n        body: { phone },\r\n        auth: false,\r\n      }),\r\n\r\n    accept: (token: string, phone: string, code: string) =>\r\n      apiRequest<{\r\n        accessToken: string;\r\n        refreshToken: string;\r\n        user: {\r\n          id: string;\r\n          name: string;\r\n          phone: string;\r\n          role: string;\r\n          organizationId: string;\r\n        };\r\n      }>(`/invites/${token}/accept`, {\r\n        method: 'POST',\r\n        body: { phone, code },\r\n        auth: false,\r\n      }),\r\n  },\r\n\r\n  // Phase 4.3: Digital Entry Badge\r\n  badge: {\r\n    // Get current user's badge data\r\n    get: (userId: string) =>\r\n      apiRequest<{\r\n        technician: {\r\n          id: string;\r\n          name: string;\r\n          photo: string | null;\r\n          specialty: string | null;\r\n          phone: string;\r\n        };\r\n        organization: {\r\n          id: string;\r\n          name: string;\r\n          logo: string | null;\r\n        };\r\n        verification: {\r\n          artStatus: 'valid' | 'expiring' | 'expired' | 'missing';\r\n          artExpiry: string | null;\r\n          artProvider: string | null;\r\n          artPolicyNumber: string | null;\r\n          backgroundCheck: 'pending' | 'approved' | 'rejected' | 'expired';\r\n          backgroundCheckDate: string | null;\r\n          backgroundCheckProvider: string | null;\r\n        };\r\n        qrPayload: string;\r\n        generatedAt: string;\r\n        validUntil: string | null;\r\n        isValid: boolean;\r\n      }>(`/users/${userId}/badge`),\r\n\r\n    // Refresh badge token\r\n    refresh: (userId: string) =>\r\n      apiRequest<{\r\n        technician: {\r\n          id: string;\r\n          name: string;\r\n          photo: string | null;\r\n          specialty: string | null;\r\n          phone: string;\r\n        };\r\n        organization: {\r\n          id: string;\r\n          name: string;\r\n          logo: string | null;\r\n        };\r\n        verification: {\r\n          artStatus: 'valid' | 'expiring' | 'expired' | 'missing';\r\n          artExpiry: string | null;\r\n          artProvider: string | null;\r\n          artPolicyNumber: string | null;\r\n          backgroundCheck: 'pending' | 'approved' | 'rejected' | 'expired';\r\n          backgroundCheckDate: string | null;\r\n          backgroundCheckProvider: string | null;\r\n        };\r\n        qrPayload: string;\r\n        generatedAt: string;\r\n        validUntil: string | null;\r\n        isValid: boolean;\r\n        refreshed: boolean;\r\n      }>(`/users/${userId}/badge/refresh`, {\r\n        method: 'POST',\r\n      }),\r\n  },\r\n};\r\n\r\nexport default api;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\auth\\auth-context.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":8,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":76},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkAuthState'. Either include it or remove the dependency array.","line":54,"column":6,"nodeType":"ArrayExpression","endLine":54,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [checkAuthState]","fix":{"range":[1600,1602],"text":"[checkAuthState]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'router'. Either include it or remove the dependency array.","line":69,"column":6,"nodeType":"ArrayExpression","endLine":69,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [user, segments, isLoading, router]","fix":{"range":[2014,2041],"text":"[user, segments, isLoading, router]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Auth Context\r\n * ============\r\n *\r\n * Provides authentication state and methods throughout the app.\r\n */\r\n\r\nimport React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\r\nimport { useRouter, useSegments } from 'expo-router';\r\nimport * as SecureStore from '../storage/secure-store';\r\nimport { api } from '../api/client';\r\nimport { database, userSessionCollection } from '../../watermelon/database';\r\nimport { performSync } from '../sync/sync-engine';\r\n\r\ninterface User {\r\n  id: string;\r\n  name: string;\r\n  phone: string;\r\n  role: string;\r\n  organizationId: string;\r\n}\r\n\r\ninterface AuthContextType {\r\n  user: User | null;\r\n  isLoading: boolean;\r\n  isAuthenticated: boolean;\r\n  mode: 'simple' | 'advanced';\r\n  login: (phone: string, code: string) => Promise<{ success: boolean; error?: string }>;\r\n  logout: () => Promise<void>;\r\n  setMode: (mode: 'simple' | 'advanced') => Promise<void>;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | null>(null);\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [mode, setModeState] = useState<'simple' | 'advanced'>('simple');\r\n\r\n  const router = useRouter();\r\n  const segments = useSegments();\r\n\r\n  // Check auth state on mount\r\n  useEffect(() => {\r\n    checkAuthState();\r\n  }, []);\r\n\r\n  // Handle navigation based on auth state\r\n  useEffect(() => {\r\n    if (isLoading) return;\r\n\r\n    const inAuthGroup = segments[0] === '(auth)';\r\n\r\n    if (!user && !inAuthGroup) {\r\n      // Not authenticated, redirect to login\r\n      router.replace('/(auth)/login');\r\n    } else if (user && inAuthGroup) {\r\n      // Authenticated, redirect to main app\r\n      router.replace('/(tabs)/today');\r\n    }\r\n  }, [user, segments, isLoading]);\r\n\r\n  const checkAuthState = async () => {\r\n    try {\r\n      const authenticated = await SecureStore.isAuthenticated();\r\n\r\n      if (authenticated) {\r\n        // Try to get user from local session first\r\n        const sessions = await userSessionCollection.query().fetch();\r\n        if (sessions.length > 0) {\r\n          const session = sessions[0] as any;\r\n          setUser({\r\n            id: session.userId,\r\n            name: session.name,\r\n            phone: session.phone,\r\n            role: session.role,\r\n            organizationId: session.organizationId,\r\n          });\r\n          setModeState(session.mode || 'simple');\r\n        } else {\r\n          // Fetch from server\r\n          const response = await api.auth.me();\r\n          if (response.success && response.data) {\r\n            setUser(response.data);\r\n            // Save to local session\r\n            await saveUserSession(response.data);\r\n          } else {\r\n            await SecureStore.clearAuth();\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Auth check failed:', error);\r\n      await SecureStore.clearAuth();\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (phone: string, code: string): Promise<{ success: boolean; error?: string }> => {\r\n    try {\r\n      const response = await api.auth.verifyOtp(phone, code);\r\n\r\n      if (!response.success || !response.data) {\r\n        return { success: false, error: response.error?.message || 'Login failed' };\r\n      }\r\n\r\n      const { accessToken, refreshToken, user: userData } = response.data;\r\n\r\n      // Save tokens\r\n      await SecureStore.setTokens(accessToken, refreshToken);\r\n      await SecureStore.setUserId(userData.id);\r\n      await SecureStore.setOrgId(userData.organizationId);\r\n\r\n      // Save to local session\r\n      await saveUserSession(userData);\r\n\r\n      setUser(userData);\r\n\r\n      // Trigger initial sync after login to populate local database\r\n      performSync().catch((error) => {\r\n        console.warn('Initial sync after login failed:', error);\r\n      });\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      return {\r\n        success: false,\r\n        error: error instanceof Error ? error.message : 'Login failed',\r\n      };\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await api.auth.logout();\r\n    } catch {\r\n      // Ignore server errors on logout\r\n    }\r\n\r\n    await SecureStore.clearAuth();\r\n\r\n    // Clear local session\r\n    await database.write(async () => {\r\n      const sessions = await userSessionCollection.query().fetch();\r\n      for (const session of sessions) {\r\n        await session.destroyPermanently();\r\n      }\r\n    });\r\n\r\n    setUser(null);\r\n    router.replace('/(auth)/login');\r\n  };\r\n\r\n  const setMode = async (newMode: 'simple' | 'advanced') => {\r\n    setModeState(newMode);\r\n\r\n    // Update local session\r\n    await database.write(async () => {\r\n      const sessions = await userSessionCollection.query().fetch();\r\n      if (sessions.length > 0) {\r\n        await sessions[0].update((s: any) => {\r\n          s.mode = newMode;\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  const saveUserSession = async (userData: User) => {\r\n    await database.write(async () => {\r\n      // Clear existing sessions\r\n      const existing = await userSessionCollection.query().fetch();\r\n      for (const session of existing) {\r\n        await session.destroyPermanently();\r\n      }\r\n\r\n      // Create new session\r\n      await userSessionCollection.create((session: any) => {\r\n        session.userId = userData.id;\r\n        session.organizationId = userData.organizationId;\r\n        session.name = userData.name;\r\n        session.phone = userData.phone;\r\n        session.role = userData.role;\r\n        session.mode = 'simple';\r\n      });\r\n    });\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        isLoading,\r\n        isAuthenticated: !!user,\r\n        mode,\r\n        login,\r\n        logout,\r\n        setMode,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\consumer\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\consumer\\hooks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\consumer\\hooks\\use-consumer-auth.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":9,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":61,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'segments' is assigned a value but never used.","line":62,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Consumer Auth Hook\r\n * ==================\r\n *\r\n * Phase 15: Consumer Marketplace\r\n * Authentication hook for consumer users.\r\n */\r\n\r\nimport { useState, useEffect, useCallback, createContext, useContext } from 'react';\r\nimport { useRouter, useSegments } from 'expo-router';\r\nimport * as SecureStore from '../../storage/secure-store';\r\nimport { apiRequest } from '../../api/client';\r\n\r\ninterface ConsumerProfile {\r\n  id: string;\r\n  phone: string;\r\n  firstName: string;\r\n  lastName?: string;\r\n  profilePhotoUrl?: string;\r\n  neighborhood?: string;\r\n  city?: string;\r\n  totalRequests?: number;\r\n  totalJobsCompleted?: number;\r\n  totalReviewsGiven?: number;\r\n  referralCode?: string;\r\n}\r\n\r\ninterface ConsumerAuthContextType {\r\n  consumer: ConsumerProfile | null;\r\n  isLoading: boolean;\r\n  isAuthenticated: boolean;\r\n  login: (phone: string, code: string) => Promise<{ success: boolean; error?: string }>;\r\n  logout: () => Promise<void>;\r\n  requestOtp: (phone: string) => Promise<{ success: boolean; error?: string }>;\r\n  updateProfile: (data: Partial<ConsumerProfile>) => Promise<{ success: boolean; error?: string }>;\r\n}\r\n\r\nconst ConsumerAuthContext = createContext<ConsumerAuthContextType | null>(null);\r\n\r\nexport function useConsumerAuth() {\r\n  const context = useContext(ConsumerAuthContext);\r\n  if (!context) {\r\n    // Return a default context for development\r\n    return {\r\n      consumer: null,\r\n      isLoading: false,\r\n      isAuthenticated: false,\r\n      login: async () => ({ success: false, error: 'Not implemented' }),\r\n      logout: async () => {},\r\n      requestOtp: async () => ({ success: false, error: 'Not implemented' }),\r\n      updateProfile: async () => ({ success: false, error: 'Not implemented' }),\r\n    };\r\n  }\r\n  return context;\r\n}\r\n\r\nexport function ConsumerAuthProvider({ children }: { children: React.ReactNode }) {\r\n  const [consumer, setConsumer] = useState<ConsumerProfile | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  const router = useRouter();\r\n  const segments = useSegments();\r\n\r\n  useEffect(() => {\r\n    checkAuthState();\r\n  }, []);\r\n\r\n  const checkAuthState = async () => {\r\n    try {\r\n      const authenticated = await SecureStore.isAuthenticated();\r\n\r\n      if (authenticated) {\r\n        const response = await apiRequest<ConsumerProfile>('/consumer/profiles/me');\r\n        if (response.success && response.data) {\r\n          setConsumer(response.data);\r\n        } else {\r\n          await SecureStore.clearAuth();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Consumer auth check failed:', error);\r\n      await SecureStore.clearAuth();\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const requestOtp = async (phone: string): Promise<{ success: boolean; error?: string }> => {\r\n    try {\r\n      const response = await apiRequest<{ sent: boolean }>('/consumer/auth/login', {\r\n        method: 'POST',\r\n        body: { phone },\r\n        auth: false,\r\n      });\r\n\r\n      if (response.success && response.data?.sent) {\r\n        return { success: true };\r\n      }\r\n\r\n      return {\r\n        success: false,\r\n        error: response.error?.message || 'No se pudo enviar el codigo',\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        success: false,\r\n        error: error instanceof Error ? error.message : 'Error al enviar codigo',\r\n      };\r\n    }\r\n  };\r\n\r\n  const login = async (phone: string, code: string): Promise<{ success: boolean; error?: string }> => {\r\n    try {\r\n      const response = await apiRequest<{\r\n        accessToken: string;\r\n        refreshToken: string;\r\n        consumer: ConsumerProfile;\r\n      }>('/consumer/auth/verify', {\r\n        method: 'POST',\r\n        body: { phone, code },\r\n        auth: false,\r\n      });\r\n\r\n      if (!response.success || !response.data) {\r\n        return {\r\n          success: false,\r\n          error: response.error?.message || 'Codigo incorrecto',\r\n        };\r\n      }\r\n\r\n      const { accessToken, refreshToken, consumer: consumerData } = response.data;\r\n\r\n      await SecureStore.setTokens(accessToken, refreshToken);\r\n      setConsumer(consumerData);\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      return {\r\n        success: false,\r\n        error: error instanceof Error ? error.message : 'Error al iniciar sesion',\r\n      };\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await apiRequest('/consumer/auth/logout', { method: 'POST' });\r\n    } catch {\r\n      // Ignore server errors on logout\r\n    }\r\n\r\n    await SecureStore.clearAuth();\r\n    setConsumer(null);\r\n  };\r\n\r\n  const updateProfile = async (\r\n    data: Partial<ConsumerProfile>\r\n  ): Promise<{ success: boolean; error?: string }> => {\r\n    try {\r\n      const response = await apiRequest<ConsumerProfile>('/consumer/profiles/me', {\r\n        method: 'PUT',\r\n        body: data,\r\n      });\r\n\r\n      if (response.success && response.data) {\r\n        setConsumer(response.data);\r\n        return { success: true };\r\n      }\r\n\r\n      return {\r\n        success: false,\r\n        error: response.error?.message || 'No se pudo actualizar el perfil',\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        success: false,\r\n        error: error instanceof Error ? error.message : 'Error al actualizar perfil',\r\n      };\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ConsumerAuthContext.Provider\r\n      value={{\r\n        consumer,\r\n        isLoading,\r\n        isAuthenticated: !!consumer,\r\n        login,\r\n        logout,\r\n        requestOtp,\r\n        updateProfile,\r\n      }}\r\n    >\r\n      {children}\r\n    </ConsumerAuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport default useConsumerAuth;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\consumer\\hooks\\use-discovery.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\consumer\\hooks\\use-jobs.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\consumer\\hooks\\use-location.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\consumer\\hooks\\use-quotes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\consumer\\hooks\\use-requests.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\consumer\\hooks\\use-reviews.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used.","line":80,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":80,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Reviews Hooks\r\n * =============\r\n *\r\n * Phase 15: Consumer Marketplace\r\n * Hooks for managing reviews.\r\n */\r\n\r\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { apiRequest } from '../../api/client';\r\n\r\ninterface SubmitReviewInput {\r\n  businessProfileId: string;\r\n  jobId?: string;\r\n  overallRating: number;\r\n  punctualityRating?: number;\r\n  qualityRating?: number;\r\n  priceRating?: number;\r\n  communicationRating?: number;\r\n  comment?: string;\r\n  wouldRecommend: boolean;\r\n  photos?: string[];\r\n}\r\n\r\ninterface Review {\r\n  id: string;\r\n  consumerId: string;\r\n  businessProfileId: string;\r\n  jobId?: string;\r\n  overallRating: number;\r\n  comment?: string;\r\n  status: string;\r\n  createdAt: string;\r\n}\r\n\r\n// Submit a review\r\nexport function useSubmitReview() {\r\n  const queryClient = useQueryClient();\r\n\r\n  const mutation = useMutation({\r\n    mutationFn: async (data: SubmitReviewInput) => {\r\n      const response = await apiRequest<Review>('/consumer/reviews', {\r\n        method: 'POST',\r\n        body: data,\r\n      });\r\n\r\n      if (!response.success || !response.data) {\r\n        throw new Error(response.error?.message || 'Failed to submit review');\r\n      }\r\n\r\n      return response.data;\r\n    },\r\n    onSuccess: (data) => {\r\n      // Invalidate business reviews\r\n      queryClient.invalidateQueries({\r\n        queryKey: ['businessReviews', data.businessProfileId],\r\n      });\r\n      // Invalidate business profile (rating will change)\r\n      queryClient.invalidateQueries({\r\n        queryKey: ['business', data.businessProfileId],\r\n      });\r\n      // Invalidate job if linked\r\n      if (data.jobId) {\r\n        queryClient.invalidateQueries({\r\n          queryKey: ['job', data.jobId],\r\n        });\r\n      }\r\n    },\r\n  });\r\n\r\n  return {\r\n    submitReview: mutation.mutateAsync,\r\n    isLoading: mutation.isPending,\r\n    error: mutation.error,\r\n  };\r\n}\r\n\r\n// Mark review as helpful\r\nexport function useMarkHelpful() {\r\n  const queryClient = useQueryClient();\r\n\r\n  const mutation = useMutation({\r\n    mutationFn: async (reviewId: string) => {\r\n      const response = await apiRequest(`/consumer/reviews/${reviewId}/helpful`, {\r\n        method: 'POST',\r\n      });\r\n\r\n      if (!response.success) {\r\n        throw new Error(response.error?.message || 'Failed to mark as helpful');\r\n      }\r\n\r\n      return response.data;\r\n    },\r\n    onSuccess: () => {\r\n      // Could invalidate specific queries if needed\r\n    },\r\n  });\r\n\r\n  return {\r\n    markHelpful: mutation.mutateAsync,\r\n    isLoading: mutation.isPending,\r\n  };\r\n}\r\n\r\n// Report a review\r\nexport function useReportReview() {\r\n  const mutation = useMutation({\r\n    mutationFn: async ({\r\n      reviewId,\r\n      reason,\r\n      details,\r\n    }: {\r\n      reviewId: string;\r\n      reason: string;\r\n      details?: string;\r\n    }) => {\r\n      const response = await apiRequest(`/consumer/reviews/${reviewId}/report`, {\r\n        method: 'POST',\r\n        body: { reason, details },\r\n      });\r\n\r\n      if (!response.success) {\r\n        throw new Error(response.error?.message || 'Failed to report review');\r\n      }\r\n\r\n      return response.data;\r\n    },\r\n  });\r\n\r\n  return {\r\n    reportReview: mutation.mutateAsync,\r\n    isLoading: mutation.isPending,\r\n  };\r\n}\r\n\r\nexport default {\r\n  useSubmitReview,\r\n  useMarkHelpful,\r\n  useReportReview,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\consumer\\mode-switch.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkProfiles'. Either include it or remove the dependency array.","line":49,"column":6,"nodeType":"ArrayExpression","endLine":49,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [checkProfiles]","fix":{"range":[1256,1258],"text":"[checkProfiles]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Mode Switch\r\n * ===========\r\n *\r\n * Phase 15: Consumer Marketplace\r\n * Handle switching between consumer and business modes.\r\n */\r\n\r\nimport { useState, useCallback, useEffect } from 'react';\r\nimport { useRouter } from 'expo-router';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport { apiRequest } from '../api/client';\r\n\r\ntype AppMode = 'consumer' | 'business';\r\n\r\nconst MODE_STORAGE_KEY = 'campotech_app_mode';\r\n\r\ninterface UserProfiles {\r\n  businessProfile?: {\r\n    id: string;\r\n    organizationId: string;\r\n    displayName: string;\r\n  };\r\n  consumerProfile?: {\r\n    id: string;\r\n    firstName: string;\r\n  };\r\n}\r\n\r\ninterface UseAppModeReturn {\r\n  mode: AppMode;\r\n  hasBusinessProfile: boolean;\r\n  hasConsumerProfile: boolean;\r\n  isLoading: boolean;\r\n  switchToBusinessMode: () => Promise<void>;\r\n  switchToConsumerMode: () => Promise<void>;\r\n  checkProfiles: () => Promise<UserProfiles>;\r\n}\r\n\r\nexport function useAppMode(): UseAppModeReturn {\r\n  const router = useRouter();\r\n  const [mode, setMode] = useState<AppMode>('consumer');\r\n  const [profiles, setProfiles] = useState<UserProfiles>({});\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadMode();\r\n    checkProfiles();\r\n  }, []);\r\n\r\n  const loadMode = async () => {\r\n    try {\r\n      const savedMode = await AsyncStorage.getItem(MODE_STORAGE_KEY);\r\n      if (savedMode === 'business' || savedMode === 'consumer') {\r\n        setMode(savedMode);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load mode:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const saveMode = async (newMode: AppMode) => {\r\n    try {\r\n      await AsyncStorage.setItem(MODE_STORAGE_KEY, newMode);\r\n      setMode(newMode);\r\n\r\n      // Record mode switch for analytics\r\n      await apiRequest('/consumer/mode-switch/log', {\r\n        method: 'POST',\r\n        body: { targetMode: newMode },\r\n      });\r\n    } catch (error) {\r\n      console.error('Failed to save mode:', error);\r\n    }\r\n  };\r\n\r\n  const checkProfiles = useCallback(async (): Promise<UserProfiles> => {\r\n    try {\r\n      const response = await apiRequest<UserProfiles>('/consumer/mode-switch/profiles');\r\n      if (response.success && response.data) {\r\n        setProfiles(response.data);\r\n        return response.data;\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to check profiles:', error);\r\n    }\r\n    return {};\r\n  }, []);\r\n\r\n  const switchToBusinessMode = useCallback(async () => {\r\n    if (!profiles.businessProfile) {\r\n      // User doesn't have a business profile\r\n      throw new Error('No business profile available');\r\n    }\r\n\r\n    await saveMode('business');\r\n\r\n    // Navigate to business tabs\r\n    router.replace('/(tabs)/today');\r\n  }, [profiles, router]);\r\n\r\n  const switchToConsumerMode = useCallback(async () => {\r\n    await saveMode('consumer');\r\n\r\n    // Navigate to consumer tabs\r\n    router.replace('/(consumer)/' as any);\r\n  }, [router]);\r\n\r\n  return {\r\n    mode,\r\n    hasBusinessProfile: !!profiles.businessProfile,\r\n    hasConsumerProfile: !!profiles.consumerProfile,\r\n    isLoading,\r\n    switchToBusinessMode,\r\n    switchToConsumerMode,\r\n    checkProfiles,\r\n  };\r\n}\r\n\r\nexport default useAppMode;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\hooks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\hooks\\use-background-tracking.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":109,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":109,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Background Tracking Hook\r\n * ========================\r\n *\r\n * Phase 9.9: Customer Live Tracking System\r\n * React hook for managing background location tracking.\r\n */\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { AppState, AppStateStatus } from 'react-native';\r\nimport { backgroundTracking, TrackingSession, LocationUpdate } from '../location/background-tracking.service';\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// TYPES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\ninterface UseBackgroundTrackingResult {\r\n  isTracking: boolean;\r\n  session: TrackingSession | null;\r\n  currentLocation: LocationUpdate | null;\r\n  permissions: { foreground: boolean; background: boolean };\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  startTracking: (jobId: string) => Promise<boolean>;\r\n  stopTracking: () => Promise<void>;\r\n  requestPermissions: () => Promise<boolean>;\r\n  refreshLocation: () => Promise<void>;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// HOOK\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport function useBackgroundTracking(): UseBackgroundTrackingResult {\r\n  const [isTracking, setIsTracking] = useState(false);\r\n  const [session, setSession] = useState<TrackingSession | null>(null);\r\n  const [currentLocation, setCurrentLocation] = useState<LocationUpdate | null>(null);\r\n  const [permissions, setPermissions] = useState({ foreground: false, background: false });\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Check permissions on mount\r\n  useEffect(() => {\r\n    const checkPermissions = async () => {\r\n      const perms = await backgroundTracking.hasPermissions();\r\n      setPermissions(perms);\r\n    };\r\n    checkPermissions();\r\n  }, []);\r\n\r\n  // Resume tracking on app start\r\n  useEffect(() => {\r\n    const initialize = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        const resumed = await backgroundTracking.resumeIfNeeded();\r\n        if (resumed) {\r\n          setIsTracking(true);\r\n          setSession(backgroundTracking.getCurrentSession());\r\n        }\r\n      } catch (err) {\r\n        console.error('Initialize tracking error:', err);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    initialize();\r\n  }, []);\r\n\r\n  // Handle app state changes\r\n  useEffect(() => {\r\n    const handleAppStateChange = async (nextAppState: AppStateStatus) => {\r\n      if (nextAppState === 'active' && isTracking) {\r\n        // Refresh location when app becomes active\r\n        const location = await backgroundTracking.getCurrentLocation();\r\n        if (location) {\r\n          setCurrentLocation(location);\r\n        }\r\n      }\r\n    };\r\n\r\n    const subscription = AppState.addEventListener('change', handleAppStateChange);\r\n    return () => subscription?.remove();\r\n  }, [isTracking]);\r\n\r\n  // Start tracking\r\n  const startTracking = useCallback(async (jobId: string): Promise<boolean> => {\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const result = await backgroundTracking.startTracking(jobId);\r\n\r\n      if (result.success) {\r\n        setIsTracking(true);\r\n        setSession(backgroundTracking.getCurrentSession());\r\n\r\n        // Get initial location\r\n        const location = await backgroundTracking.getCurrentLocation();\r\n        if (location) {\r\n          setCurrentLocation(location);\r\n        }\r\n\r\n        return true;\r\n      } else {\r\n        setError(result.error || 'Error iniciando rastreo');\r\n        return false;\r\n      }\r\n    } catch (err) {\r\n      setError('Error inesperado');\r\n      return false;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // Stop tracking\r\n  const stopTracking = useCallback(async (): Promise<void> => {\r\n    setIsLoading(true);\r\n    try {\r\n      await backgroundTracking.stopTracking();\r\n      setIsTracking(false);\r\n      setSession(null);\r\n      setCurrentLocation(null);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // Request permissions\r\n  const requestPermissions = useCallback(async (): Promise<boolean> => {\r\n    const granted = await backgroundTracking.requestPermissions();\r\n    const perms = await backgroundTracking.hasPermissions();\r\n    setPermissions(perms);\r\n    return granted;\r\n  }, []);\r\n\r\n  // Refresh current location\r\n  const refreshLocation = useCallback(async (): Promise<void> => {\r\n    const location = await backgroundTracking.getCurrentLocation();\r\n    if (location) {\r\n      setCurrentLocation(location);\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    isTracking,\r\n    session,\r\n    currentLocation,\r\n    permissions,\r\n    isLoading,\r\n    error,\r\n    startTracking,\r\n    stopTracking,\r\n    requestPermissions,\r\n    refreshLocation,\r\n  };\r\n}\r\n\r\nexport default useBackgroundTracking;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\hooks\\use-offline-data.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'database'. Either include it or remove the dependency array.","line":120,"column":6,"nodeType":"ArrayExpression","endLine":120,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData, collectionName, database]","fix":{"range":[3507,3534],"text":"[fetchData, collectionName, database]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Offline Data Hook\r\n * =================\r\n *\r\n * Phase 9.10: Mobile-First Architecture\r\n * Unified hook for offline-first data access with optimistic updates.\r\n */\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { Q } from '@nozbe/watermelondb';\r\nimport { useDatabase } from '@nozbe/watermelondb/hooks';\r\n\r\nimport { enqueueOperation } from '../sync/sync-engine';\r\nimport { useSyncStatus } from './use-sync-status';\r\n\r\n// Types for supported entities\r\nexport type EntityType = 'job' | 'customer' | 'invoice' | 'team_member';\r\n\r\ninterface UseOfflineDataOptions<T> {\r\n  entityType: EntityType;\r\n  collection: string;\r\n  where?: Record<string, unknown>;\r\n  orderBy?: { column: string; direction: 'asc' | 'desc' };\r\n  limit?: number;\r\n  transform?: (record: any) => T;\r\n}\r\n\r\ninterface OfflineDataResult<T> {\r\n  data: T[];\r\n  loading: boolean;\r\n  error: string | null;\r\n  refetch: () => Promise<void>;\r\n  create: (data: Partial<T>) => Promise<T | null>;\r\n  update: (id: string, data: Partial<T>) => Promise<T | null>;\r\n  remove: (id: string) => Promise<boolean>;\r\n  isOnline: boolean;\r\n  pendingChanges: number;\r\n}\r\n\r\n/**\r\n * Hook for offline-first data access with optimistic updates\r\n */\r\nexport function useOfflineData<T extends { id: string }>(\r\n  options: UseOfflineDataOptions<T>\r\n): OfflineDataResult<T> {\r\n  const database = useDatabase();\r\n  const { isOnline, pendingOperations } = useSyncStatus();\r\n  const [data, setData] = useState<T[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const {\r\n    entityType,\r\n    collection: collectionName,\r\n    where,\r\n    orderBy,\r\n    limit,\r\n    transform = (r) => r as T,\r\n  } = options;\r\n\r\n  // Fetch data from local database\r\n  const fetchData = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      const collection = database.get(collectionName);\r\n      let query = collection.query();\r\n\r\n      // Apply where conditions\r\n      if (where) {\r\n        const conditions = Object.entries(where).map(([key, value]) =>\r\n          Q.where(key, value as any)\r\n        );\r\n        query = collection.query(...conditions);\r\n      }\r\n\r\n      // Observe the collection for real-time updates\r\n      const records = await query.fetch();\r\n\r\n      // Apply sorting client-side if specified\r\n      let sortedRecords = records;\r\n      if (orderBy) {\r\n        sortedRecords = [...records].sort((a: any, b: any) => {\r\n          const aVal = a[orderBy.column];\r\n          const bVal = b[orderBy.column];\r\n          if (orderBy.direction === 'asc') {\r\n            return aVal > bVal ? 1 : -1;\r\n          }\r\n          return aVal < bVal ? 1 : -1;\r\n        });\r\n      }\r\n\r\n      // Apply limit\r\n      if (limit) {\r\n        sortedRecords = sortedRecords.slice(0, limit);\r\n      }\r\n\r\n      // Transform records\r\n      const transformed = sortedRecords.map(transform);\r\n      setData(transformed);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Error loading data');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [database, collectionName, where, orderBy, limit, transform]);\r\n\r\n  // Initial fetch and subscription\r\n  useEffect(() => {\r\n    fetchData();\r\n\r\n    // Subscribe to collection changes\r\n    const collection = database.get(collectionName);\r\n    const subscription = collection.query().observe().subscribe(() => {\r\n      fetchData();\r\n    });\r\n\r\n    return () => subscription.unsubscribe();\r\n  }, [fetchData, collectionName]);\r\n\r\n  // Create with optimistic update\r\n  const create = useCallback(\r\n    async (createData: Partial<T>): Promise<T | null> => {\r\n      try {\r\n        const collection = database.get(collectionName);\r\n\r\n        // Generate temporary ID for optimistic update\r\n        const tempId = `temp_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n\r\n        // Create locally\r\n        const created = await database.write(async () => {\r\n          return collection.create((record: any) => {\r\n            record._raw.id = tempId;\r\n            Object.assign(record, createData);\r\n            record.isDirty = true;\r\n            record.createdAt = new Date();\r\n          });\r\n        });\r\n\r\n        // Queue for sync\r\n        await enqueueOperation(\r\n          entityType,\r\n          tempId,\r\n          'create',\r\n          { ...createData, tempId },\r\n          8 // High priority for creates\r\n        );\r\n\r\n        return transform(created);\r\n      } catch (err) {\r\n        setError(err instanceof Error ? err.message : 'Error creating record');\r\n        return null;\r\n      }\r\n    },\r\n    [database, collectionName, entityType, transform]\r\n  );\r\n\r\n  // Update with optimistic update\r\n  const update = useCallback(\r\n    async (id: string, updateData: Partial<T>): Promise<T | null> => {\r\n      try {\r\n        const collection = database.get(collectionName);\r\n        const record = await collection.find(id);\r\n\r\n        // Update locally\r\n        await database.write(async () => {\r\n          await record.update((r: any) => {\r\n            Object.assign(r, updateData);\r\n            r.isDirty = true;\r\n            r.updatedAt = new Date();\r\n          });\r\n        });\r\n\r\n        // Queue for sync\r\n        await enqueueOperation(\r\n          entityType,\r\n          id,\r\n          'update',\r\n          updateData as Record<string, unknown>,\r\n          5 // Medium priority for updates\r\n        );\r\n\r\n        // Refetch to get updated record\r\n        const updated = await collection.find(id);\r\n        return transform(updated);\r\n      } catch (err) {\r\n        setError(err instanceof Error ? err.message : 'Error updating record');\r\n        return null;\r\n      }\r\n    },\r\n    [database, collectionName, entityType, transform]\r\n  );\r\n\r\n  // Delete with optimistic update\r\n  const remove = useCallback(\r\n    async (id: string): Promise<boolean> => {\r\n      try {\r\n        const collection = database.get(collectionName);\r\n        const record = await collection.find(id);\r\n\r\n        // Mark as deleted locally (soft delete for sync)\r\n        await database.write(async () => {\r\n          await record.markAsDeleted();\r\n        });\r\n\r\n        // Queue for sync\r\n        await enqueueOperation(entityType, id, 'delete', {}, 3);\r\n\r\n        return true;\r\n      } catch (err) {\r\n        setError(err instanceof Error ? err.message : 'Error deleting record');\r\n        return false;\r\n      }\r\n    },\r\n    [database, collectionName, entityType]\r\n  );\r\n\r\n  return {\r\n    data,\r\n    loading,\r\n    error,\r\n    refetch: fetchData,\r\n    create,\r\n    update,\r\n    remove,\r\n    isOnline,\r\n    pendingChanges: pendingOperations,\r\n  };\r\n}\r\n\r\n/**\r\n * Convenience hook for jobs\r\n */\r\nexport function useOfflineJobs(filters?: {\r\n  status?: string;\r\n  assignedTo?: string;\r\n  customerId?: string;\r\n}) {\r\n  return useOfflineData({\r\n    entityType: 'job',\r\n    collection: 'jobs',\r\n    where: filters,\r\n    orderBy: { column: 'scheduledStart', direction: 'asc' },\r\n    transform: (record: any) => ({\r\n      id: record.id,\r\n      serverId: record.serverId,\r\n      customerId: record.customerId,\r\n      status: record.status,\r\n      serviceType: record.serviceType,\r\n      priority: record.priority,\r\n      scheduledStart: record.scheduledStart ? new Date(record.scheduledStart) : null,\r\n      scheduledEnd: record.scheduledEnd ? new Date(record.scheduledEnd) : null,\r\n      address: record.address,\r\n      notes: record.notes,\r\n      assignedToId: record.assignedToId,\r\n      isDirty: record.isDirty,\r\n    }),\r\n  });\r\n}\r\n\r\n/**\r\n * Convenience hook for customers\r\n */\r\nexport function useOfflineCustomers(filters?: {\r\n  search?: string;\r\n}) {\r\n  return useOfflineData({\r\n    entityType: 'customer',\r\n    collection: 'customers',\r\n    orderBy: { column: 'name', direction: 'asc' },\r\n    transform: (record: any) => ({\r\n      id: record.id,\r\n      serverId: record.serverId,\r\n      name: record.name,\r\n      phone: record.phone,\r\n      email: record.email,\r\n      address: record.address,\r\n      city: record.city,\r\n      province: record.province,\r\n      cuit: record.cuit,\r\n      isDirty: record.isDirty,\r\n    }),\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for single entity by ID\r\n */\r\nexport function useOfflineEntity<T>(\r\n  entityType: EntityType,\r\n  collectionName: string,\r\n  id: string | null\r\n) {\r\n  const database = useDatabase();\r\n  const [entity, setEntity] = useState<T | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!id) {\r\n      setEntity(null);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    const fetchEntity = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const collection = database.get(collectionName);\r\n        const record = await collection.find(id);\r\n        setEntity(record as unknown as T);\r\n      } catch (err) {\r\n        setError(err instanceof Error ? err.message : 'Entity not found');\r\n        setEntity(null);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchEntity();\r\n\r\n    // Subscribe to changes\r\n    const collection = database.get(collectionName);\r\n    const subscription = collection\r\n      .findAndObserve(id)\r\n      .subscribe(\r\n        (record) => setEntity(record as unknown as T),\r\n        () => setEntity(null)\r\n      );\r\n\r\n    return () => subscription.unsubscribe();\r\n  }, [database, collectionName, id]);\r\n\r\n  return { entity, loading, error };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\hooks\\use-offline.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Platform' is defined but never used.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":18},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleAppStateChange'. Either include it or remove the dependency array.","line":154,"column":6,"nodeType":"ArrayExpression","endLine":154,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [handleAppStateChange]","fix":{"range":[4560,4562],"text":"[handleAppStateChange]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Offline Support Hook\r\n * ====================\r\n *\r\n * Phase 2.3.5: Offline Support\r\n * Provides unified offline state management with:\r\n * - Connection status monitoring\r\n * - Pending operations tracking\r\n * - Sync conflict detection\r\n * - Retry utilities\r\n */\r\n\r\nimport { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { Platform, AppState, AppStateStatus } from 'react-native';\r\nimport { Q } from '@nozbe/watermelondb';\r\nimport {\r\n  syncQueueCollection,\r\n  syncConflictsCollection,\r\n  database,\r\n} from '../../watermelon/database';\r\nimport { SyncQueue, SyncConflict } from '../../watermelon/models';\r\nimport {\r\n  performSync,\r\n  enqueueOperation,\r\n  resolveConflict as resolveConflictSync,\r\n  addSyncListener,\r\n  getSyncStatus,\r\n  SyncStatus,\r\n} from '../sync/sync-engine';\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// TYPES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport interface OfflineState {\r\n  isOnline: boolean;\r\n  isSyncing: boolean;\r\n  pendingCount: number;\r\n  conflictCount: number;\r\n  lastSync: Date | null;\r\n  pendingOperations: SyncQueue[];\r\n  conflicts: SyncConflict[];\r\n  error: string | null;\r\n}\r\n\r\nexport interface OfflineActions {\r\n  sync: () => Promise<{ success: boolean; error?: string }>;\r\n  retryOperation: (operationId: string) => Promise<void>;\r\n  deleteOperation: (operationId: string) => Promise<void>;\r\n  clearQueue: () => Promise<void>;\r\n  resolveConflict: (\r\n    conflictId: string,\r\n    resolution: 'local' | 'server' | 'merged',\r\n    mergedData?: Record<string, unknown>\r\n  ) => Promise<void>;\r\n  queueOperation: (\r\n    entityType: string,\r\n    entityId: string,\r\n    operation: 'create' | 'update' | 'delete',\r\n    payload: Record<string, unknown>\r\n  ) => Promise<void>;\r\n}\r\n\r\nexport interface UseOfflineResult {\r\n  state: OfflineState;\r\n  actions: OfflineActions;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// HOOK\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport function useOffline(): UseOfflineResult {\r\n  const [state, setState] = useState<OfflineState>({\r\n    isOnline: true,\r\n    isSyncing: false,\r\n    pendingCount: 0,\r\n    conflictCount: 0,\r\n    lastSync: null,\r\n    pendingOperations: [],\r\n    conflicts: [],\r\n    error: null,\r\n  });\r\n\r\n  const syncInProgressRef = useRef(false);\r\n  const appStateRef = useRef<AppStateStatus>(AppState.currentState);\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // SUBSCRIPTIONS\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  useEffect(() => {\r\n    // Subscribe to sync status changes\r\n    const unsubscribeSyncStatus = addSyncListener((status: SyncStatus) => {\r\n      setState((prev) => ({\r\n        ...prev,\r\n        isOnline: status.isOnline,\r\n        isSyncing: status.isSyncing,\r\n        pendingCount: status.pendingOperations,\r\n        conflictCount: status.conflicts,\r\n        lastSync: status.lastSync,\r\n        error: status.error || null,\r\n      }));\r\n    });\r\n\r\n    // Get initial status\r\n    getSyncStatus().then((status) => {\r\n      setState((prev) => ({\r\n        ...prev,\r\n        isOnline: status.isOnline,\r\n        isSyncing: status.isSyncing,\r\n        pendingCount: status.pendingOperations,\r\n        conflictCount: status.conflicts,\r\n        lastSync: status.lastSync,\r\n      }));\r\n    });\r\n\r\n    // Subscribe to pending operations\r\n    const operationsSubscription = syncQueueCollection\r\n      .query(Q.sortBy('created_at', Q.desc))\r\n      .observe()\r\n      .subscribe((operations) => {\r\n        setState((prev) => ({\r\n          ...prev,\r\n          pendingOperations: operations as SyncQueue[],\r\n          pendingCount: operations.length,\r\n        }));\r\n      });\r\n\r\n    // Subscribe to conflicts\r\n    const conflictsSubscription = syncConflictsCollection\r\n      .query(Q.where('resolved', false))\r\n      .observe()\r\n      .subscribe((conflicts) => {\r\n        setState((prev) => ({\r\n          ...prev,\r\n          conflicts: conflicts as SyncConflict[],\r\n          conflictCount: conflicts.length,\r\n        }));\r\n      });\r\n\r\n    // Subscribe to app state changes\r\n    const appStateSubscription = AppState.addEventListener(\r\n      'change',\r\n      handleAppStateChange\r\n    );\r\n\r\n    return () => {\r\n      unsubscribeSyncStatus();\r\n      operationsSubscription.unsubscribe();\r\n      conflictsSubscription.unsubscribe();\r\n      appStateSubscription.remove();\r\n    };\r\n  }, []);\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // APP STATE HANDLER\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  const handleAppStateChange = useCallback(\r\n    async (nextAppState: AppStateStatus) => {\r\n      // Sync when app comes to foreground\r\n      if (\r\n        appStateRef.current.match(/inactive|background/) &&\r\n        nextAppState === 'active'\r\n      ) {\r\n        // Small delay to let network reconnect\r\n        setTimeout(() => {\r\n          if (state.isOnline && !syncInProgressRef.current) {\r\n            performSync();\r\n          }\r\n        }, 1000);\r\n      }\r\n      appStateRef.current = nextAppState;\r\n    },\r\n    [state.isOnline]\r\n  );\r\n\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n  // ACTIONS\r\n  // ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n  const sync = useCallback(async (): Promise<{\r\n    success: boolean;\r\n    error?: string;\r\n  }> => {\r\n    if (syncInProgressRef.current) {\r\n      return { success: false, error: 'Sync already in progress' };\r\n    }\r\n\r\n    if (!state.isOnline) {\r\n      return { success: false, error: 'Sin conexi├│n a internet' };\r\n    }\r\n\r\n    syncInProgressRef.current = true;\r\n    try {\r\n      const result = await performSync();\r\n      return {\r\n        success: result.success,\r\n        error: result.error,\r\n      };\r\n    } finally {\r\n      syncInProgressRef.current = false;\r\n    }\r\n  }, [state.isOnline]);\r\n\r\n  const retryOperation = useCallback(async (operationId: string) => {\r\n    const operation = await syncQueueCollection.find(operationId);\r\n    if (operation) {\r\n      await database.write(async () => {\r\n        await operation.update((op: any) => {\r\n          op.retryCount = 0;\r\n        });\r\n      });\r\n      performSync();\r\n    }\r\n  }, []);\r\n\r\n  const deleteOperation = useCallback(async (operationId: string) => {\r\n    await database.write(async () => {\r\n      const operation = await syncQueueCollection.find(operationId);\r\n      await operation.destroyPermanently();\r\n    });\r\n  }, []);\r\n\r\n  const clearQueue = useCallback(async () => {\r\n    await database.write(async () => {\r\n      const operations = await syncQueueCollection.query().fetch();\r\n      for (const op of operations) {\r\n        await op.destroyPermanently();\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const resolveConflict = useCallback(\r\n    async (\r\n      conflictId: string,\r\n      resolution: 'local' | 'server' | 'merged',\r\n      mergedData?: Record<string, unknown>\r\n    ) => {\r\n      await resolveConflictSync(conflictId, resolution, mergedData);\r\n    },\r\n    []\r\n  );\r\n\r\n  const queueOperation = useCallback(\r\n    async (\r\n      entityType: string,\r\n      entityId: string,\r\n      operation: 'create' | 'update' | 'delete',\r\n      payload: Record<string, unknown>\r\n    ) => {\r\n      await enqueueOperation(entityType, entityId, operation, payload);\r\n    },\r\n    []\r\n  );\r\n\r\n  return {\r\n    state,\r\n    actions: {\r\n      sync,\r\n      retryOperation,\r\n      deleteOperation,\r\n      clearQueue,\r\n      resolveConflict,\r\n      queueOperation,\r\n    },\r\n  };\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// SIMPLE CONNECTION HOOK\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport function useIsOnline(): boolean {\r\n  const [isOnline, setIsOnline] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = addSyncListener((status) => {\r\n      setIsOnline(status.isOnline);\r\n    });\r\n\r\n    getSyncStatus().then((status) => {\r\n      setIsOnline(status.isOnline);\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, []);\r\n\r\n  return isOnline;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// PENDING SYNC HOOK\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport function usePendingSync(): {\r\n  count: number;\r\n  hasPending: boolean;\r\n  isSyncing: boolean;\r\n} {\r\n  const [state, setState] = useState({\r\n    count: 0,\r\n    hasPending: false,\r\n    isSyncing: false,\r\n  });\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = addSyncListener((status) => {\r\n      setState({\r\n        count: status.pendingOperations,\r\n        hasPending: status.pendingOperations > 0,\r\n        isSyncing: status.isSyncing,\r\n      });\r\n    });\r\n\r\n    getSyncStatus().then((status) => {\r\n      setState({\r\n        count: status.pendingOperations,\r\n        hasPending: status.pendingOperations > 0,\r\n        isSyncing: status.isSyncing,\r\n      });\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, []);\r\n\r\n  return state;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// CONFLICT DETECTION HOOK\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport function useConflicts(): {\r\n  conflicts: SyncConflict[];\r\n  hasConflicts: boolean;\r\n  count: number;\r\n} {\r\n  const [conflicts, setConflicts] = useState<SyncConflict[]>([]);\r\n\r\n  useEffect(() => {\r\n    const subscription = syncConflictsCollection\r\n      .query(Q.where('resolved', false))\r\n      .observe()\r\n      .subscribe((items) => {\r\n        setConflicts(items as SyncConflict[]);\r\n      });\r\n\r\n    return () => subscription.unsubscribe();\r\n  }, []);\r\n\r\n  return {\r\n    conflicts,\r\n    hasConflicts: conflicts.length > 0,\r\n    count: conflicts.length,\r\n  };\r\n}\r\n\r\nexport default useOffline;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\hooks\\use-sync-status.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\hooks\\use-tracking.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\location\\background-tracking.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\monitoring\\sentry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\notifications\\deep-linking.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\notifications\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\notifications\\push-notifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\notifications\\use-notifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\performance\\image-utils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'originalInfo' is assigned a value but never used.","line":52,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":21},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":111,"column":12,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":111,"endColumn":79,"fix":{"range":[2759,2826],"text":"{ uri: string; width: number; height: number; size: number }[]"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\r\n * Image Utilities\r\n * ===============\r\n *\r\n * Image compression, caching, and optimization utilities\r\n */\r\n\r\nimport * as ImageManipulator from 'expo-image-manipulator';\r\nimport * as FileSystem from 'expo-file-system';\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// CONFIGURATION\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n// Note: FileSystem.cacheDirectory may not be available at module load time on all platforms\r\nconst IMAGE_CACHE_DIR = ((FileSystem as any).cacheDirectory || '') + 'images/';\r\nconst MAX_IMAGE_SIZE = 1920; // Max dimension in pixels\r\nconst JPEG_QUALITY = 0.8;\r\nconst THUMBNAIL_SIZE = 200;\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// COMPRESSION\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\ninterface CompressOptions {\r\n  maxWidth?: number;\r\n  maxHeight?: number;\r\n  quality?: number;\r\n  format?: 'jpeg' | 'png' | 'webp';\r\n}\r\n\r\n/**\r\n * Compress an image for upload\r\n */\r\nexport async function compressImage(\r\n  uri: string,\r\n  options: CompressOptions = {}\r\n): Promise<{\r\n  uri: string;\r\n  width: number;\r\n  height: number;\r\n  size: number;\r\n}> {\r\n  const {\r\n    maxWidth = MAX_IMAGE_SIZE,\r\n    maxHeight = MAX_IMAGE_SIZE,\r\n    quality = JPEG_QUALITY,\r\n    format = 'jpeg',\r\n  } = options;\r\n\r\n  // Get original dimensions\r\n  const originalInfo = await FileSystem.getInfoAsync(uri);\r\n\r\n  // Calculate resize\r\n  const actions: ImageManipulator.Action[] = [\r\n    {\r\n      resize: {\r\n        width: maxWidth,\r\n        height: maxHeight,\r\n      },\r\n    },\r\n  ];\r\n\r\n  // Compress\r\n  const result = await ImageManipulator.manipulateAsync(uri, actions, {\r\n    compress: quality,\r\n    format:\r\n      format === 'jpeg'\r\n        ? ImageManipulator.SaveFormat.JPEG\r\n        : format === 'png'\r\n          ? ImageManipulator.SaveFormat.PNG\r\n          : ImageManipulator.SaveFormat.WEBP,\r\n  });\r\n\r\n  // Get final size\r\n  const finalInfo = await FileSystem.getInfoAsync(result.uri);\r\n\r\n  return {\r\n    uri: result.uri,\r\n    width: result.width,\r\n    height: result.height,\r\n    size: (finalInfo as any).size || 0,\r\n  };\r\n}\r\n\r\n/**\r\n * Create a thumbnail from an image\r\n */\r\nexport async function createThumbnail(\r\n  uri: string,\r\n  size: number = THUMBNAIL_SIZE\r\n): Promise<string> {\r\n  const result = await ImageManipulator.manipulateAsync(\r\n    uri,\r\n    [{ resize: { width: size, height: size } }],\r\n    {\r\n      compress: 0.7,\r\n      format: ImageManipulator.SaveFormat.JPEG,\r\n    }\r\n  );\r\n\r\n  return result.uri;\r\n}\r\n\r\n/**\r\n * Compress multiple images in parallel\r\n */\r\nexport async function compressImages(\r\n  uris: string[],\r\n  options: CompressOptions = {}\r\n): Promise<Array<{ uri: string; width: number; height: number; size: number }>> {\r\n  return Promise.all(uris.map((uri) => compressImage(uri, options)));\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// CACHING\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n/**\r\n * Initialize the image cache directory\r\n */\r\nexport async function initImageCache(): Promise<void> {\r\n  const dirInfo = await FileSystem.getInfoAsync(IMAGE_CACHE_DIR);\r\n  if (!dirInfo.exists) {\r\n    await FileSystem.makeDirectoryAsync(IMAGE_CACHE_DIR, { intermediates: true });\r\n  }\r\n}\r\n\r\n/**\r\n * Get cached image or download and cache it\r\n */\r\nexport async function getCachedImage(\r\n  remoteUri: string,\r\n  cacheKey?: string\r\n): Promise<string> {\r\n  // Generate cache key from URL if not provided\r\n  const key = cacheKey || remoteUri.split('/').pop() || `img_${Date.now()}`;\r\n  const localPath = `${IMAGE_CACHE_DIR}${key}`;\r\n\r\n  // Check if cached\r\n  const info = await FileSystem.getInfoAsync(localPath);\r\n  if (info.exists) {\r\n    return localPath;\r\n  }\r\n\r\n  // Download and cache\r\n  await FileSystem.downloadAsync(remoteUri, localPath);\r\n  return localPath;\r\n}\r\n\r\n/**\r\n * Clear the image cache\r\n */\r\nexport async function clearImageCache(): Promise<void> {\r\n  const dirInfo = await FileSystem.getInfoAsync(IMAGE_CACHE_DIR);\r\n  if (dirInfo.exists) {\r\n    await FileSystem.deleteAsync(IMAGE_CACHE_DIR, { idempotent: true });\r\n    await FileSystem.makeDirectoryAsync(IMAGE_CACHE_DIR, { intermediates: true });\r\n  }\r\n}\r\n\r\n/**\r\n * Get cache size in bytes\r\n */\r\nexport async function getImageCacheSize(): Promise<number> {\r\n  const dirInfo = await FileSystem.getInfoAsync(IMAGE_CACHE_DIR);\r\n  if (!dirInfo.exists) {\r\n    return 0;\r\n  }\r\n\r\n  const files = await FileSystem.readDirectoryAsync(IMAGE_CACHE_DIR);\r\n  let totalSize = 0;\r\n\r\n  for (const file of files) {\r\n    const fileInfo = await FileSystem.getInfoAsync(`${IMAGE_CACHE_DIR}${file}`);\r\n    totalSize += (fileInfo as any).size || 0;\r\n  }\r\n\r\n  return totalSize;\r\n}\r\n\r\n/**\r\n * Prune old cache files (older than maxAge in milliseconds)\r\n */\r\nexport async function pruneImageCache(maxAge: number = 7 * 24 * 60 * 60 * 1000): Promise<number> {\r\n  const dirInfo = await FileSystem.getInfoAsync(IMAGE_CACHE_DIR);\r\n  if (!dirInfo.exists) {\r\n    return 0;\r\n  }\r\n\r\n  const files = await FileSystem.readDirectoryAsync(IMAGE_CACHE_DIR);\r\n  const now = Date.now();\r\n  let deletedCount = 0;\r\n\r\n  for (const file of files) {\r\n    const filePath = `${IMAGE_CACHE_DIR}${file}`;\r\n    const fileInfo = await FileSystem.getInfoAsync(filePath);\r\n\r\n    if (fileInfo.exists && (fileInfo as any).modificationTime) {\r\n      const age = now - (fileInfo as any).modificationTime * 1000;\r\n      if (age > maxAge) {\r\n        await FileSystem.deleteAsync(filePath, { idempotent: true });\r\n        deletedCount++;\r\n      }\r\n    }\r\n  }\r\n\r\n  return deletedCount;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// UTILITIES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n/**\r\n * Get image file size\r\n */\r\nexport async function getImageSize(uri: string): Promise<number> {\r\n  const info = await FileSystem.getInfoAsync(uri);\r\n  return (info as any).size || 0;\r\n}\r\n\r\n/**\r\n * Format bytes to human readable string\r\n */\r\nexport function formatBytes(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n\r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n\r\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`;\r\n}\r\n\r\n/**\r\n * Check if file is an image based on extension\r\n */\r\nexport function isImageFile(filename: string): boolean {\r\n  const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.heic', '.heif'];\r\n  const ext = filename.toLowerCase().slice(filename.lastIndexOf('.'));\r\n  return imageExtensions.includes(ext);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\performance\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\performance\\list-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\performance\\monitoring.ts","messages":[{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":219,"column":15,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":219,"endColumn":29,"fix":{"range":[5119,5133],"text":"(() => T)[]"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\r\n * Performance Monitoring\r\n * ======================\r\n *\r\n * Tools for monitoring and debugging app performance\r\n */\r\n\r\nimport { InteractionManager } from 'react-native';\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// TIMING UTILITIES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\ninterface PerformanceMark {\r\n  name: string;\r\n  startTime: number;\r\n  endTime?: number;\r\n  duration?: number;\r\n}\r\n\r\nconst marks = new Map<string, PerformanceMark>();\r\nconst measures: PerformanceMark[] = [];\r\n\r\n/**\r\n * Start measuring a performance mark\r\n */\r\nexport function perfMark(name: string): void {\r\n  marks.set(name, {\r\n    name,\r\n    startTime: performance.now(),\r\n  });\r\n}\r\n\r\n/**\r\n * End a performance mark and record the measurement\r\n */\r\nexport function perfMeasure(name: string): number | null {\r\n  const mark = marks.get(name);\r\n  if (!mark) {\r\n    console.warn(`Performance mark \"${name}\" not found`);\r\n    return null;\r\n  }\r\n\r\n  const endTime = performance.now();\r\n  const duration = endTime - mark.startTime;\r\n\r\n  const measurement: PerformanceMark = {\r\n    ...mark,\r\n    endTime,\r\n    duration,\r\n  };\r\n\r\n  measures.push(measurement);\r\n  marks.delete(name);\r\n\r\n  if (__DEV__) {\r\n    console.log(`[PERF] ${name}: ${duration.toFixed(2)}ms`);\r\n  }\r\n\r\n  return duration;\r\n}\r\n\r\n/**\r\n * Measure a function execution time\r\n */\r\nexport async function perfAsync<T>(\r\n  name: string,\r\n  fn: () => Promise<T>\r\n): Promise<T> {\r\n  perfMark(name);\r\n  try {\r\n    const result = await fn();\r\n    perfMeasure(name);\r\n    return result;\r\n  } catch (error) {\r\n    perfMeasure(name);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Measure a synchronous function execution time\r\n */\r\nexport function perfSync<T>(name: string, fn: () => T): T {\r\n  perfMark(name);\r\n  try {\r\n    const result = fn();\r\n    perfMeasure(name);\r\n    return result;\r\n  } catch (error) {\r\n    perfMeasure(name);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all recorded measurements\r\n */\r\nexport function getPerformanceMeasures(): PerformanceMark[] {\r\n  return [...measures];\r\n}\r\n\r\n/**\r\n * Clear all measurements\r\n */\r\nexport function clearPerformanceMeasures(): void {\r\n  measures.length = 0;\r\n  marks.clear();\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// INTERACTION MANAGER UTILITIES\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n/**\r\n * Run a function after interactions complete (for smooth animations)\r\n */\r\nexport function runAfterInteractions<T>(fn: () => T | Promise<T>): Promise<T> {\r\n  return new Promise((resolve, reject) => {\r\n    InteractionManager.runAfterInteractions(async () => {\r\n      try {\r\n        const result = await fn();\r\n        resolve(result);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Defer heavy operations to prevent blocking the UI thread\r\n */\r\nexport function deferOperation<T>(\r\n  fn: () => T,\r\n  delay: number = 0\r\n): Promise<T> {\r\n  return new Promise((resolve) => {\r\n    setTimeout(() => {\r\n      requestAnimationFrame(() => {\r\n        const result = fn();\r\n        resolve(result);\r\n      });\r\n    }, delay);\r\n  });\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// MEMORY MONITORING\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\ninterface MemoryInfo {\r\n  used: number;\r\n  total: number;\r\n  percentage: number;\r\n}\r\n\r\n/**\r\n * Get memory usage info (if available)\r\n * Note: This is limited in React Native, but provides what's available\r\n */\r\nexport function getMemoryInfo(): MemoryInfo | null {\r\n  // @ts-ignore - performance.memory is non-standard\r\n  const memory = (performance as any).memory;\r\n\r\n  if (!memory) {\r\n    return null;\r\n  }\r\n\r\n  return {\r\n    used: memory.usedJSHeapSize,\r\n    total: memory.totalJSHeapSize,\r\n    percentage: (memory.usedJSHeapSize / memory.totalJSHeapSize) * 100,\r\n  };\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// RENDER TRACKING\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nconst renderCounts = new Map<string, number>();\r\n\r\n/**\r\n * Track component render count (for debugging)\r\n */\r\nexport function trackRender(componentName: string): number {\r\n  const count = (renderCounts.get(componentName) || 0) + 1;\r\n  renderCounts.set(componentName, count);\r\n\r\n  if (__DEV__ && count > 10) {\r\n    console.warn(`[PERF] ${componentName} has rendered ${count} times`);\r\n  }\r\n\r\n  return count;\r\n}\r\n\r\n/**\r\n * Reset render counts\r\n */\r\nexport function resetRenderCounts(): void {\r\n  renderCounts.clear();\r\n}\r\n\r\n/**\r\n * Get all render counts\r\n */\r\nexport function getRenderCounts(): Map<string, number> {\r\n  return new Map(renderCounts);\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// BATCHING\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n/**\r\n * Batch multiple operations together\r\n */\r\nexport function batchOperations<T>(\r\n  operations: Array<() => T>,\r\n  batchSize: number = 10\r\n): Promise<T[]> {\r\n  return new Promise((resolve) => {\r\n    const results: T[] = [];\r\n    let index = 0;\r\n\r\n    function processBatch() {\r\n      const batch = operations.slice(index, index + batchSize);\r\n      batch.forEach((op) => results.push(op()));\r\n      index += batchSize;\r\n\r\n      if (index < operations.length) {\r\n        requestAnimationFrame(processBatch);\r\n      } else {\r\n        resolve(results);\r\n      }\r\n    }\r\n\r\n    requestAnimationFrame(processBatch);\r\n  });\r\n}\r\n\r\n/**\r\n * Throttle function calls\r\n */\r\nexport function throttle<T extends (...args: unknown[]) => unknown>(\r\n  fn: T,\r\n  limit: number\r\n): T {\r\n  let lastCall = 0;\r\n  let lastResult: ReturnType<T>;\r\n\r\n  return ((...args: Parameters<T>) => {\r\n    const now = Date.now();\r\n    if (now - lastCall >= limit) {\r\n      lastCall = now;\r\n      lastResult = fn(...args) as ReturnType<T>;\r\n    }\r\n    return lastResult;\r\n  }) as T;\r\n}\r\n\r\n/**\r\n * Debounce function calls\r\n */\r\nexport function debounce<T extends (...args: unknown[]) => unknown>(\r\n  fn: T,\r\n  delay: number\r\n): T {\r\n  let timeoutId: ReturnType<typeof setTimeout>;\r\n\r\n  return ((...args: Parameters<T>) => {\r\n    clearTimeout(timeoutId);\r\n    timeoutId = setTimeout(() => fn(...args), delay);\r\n  }) as T;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// STARTUP TIMING\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nlet appStartTime: number | null = null;\r\nlet interactiveTime: number | null = null;\r\n\r\n/**\r\n * Mark app start time\r\n */\r\nexport function markAppStart(): void {\r\n  appStartTime = performance.now();\r\n}\r\n\r\n/**\r\n * Mark time to interactive\r\n */\r\nexport function markTimeToInteractive(): void {\r\n  if (appStartTime !== null) {\r\n    interactiveTime = performance.now() - appStartTime;\r\n    if (__DEV__) {\r\n      console.log(`[PERF] Time to Interactive: ${interactiveTime.toFixed(2)}ms`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Get startup metrics\r\n */\r\nexport function getStartupMetrics(): {\r\n  timeToInteractive: number | null;\r\n  appStartTime: number | null;\r\n} {\r\n  return {\r\n    timeToInteractive: interactiveTime,\r\n    appStartTime,\r\n  };\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// DEVELOPMENT HELPERS\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n/**\r\n * Log performance summary (development only)\r\n */\r\nexport function logPerformanceSummary(): void {\r\n  if (!__DEV__) return;\r\n\r\n  console.log('=== Performance Summary ===');\r\n\r\n  // Startup metrics\r\n  const startup = getStartupMetrics();\r\n  if (startup.timeToInteractive) {\r\n    console.log(`Time to Interactive: ${startup.timeToInteractive.toFixed(2)}ms`);\r\n  }\r\n\r\n  // Top measurements\r\n  const topMeasures = measures\r\n    .sort((a, b) => (b.duration || 0) - (a.duration || 0))\r\n    .slice(0, 10);\r\n\r\n  console.log('Top 10 Operations:');\r\n  topMeasures.forEach((m) => {\r\n    console.log(`  ${m.name}: ${m.duration?.toFixed(2)}ms`);\r\n  });\r\n\r\n  // Render counts\r\n  const topRenders = [...renderCounts.entries()]\r\n    .sort((a, b) => b[1] - a[1])\r\n    .slice(0, 10);\r\n\r\n  console.log('Top 10 Re-renders:');\r\n  topRenders.forEach(([name, count]) => {\r\n    console.log(`  ${name}: ${count} renders`);\r\n  });\r\n\r\n  console.log('===========================');\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\providers\\DatabaseProvider.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":1,"message":"A `require()` style import is forbidden.","line":25,"column":32,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":25,"endColumn":68},{"ruleId":"@typescript-eslint/no-require-imports","severity":1,"message":"A `require()` style import is forbidden.","line":26,"column":24,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":26,"endColumn":67}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Platform-Aware Database Provider\r\n * =================================\r\n *\r\n * Wraps WatermelonDB's DatabaseProvider for native platforms,\r\n * but skips it on web where WatermelonDB doesn't work.\r\n */\r\n\r\nimport React from 'react';\r\nimport { Platform } from 'react-native';\r\n\r\ninterface Props {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport function AppDatabaseProvider({ children }: Props) {\r\n  if (Platform.OS === 'web') {\r\n    // On web, just render children without WatermelonDB provider\r\n    // The web mock database doesn't require a provider context\r\n    return <>{children}</>;\r\n  }\r\n\r\n  // On native (iOS/Android), use real WatermelonDB provider\r\n  // Using require to avoid importing native modules on web\r\n  const { DatabaseProvider } = require('@nozbe/watermelondb/react');\r\n  const { database } = require('../../watermelon/database.native');\r\n\r\n  return <DatabaseProvider database={database}>{children}</DatabaseProvider>;\r\n}\r\n\r\nexport default AppDatabaseProvider;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\services\\location.ts","messages":[{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":30,"column":24,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":30,"endColumn":65,"fix":{"range":[895,936],"text":"((location: LocationUpdate) => void)[]"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\r\n * GPS Location Tracking Service\r\n * =============================\r\n *\r\n * Location tracking for technicians.\r\n * Sends location updates to server when technician is EN_ROUTE.\r\n *\r\n * Features:\r\n * - Foreground polling in Expo Go (development)\r\n * - Background tracking in production builds\r\n * - Automatic retry and offline queuing\r\n * - 30-second update interval\r\n */\r\n\r\nimport * as Location from 'expo-location';\r\nimport * as TaskManager from 'expo-task-manager';\r\nimport { api } from '../api/client';\r\n\r\n// Background task name\r\nconst BACKGROUND_LOCATION_TASK = 'CAMPOTECH_BACKGROUND_LOCATION';\r\n\r\n// Update interval in milliseconds (30 seconds)\r\nconst UPDATE_INTERVAL = 30000;\r\nconst DISTANCE_INTERVAL = 10; // 10 meters minimum movement\r\n\r\n// State\r\nlet isTracking = false;\r\nlet currentJobId: string | null = null;\r\nlet currentSessionId: string | null = null;\r\nlet trackingListeners: Array<(location: LocationUpdate) => void> = [];\r\nlet foregroundInterval: ReturnType<typeof setInterval> | null = null;\r\nlet foregroundSubscription: Location.LocationSubscription | null = null;\r\n\r\nexport interface LocationUpdate {\r\n  latitude: number;\r\n  longitude: number;\r\n  speed: number | null;\r\n  heading: number | null;\r\n  accuracy: number | null;\r\n  altitude: number | null;\r\n  timestamp: number;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// BACKGROUND TASK DEFINITION\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n// Define background location task (must be at module level for expo-task-manager)\r\nTaskManager.defineTask(BACKGROUND_LOCATION_TASK, async ({ data, error }) => {\r\n  if (error) {\r\n    console.error('[Location] Background task error:', error);\r\n    return;\r\n  }\r\n\r\n  if (data) {\r\n    const { locations } = data as { locations: Location.LocationObject[] };\r\n\r\n    for (const location of locations) {\r\n      try {\r\n        // Send location update to server\r\n        if (currentSessionId && currentJobId) {\r\n          await api.tracking.update({\r\n            lat: location.coords.latitude,\r\n            lng: location.coords.longitude,\r\n            jobId: currentJobId,\r\n            sessionId: currentSessionId,\r\n            speed: location.coords.speed,\r\n            heading: location.coords.heading,\r\n            accuracy: location.coords.accuracy,\r\n            altitude: location.coords.altitude,\r\n          });\r\n        }\r\n\r\n        // Notify listeners\r\n        notifyListeners({\r\n          latitude: location.coords.latitude,\r\n          longitude: location.coords.longitude,\r\n          speed: location.coords.speed,\r\n          heading: location.coords.heading,\r\n          accuracy: location.coords.accuracy,\r\n          altitude: location.coords.altitude,\r\n          timestamp: location.timestamp,\r\n        });\r\n      } catch (err) {\r\n        console.warn('[Location] Background update error:', err);\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// PERMISSIONS\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport async function requestLocationPermissions(): Promise<{\r\n  foreground: boolean;\r\n  background: boolean;\r\n}> {\r\n  // Request foreground permission first\r\n  const { status: foregroundStatus } =\r\n    await Location.requestForegroundPermissionsAsync();\r\n\r\n  if (foregroundStatus !== 'granted') {\r\n    return { foreground: false, background: false };\r\n  }\r\n\r\n  // Request background permission for production builds\r\n  let backgroundGranted = false;\r\n  try {\r\n    const { status: backgroundStatus } =\r\n      await Location.requestBackgroundPermissionsAsync();\r\n    backgroundGranted = backgroundStatus === 'granted';\r\n  } catch (error) {\r\n    // Background permissions may not be available in Expo Go\r\n    console.log('[Location] Background permissions not available:', error);\r\n  }\r\n\r\n  return { foreground: true, background: backgroundGranted };\r\n}\r\n\r\nexport async function checkLocationPermissions(): Promise<{\r\n  foreground: boolean;\r\n  background: boolean;\r\n}> {\r\n  const foreground = await Location.getForegroundPermissionsAsync();\r\n\r\n  let backgroundGranted = false;\r\n  try {\r\n    const background = await Location.getBackgroundPermissionsAsync();\r\n    backgroundGranted = background.status === 'granted';\r\n  } catch {\r\n    // Ignore - background permissions may not be available\r\n  }\r\n\r\n  return {\r\n    foreground: foreground.status === 'granted',\r\n    background: backgroundGranted,\r\n  };\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// TRACKING CONTROL\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n/**\r\n * Start location tracking for a job\r\n */\r\nexport async function startTracking(jobId: string): Promise<{\r\n  success: boolean;\r\n  sessionId?: string;\r\n  trackingUrl?: string;\r\n  error?: string;\r\n}> {\r\n  if (isTracking) {\r\n    return {\r\n      success: false,\r\n      error: 'Tracking is already active',\r\n    };\r\n  }\r\n\r\n  // Check and request permissions\r\n  let permissions = await checkLocationPermissions();\r\n  if (!permissions.foreground) {\r\n    permissions = await requestLocationPermissions();\r\n    if (!permissions.foreground) {\r\n      return {\r\n        success: false,\r\n        error: 'Location permission required',\r\n      };\r\n    }\r\n  }\r\n\r\n  try {\r\n    // Get current location\r\n    const currentLocation = await Location.getCurrentPositionAsync({\r\n      accuracy: Location.Accuracy.High,\r\n    });\r\n\r\n    // Start tracking session on server\r\n    const response = await api.tracking.start(\r\n      jobId,\r\n      currentLocation.coords.latitude,\r\n      currentLocation.coords.longitude\r\n    );\r\n\r\n    if (!response.success || !response.data) {\r\n      return {\r\n        success: false,\r\n        error: response.error?.message || 'Failed to start tracking session',\r\n      };\r\n    }\r\n\r\n    currentJobId = jobId;\r\n    currentSessionId = response.data.sessionId;\r\n    isTracking = true;\r\n\r\n    // Start location updates based on available permissions\r\n    if (permissions.background) {\r\n      await startBackgroundTracking();\r\n      console.log('[Location] Started background tracking');\r\n    } else {\r\n      startForegroundTracking();\r\n      console.log('[Location] Started foreground tracking (polling every 30s)');\r\n    }\r\n\r\n    // Also start watch for foreground updates (more frequent when app is open)\r\n    await startForegroundWatch();\r\n\r\n    // Notify listeners of initial location\r\n    notifyListeners({\r\n      latitude: currentLocation.coords.latitude,\r\n      longitude: currentLocation.coords.longitude,\r\n      speed: currentLocation.coords.speed,\r\n      heading: currentLocation.coords.heading,\r\n      accuracy: currentLocation.coords.accuracy,\r\n      altitude: currentLocation.coords.altitude,\r\n      timestamp: currentLocation.timestamp,\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      sessionId: response.data.sessionId,\r\n      trackingUrl: response.data.trackingUrl,\r\n    };\r\n  } catch (error) {\r\n    console.error('Start tracking error:', error);\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Failed to start tracking',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Stop location tracking\r\n */\r\nexport async function stopTracking(): Promise<void> {\r\n  if (!isTracking) return;\r\n\r\n  try {\r\n    // Stop all tracking methods\r\n    stopForegroundTracking();\r\n    await stopForegroundWatch();\r\n    await stopBackgroundTracking();\r\n\r\n    // Notify server that tracking has stopped\r\n    if (currentSessionId) {\r\n      await api.tracking.stop(currentSessionId);\r\n    }\r\n  } catch (error) {\r\n    console.error('Stop tracking error:', error);\r\n  } finally {\r\n    isTracking = false;\r\n    currentJobId = null;\r\n    currentSessionId = null;\r\n  }\r\n}\r\n\r\n/**\r\n * Check if tracking is currently active\r\n */\r\nexport function isTrackingActive(): boolean {\r\n  return isTracking;\r\n}\r\n\r\n/**\r\n * Get current tracked job ID\r\n */\r\nexport function getCurrentJobId(): string | null {\r\n  return currentJobId;\r\n}\r\n\r\n/**\r\n * Get current session ID\r\n */\r\nexport function getCurrentSessionId(): string | null {\r\n  return currentSessionId;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// BACKGROUND TRACKING (Production builds only)\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nasync function startBackgroundTracking(): Promise<void> {\r\n  try {\r\n    const isTaskRegistered = await TaskManager.isTaskRegisteredAsync(\r\n      BACKGROUND_LOCATION_TASK\r\n    );\r\n\r\n    if (!isTaskRegistered) {\r\n      await Location.startLocationUpdatesAsync(BACKGROUND_LOCATION_TASK, {\r\n        accuracy: Location.Accuracy.High,\r\n        timeInterval: UPDATE_INTERVAL,\r\n        distanceInterval: DISTANCE_INTERVAL,\r\n        showsBackgroundLocationIndicator: true,\r\n        foregroundService: {\r\n          notificationTitle: 'CampoTech - Rastreo activo',\r\n          notificationBody: 'Tu ubicaci├│n se est├í compartiendo con el cliente',\r\n          notificationColor: '#16a34a',\r\n        },\r\n        pausesUpdatesAutomatically: false,\r\n        activityType: Location.ActivityType.AutomotiveNavigation,\r\n      });\r\n    }\r\n  } catch (error) {\r\n    console.warn('[Location] Could not start background tracking:', error);\r\n    // Fall back to foreground polling\r\n    startForegroundTracking();\r\n  }\r\n}\r\n\r\nasync function stopBackgroundTracking(): Promise<void> {\r\n  try {\r\n    const isTaskRegistered = await TaskManager.isTaskRegisteredAsync(\r\n      BACKGROUND_LOCATION_TASK\r\n    );\r\n    if (isTaskRegistered) {\r\n      await Location.stopLocationUpdatesAsync(BACKGROUND_LOCATION_TASK);\r\n    }\r\n  } catch (error) {\r\n    console.warn('[Location] Error stopping background tracking:', error);\r\n  }\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// FOREGROUND TRACKING (Fallback for Expo Go)\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nfunction startForegroundTracking(): void {\r\n  if (foregroundInterval) return;\r\n\r\n  // Poll location every 30 seconds (fallback for Expo Go)\r\n  foregroundInterval = setInterval(async () => {\r\n    if (!isTracking) {\r\n      stopForegroundTracking();\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const location = await Location.getCurrentPositionAsync({\r\n        accuracy: Location.Accuracy.High,\r\n      });\r\n\r\n      const locationUpdate: LocationUpdate = {\r\n        latitude: location.coords.latitude,\r\n        longitude: location.coords.longitude,\r\n        speed: location.coords.speed,\r\n        heading: location.coords.heading,\r\n        accuracy: location.coords.accuracy,\r\n        altitude: location.coords.altitude,\r\n        timestamp: location.timestamp,\r\n      };\r\n\r\n      notifyListeners(locationUpdate);\r\n\r\n      // Send to server\r\n      if (currentSessionId && currentJobId) {\r\n        await api.tracking.update({\r\n          lat: location.coords.latitude,\r\n          lng: location.coords.longitude,\r\n          jobId: currentJobId,\r\n          sessionId: currentSessionId,\r\n          speed: location.coords.speed,\r\n          heading: location.coords.heading,\r\n          accuracy: location.coords.accuracy,\r\n          altitude: location.coords.altitude,\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.warn('Foreground location update error:', error);\r\n    }\r\n  }, UPDATE_INTERVAL);\r\n}\r\n\r\nfunction stopForegroundTracking(): void {\r\n  if (foregroundInterval) {\r\n    clearInterval(foregroundInterval);\r\n    foregroundInterval = null;\r\n  }\r\n}\r\n\r\n// Foreground watch for more frequent updates when app is in foreground\r\nasync function startForegroundWatch(): Promise<void> {\r\n  try {\r\n    foregroundSubscription = await Location.watchPositionAsync(\r\n      {\r\n        accuracy: Location.Accuracy.High,\r\n        timeInterval: 5000, // 5 seconds when in foreground\r\n        distanceInterval: DISTANCE_INTERVAL,\r\n      },\r\n      (location) => {\r\n        const locationUpdate: LocationUpdate = {\r\n          latitude: location.coords.latitude,\r\n          longitude: location.coords.longitude,\r\n          speed: location.coords.speed,\r\n          heading: location.coords.heading,\r\n          accuracy: location.coords.accuracy,\r\n          altitude: location.coords.altitude,\r\n          timestamp: location.timestamp,\r\n        };\r\n        notifyListeners(locationUpdate);\r\n      }\r\n    );\r\n  } catch (error) {\r\n    console.warn('[Location] Could not start foreground watch:', error);\r\n  }\r\n}\r\n\r\nasync function stopForegroundWatch(): Promise<void> {\r\n  if (foregroundSubscription) {\r\n    foregroundSubscription.remove();\r\n    foregroundSubscription = null;\r\n  }\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// LISTENERS\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport function addTrackingListener(\r\n  listener: (location: LocationUpdate) => void\r\n): () => void {\r\n  trackingListeners.push(listener);\r\n  return () => {\r\n    trackingListeners = trackingListeners.filter((l) => l !== listener);\r\n  };\r\n}\r\n\r\nfunction notifyListeners(location: LocationUpdate): void {\r\n  trackingListeners.forEach((listener) => {\r\n    try {\r\n      listener(location);\r\n    } catch (error) {\r\n      console.error('Tracking listener error:', error);\r\n    }\r\n  });\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// MANUAL LOCATION UPDATE\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n/**\r\n * Get current location once (not for tracking)\r\n */\r\nexport async function getCurrentLocation(): Promise<LocationUpdate | null> {\r\n  try {\r\n    const permissions = await checkLocationPermissions();\r\n    if (!permissions.foreground) {\r\n      const requested = await requestLocationPermissions();\r\n      if (!requested.foreground) {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    const location = await Location.getCurrentPositionAsync({\r\n      accuracy: Location.Accuracy.High,\r\n    });\r\n\r\n    return {\r\n      latitude: location.coords.latitude,\r\n      longitude: location.coords.longitude,\r\n      speed: location.coords.speed,\r\n      heading: location.coords.heading,\r\n      accuracy: location.coords.accuracy,\r\n      altitude: location.coords.altitude,\r\n      timestamp: location.timestamp,\r\n    };\r\n  } catch (error) {\r\n    console.error('Get current location error:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Send a manual location update to the server\r\n */\r\nexport async function sendLocationUpdate(): Promise<boolean> {\r\n  if (!isTracking || !currentJobId) {\r\n    return false;\r\n  }\r\n\r\n  const location = await getCurrentLocation();\r\n  if (!location) {\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    await api.tracking.update({\r\n      lat: location.latitude,\r\n      lng: location.longitude,\r\n      jobId: currentJobId,\r\n      sessionId: currentSessionId,\r\n      speed: location.speed,\r\n      heading: location.heading,\r\n      accuracy: location.accuracy,\r\n      altitude: location.altitude,\r\n    });\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Manual location update error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Check if background tracking is available\r\n * (Requires development build, not available in Expo Go)\r\n */\r\nexport async function isBackgroundTrackingAvailable(): Promise<boolean> {\r\n  try {\r\n    const permissions = await checkLocationPermissions();\r\n    return permissions.background;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\storage\\secure-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\sync\\pending-deductions-sync.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\sync\\sync-engine.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MAX_RETRIES' is assigned a value but never used.","line":29,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":18},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":38,"column":16,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":38,"endColumn":51,"fix":{"range":[1168,1203],"text":"((status: SyncStatus) => void)[]"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\r\n * Sync Engine\r\n * ===========\r\n *\r\n * Bidirectional sync between local WatermelonDB and server.\r\n * Handles conflict resolution and offline queuing.\r\n */\r\n\r\nimport { Platform } from 'react-native';\r\nimport { Q } from '@nozbe/watermelondb';\r\nimport {\r\n  database,\r\n  jobsCollection,\r\n  customersCollection,\r\n  priceBookCollection,\r\n  syncQueueCollection,\r\n  syncConflictsCollection,\r\n  userSessionCollection,\r\n} from '../../watermelon/database';\r\nimport { api } from '../api/client';\r\nimport { Job, Customer, SyncQueue, SyncConflict } from '../../watermelon/models';\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// CONSTANTS\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nconst MAX_QUEUE_SIZE = 50;\r\nconst SYNC_DEBOUNCE_MS = 5000;\r\nconst MAX_RETRIES = 5;\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// STATE\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nlet isSyncing = false;\r\nlet lastSyncTime: number | null = null;\r\nlet syncTimeout: ReturnType<typeof setTimeout> | null = null;\r\nlet listeners: Array<(status: SyncStatus) => void> = [];\r\n\r\nexport interface SyncStatus {\r\n  isSyncing: boolean;\r\n  lastSync: Date | null;\r\n  pendingOperations: number;\r\n  conflicts: number;\r\n  isOnline: boolean;\r\n  error?: string;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// NETWORK MONITORING\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nlet isOnline = true;\r\n\r\n// Only setup NetInfo listener on native platforms\r\nif (Platform.OS !== 'web') {\r\n  // Lazy import to avoid web issues\r\n  import('@react-native-community/netinfo').then((NetInfo) => {\r\n    NetInfo.default.addEventListener((state) => {\r\n      const wasOffline = !isOnline;\r\n      isOnline = state.isConnected ?? false;\r\n\r\n      // Trigger sync when coming back online\r\n      if (wasOffline && isOnline) {\r\n        scheduleSyncDebounced();\r\n      }\r\n\r\n      notifyListeners();\r\n    });\r\n  }).catch(() => {\r\n    // NetInfo not available, assume online\r\n    isOnline = true;\r\n  });\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// SYNC OPERATIONS\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n/**\r\n * Full bidirectional sync\r\n */\r\nexport async function performSync(): Promise<{\r\n  success: boolean;\r\n  pulled: number;\r\n  pushed: number;\r\n  conflicts: number;\r\n  pendingDeductionsSynced?: number;\r\n  error?: string;\r\n}> {\r\n  if (isSyncing) {\r\n    return { success: false, pulled: 0, pushed: 0, conflicts: 0, error: 'Sync in progress' };\r\n  }\r\n\r\n  if (!isOnline) {\r\n    return { success: false, pulled: 0, pushed: 0, conflicts: 0, error: 'Offline' };\r\n  }\r\n\r\n  isSyncing = true;\r\n  notifyListeners();\r\n\r\n  try {\r\n    // 1. Push local changes first\r\n    const pushResult = await pushLocalChanges();\r\n\r\n    // 2. Phase 2.2.4.4: Sync pending stock deductions\r\n    let pendingDeductionsSynced = 0;\r\n    try {\r\n      const { syncPendingDeductions } = await import('./pending-deductions-sync');\r\n      const deductionsResult = await syncPendingDeductions();\r\n      pendingDeductionsSynced = deductionsResult.synced;\r\n    } catch (deductionError) {\r\n      console.error('Error syncing pending deductions:', deductionError);\r\n    }\r\n\r\n    // 3. Pull server changes\r\n    const pullResult = await pullServerChanges();\r\n\r\n    // 4. Update last sync time\r\n    lastSyncTime = Date.now();\r\n    await updateSessionLastSync(lastSyncTime);\r\n\r\n    return {\r\n      success: true,\r\n      pulled: pullResult.count,\r\n      pushed: pushResult.count,\r\n      conflicts: pushResult.conflicts,\r\n      pendingDeductionsSynced,\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      pulled: 0,\r\n      pushed: 0,\r\n      conflicts: 0,\r\n      error: error instanceof Error ? error.message : 'Sync failed',\r\n    };\r\n  } finally {\r\n    isSyncing = false;\r\n    notifyListeners();\r\n  }\r\n}\r\n\r\n/**\r\n * Push local changes to server\r\n */\r\nasync function pushLocalChanges(): Promise<{ count: number; conflicts: number }> {\r\n  // Get pending sync operations\r\n  const pendingOps = await syncQueueCollection\r\n    .query()\r\n    .fetch() as SyncQueue[];\r\n\r\n  if (pendingOps.length === 0) {\r\n    return { count: 0, conflicts: 0 };\r\n  }\r\n\r\n  // Build operations array\r\n  const operations = pendingOps.map((op) => ({\r\n    type: op.operation,\r\n    entity: op.entityType,\r\n    data: op.parsedPayload,\r\n  }));\r\n\r\n  // Send to server\r\n  const response = await api.sync.push(operations);\r\n\r\n  if (!response.success) {\r\n    throw new Error(response.error?.message || 'Push failed');\r\n  }\r\n\r\n  // Handle conflicts\r\n  let conflictCount = 0;\r\n  if (response.data?.conflicts && response.data.conflicts.length > 0) {\r\n    for (const conflict of response.data.conflicts) {\r\n      await createConflict(conflict);\r\n      conflictCount++;\r\n    }\r\n  }\r\n\r\n  // Clear processed operations\r\n  await database.write(async () => {\r\n    for (const op of pendingOps) {\r\n      await op.destroyPermanently();\r\n    }\r\n  });\r\n\r\n  return { count: response.data?.processed || 0, conflicts: conflictCount };\r\n}\r\n\r\n/**\r\n * Pull changes from server\r\n */\r\nasync function pullServerChanges(): Promise<{ count: number }> {\r\n  const response = await api.sync.pull(lastSyncTime || undefined);\r\n\r\n  if (!response.success || !response.data) {\r\n    throw new Error(response.error?.message || 'Pull failed');\r\n  }\r\n\r\n  const { jobs, customers, priceBook } = response.data;\r\n  let count = 0;\r\n\r\n  await database.write(async () => {\r\n    // Sync jobs\r\n    for (const serverJob of jobs as any[]) {\r\n      await syncJob(serverJob);\r\n      count++;\r\n    }\r\n\r\n    // Sync customers\r\n    for (const serverCustomer of customers as any[]) {\r\n      await syncCustomer(serverCustomer);\r\n      count++;\r\n    }\r\n\r\n    // Sync price book\r\n    for (const serverItem of priceBook as any[]) {\r\n      await syncPriceBookItem(serverItem);\r\n      count++;\r\n    }\r\n  });\r\n\r\n  return { count };\r\n}\r\n\r\n/**\r\n * Sync a single job from server\r\n */\r\nasync function syncJob(serverJob: any): Promise<void> {\r\n  const results = await jobsCollection\r\n    .query(Q.where('server_id', serverJob.id))\r\n    .fetch() as Job[];\r\n  const existing = results.length > 0 ? results[0] : null;\r\n\r\n  if (existing) {\r\n    // Check for conflicts\r\n    if (existing.isDirty) {\r\n      // Local has changes - create conflict\r\n      await createConflict({\r\n        entityType: 'job',\r\n        entityId: serverJob.id,\r\n        serverData: serverJob,\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Update local record\r\n    await existing.update((job: any) => {\r\n      Object.assign(job, mapServerJobToLocal(serverJob));\r\n      job.syncedAt = Date.now();\r\n    });\r\n  } else {\r\n    // Create new local record\r\n    await jobsCollection.create((job: any) => {\r\n      Object.assign(job, mapServerJobToLocal(serverJob));\r\n      job.serverId = serverJob.id;\r\n      job.syncedAt = Date.now();\r\n      job.isDirty = false;\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Sync a single customer from server\r\n */\r\nasync function syncCustomer(serverCustomer: any): Promise<void> {\r\n  const results = await customersCollection\r\n    .query(Q.where('server_id', serverCustomer.id))\r\n    .fetch() as Customer[];\r\n  const existing = results.length > 0 ? results[0] : null;\r\n\r\n  if (existing) {\r\n    await existing.update((customer: any) => {\r\n      Object.assign(customer, mapServerCustomerToLocal(serverCustomer));\r\n      customer.syncedAt = Date.now();\r\n    });\r\n  } else {\r\n    await customersCollection.create((customer: any) => {\r\n      Object.assign(customer, mapServerCustomerToLocal(serverCustomer));\r\n      customer.serverId = serverCustomer.id;\r\n      customer.syncedAt = Date.now();\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Sync a single price book item from server\r\n */\r\nasync function syncPriceBookItem(serverItem: any): Promise<void> {\r\n  const results = await priceBookCollection\r\n    .query(Q.where('server_id', serverItem.id))\r\n    .fetch();\r\n  const existing = results.length > 0 ? results[0] : null;\r\n\r\n  if (existing) {\r\n    await existing.update((item: any) => {\r\n      item.name = serverItem.name;\r\n      item.category = serverItem.category;\r\n      item.description = serverItem.description;\r\n      item.unitPrice = serverItem.unitPrice;\r\n      item.unit = serverItem.unit;\r\n      item.taxRate = serverItem.taxRate;\r\n      item.isActive = serverItem.isActive;\r\n      item.syncedAt = Date.now();\r\n    });\r\n  } else {\r\n    await priceBookCollection.create((item: any) => {\r\n      item.serverId = serverItem.id;\r\n      item.organizationId = serverItem.organizationId;\r\n      item.name = serverItem.name;\r\n      item.category = serverItem.category;\r\n      item.description = serverItem.description;\r\n      item.unitPrice = serverItem.unitPrice;\r\n      item.unit = serverItem.unit;\r\n      item.taxRate = serverItem.taxRate;\r\n      item.isActive = serverItem.isActive;\r\n      item.syncedAt = Date.now();\r\n    });\r\n  }\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// QUEUE MANAGEMENT\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\n/**\r\n * Add operation to sync queue\r\n */\r\nexport async function enqueueOperation(\r\n  entityType: string,\r\n  entityId: string,\r\n  operation: 'create' | 'update' | 'delete',\r\n  payload: Record<string, unknown>,\r\n  priority: number = 5\r\n): Promise<void> {\r\n  // Check queue size\r\n  const queueSize = await syncQueueCollection.query().fetchCount();\r\n  if (queueSize >= MAX_QUEUE_SIZE) {\r\n    // Remove oldest low-priority items\r\n    const allOps = await syncQueueCollection.query().fetch();\r\n    const oldestOps = allOps\r\n      .sort((a: any, b: any) => a.priority - b.priority || a.createdAt - b.createdAt)\r\n      .slice(0, 10);\r\n\r\n    await database.write(async () => {\r\n      for (const op of oldestOps) {\r\n        await op.destroyPermanently();\r\n      }\r\n    });\r\n  }\r\n\r\n  await database.write(async () => {\r\n    await syncQueueCollection.create((op: any) => {\r\n      op.entityType = entityType;\r\n      op.entityId = entityId;\r\n      op.operation = operation;\r\n      op.payload = JSON.stringify(payload);\r\n      op.priority = priority;\r\n      op.retryCount = 0;\r\n      op.createdAt = new Date();\r\n    });\r\n  });\r\n\r\n  // Schedule sync\r\n  scheduleSyncDebounced();\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// CONFLICT RESOLUTION\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nasync function createConflict(data: {\r\n  entityType: string;\r\n  entityId: string;\r\n  serverData: unknown;\r\n}): Promise<void> {\r\n  // Get local data\r\n  let localData: unknown = null;\r\n  if (data.entityType === 'job') {\r\n    const jobResults = await jobsCollection\r\n      .query(Q.where('server_id', data.entityId))\r\n      .fetch();\r\n    const job = jobResults.length > 0 ? jobResults[0] : null;\r\n    localData = job?._raw;\r\n  }\r\n\r\n  await database.write(async () => {\r\n    await syncConflictsCollection.create((conflict: any) => {\r\n      conflict.entityType = data.entityType;\r\n      conflict.entityId = data.entityId;\r\n      conflict.localData = JSON.stringify(localData);\r\n      conflict.serverData = JSON.stringify(data.serverData);\r\n      conflict.conflictType = 'concurrent_edit';\r\n      conflict.resolved = false;\r\n      conflict.createdAt = new Date();\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Resolve a sync conflict\r\n */\r\nexport async function resolveConflict(\r\n  conflictId: string,\r\n  resolution: 'local' | 'server' | 'merged',\r\n  mergedData?: Record<string, unknown>\r\n): Promise<void> {\r\n  const conflict = await syncConflictsCollection.find(conflictId) as SyncConflict;\r\n\r\n  if (resolution === 'server') {\r\n    // Apply server data\r\n    if (conflict.entityType === 'job') {\r\n      await syncJob(conflict.parsedServerData);\r\n    }\r\n  } else if (resolution === 'local') {\r\n    // Queue local data for push\r\n    await enqueueOperation(\r\n      conflict.entityType,\r\n      conflict.entityId,\r\n      'update',\r\n      conflict.parsedLocalData,\r\n      10 // High priority\r\n    );\r\n  } else if (resolution === 'merged' && mergedData) {\r\n    // Apply merged data locally and queue for push\r\n    await enqueueOperation(\r\n      conflict.entityType,\r\n      conflict.entityId,\r\n      'update',\r\n      mergedData,\r\n      10\r\n    );\r\n  }\r\n\r\n  // Mark conflict as resolved\r\n  await database.write(async () => {\r\n    await conflict.update((c: any) => {\r\n      c.resolved = true;\r\n      c.resolution = resolution;\r\n      c.resolvedAt = Date.now();\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Get unresolved conflicts\r\n */\r\nexport async function getUnresolvedConflicts(): Promise<SyncConflict[]> {\r\n  return syncConflictsCollection\r\n    .query(Q.where('resolved', false))\r\n    .fetch() as Promise<SyncConflict[]>;\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// HELPERS\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nfunction mapServerJobToLocal(serverJob: any): Partial<Job> {\r\n  return {\r\n    customerId: serverJob.customerId,\r\n    organizationId: serverJob.organizationId,\r\n    assignedToId: serverJob.assignedToId,\r\n    serviceType: serverJob.serviceType,\r\n    status: serverJob.status,\r\n    priority: serverJob.priority,\r\n    scheduledStart: serverJob.scheduledStart ? new Date(serverJob.scheduledStart).getTime() : null,\r\n    scheduledEnd: serverJob.scheduledEnd ? new Date(serverJob.scheduledEnd).getTime() : null,\r\n    actualStart: serverJob.actualStart ? new Date(serverJob.actualStart).getTime() : null,\r\n    actualEnd: serverJob.actualEnd ? new Date(serverJob.actualEnd).getTime() : null,\r\n    address: serverJob.address,\r\n    latitude: serverJob.latitude,\r\n    longitude: serverJob.longitude,\r\n    notes: serverJob.notes,\r\n    internalNotes: serverJob.internalNotes,\r\n    completionNotes: serverJob.completionNotes,\r\n    materialsUsed: serverJob.materialsUsed ? JSON.stringify(serverJob.materialsUsed) : null,\r\n    signatureUrl: serverJob.signatureUrl,\r\n    subtotal: serverJob.subtotal,\r\n    tax: serverJob.tax,\r\n    total: serverJob.total,\r\n  } as any;\r\n}\r\n\r\nfunction mapServerCustomerToLocal(serverCustomer: any): Partial<Customer> {\r\n  return {\r\n    organizationId: serverCustomer.organizationId,\r\n    name: serverCustomer.name,\r\n    phone: serverCustomer.phone,\r\n    email: serverCustomer.email,\r\n    dni: serverCustomer.dni,\r\n    cuit: serverCustomer.cuit,\r\n    ivaCondition: serverCustomer.ivaCondition,\r\n    address: serverCustomer.address,\r\n    city: serverCustomer.city,\r\n    province: serverCustomer.province,\r\n    notes: serverCustomer.notes,\r\n  } as any;\r\n}\r\n\r\nasync function updateSessionLastSync(timestamp: number): Promise<void> {\r\n  const sessions = await userSessionCollection.query().fetch();\r\n  if (sessions.length > 0) {\r\n    await database.write(async () => {\r\n      await sessions[0].update((s: any) => {\r\n        s.lastSync = timestamp;\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nfunction scheduleSyncDebounced(): void {\r\n  if (syncTimeout) {\r\n    clearTimeout(syncTimeout);\r\n  }\r\n\r\n  syncTimeout = setTimeout(() => {\r\n    performSync();\r\n  }, SYNC_DEBOUNCE_MS);\r\n}\r\n\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n// STATUS & LISTENERS\r\n// ΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉΓòÉ\r\n\r\nexport function addSyncListener(listener: (status: SyncStatus) => void): () => void {\r\n  listeners.push(listener);\r\n  return () => {\r\n    listeners = listeners.filter((l) => l !== listener);\r\n  };\r\n}\r\n\r\nasync function notifyListeners(): Promise<void> {\r\n  const pendingOps = await syncQueueCollection.query().fetchCount();\r\n  const conflicts = await syncConflictsCollection\r\n    .query(Q.where('resolved', false))\r\n    .fetchCount();\r\n\r\n  const status: SyncStatus = {\r\n    isSyncing,\r\n    lastSync: lastSyncTime ? new Date(lastSyncTime) : null,\r\n    pendingOperations: pendingOps,\r\n    conflicts,\r\n    isOnline,\r\n  };\r\n\r\n  listeners.forEach((listener) => listener(status));\r\n}\r\n\r\nexport async function getSyncStatus(): Promise<SyncStatus> {\r\n  const pendingOps = await syncQueueCollection.query().fetchCount();\r\n  const conflicts = await syncConflictsCollection\r\n    .query(Q.where('resolved', false))\r\n    .fetchCount();\r\n\r\n  return {\r\n    isSyncing,\r\n    lastSync: lastSyncTime ? new Date(lastSyncTime) : null,\r\n    pendingOperations: pendingOps,\r\n    conflicts,\r\n    isOnline,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\sync\\useSyncStatus.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setStatus' is assigned a value but never used.","line":18,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Sync Status Hook\r\n * =================\r\n *\r\n * Provides sync status information for offline-first architecture\r\n */\r\n\r\nimport { useState, useEffect } from 'react';\r\n\r\nexport interface SyncStatus {\r\n    status: 'idle' | 'syncing' | 'success' | 'error';\r\n    lastSyncTime: number | null;\r\n    pendingOperations: number;\r\n    error: string | null;\r\n}\r\n\r\nexport function useSyncStatus(): SyncStatus {\r\n    const [status, setStatus] = useState<SyncStatus>({\r\n        status: 'idle',\r\n        lastSyncTime: null,\r\n        pendingOperations: 0,\r\n        error: null,\r\n    });\r\n\r\n    useEffect(() => {\r\n        // TODO: Implement actual sync status tracking\r\n        // This is a placeholder implementation\r\n        return () => {\r\n            // Cleanup\r\n        };\r\n    }, []);\r\n\r\n    return status;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\utils\\image-optimization.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Platform' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'calculateDimensions' is defined but never used.","line":34,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'imageInfo' is assigned a value but never used.","line":88,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Image Optimization Utilities\r\n * ============================\r\n *\r\n * Phase 2.6.1: Device Compatibility\r\n * Optimizes images for older devices with limited memory\r\n */\r\n\r\nimport * as ImageManipulator from 'expo-image-manipulator';\r\nimport * as FileSystem from 'expo-file-system';\r\nimport { Platform } from 'react-native';\r\nimport { PERFORMANCE_CONFIG, createLimitedCache } from './performance';\r\n\r\ninterface ImageDimensions {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\ninterface OptimizedImage {\r\n  uri: string;\r\n  width: number;\r\n  height: number;\r\n  fileSize?: number;\r\n}\r\n\r\n// Memory-limited cache for processed images\r\nconst imageCache = createLimitedCache<string, OptimizedImage>(\r\n  PERFORMANCE_CONFIG.memory.imagePoolSize\r\n);\r\n\r\n/**\r\n * Calculate dimensions while maintaining aspect ratio\r\n */\r\nfunction calculateDimensions(\r\n  originalWidth: number,\r\n  originalHeight: number,\r\n  maxWidth: number,\r\n  maxHeight: number\r\n): ImageDimensions {\r\n  const aspectRatio = originalWidth / originalHeight;\r\n\r\n  let newWidth = originalWidth;\r\n  let newHeight = originalHeight;\r\n\r\n  if (newWidth > maxWidth) {\r\n    newWidth = maxWidth;\r\n    newHeight = newWidth / aspectRatio;\r\n  }\r\n\r\n  if (newHeight > maxHeight) {\r\n    newHeight = maxHeight;\r\n    newWidth = newHeight * aspectRatio;\r\n  }\r\n\r\n  return {\r\n    width: Math.round(newWidth),\r\n    height: Math.round(newHeight),\r\n  };\r\n}\r\n\r\n/**\r\n * Compress and resize image for upload\r\n * Optimized for older devices with limited memory\r\n */\r\nexport async function optimizeImageForUpload(\r\n  uri: string,\r\n  options?: {\r\n    maxWidth?: number;\r\n    maxHeight?: number;\r\n    quality?: number;\r\n  }\r\n): Promise<OptimizedImage> {\r\n  const {\r\n    maxWidth = PERFORMANCE_CONFIG.fullImageSize.width,\r\n    maxHeight = PERFORMANCE_CONFIG.fullImageSize.height,\r\n    quality = PERFORMANCE_CONFIG.imageQuality,\r\n  } = options || {};\r\n\r\n  // Check cache first\r\n  const cacheKey = `${uri}-${maxWidth}-${maxHeight}-${quality}`;\r\n  const cached = imageCache.get(cacheKey);\r\n  if (cached) {\r\n    return cached;\r\n  }\r\n\r\n  try {\r\n    // Get original image info\r\n    const imageInfo = await FileSystem.getInfoAsync(uri);\r\n\r\n    // Process image with resizing and compression\r\n    const result = await ImageManipulator.manipulateAsync(\r\n      uri,\r\n      [\r\n        {\r\n          resize: {\r\n            width: maxWidth,\r\n            height: maxHeight,\r\n          },\r\n        },\r\n      ],\r\n      {\r\n        compress: quality,\r\n        format: ImageManipulator.SaveFormat.JPEG,\r\n      }\r\n    );\r\n\r\n    const optimizedImage: OptimizedImage = {\r\n      uri: result.uri,\r\n      width: result.width,\r\n      height: result.height,\r\n    };\r\n\r\n    // Get file size of optimized image\r\n    const optimizedInfo = await FileSystem.getInfoAsync(result.uri);\r\n    if (optimizedInfo.exists && 'size' in optimizedInfo) {\r\n      optimizedImage.fileSize = optimizedInfo.size;\r\n    }\r\n\r\n    // Cache the result\r\n    imageCache.set(cacheKey, optimizedImage);\r\n\r\n    return optimizedImage;\r\n  } catch (error) {\r\n    console.error('Image optimization failed:', error);\r\n    // Return original if optimization fails\r\n    return { uri, width: 0, height: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Create a thumbnail from an image\r\n * Uses aggressive compression for list views\r\n */\r\nexport async function createThumbnail(uri: string): Promise<OptimizedImage> {\r\n  const cacheKey = `thumb-${uri}`;\r\n  const cached = imageCache.get(cacheKey);\r\n  if (cached) {\r\n    return cached;\r\n  }\r\n\r\n  try {\r\n    const result = await ImageManipulator.manipulateAsync(\r\n      uri,\r\n      [\r\n        {\r\n          resize: {\r\n            width: PERFORMANCE_CONFIG.thumbnailSize.width,\r\n            height: PERFORMANCE_CONFIG.thumbnailSize.height,\r\n          },\r\n        },\r\n      ],\r\n      {\r\n        compress: 0.5, // Aggressive compression for thumbnails\r\n        format: ImageManipulator.SaveFormat.JPEG,\r\n      }\r\n    );\r\n\r\n    const thumbnail: OptimizedImage = {\r\n      uri: result.uri,\r\n      width: result.width,\r\n      height: result.height,\r\n    };\r\n\r\n    imageCache.set(cacheKey, thumbnail);\r\n    return thumbnail;\r\n  } catch (error) {\r\n    console.error('Thumbnail creation failed:', error);\r\n    return { uri, width: 0, height: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Prepare multiple images for batch upload\r\n * Processes in sequence to avoid memory issues on low-end devices\r\n */\r\nexport async function optimizeImagesForUpload(\r\n  uris: string[],\r\n  options?: {\r\n    maxWidth?: number;\r\n    maxHeight?: number;\r\n    quality?: number;\r\n    onProgress?: (current: number, total: number) => void;\r\n  }\r\n): Promise<OptimizedImage[]> {\r\n  const results: OptimizedImage[] = [];\r\n  const { onProgress } = options || {};\r\n\r\n  for (let i = 0; i < uris.length; i++) {\r\n    const optimized = await optimizeImageForUpload(uris[i], options);\r\n    results.push(optimized);\r\n\r\n    if (onProgress) {\r\n      onProgress(i + 1, uris.length);\r\n    }\r\n  }\r\n\r\n  return results;\r\n}\r\n\r\n/**\r\n * Get file size in human-readable format\r\n */\r\nexport function formatFileSize(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\r\n}\r\n\r\n/**\r\n * Check if image needs optimization based on file size\r\n */\r\nexport async function shouldOptimize(uri: string): Promise<boolean> {\r\n  try {\r\n    const info = await FileSystem.getInfoAsync(uri);\r\n    if (!info.exists || !('size' in info)) {\r\n      return false;\r\n    }\r\n\r\n    // Optimize if larger than 500KB\r\n    const maxSizeBytes = 500 * 1024;\r\n    return info.size > maxSizeBytes;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Clean up cached images to free memory\r\n */\r\nexport function clearImageCache(): void {\r\n  imageCache.clear();\r\n}\r\n\r\n/**\r\n * Get image dimensions without loading full image\r\n */\r\nexport async function getImageDimensions(\r\n  uri: string\r\n): Promise<ImageDimensions | null> {\r\n  try {\r\n    // Use manipulator with no-op to get dimensions\r\n    const result = await ImageManipulator.manipulateAsync(uri, [], {\r\n      compress: 1,\r\n      format: ImageManipulator.SaveFormat.JPEG,\r\n    });\r\n    return { width: result.width, height: result.height };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Platform-specific image format\r\n */\r\nexport function getOptimalImageFormat(): ImageManipulator.SaveFormat {\r\n  // Use JPEG for better compatibility on older devices\r\n  return ImageManipulator.SaveFormat.JPEG;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\lib\\utils\\performance.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":9,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":38},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":242,"column":5,"nodeType":"Identifier","endLine":242,"endColumn":14}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect was passed a dependency list that is not an array literal. This means we can't statically verify whether you've passed the correct dependencies.","line":64,"column":6,"nodeType":"Identifier","endLine":64,"endColumn":10,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'callback'. Either include it or remove the dependency array. If 'callback' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":64,"column":6,"nodeType":"Identifier","endLine":64,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [callback]","fix":{"range":[1686,1690],"text":"[callback]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Performance Optimization Utilities\r\n * ===================================\r\n *\r\n * Phase 2.6.1: Device Compatibility\r\n * Optimizations for older devices (Android 8+, iOS 14+)\r\n */\r\n\r\nimport { useCallback, useRef, useMemo, useEffect, useState } from 'react';\r\nimport { InteractionManager, Platform } from 'react-native';\r\n\r\n/**\r\n * Debounce function for expensive operations\r\n * Prevents rapid-fire calls on older devices\r\n */\r\nexport function debounce<T extends (...args: unknown[]) => void>(\r\n  func: T,\r\n  wait: number\r\n): (...args: Parameters<T>) => void {\r\n  let timeoutId: ReturnType<typeof setTimeout> | null = null;\r\n\r\n  return (...args: Parameters<T>) => {\r\n    if (timeoutId) {\r\n      clearTimeout(timeoutId);\r\n    }\r\n    timeoutId = setTimeout(() => {\r\n      func(...args);\r\n    }, wait);\r\n  };\r\n}\r\n\r\n/**\r\n * Throttle function for scroll handlers and frequent events\r\n */\r\nexport function throttle<T extends (...args: unknown[]) => void>(\r\n  func: T,\r\n  limit: number\r\n): (...args: Parameters<T>) => void {\r\n  let inThrottle = false;\r\n\r\n  return (...args: Parameters<T>) => {\r\n    if (!inThrottle) {\r\n      func(...args);\r\n      inThrottle = true;\r\n      setTimeout(() => {\r\n        inThrottle = false;\r\n      }, limit);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Hook to run expensive operations after interactions complete\r\n * Critical for smooth transitions on older devices\r\n */\r\nexport function useAfterInteractions(callback: () => void, deps: unknown[] = []) {\r\n  useEffect(() => {\r\n    const task = InteractionManager.runAfterInteractions(() => {\r\n      callback();\r\n    });\r\n\r\n    return () => task.cancel();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, deps);\r\n}\r\n\r\n/**\r\n * Hook for lazy initialization of expensive computations\r\n */\r\nexport function useLazyRef<T>(initializer: () => T): React.MutableRefObject<T> {\r\n  const ref = useRef<T | null>(null);\r\n\r\n  if (ref.current === null) {\r\n    ref.current = initializer();\r\n  }\r\n\r\n  return ref as React.MutableRefObject<T>;\r\n}\r\n\r\n/**\r\n * Memory-efficient memoization with size limit\r\n * Prevents memory issues on low-RAM devices (2GB)\r\n */\r\nexport function createLimitedCache<K, V>(maxSize: number = 50) {\r\n  const cache = new Map<K, V>();\r\n  const keys: K[] = [];\r\n\r\n  return {\r\n    get(key: K): V | undefined {\r\n      return cache.get(key);\r\n    },\r\n    set(key: K, value: V): void {\r\n      if (cache.has(key)) {\r\n        cache.set(key, value);\r\n        return;\r\n      }\r\n\r\n      if (keys.length >= maxSize) {\r\n        const oldestKey = keys.shift();\r\n        if (oldestKey !== undefined) {\r\n          cache.delete(oldestKey);\r\n        }\r\n      }\r\n\r\n      cache.set(key, value);\r\n      keys.push(key);\r\n    },\r\n    clear(): void {\r\n      cache.clear();\r\n      keys.length = 0;\r\n    },\r\n    size(): number {\r\n      return cache.size;\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * Batch state updates to reduce re-renders\r\n */\r\nexport function useBatchedUpdates<T>(\r\n  initialState: T,\r\n  batchDelay: number = 16 // ~1 frame at 60fps\r\n): [T, (updates: Partial<T>) => void, () => void] {\r\n  const stateRef = useRef<T>(initialState);\r\n  const pendingUpdates = useRef<Partial<T>>({});\r\n  const timeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\r\n  const [, forceUpdate] = useState({});\r\n  const triggerRender = useCallback(() => forceUpdate({}), []);\r\n\r\n  const scheduleUpdate = useCallback(\r\n    (updates: Partial<T>) => {\r\n      pendingUpdates.current = { ...pendingUpdates.current, ...updates };\r\n\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n\r\n      timeoutRef.current = setTimeout(() => {\r\n        stateRef.current = { ...stateRef.current, ...pendingUpdates.current };\r\n        pendingUpdates.current = {};\r\n        triggerRender();\r\n      }, batchDelay);\r\n    },\r\n    [batchDelay, triggerRender]\r\n  );\r\n\r\n  const flushUpdates = useCallback(() => {\r\n    if (timeoutRef.current) {\r\n      clearTimeout(timeoutRef.current);\r\n    }\r\n    stateRef.current = { ...stateRef.current, ...pendingUpdates.current };\r\n    pendingUpdates.current = {};\r\n    triggerRender();\r\n  }, [triggerRender]);\r\n\r\n  return [stateRef.current, scheduleUpdate, flushUpdates];\r\n}\r\n\r\n/**\r\n * Platform-specific performance settings\r\n */\r\nexport const PERFORMANCE_CONFIG = {\r\n  // Image quality for older devices\r\n  imageQuality: Platform.select({\r\n    android: 0.7, // Lower quality on Android for performance\r\n    ios: 0.8,\r\n    default: 0.8,\r\n  }),\r\n\r\n  // Max image dimensions for thumbnails\r\n  thumbnailSize: {\r\n    width: 200,\r\n    height: 200,\r\n  },\r\n\r\n  // Full image max dimensions\r\n  fullImageSize: {\r\n    width: 1200,\r\n    height: 1200,\r\n  },\r\n\r\n  // List rendering optimizations\r\n  list: {\r\n    initialNumToRender: 10,\r\n    maxToRenderPerBatch: 5,\r\n    windowSize: 5,\r\n    updateCellsBatchingPeriod: 50,\r\n    removeClippedSubviews: Platform.OS === 'android',\r\n  },\r\n\r\n  // Animation settings for older devices\r\n  animation: {\r\n    useNativeDriver: true,\r\n    duration: Platform.select({\r\n      android: 200, // Shorter on Android\r\n      ios: 250,\r\n      default: 250,\r\n    }),\r\n  },\r\n\r\n  // Memory thresholds\r\n  memory: {\r\n    maxCacheSize: 50, // Max items in memory cache\r\n    imagePoolSize: 20, // Max images to keep in memory\r\n  },\r\n};\r\n\r\n/**\r\n * Check if device is likely low-end based on platform\r\n */\r\nexport function isLowEndDevice(): boolean {\r\n  // In production, you'd check Device.totalMemory\r\n  // For now, assume Android devices might be lower-end\r\n  return Platform.OS === 'android';\r\n}\r\n\r\n/**\r\n * Get optimized list props for FlashList/FlatList\r\n */\r\nexport function getOptimizedListProps() {\r\n  const isLowEnd = isLowEndDevice();\r\n\r\n  return {\r\n    initialNumToRender: isLowEnd ? 5 : PERFORMANCE_CONFIG.list.initialNumToRender,\r\n    maxToRenderPerBatch: isLowEnd ? 3 : PERFORMANCE_CONFIG.list.maxToRenderPerBatch,\r\n    windowSize: isLowEnd ? 3 : PERFORMANCE_CONFIG.list.windowSize,\r\n    updateCellsBatchingPeriod: PERFORMANCE_CONFIG.list.updateCellsBatchingPeriod,\r\n    removeClippedSubviews: PERFORMANCE_CONFIG.list.removeClippedSubviews,\r\n  };\r\n}\r\n\r\n/**\r\n * Measure component render time (development only)\r\n */\r\nexport function useRenderTime(componentName: string) {\r\n  const startTime = useRef<number>(0);\r\n\r\n  if (__DEV__) {\r\n    startTime.current = performance.now();\r\n\r\n    useEffect(() => {\r\n      const endTime = performance.now();\r\n      const renderTime = endTime - startTime.current;\r\n      if (renderTime > 16) {\r\n        // More than 1 frame\r\n        console.warn(\r\n          `[Performance] ${componentName} took ${renderTime.toFixed(2)}ms to render`\r\n        );\r\n      }\r\n    });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\metro.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\types\\expo-vector-icons.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\database.native.ts","messages":[{"ruleId":"import/no-named-as-default","severity":1,"message":"Using exported name 'schema' as identifier for default import.","line":11,"column":8,"nodeType":"ImportDefaultSpecifier","endLine":11,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * WatermelonDB Database Initialization\r\n * ====================================\r\n *\r\n * Sets up the local SQLite database for offline-first functionality.\r\n */\r\n\r\nimport { Database } from '@nozbe/watermelondb';\r\nimport SQLiteAdapter from '@nozbe/watermelondb/adapters/sqlite';\r\n\r\nimport schema from './schema';\r\nimport { modelClasses } from './models';\r\n\r\n// Create adapter\r\nconst adapter = new SQLiteAdapter({\r\n  schema,\r\n  // (optional) migrations\r\n  // migrations,\r\n  // (optional) jsi: Platform.OS === 'ios',\r\n  dbName: 'campotech',\r\n  onSetUpError: (error) => {\r\n    console.error('Database setup error:', error);\r\n  },\r\n});\r\n\r\n// Create database instance\r\nexport const database = new Database({\r\n  adapter,\r\n  modelClasses,\r\n});\r\n\r\n// Export collections for easy access\r\nexport const jobsCollection = database.get('jobs');\r\nexport const customersCollection = database.get('customers');\r\nexport const priceBookCollection = database.get('price_book_items');\r\nexport const jobPhotosCollection = database.get('job_photos');\r\nexport const syncQueueCollection = database.get('sync_queue');\r\nexport const syncConflictsCollection = database.get('sync_conflicts');\r\nexport const userSessionCollection = database.get('user_session');\r\n\r\nexport default database;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\database.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\database.web.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\models\\Customer.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'readonly' is defined but never used.","line":9,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Customer Model\r\n * ==============\r\n *\r\n * WatermelonDB model for customer data.\r\n */\r\n\r\nimport { Model } from '@nozbe/watermelondb';\r\nimport { field, date, readonly, children } from '@nozbe/watermelondb/decorators';\r\n\r\nexport default class Customer extends Model {\r\n  static table = 'customers';\r\n\r\n  static associations = {\r\n    jobs: { type: 'has_many' as const, foreignKey: 'customer_id' },\r\n  };\r\n\r\n  @field('server_id') serverId!: string;\r\n  @field('organization_id') organizationId!: string;\r\n  @field('name') name!: string;\r\n  @field('phone') phone!: string;\r\n  @field('email') email!: string | null;\r\n  @field('dni') dni!: string | null;\r\n  @field('cuit') cuit!: string | null;\r\n  @field('iva_condition') ivaCondition!: string | null;\r\n  @field('address') address!: string | null;\r\n  @field('city') city!: string | null;\r\n  @field('province') province!: string | null;\r\n  @field('notes') notes!: string | null;\r\n\r\n  @date('created_at') createdAt!: Date;\r\n  @date('updated_at') updatedAt!: Date;\r\n  @field('synced_at') syncedAt!: number | null;\r\n\r\n  @children('jobs') jobs!: any;\r\n\r\n  // Computed properties\r\n  get displayName(): string {\r\n    return this.name || this.phone;\r\n  }\r\n\r\n  get fullAddress(): string {\r\n    const parts = [this.address, this.city, this.province].filter(Boolean);\r\n    return parts.join(', ');\r\n  }\r\n\r\n  get formattedPhone(): string {\r\n    const digits = this.phone.replace(/\\D/g, '');\r\n    if (digits.length === 13 && digits.startsWith('549')) {\r\n      // Argentine mobile: +54 9 11 1234-5678\r\n      return `+54 9 ${digits.slice(3, 5)} ${digits.slice(5, 9)}-${digits.slice(9)}`;\r\n    }\r\n    return this.phone;\r\n  }\r\n\r\n  get initials(): string {\r\n    const words = this.name.split(' ');\r\n    if (words.length >= 2) {\r\n      return `${words[0][0]}${words[1][0]}`.toUpperCase();\r\n    }\r\n    return this.name.slice(0, 2).toUpperCase();\r\n  }\r\n\r\n  get ivaConditionLabel(): string {\r\n    const labels: Record<string, string> = {\r\n      responsable_inscripto: 'Responsable Inscripto',\r\n      monotributista: 'Monotributista',\r\n      exento: 'Exento',\r\n      consumidor_final: 'Consumidor Final',\r\n    };\r\n    return labels[this.ivaCondition || ''] || 'Sin especificar';\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\models\\Job.ts","messages":[{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":83,"column":30,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":83,"endColumn":86,"fix":{"range":[3096,3152],"text":"{ name: string; quantity: number; price: number }[]"}},{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":158,"column":16,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":158,"endColumn":72,"fix":{"range":[5097,5153],"text":"{ name: string; quantity: number; price: number }[]"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":2,"source":"/**\r\n * Job Model\r\n * =========\r\n *\r\n * WatermelonDB model for offline job management.\r\n */\r\n\r\nimport { Model } from '@nozbe/watermelondb';\r\nimport { field, date, children, relation } from '@nozbe/watermelondb/decorators';\r\n\r\nexport default class Job extends Model {\r\n  static table = 'jobs';\r\n\r\n  static associations = {\r\n    customers: { type: 'belongs_to' as const, key: 'customer_id' },\r\n    job_photos: { type: 'has_many' as const, foreignKey: 'job_id' },\r\n  };\r\n\r\n  @field('server_id') serverId!: string;\r\n  @field('customer_id') customerId!: string;\r\n  @field('organization_id') organizationId!: string;\r\n  @field('assigned_to_id') assignedToId!: string | null;\r\n  @field('job_number') jobNumber!: string | null;\r\n  @field('title') title!: string | null;\r\n  @field('service_type') serviceType!: string;\r\n  @field('status') status!: string;\r\n  @field('priority') priority!: string;\r\n\r\n  @field('scheduled_start') scheduledStart!: number | null;\r\n  @field('scheduled_end') scheduledEnd!: number | null;\r\n  @field('actual_start') actualStart!: number | null;\r\n  @field('actual_end') actualEnd!: number | null;\r\n  @field('estimated_duration') estimatedDuration!: number | null;\r\n\r\n  @field('address') address!: string;\r\n  @field('latitude') latitude!: number | null;\r\n  @field('longitude') longitude!: number | null;\r\n\r\n  @field('notes') notes!: string | null;\r\n  @field('internal_notes') internalNotes!: string | null;\r\n  @field('completion_notes') completionNotes!: string | null;\r\n  @field('materials_used') materialsUsed!: string | null;\r\n  @field('signature_url') signatureUrl!: string | null;\r\n\r\n  @field('subtotal') subtotal!: number | null;\r\n  @field('tax') tax!: number | null;\r\n  @field('total') total!: number | null;\r\n\r\n  @date('created_at') createdAt!: Date;\r\n  @date('updated_at') updatedAt!: Date;\r\n  @field('synced_at') syncedAt!: number | null;\r\n  @field('is_dirty') isDirty!: boolean;\r\n\r\n  // Per-visit pricing fields (Phase 1 - Jan 2026)\r\n  @field('pricing_mode') pricingMode!: string | null; // FIXED_TOTAL, PER_VISIT, HYBRID\r\n  @field('default_visit_rate') defaultVisitRate!: number | null;\r\n  @field('estimated_total') estimatedTotal!: number | null;\r\n  @field('current_visit_index') currentVisitIndex!: number | null;\r\n  @field('visit_estimated_price') visitEstimatedPrice!: number | null;\r\n  @field('visit_actual_price') visitActualPrice!: number | null;\r\n  @field('price_variance_reason') priceVarianceReason!: string | null;\r\n\r\n  @relation('customers', 'customer_id') customer!: any;\r\n  @children('job_photos') photos!: any;\r\n\r\n  // Computed property for customer name (cached from server sync)\r\n  @field('customer_name') customerName!: string | null;\r\n\r\n  // Computed properties\r\n  get scheduledStartDate(): Date | null {\r\n    return this.scheduledStart ? new Date(this.scheduledStart) : null;\r\n  }\r\n\r\n  get scheduledEndDate(): Date | null {\r\n    return this.scheduledEnd ? new Date(this.scheduledEnd) : null;\r\n  }\r\n\r\n  // Alias for backward compatibility\r\n  get scheduledDate(): number | null {\r\n    return this.scheduledStart;\r\n  }\r\n\r\n  get parsedMaterialsUsed(): Array<{ name: string; quantity: number; price: number }> {\r\n    if (!this.materialsUsed) return [];\r\n    try {\r\n      return JSON.parse(this.materialsUsed);\r\n    } catch {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  get isPending(): boolean {\r\n    return this.status === 'pending';\r\n  }\r\n\r\n  get isScheduled(): boolean {\r\n    return this.status === 'scheduled';\r\n  }\r\n\r\n  get isInProgress(): boolean {\r\n    return this.status === 'en_camino' || this.status === 'working';\r\n  }\r\n\r\n  get isCompleted(): boolean {\r\n    return this.status === 'completed';\r\n  }\r\n\r\n  get isCancelled(): boolean {\r\n    return this.status === 'cancelled';\r\n  }\r\n\r\n  get canStart(): boolean {\r\n    return this.status === 'scheduled';\r\n  }\r\n\r\n  get canComplete(): boolean {\r\n    return this.status === 'working';\r\n  }\r\n\r\n  // Per-visit pricing computed properties (Phase 1 - Jan 2026)\r\n  get isPerVisitPricing(): boolean {\r\n    return this.pricingMode === 'PER_VISIT' || this.pricingMode === 'HYBRID';\r\n  }\r\n\r\n  get effectiveVisitPrice(): number {\r\n    // Use actual price if set, otherwise estimated, otherwise default rate\r\n    if (this.visitActualPrice !== null) return this.visitActualPrice;\r\n    if (this.visitEstimatedPrice !== null) return this.visitEstimatedPrice;\r\n    if (this.defaultVisitRate !== null) return this.defaultVisitRate;\r\n    return 0;\r\n  }\r\n\r\n  // Status transition methods\r\n  async startJob() {\r\n    await this.update((job) => {\r\n      job.status = 'en_camino';\r\n      job.actualStart = Date.now();\r\n      job.isDirty = true;\r\n    });\r\n  }\r\n\r\n  async arriveAtJob() {\r\n    await this.update((job) => {\r\n      job.status = 'working';\r\n      job.isDirty = true;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Complete job with support for per-visit pricing\r\n   * @param notes - Completion notes\r\n   * @param materials - Materials used\r\n   * @param signatureUrl - Optional signature URL\r\n   * @param visitPricing - Optional per-visit pricing data (Phase 1 - Jan 2026)\r\n   */\r\n  async completeJob(\r\n    notes: string,\r\n    materials: Array<{ name: string; quantity: number; price: number }>,\r\n    signatureUrl?: string,\r\n    visitPricing?: {\r\n      actualPrice?: number;\r\n      priceVarianceReason?: string;\r\n    }\r\n  ) {\r\n    const subtotal = materials.reduce((sum, m) => sum + m.quantity * m.price, 0);\r\n    const tax = subtotal * 0.21; // 21% IVA\r\n    const total = subtotal + tax;\r\n\r\n    await this.update((job) => {\r\n      job.status = 'completed';\r\n      job.actualEnd = Date.now();\r\n      job.completionNotes = notes;\r\n      job.materialsUsed = JSON.stringify(materials);\r\n      job.signatureUrl = signatureUrl || null;\r\n      job.subtotal = subtotal;\r\n      job.tax = tax;\r\n      job.total = total;\r\n      job.isDirty = true;\r\n\r\n      // Per-visit pricing (Phase 1 - Jan 2026)\r\n      if (visitPricing) {\r\n        if (visitPricing.actualPrice !== undefined) {\r\n          job.visitActualPrice = visitPricing.actualPrice;\r\n        }\r\n        if (visitPricing.priceVarianceReason) {\r\n          job.priceVarianceReason = visitPricing.priceVarianceReason;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  async cancelJob(reason: string) {\r\n    await this.update((job) => {\r\n      job.status = 'cancelled';\r\n      job.completionNotes = reason;\r\n      job.isDirty = true;\r\n    });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\models\\JobPhoto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\models\\PendingStockDeduction.ts","messages":[{"ruleId":"@typescript-eslint/array-type","severity":1,"message":"Array type using 'Array<T>' is forbidden. Use 'T[]' instead.","line":38,"column":24,"nodeType":"TSTypeReference","messageId":"errorStringArray","endLine":38,"endColumn":91,"fix":{"range":[1314,1381],"text":"{ productId: string; productName: string; quantity: number }[]"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\r\n * PendingStockDeduction Model\r\n * ===========================\r\n * \r\n * Phase 2.2.4.4: Offline Queue for Scanned Items\r\n * \r\n * Stores material usage records that are pending sync to the server.\r\n * These are created when a technician records material usage (scan + deduct)\r\n * and are synced to the cascade API when online.\r\n */\r\n\r\nimport { Model } from '@nozbe/watermelondb';\r\nimport { field, date, readonly } from '@nozbe/watermelondb/decorators';\r\n\r\nexport default class PendingStockDeduction extends Model {\r\n    static table = 'pending_stock_deductions';\r\n\r\n    // Job reference\r\n    @field('job_id') jobId!: string;\r\n    @field('job_number') jobNumber!: string;\r\n\r\n    // Items to deduct (JSON array of { productId, productName, quantity })\r\n    @field('items') items!: string;\r\n\r\n    // Optional notes\r\n    @field('notes') notes!: string | null;\r\n\r\n    // Sync status (renamed from syncStatus to avoid conflict with WatermelonDB base Model)\r\n    @field('deduction_status') deductionStatus!: 'pending' | 'syncing' | 'synced' | 'failed';\r\n    @field('sync_error') syncError!: string | null;\r\n    @field('retry_count') retryCount!: number;\r\n\r\n    // Timestamps\r\n    @readonly @date('created_at') createdAt!: Date;\r\n    @date('synced_at') syncedAt!: Date | null;\r\n\r\n    // Getters\r\n    get parsedItems(): Array<{ productId: string; productName: string; quantity: number }> {\r\n        try {\r\n            return JSON.parse(this.items);\r\n        } catch {\r\n            return [];\r\n        }\r\n    }\r\n\r\n    get itemCount(): number {\r\n        return this.parsedItems.length;\r\n    }\r\n\r\n    get totalQuantity(): number {\r\n        return this.parsedItems.reduce((sum, item) => sum + item.quantity, 0);\r\n    }\r\n\r\n    get isPending(): boolean {\r\n        return this.deductionStatus === 'pending';\r\n    }\r\n\r\n    get isSyncing(): boolean {\r\n        return this.deductionStatus === 'syncing';\r\n    }\r\n\r\n    get hasFailed(): boolean {\r\n        return this.deductionStatus === 'failed';\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\models\\PriceBookItem.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\models\\Product.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'json' is defined but never used.","line":9,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Product Model\r\n * =============\r\n *\r\n * Local model for products/materials available to technicians.\r\n */\r\n\r\nimport { Model } from '@nozbe/watermelondb';\r\nimport { field, date, readonly, json } from '@nozbe/watermelondb/decorators';\r\n\r\nexport default class Product extends Model {\r\n  static table = 'products';\r\n\r\n  @field('server_id') serverId!: string;\r\n  @field('organization_id') organizationId!: string;\r\n  @field('sku') sku!: string;\r\n  @field('barcode') barcode!: string | null;\r\n  @field('name') name!: string;\r\n  @field('description') description!: string | null;\r\n  @field('category_name') categoryName!: string | null;\r\n  @field('unit_of_measure') unitOfMeasure!: string;\r\n  @field('sale_price') salePrice!: number;\r\n  @field('cost_price') costPrice!: number;\r\n  @field('is_active') isActive!: boolean;\r\n  @field('track_inventory') trackInventory!: boolean;\r\n  @field('image_url') imageUrl!: string | null;\r\n  @readonly @date('synced_at') syncedAt!: Date | null;\r\n  @readonly @date('updated_at') updatedAt!: Date;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\models\\ReplenishmentRequest.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\models\\SyncConflict.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\models\\SyncQueue.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\models\\UserSession.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\models\\VehicleStock.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'children' is defined but never used.","line":9,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'relation' is defined but never used.","line":9,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * VehicleStock Model\r\n * ==================\r\n *\r\n * Local model for technician vehicle inventory.\r\n */\r\n\r\nimport { Model } from '@nozbe/watermelondb';\r\nimport { field, date, readonly, children, relation } from '@nozbe/watermelondb/decorators';\r\n\r\nexport default class VehicleStock extends Model {\r\n  static table = 'vehicle_stock';\r\n\r\n  static associations = {\r\n    products: { type: 'belongs_to' as const, key: 'product_id' },\r\n  };\r\n\r\n  @field('server_id') serverId!: string;\r\n  @field('vehicle_id') vehicleId!: string;\r\n  @field('product_id') productId!: string;\r\n  @field('product_name') productName!: string;\r\n  @field('product_sku') productSku!: string;\r\n  @field('quantity') quantity!: number;\r\n  @field('min_quantity') minQuantity!: number;\r\n  @field('max_quantity') maxQuantity!: number;\r\n  @field('unit_cost') unitCost!: number;\r\n  @field('needs_replenishment') needsReplenishment!: boolean;\r\n  @readonly @date('synced_at') syncedAt!: Date | null;\r\n  @readonly @date('updated_at') updatedAt!: Date;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\models\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\watermelon\\schema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\CampoTech\\apps\\mobile\\web-mocks\\react-native-maps.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
